<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6. Аргумент комплексного числа</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Ваш CSS залишається без змін */
        *, *:before, *:after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        .figure {
            display: block;
            margin: 10px auto;
            max-width: 100%;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            object-fit: contain;
        }
        .figure.figure-2-2 {
            width: 180px;
            height: 180px;
        }
        .figure.figure-2-3 {
            width: 320px;
            height: 230px;
        }
        .figure.figure-2-4 {
            width: 170px;
            height: 170px;
        }
        .figure.figure-2-5 {
            width: 170px;
            height: 170px;
        }
        .figure.figure-2-6 {
            width: 200px;
            height: 200px;
        }
        .figure.figure-2-7 {
            width: 190px;
            height: 190px;
        }
        .figure.figure-2-8 {
            width: 170px;
            height: 170px;
        }
        .figure.figure-2-9 {
            width: 190px;
            height: 190px;
        }
        .figure.figure-2-10 {
            width: 190px;
            height: 170px;
        }
        .figure.figure-2-11 {
            width: 190px;
            height: 170px;
        }
        .figure.figure-2-12 {
            width: 170px;
            height: 160px;
        }
        .quadrant-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 40px;
            justify-content: center;
            align-items: center;
            text-align: center;
            list-style: none;
            padding: 0;
            margin: 20px auto;
            max-width: 600px;
        }
        .quadrant-list li {
            background: #1e3a8a;
            color: #fff;
            padding: 10px 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        body {
            background: linear-gradient(135deg, #1e1b4b, #2c2a6b);
            font-family: 'Inter', sans-serif;
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: linear-gradient(135deg, #2c2a6b, #4338ca);
            border-radius: 25px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5), inset 0 0 8px rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        .title-box h1 {
            font-size: 28px;
            color: #ffff00;
            text-shadow: 0 0 8px rgba(236, 72, 153, 0.5);
            font-weight: 800;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: linear-gradient(135deg, #2c2a6b, #4f46e5);
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), inset 0 0 6px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: inherit;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        .section:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(236, 72, 153, 0.2);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 4px rgba(236, 72, 153, 0.3));
        }
        .section h2 {
            font-size: clamp(16px, 2.5vw, 18px);
            color: #e5e7eb;
            font-weight: 600;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 95%;
            max-width: 95vw;
            height: 95vh;
            max-height: 95vh;
            background: linear-gradient(135deg, #1e1b4b, #2c2a6b);
            z-index: 1001;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            transition: opacity 0.25s ease, transform 0.25s ease;
            opacity: 0;
            border-radius: 15px;
            overflow: hidden;
            transform: translateZ(0);
        }
        .modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        .modal-header {
            background: linear-gradient(90deg, #2c2a6b, #4338ca);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
        }
        .close-btn {
            background: #f984e5;
            color: #1e1b4b;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .close-btn:hover {
            background: #db2777;
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: linear-gradient(135deg, #a78bfa, #4f46e5);
            border-radius: 10px;
            margin: 10px;
            color: #fae2f6;
            width: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(236, 72, 153, 0.5) transparent;
        }
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(236, 72, 153, 0.5);
            border-radius: 3px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(236, 72, 153, 0.8);
        }
        #theoryModal .modal-content p {
            font-size: clamp(16px, 2.8vw, 18px);
            line-height: 1.7;
            text-align: justify;
            max-width: 100%;
        }
        #theoryModal .modal-content ul {
            list-style: none;
            padding-left: 20px;
        }
        #theoryModal .modal-content li {
            color: #e9b1a0;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
        }
        #theoryModal .modal-content li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #00ff88;
            font-size: 16px;
        }
        #theoryModal mjx-container {
            font-size: clamp(18px, 3vw, 20px) !important;
            color: #fef08a !important;
            display: inline-block !important;
            max-width: 100%;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            padding: 5px;
            text-align: center;
        }
        #theoryModal mjx-container.math-notation-centered {
            display: block !important;
            text-align: center !important;
            max-width: 100%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 10px auto;
            max-width: 100%;
            width: fit-content;
            padding: 5px;
            box-sizing: border-box;
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] mjx-mtable {
            display: inline-block;
            text-align: center;
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] mjx-mtag {
            display: inline-block;
            vertical-align: middle;
            margin-left: 5px;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            will-change: opacity;
            transition: opacity 0.25s ease;
            transform: translateZ(0);
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(135deg, #2c2a6b, #4338ca);
            cursor: pointer;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        summary {
            font-weight: 600;
            padding: 10px;
            background: linear-gradient(90deg, #4338ca, #5b21b6);
            border-radius: 8px;
            color: #c6ffe9;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
        }
        summary:hover {
            background: linear-gradient(90deg, #5b21b6, #7c3aed);
        }
        details p {
            padding: 0 20px 10px;
            color: #e5e7eb;
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .video-card {
            width: 300px;
            height: 180px;
            background: linear-gradient(135deg, #4338ca, #5b21b6);
            border-radius: 15px;
            border: 1px solid rgba(236, 72, 153, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #ecec53;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
        }
        .video-player-container {
            max-width: 95%;
            margin: 0 auto;
        }
        .video-player-container iframe {
            width: 100%;
            aspect-ratio: 16 / 9;
            height: auto;
        }
        .glow-title {
            text-align: center;
            font-size: 2em;
            color: #ffff00;
            font-family: 'Verdana', sans-serif;
            text-shadow: 0 0 10px #ffd700, 0 0 20px #ffa500, 0 0 30px #ff0;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #ffd700, 0 0 10px #ffa500;
            }
            to {
                text-shadow: 0 0 20px #ffff33, 0 0 30px #ff9900;
            }
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 95%;
            height: 200px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            will-change: transform;
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 12px;
            border-radius: 15px;
            font-size: clamp(16px, 3vw, 18px);
            line-height: 1.5;
            border: 1px solid rgba(236, 72, 153, 0.3);
            box-sizing: border-box;
        }
        .card-front {
            background: linear-gradient(135deg, #2c2a6b, #4f46e5);
            color: #ffffff;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-wrap: wrap;
            overflow-wrap: break-word;
            word-break: break-word;
            padding: 12px 15px;
            max-width: 100%;
        }
        .card-back {
            background: linear-gradient(135deg, #4338ca, #7c3aed);
            color: #ffffff;
            transform: rotateY(180deg);
            overflow-y: auto;
            overflow-x: hidden;
            text-align: justify;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            word-break: break-word;
            box-sizing: border-box;
            width: 100%;
        }
        #questionsModal mjx-container {
            color: #ffff00 !important;
            font-size: clamp(20px, 2.5vw, 22px) !important;
            max-width: 100%;
            margin: 5px auto;
            padding: 3px;
            box-sizing: border-box;
            overflow: hidden;
            text-shadow: none !important;
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 95%;
            height: 200px;
            overflow: hidden;
        }
        .trainer-container {
    width: 95%;
    max-width: 95%;
    padding: 20px;
    padding-bottom: 40px; /* Додаємо нижній відступ для кнопки */
    text-align: center;
    background: linear-gradient(135deg, #2c2a6b, #4338ca);
    border-radius: 15px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(236, 72, 153, 0.3);
    position: relative; /* Додаємо для кращого контролю позиціонування */
}
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px auto;
            flex-wrap: wrap;
        }
        .nav-button {
            background: linear-gradient(135deg, #2c2a6b, #4338ca);
            color: #ebc0a4;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: clamp(15px, 2.5vw, 17px);
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(236, 72, 153, 0.3);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .nav-button:hover {
            background: linear-gradient(135deg, #4338ca, #5b21b6);
            color: #f9a8d4;
            text-decoration: none;
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
            width: 18px;
            height: 18px;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #fef08a;
            margin-bottom: 20px;
        }
        .trainer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            justify-content: center;
            max-width: 600px;
            margin: 0 auto;
        }
        .trainer-option {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(20px, 3.2vw, 22px);
            text-align: center;
            border: 1px solid rgba(236, 72, 153, 0.3);
            transition: background 0.3s ease;
        }
        .trainer-option:hover {
            background: linear-gradient(135deg, #7c3aed, #a78bfa);
        }
        .trainer-option.selected {
            background: linear-gradient(135deg, #f984e5, #db2777);
        }
        .trainer-submit {
            background: #f984e5;
            color: #1e1b4b;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(16px, 2.5vw, 18px);
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s ease;
        }
        .trainer-submit:hover {
            background: #db2777;
        }
        .trainer-feedback {
            margin-top: 20px;
            font-size: clamp(18px, 3vw, 20px);
            color: #fef08a;
        }
            .question-circle {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #4338ca, #7c3aed);
            border-radius: 60%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ffff00;
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
            margin: 0 auto 20px;
            border: 1px solid rgba(236, 72, 153, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
            #complexPlaneCanvas {
    display: block;
    margin: 20px auto;
    border: 1px solid rgba(236, 72, 153, 0.3);
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    width: 250px; /* Фіксована ширина */
    height: 250px; /* Фіксована висота */
}
.feedback {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    border-radius: 10px;
    color: #fff;
    font-size: clamp(18px, 3vw, 20px);
    font-weight: 600;
    text-align: center;
    z-index: 1002;
    opacity: 0;
    transition: opacity 0.3s ease;
    max-width: 80%;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(236, 72, 153, 0.3);
}

.correct-feedback {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.5);
    opacity: 1;
}

.incorrect-feedback {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
    opacity: 1;
}

.feedback.show {
    opacity: 1;
}

.completion-emoji {
    font-size: 60px;
    text-align: center;
    margin-bottom: 10px;
}

.completion-message {
    text-align: center;
}

.completion-message h2 {
    font-size: clamp(20px, 3.5vw, 24px);
    color: #fef08a;
    margin-bottom: 10px;
}

.completion-message p {
    font-size: clamp(16px, 2.5vw, 18px);
    color: #e5e7eb;
    margin-bottom: 20px;
}

.completion-message button {
    background: #f984e5;
    color: #1e1b4b;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: clamp(16px, 2.5vw, 18px);
    cursor: pointer;
    transition: background 0.3s ease;
}

.completion-message button:hover {
    background: #db2777;
}

            
        @media (max-width: 768px) {
            .figure.figure-2-2 {
                width: 180px;
                height: 180px;
            }
            .figure.figure-2-3 {
                width: 320px;
                height: 260px;
            }
            .figure.figure-2-4 {
                width: 190px;
                height: 170px;
            }
            .figure.figure-2-5 {
                width: 170px;
                height: 170px;
            }
            .figure.figure-2-6 {
                width: 220px;
                height: 200px;
            }
            .figure.figure-2-7 {
                width: 190px;
                height: 190px;
            }
            .figure.figure-2-8 {
                width: 160px;
                height: 160px;
            }
            .figure.figure-2-9 {
                width: 180px;
                height: 180px;
            }
            .figure.figure-2-10 {
                width: 180px;
                height: 180px;
            }
            .figure.figure-2-11 {
                width: 180px;
                height: 170px;
            }
            .figure.figure-2-12 {
                width: 170px;
                height: 160px;
            }
            .title-box {
                margin-top: 20px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            .section {
                width: 80%;
                height: 200px;
            }
            .quadrant-list {
                display: flex;
                flex-direction: column;
                gap: 15px;
                max-width: 100%;
            }
            .quadrant-list li {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                padding: 12px;
                font-size: clamp(14px, 2.5vw, 16px);
                width: 85%;
                max-width: 400px;
                margin: 0 auto;
            }
            .quadrant-list li .condition {
                display: inline;
                margin-left: 10px;
                font-size: clamp(13px, 2.3vw, 15px);
                color: #fef08a;
            }
            .modal-content {
                padding: 15px;
            }
            #theoryModal details:nth-child(3) .modal-content {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100%;
                box-sizing: border-box;
            }
            #theoryModal details:nth-child(3) p {
                white-space: normal !important;
                overflow-x: visible !important;
                display: block !important;
                min-width: 0 !important;
                max-width: 100% !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            #theoryModal details:nth-child(3) p mjx-container {
                display: inline-block !important;
                white-space: nowrap !important;
                vertical-align: middle !important;
                min-width: auto !important;
            }
            #theoryModal details:nth-child(3) {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
                width: 100% !important;
            }

#theoryModal .modal-content ul {
        padding-left: 15px; /* Зменшуємо відступ списку */
    }
    #theoryModal .modal-content li {
        padding-left: 15px; /* Зменшуємо відступ елементів списку */
        margin-left: 10px; /* Зменшуємо лівий відступ */
        font-size: clamp(15px, 3vw, 16px); /* Зменшуємо розмір шрифту для списків */
    }
    #theoryModal .modal-content li::before {
        font-size: 14px; /* Зменшуємо розмір маркера */
        left: -1px; /* Зміщуємо маркер ближче до тексту */
    }

            
            details:nth-child(3) .modal-content p::-webkit-scrollbar {
                height: 8px;
            }
            details:nth-child(3) .modal-content p::-webkit-scrollbar-thumb {
                background-color: #800000;
                border-radius: 4px;
            }
            details:nth-child(3) .modal-content p::-webkit-scrollbar-track {
                background-color: #f0f0f0;
            }
            .resizable-image {
                max-width: 100%;
            }
            .video-card {
                width: 300px;
                height: 200px;
            }
            .video-player-container {
                max-width: 95%;
            }
            .question-card {
                height: 160px;
                margin: 15px auto;
            }
            .card-front, .card-back {
                font-size: clamp(14px, 2.5vw, 16px);
                padding: 15px;
            }
            .trainer-container {
                padding: 15px;
            }
           .trainer-options {
        grid-template-columns: 1fr 1fr; /* Залишаємо два стовпці */
        gap: 8px;
    }
    .trainer-option {
        font-size: clamp(17px, 3vw, 18px);
        padding: 8px;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
    }
            #complexPlaneCanvas {
    
    width: 200px; /* Фіксована ширина */
    height: 200px; /* Фіксована висота */
}
            .question-circle {
                width: 80px;
                height: 80px;
                font-size: clamp(14px, 2.3vw, 16px);
            }
        }
        @media (max-width: 480px) {
            .section {
                width: 90%;
                height: 170px;
            }
            .section img {
                width: 40px;
                height: 40px;
            }
            .section h2 {
                font-size: 17px;
            }
            .modal-content {
                padding: 10px;
            }
            .video-card {
                width: 260px;
                height: 200px;
            }
            .question-card {
                height: 140px;
            }
            .card-front, .card-back {
                font-size: clamp(13px, 2.3vw, 15px);
                padding: 10px;
            }
            .question-circle {
                width: 75px;
                height: 75px;
                font-size: clamp(13px, 2.2vw, 15px);
            }
            .trainer-options {
        grid-template-columns: 1fr; /* Один стовпець для дуже малих екранів */
)
 .trainer-option {
        font-size: clamp(16px, 3vw, 17px); /* Менший розмір шрифту */
        padding: 6px; /* Зменшуємо відступи для компактності */
    }
            
#theoryModal .modal-content ul {
        padding-left: 15px; /* Зменшуємо відступ списку */
    }
    #theoryModal .modal-content li {
        padding-left: 15px; /* Зменшуємо відступ елементів списку */
        margin-left: 8px; /* Зменшуємо лівий відступ */
        font-size: clamp(15px, 3vw, 16px); /* Зменшуємо розмір шрифту для списків */
    }
    #theoryModal .modal-content li::before {
        font-size: 14px; /* Зменшуємо розмір маркера */
        left: -1px; /* Зміщуємо маркер ближче до тексту */
    }
            
            #complexPlaneCanvas {
        width: 180px;
        height: 180px;
    }
        }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>6. Аргумент комплексного числа</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
       <a class="nav-button" href='tema2.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 2
        </a>
        <a class="nav-button" href='index.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>

    <div id="modalOverlay"></div>

    <div id="theoryModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <details>
                <summary>Головне значення аргументу</summary>
                <p>
                    Комплексні числа, які мають однаковий модуль \( r \), розташовуються на колі радіусом \( r \) з центром у початку координат \( O(0;0) \) на комплексній площині. Це означає, що для кожного фіксованого значення модуля \( r \) існує нескінченна кількість комплексних чисел, які визначаються напрямком вектора, що відповідає числу \( z \) (рис. 2.2). Напрямок цього вектора визначається кутом \( φ \), який називають аргументом (\( \arg z \)) комплексного числа \( z = a + bi \).
                </p>
                <img src="static/figure2.2.jpg" alt="Рисунок 2.2" class="figure figure-2-2" />
                <p>
                    Аргумент \( φ \) – це кут між додатною віссю \( x \) і вектором, що відповідає числу \( z \). Аргумент може бути додатним (якщо кут відкладено проти годинникової стрілки від осі \( x \)) або від’ємним (якщо за годинниковою стрілкою). Для спрощення обчислень і графічного зображення використовують головне значення аргументу, яке належить інтервалу \( (-\pi, \pi] \).
                </p>
                <p>
                    Аргумент обчислюється як:
                </p>
                <p class="math-notation-centered">
                    \[ φ = \text{arctg}\left(\frac{b}{a}\right) \tag{2.3} \]
                </p>
                <p>
                    де \( a \) – дійсна частина, а \( b \) – уявна частина комплексного числа \( z \). Але його точне значення залежить від координатної чверті, у якій розташовано число \( z \), і визначається за такими правилами:
                </p>
                <ul>
                    <li>Для І чверті (\( a > 0, b > 0 \)): \( φ = \text{arctg}\left(\frac{b}{a}\right) \).</li>
                    <li>Для ІІ чверті (\( a < 0, b > 0 \)): \( φ= \text{arctg}\left(\frac{b}{a}\right) + \pi \).</li>
                    <li>Для ІІІ чверті (\( a < 0, b < 0 \)): \( φ = \text{arctg}\left(\frac{b}{a}\right) - \pi \).</li>
                    <li>Для IV чверті (\( a > 0, b < 0 \)): \( φ = \text{arctg}\left(\frac{b}{a}\right) \).</li>
                </ul>
                <p>
                    Цей підхід спрощує обчислення головного значення аргументу комплексного числа, забезпечуючи чіткі формули для кожної координатної чверті комплексної площини.
                </p>
            </details>
            <details>
                <summary>
                    Алгоритм обчислення головного значення аргументу комплексного числа 
                    <span style="color: orange;">z = a + bi</span>, де 
                    <span style="color: orange;">z ≠ 0</span>
                </summary>
                <p>
                    Для обчислення головного значення аргументу комплексного числа \( z = a + bi \), де \( z \neq 0 \), виконайте наступні кроки:
                </p>
                <ol>
                    <p><span style="color: orange;">1.</span> Визначити дійсну (\( a \)) і уявну (\( b \)) частини числа \( z \). </p>
                    <p><span style="color: orange;">2.</span> Визначити, у якій координатній чверті комплексної площини розташоване число \( z \), на основі знаків \( a \) і \( b \):</p>
                    <ul class="quadrant-list">
                        <li>І чверть <span class="condition">(\( a > 0, b > 0 \))</span></li>
                        <li>ІІ чверть <span class="condition">(\( a < 0, b > 0 \))</span></li>
                        <li>ІІІ чверть <span class="condition">(\( a < 0, b < 0 \))</span></li>
                        <li>IV чверть <span class="condition">(\( a > 0, b < 0 \))</span></li>
                    </ul>
                    <p><span style="color: orange;">3.</span> Обчислити головне значення аргументу \( φ\), використовуючи відповідну формулу з корекцією за чвертями (рис. 2.3).</p>
                    <img src="static/figure2.3.jpg" alt="Рисунок 2.3" class="figure figure-2-3" />
                </ol>
                <p>
                    У випадках, коли одна з компонент (\( a \) або \( b \)) комплексного числа \( z = a + bi \) дорівнює нулю, головне значення аргументу \( φ \) обчислюється за такими правилами:
                </p>
                <ol>
                    <p><span style="color: orange;">1) Для дійсних чисел </span>(\( b = 0 \), \( z = a \)):</p>
                    <ul>
                        <li>Якщо \( a > 0 \), напрям радіус-вектора числа \( z \) співпадає з напрямом дійсної осі \( x \), то \(φ = 0 \)(рис. 2.4).
                            <img src="static/figure2.4.jpg" alt="Рисунок 2.4" class="figure figure-2-4" />
                        </li>
                        <li>Якщо \( a < 0 \), напрям радіус-вектора числа \( z \) протилежно напрямлений до напряму дійсної осі \( x \), то \( φ = \pi \) (рис. 2.5).
                            <img src="static/figure2.5.jpg" alt="Рисунок 2.5" class="figure figure-2-5" />
                        </li>
                    </ul>
                    <p><span style="color: orange;">2) Для уявних чисел </span>(\( a = 0 \), \( z = bi \)):</p>
                    <ul>
                        <li>Якщо \( b > 0 \), напрям радіус-вектора числа \( z \) співпадає з напрямом уявної осі \( y \), то
                            \( φ = \frac{\pi}{2} \) (рис. 2.6).   
                            <img src="static/figure2.6.jpg" alt="Рисунок 2.6" class="figure figure-2-6" />
                        </li>
                        <li>Якщо \( b < 0 \), напрям радіус-вектора числа \( z \) протилежно напрямлений до напряму уявної осі \( y \), то
                            \( φ = -\frac{\pi}{2} \) (рис. 2.7).
                            <img src="static/figure2.7.jpg" alt="Рисунок 2.7" class="figure figure-2-7" />
                        </li>
                    </ul>
                    <p><span style="color: orange;">3) </span>Якщо \( a = 0 \) і \( b = 0 \), то \( z = 0 \), і його аргумент вважається невизначеним.</p>
                </ol>
                <p>
                    <strong>Примітка.</strong> У цьому посібнику головне значення аргументу комплексного числа \( φ \) обирається в інтервалі \( (-\pi, \pi] \), що відповідає стандартному підходу в комплексному аналізі. Також у деяких задачах чи джерелах використовується інтервал \( [0, 2\pi) \). Обидва варіанти є правильними!
                </p>
            </details>
            <details>
                <summary>Приклади</summary>
                <p><strong><span style="color: orange;">Приклад 2.2.</span></strong> Визначити, в якій координатній чверті комплексної площини знаходяться задані комплексні числа:</p>
                <p>
                    а) \( z_1 = 2 + i \); б) \( z_2 = -2 + 3i \); в) \( z_3 = 2 - 2i \); г) \( z_4 = -2 - i \).
                </p>
                <p>
                    Для визначення координатної чверті, в якій знаходиться комплексне число, потрібно врахувати знаки його дійсної (\( a \)) та уявної (\( b \)) частин:
                </p>
                <ul>
                    <li>
                        а) \( z_1 = 2 + i \): дійсна частина \( a = 2 > 0 \), уявна частина \( b = 1 > 0 \). Отже, число \( z_1 \) знаходиться в І чверті (рис. 2.8).
                        <img src="static/figure2.8.jpg" alt="Рисунок 2.8" class="figure figure-2-8" />
                    </li>
                    <li>
                        б) \( z_2 = -2 + 3i \): дійсна частина \( a = -2 < 0 \), уявна частина \( b = 3 > 0 \). Отже, число \( z_2 \) знаходиться в ІІ чверті (рис. 2.9).
                        <img src="static/figure2.9.jpg" alt="Рисунок 2.9" class="figure figure-2-9" />
                    </li>
                    <li>
                        в) \( z_3 = 2 - 2i \): дійсна частина \( a = 2 > 0 \), уявна частина \( b = -2 < 0 \). Отже, число \( z_3 \) знаходиться в IV чверті (рис. 2.10).
                        <img src="static/figure2.10.jpg" alt="Рисунок 2.10" class="figure figure-2-10" />
                    </li>
                    <li>
                        г) \( z_4 = -2 - i \): дійсна частина \( a = -2 < 0 \), уявна частина \( b = -1 < 0 \). Отже, число \( z_4 \) знаходиться в ІІІ чверті (рис. 2.11).
                        <img src="static/figure2.11.jpg" alt="Рисунок 2.11" class="figure figure-2-11" />
                    </li>
                </ul>
                <p><strong><span style="color: orange;">Приклад 2.3.</span></strong> Знайти аргументи комплексних чисел:</p>
                <p>
                    а) \( z = 8 \); б) \( z = -2i \); в) \( z = 2 - 2i \).
                </p>
                <ul>
                    <li>
                        а) \( z = 8 \): дійсна частина \( a = 8 > 0 \), уявна частина \( b = 0 \). Радіус-вектор даного числа \( z \) розташований на дійсній осі, і їхні напрями співпадають, отже
                        <p class="math-notation-centered">
                            \[ φ= 0 .\]
                        </p>
                    </li>
                    <li>
                        б) \( z = -2i \): дійсна частина \( a = 0 \), уявна частина \( b = -2 < 0 \). Радіус-вектор числа \( z \) розташований на осі \( Oy \) і направлений протилежно до неї, отже
                        <p class="math-notation-centered">
                            \[ φ = -\frac{\pi}{2} .\]
                        </p>
                    </li>
                    <li>
                        в) \( z = 2 - 2i \): дійсна частина \( a = 2 > 0 \), уявна частина \( b = -2 < 0 \). Радіус-вектор, що відповідає числу \( z \), зображений на рисунку 2.8. Комплексне число розташоване в IV координатній чверті комплексної площини. Щоб обчислити головне значення аргументу \( φ \), використаємо формулу для IV чверті:
                        <p class="math-notation-centered">
                            \[ φ = \text{arctg}\left(\frac{b}{a}\right) = \text{arctg}\left(\frac{-2}{2}\right) =  -\text{arctg}(1) = -\frac{\pi}{4} .\]
                        </p>
                        <img src="static/figure2.12.jpg" alt="Рисунок 2.12" class="figure figure-2-12" />
                        <p>Відповідь: \( φ = -\frac{\pi}{4} \).</p>
                    </li>
                </ul>
                <p>
                    <strong>Примітка.</strong> Функція \( y = \text{arctg}(x) \) є непарною функцією, тобто \( \text{arctg}(-x) = -\text{arctg}(x) \). Ця властивість спрощує обчислення аргументу комплексних чисел, особливо в чвертях, де одна з частин комплексного числа \( z \) (дійсна або уявна) від’ємна. Надалі ми застосовуватимемо цю властивість, але не згадуватимемо її повторно, якщо не вказано інше.
                </p>
            </details>
        </div>
    </div>

    <div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 class="glow-title">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Модуль та аргумент комплексного числа</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Argument of z</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal1" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" width="100%" src="https://www.youtube.com/embed/BXQD38Y26uM?rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal2" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer2" width="100%" src="https://www.youtube.com/embed/3f2R9shnoGI?rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="questionsModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeQuestionsBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="question-card" style="--i: 1;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>1. Що таке аргумент комплексного числа?</p>
                    </div>
                    <div class="card-back">
                        <p>Аргумент комплексного числа — це кут \( φ \) між додатною віссю \( x \) та радіус-вектором, що відповідає числу \( z = a + bi \) на комплексній площині.</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 2;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>2. У якому інтервалі беруть головне значення аргументу?</p>
                    </div>
                    <div class="card-back">
                        <p>Головне значення аргументу \(φ \) беруть в інтервалі \( (-\pi; \pi] \). У деяких задачах також використовують інтервал \( [0; 2\pi) \) — обидва варіанти правильні.</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 3;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>3. Як знайти аргумент комплексного числа, записаного в алгебраїчній формі?</p>
                    </div>
                    <div class="card-back">
                        <p>Знаходять за формулою \( φ= \text{arctg}\left(\frac{b}{a}\right) \), з урахуванням знаків \( a \) і \( b \), які визначають координатну чверть. Формула коригується додаванням або відніманням \( \pi \), залежно від чверті, у якій розташоване число.</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 4;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>4. Яке головне значення аргументу дійсного числа \( z = a \), де \( b = 0 \)?</p>
                    </div>
                    <div class="card-back">
                        <p>Якщо \( a > 0 \), то \( φ = 0 \); якщо \( a < 0 \), то \( \phi = \pi \).</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 5;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>5. Який аргумент має уявне число \( z = bi \), де \( a = 0 \)?</p>
                    </div>
                    <div class="card-back">
                        <p>Якщо \( b > 0 \), то \( φ= \frac{\pi}{2} \); якщо \( b < 0 \), то \( φ = -\frac{\pi}{2} \).</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 6;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>6. Коли аргумент комплексного числа вважається не визначеним?</p>
                    </div>
                    <div class="card-back">
                        <p>Коли \( z = 0 \), тобто \( a = 0 \) і \( b = 0 \), аргумент не визначається.</p>
                    </div>
                </div>
            </div>
            <div class="question-card" style="--i: 7;">
                <div class="card-inner">
                    <div class="card-front">
                        <p>7. Чому для одного модуля \( r \) існує багато різних чисел \( z \)?</p>
                    </div>
                    <div class="card-back">
                        <p>Бо всі такі числа лежать на колі радіуса \( r \) з центром у початку координат і відрізняються лише напрямком (аргументом).</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="trainerModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeTrainerBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container" id="trainerContent">
            <div class="question-circle" id="questionCircle">Питання 1</div>
            <canvas id="complexPlaneCanvas" width="250" height="250" style="display: none;"></canvas>
            <div class="trainer-question" id="questionText"></div>
            <div class="trainer-options" id="optionsContainer"></div>
            <button class="trainer-submit" id="submitAnswer">Перевірити</button>
            <div class="trainer-feedback" id="feedback"></div>
        </div>
    </div>
</div>

   <script>
    const modals = {
        theory: document.getElementById('theoryModal'),
        video: document.getElementById('videoModal'),
        questions: document.getElementById('questionsModal'),
        trainer: document.getElementById('trainerModal'),
        videoPlayer1: document.getElementById('videoPlayerModal1'),
        videoPlayer2: document.getElementById('videoPlayerModal2')
    };
    const buttons = {
        openTheory: document.getElementById('openTheoryBtn'),
        openVideo: document.getElementById('openVideoBtn'),
        openQuestions: document.getElementById('openQuestionsBtn'),
        openTrainer: document.getElementById('openTrainerBtn'),
        closeTheory: document.getElementById('closeTheoryBtn'),
        closeVideo: document.getElementById('closeVideoBtn'),
        closeQuestions: document.getElementById('closeQuestionsBtn'), // Виправлено ID
        closeTrainer: document.getElementById('closeTrainerBtn'),
        closeVideoPlayer1: document.getElementById('closeVideoPlayerBtn1'),
        closeVideoPlayer2: document.getElementById('closeVideoPlayerBtn2')
    };
    const overlay = document.getElementById('modalOverlay');
    const youtubePlayers = {
        1: document.getElementById('youtubePlayer1'),
        2: document.getElementById('youtubePlayer2')
    };
    let scrollPosition = 0;

    // Перевірка, чи всі елементи знайдені
    Object.entries(buttons).forEach(([key, value]) => {
        if (!value) {
            console.error(`Елемент з ID для ${key} не знайдено!`);
        }
    });
    Object.entries(modals).forEach(([key, value]) => {
        if (!value) {
            console.error(`Модальне вікно ${key} не знайдено!`);
        }
    });

    

    function openModal(modal, btn) {
        if (!modal || !btn) {
            console.error('Помилка: модальне вікно або кнопка не знайдені.');
            return;
        }
        scrollPosition = window.scrollY;
        modal.style.display = 'flex';
        modal.classList.add('show');
        overlay.style.display = 'block';
        overlay.style.opacity = '1';
        document.body.classList.add('modal-open');
        document.body.style.top = `-${scrollPosition}px`;
        btn.setAttribute('aria-pressed', 'true');
        const questionCards = modal.querySelectorAll('.question-card');
        questionCards.forEach(card => {
            card.style.opacity = '1';
        });
        setTimeout(() => {
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                MathJax.typesetPromise().catch(err => {
                    console.error('Помилка MathJax:', err);
                    questionCards.forEach(card => {
                        card.style.opacity = '1';
                    });
                });
            } else {
                console.warn('MathJax не завантажено.');
                questionCards.forEach(card => {
                    card.style.opacity = '1';
                });
            }
        }, 50);
    }

     function closeModal(modal, btn) {
            if (!modal || !btn) return;
            modal.style.display = 'none';
            overlay.style.display = 'none';
            document.body.classList.remove('modal-open');
            btn.setAttribute('aria-pressed', 'false');
            btn.focus();
        }


    function closeVideoPlayerModal(videoModal, player, mainModal, btn) {
        if (player) player.src = player.src; // Скидаємо відео
        if (videoModal) videoModal.style.display = 'none';
        overlay.style.display = 'none';
        openModal(mainModal, btn);
    }

    // Додаємо обробники подій
    if (buttons.openTheory) buttons.openTheory.addEventListener('click', () => openModal(modals.theory, buttons.openTheory));
    if (buttons.openVideo) buttons.openVideo.addEventListener('click', () => openModal(modals.video, buttons.openVideo));
    if (buttons.openQuestions) buttons.openQuestions.addEventListener('click', () => openModal(modals.questions, buttons.openQuestions));
    if (buttons.openTrainer) buttons.openTrainer.addEventListener('click', () => {
        openModal(modals.trainer, buttons.openTrainer);
        currentQuestionNumber = 1;
        generateQuestion();
    });
    if (buttons.closeTheory) buttons.closeTheory.addEventListener('click', () => closeModal(modals.theory, buttons.openTheory));
    if (buttons.closeVideo) buttons.closeVideo.addEventListener('click', () => closeModal(modals.video, buttons.openVideo));
    if (buttons.closeQuestions) buttons.closeQuestions.addEventListener('click', () => closeModal(modals.questions, buttons.openQuestions));
    if (buttons.closeTrainer) buttons.closeTrainer.addEventListener('click', () => closeModal(modals.trainer, buttons.openTrainer));
    if (buttons.closeVideoPlayer1) buttons.closeVideoPlayer1.addEventListener('click', () => closeVideoPlayerModal(modals.videoPlayer1, youtubePlayers[1], modals.video, buttons.openVideo));
    if (buttons.closeVideoPlayer2) buttons.closeVideoPlayer2.addEventListener('click', () => closeVideoPlayerModal(modals.videoPlayer2, youtubePlayers[2], modals.video, buttons.openVideo));

    if (overlay) {
        overlay.addEventListener('click', () => {
            Object.values(modals).forEach(modal => {
                modal.classList.remove('show');
                overlay.style.opacity = '0';
                setTimeout(() => {
                    modal.style.display = 'none';
                    overlay.style.display = 'none';
                    document.body.classList.remove('modal-open');
                    document.body.style.top = '';
                    window.scrollTo(0, scrollPosition);
                }, 250);
            });
        });
    }

    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoId = card.dataset.video;
            openModal(modals[`videoPlayer${videoId}`], buttons.openVideo);
        });
    });

    document.querySelectorAll('.card-inner').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('flipped');
            setTimeout(() => {
                if (typeof MathJax !== 'undefined') {
                    MathJax.typesetPromise();
                }
            }, 600);
        });
    });
// Додатковий обробник для <details>
document.addEventListener('DOMContentLoaded', () => {
    const detailsElements = document.querySelectorAll('details');
    detailsElements.forEach(details => {
        details.addEventListener('toggle', () => {
            if (modals.theory.style.display === 'flex') {
                adjustModalHeight(modals.theory);
            }
        });
    });
});


  // Логіка тренажера
let currentAnswer = null;
let selectedOption = null;
let currentQuestionNumber = 1;

function showFeedback(message, isCorrect, callback) {
    const feedbackDiv = document.createElement('div');
    feedbackDiv.className = `feedback ${isCorrect ? 'correct-feedback' : 'incorrect-feedback'}`;
    feedbackDiv.innerHTML = message;
    document.body.appendChild(feedbackDiv);
    setTimeout(() => {
        feedbackDiv.classList.add('show');
    }, 50);
    setTimeout(() => {
        feedbackDiv.remove();
        if (callback) callback();
    }, 1500);
}

    function generateNumber() {
        const isIrrational = Math.random() < 0.3;
        if (isIrrational) {
            const roots = [2, 3, 5, 7];
            const k = roots[Math.floor(Math.random() * roots.length)];
            const sign = Math.random() < 0.5 ? -1 : 1;
            return { value: sign * Math.sqrt(k), display: `${sign === -1 ? '-' : ''}\\sqrt{${k}}` };
        } else {
            let num = Math.floor(Math.random() * 40) - 20;
            while (num === 0) num = Math.floor(Math.random() * 40) - 20;
            return { value: num, display: `${num}` };
        }
    }

    function isSquare(n) {
        const sqrt = Math.sqrt(Math.abs(n));
        return Math.abs(sqrt - Math.floor(sqrt)) < 0.0001;
    }

    function formatNumber(value) {
        if (Number.isInteger(value)) {
            return `${value}`;
        }
        const root = value * value;
        if (Math.abs(root - Math.round(root)) < 0.01) {
            const sign = value < 0 ? '-' : '';
            return `${sign}\\sqrt{${Math.round(root)}}`;
        }
        return `${Math.round(value)}`; // Округлення до цілого
    }

    function formatPhi(phi) {
    const phiValues = [
        { value: Math.PI / 4, display: '\\frac{\\pi}{4}' },
        { value: -Math.PI / 4, display: '-\\frac{\\pi}{4}' },
        { value: Math.PI / 3, display: '\\frac{\\pi}{3}' },
        { value: -Math.PI / 3, display: '-\\frac{\\pi}{3}' },
        { value: Math.PI / 6, display: '\\frac{\\pi}{6}' },
        { value: -Math.PI / 6, display: '-\\frac{\\pi}{6}' },
        { value: 2 * Math.PI / 3, display: '\\frac{2\\pi}{3}' }, // Додано
        { value: -2 * Math.PI / 3, display: '-\\frac{2\\pi}{3}' }, // Додано
        { value: 3 * Math.PI / 4, display: '\\frac{3\\pi}{4}' },
        { value: -3 * Math.PI / 4, display: '-\\frac{3\\pi}{4}' },
        { value: 5 * Math.PI / 6, display: '\\frac{5\\pi}{6}' },
        { value: -5 * Math.PI / 6, display: '-\\frac{5\\pi}{6}' },
        { value: 0, display: '0' },
        { value: Math.PI / 2, display: '\\frac{\\pi}{2}' },
        { value: -Math.PI / 2, display: '-\\frac{\\pi}{2}' }
    ];
    const match = phiValues.find(p => Math.abs(p.value - phi) < 0.0001);
    return match ? match.display : phi.toFixed(2);
}

function generateQuestion1() {
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const feedback = document.getElementById('feedback');
    const canvas = document.getElementById('complexPlaneCanvas');

    if (!questionText || !optionsContainer || !feedback || !canvas) {
        console.error('Елементи для питання 1 не знайдені!');
        return;
    }

    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';
    canvas.style.display = 'none';

    // Генерація комплексного числа
    const scale = Math.floor(Math.random() * 5) + 1; // Масштаб від 1 до 5
    const aSign = Math.random() < 0.5 ? -1 : 1;
    const bSign = Math.random() < 0.5 ? -1 : 1;
    const a = aSign * scale;
    const b = bSign * scale;
    const aDisplay = a < 0 ? `-${scale}` : `${scale}`;
    const bDisplay = b < 0 ? `-${scale}` : `${scale}`;
    let zDisplay = Math.abs(b) === 1 ? `${aDisplay} ${b < 0 ? '-' : '+'} i` : `${aDisplay} ${b < 0 ? '-' : '+'} ${bDisplay.replace('-', '')}i`;

    // Визначення правильної чверті
    let correctQuadrant;
    if (a > 0 && b > 0) correctQuadrant = 1;
    else if (a < 0 && b > 0) correctQuadrant = 2;
    else if (a < 0 && b < 0) correctQuadrant = 3;
    else if (a > 0 && b < 0) correctQuadrant = 4;

    const possibleAnswers = [
        { value: 1, display: 'I чверть' },
        { value: 2, display: 'II чверть' },
        { value: 3, display: 'III чверть' },
        { value: 4, display: 'IV чверть' }
    ];
    const shuffledAnswers = possibleAnswers.sort(() => Math.random() - 0.5);

    currentAnswer = correctQuadrant;
    questionText.innerHTML = `У якій координатній чверті розташовано комплексне число \\( z = ${zDisplay} \\)?`;
    optionsContainer.innerHTML = '';
    shuffledAnswers.forEach(ans => {
        const option = document.createElement('div');
        option.className = 'trainer-option';
        option.innerHTML = ans.display;
        option.dataset.value = ans.value;
        option.addEventListener('click', () => {
            document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            selectedOption = ans.value;
        });
        optionsContainer.appendChild(option);
    });

    document.getElementById('questionCircle').innerText = 'Питання 1';
    feedback.innerText = '';
    selectedOption = null;

    waitForMathJax().then(() => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            MathJax.typesetPromise([document.getElementById('trainerContent')]).then(() => {
                questionText.style.display = 'block';
                optionsContainer.style.display = 'grid';
            }).catch(err => console.error('Помилка MathJax:', err));
        }
    });
}


    function generateQuestion2() {
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';

    const isReal = Math.random() < 0.5;
    let z, phi, zDisplay;
    if (isReal) {
        const num = generateNumber();
        z = { a: num.value, b: 0 };
        zDisplay = num.display;
        phi = z.a > 0 ? 0 : Math.PI;
    } else {
        const num = generateNumber();
        z = { a: 0, b: num.value };
        zDisplay = `${num.display}i`;
        phi = z.b > 0 ? Math.PI / 2 : -Math.PI / 2;
    }

    let phiDisplay;
    if (phi === 0) phiDisplay = '0';
    else if (phi === Math.PI) phiDisplay = '\\pi';
    else if (phi === Math.PI / 2) phiDisplay = '\\frac{\\pi}{2}';
    else if (phi === -Math.PI / 2) phiDisplay = '-\\frac{\\pi}{2}';

    const possibleAnswers = [
        { value: 0, display: '0' },
        { value: Math.PI, display: '\\pi' },
        { value: Math.PI / 2, display: '\\frac{\\pi}{2}' },
        { value: -Math.PI / 2, display: '-\\frac{\\pi}{2}' },
        { value: Math.PI / 4, display: '\\frac{\\pi}{4}' },
        { value: -Math.PI / 4, display: '-\\frac{\\pi}{4}' },
        { value: 1, display: '1' },
        { value: -1, display: '-1' }
    ].filter(ans => ans.value !== phi);

    const shuffledAnswers = possibleAnswers.sort(() => Math.random() - 0.5).slice(0, 3);
    shuffledAnswers.push({ value: phi, display: phiDisplay });
    shuffledAnswers.sort(() => Math.random() - 0.5);

    currentAnswer = phi;
    document.getElementById('questionText').innerHTML = `Головним значенням аргументу комплексного числа \\( z = ${zDisplay} \\) є:`;
    optionsContainer.innerHTML = '';
    shuffledAnswers.forEach(ans => {
        const option = document.createElement('div');
        option.className = 'trainer-option';
        option.innerHTML = `\\(${ans.display}\\)`;
        option.dataset.value = ans.value;
        option.addEventListener('click', () => {
            document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            selectedOption = ans.value;
        });
        optionsContainer.appendChild(option);
    });

    document.getElementById('questionCircle').innerText = 'Питання 2';
    document.getElementById('feedback').innerText = '';

    waitForMathJax().then(() => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            MathJax.typesetPromise([document.getElementById('trainerContent')]).then(() => {
                questionText.style.display = 'block';
                optionsContainer.style.display = 'grid';
            }).catch(err => console.error('Помилка MathJax:', err));
        }
    });
}

    

      function generateQuestion3() {
    const tangentValues = [
        { tan: 1, phi: Math.PI / 4, phiDisplay: '\\frac{\\pi}{4}', quadrant: 1 }, // I: z = k + ki
        { tan: -1, phi: -Math.PI / 4, phiDisplay: '-\\frac{\\pi}{4}', quadrant: 4 }, // IV: z = k - ki
        { tan: Math.sqrt(3), phi: Math.PI / 3, phiDisplay: '\\frac{\\pi}{3}', quadrant: 1 }, // I: z = k + k\sqrt{3}i
        { tan: -Math.sqrt(3), phi: -Math.PI / 3, phiDisplay: '-\\frac{\\pi}{3}', quadrant: 4 }, // IV: z = k - k\sqrt{3}i
        { tan: 1 / Math.sqrt(3), phi: Math.PI / 6, phiDisplay: '\\frac{\\pi}{6}', quadrant: 1 }, // I: z = k\sqrt{3} + ki
        { tan: -1 / Math.sqrt(3), phi: -Math.PI / 6, phiDisplay: '-\\frac{\\pi}{6}', quadrant: 4 }, // IV: z = k\sqrt{3} - ki
        { tan: -1, phi: 3 * Math.PI / 4, phiDisplay: '\\frac{3\\pi}{4}', quadrant: 2 }, // II: z = -k + ki
        { tan: 1, phi: -3 * Math.PI / 4, phiDisplay: '-\\frac{3\\pi}{4}', quadrant: 3 }, // III: z = -k - ki
        { tan: -1 / Math.sqrt(3), phi: 5 * Math.PI / 6, phiDisplay: '\\frac{5\\pi}{6}', quadrant: 2 }, // II: z = -k\sqrt{3} + ki
        { tan: 1 / Math.sqrt(3), phi: -5 * Math.PI / 6, phiDisplay: '-\\frac{5\\pi}{6}', quadrant: 3 }, // III: z = -k\sqrt{3} - ki
        { tan: -Math.sqrt(3), phi: 2 * Math.PI / 3, phiDisplay: '\\frac{2\\pi}{3}', quadrant: 2 }, // II: z = -k + k\sqrt{3}i
        { tan: Math.sqrt(3), phi: -2 * Math.PI / 3, phiDisplay: '-\\frac{2\\pi}{3}', quadrant: 3 } // III: z = -k - k\sqrt{3}i
    ];
    const selectedTangent = tangentValues[Math.floor(Math.random() * tangentValues.length)];
    const scale = Math.floor(Math.random() * 5) + 1; // Масштаб 1-5

    let numAObj, numBObj, scaledAValue, numBValue;
    if (selectedTangent.quadrant === 1) {
        // I чверть: a > 0, b > 0
        if (selectedTangent.tan === Math.sqrt(3)) {
            // phi = π/3, z = k + k\sqrt{3}i
            scaledAValue = scale;
            numBValue = scale * Math.sqrt(3);
            numAObj = { value: scaledAValue, display: `${scale}` };
            numBObj = { value: numBValue, display: `${scale}\\sqrt{3}` };
        } else if (selectedTangent.tan === 1 / Math.sqrt(3)) {
            // phi = π/6, z = k\sqrt{3} + ki
            scaledAValue = scale * Math.sqrt(3);
            numBValue = scale;
            numAObj = { value: scaledAValue, display: `${scale}\\sqrt{3}` };
            numBObj = { value: numBValue, display: `${scale}` };
        } else {
            // phi = π/4, z = k + ki
            scaledAValue = scale;
            numBValue = scale;
            numAObj = { value: scaledAValue, display: `${scale}` };
            numBObj = { value: numBValue, display: `${scale}` };
        }
    } else if (selectedTangent.quadrant === 2) {
        // II чверть: a < 0, b > 0
        if (selectedTangent.tan === -1) {
            // phi = 3π/4, z = -k + ki
            scaledAValue = -scale;
            numBValue = scale;
            numAObj = { value: scaledAValue, display: `-${scale}` };
            numBObj = { value: numBValue, display: `${scale}` };
        } else if (selectedTangent.tan === -1 / Math.sqrt(3)) {
            // phi = 5π/6, z = -k\sqrt{3} + ki
            scaledAValue = -scale * Math.sqrt(3);
            numBValue = scale;
            numAObj = { value: scaledAValue, display: `-${scale}\\sqrt{3}` };
            numBObj = { value: numBValue, display: `${scale}` };
        } else {
            // phi = 2π/3, z = -k + k\sqrt{3}i
            scaledAValue = -scale;
            numBValue = scale * Math.sqrt(3);
            numAObj = { value: scaledAValue, display: `-${scale}` };
            numBObj = { value: numBValue, display: `${scale}\\sqrt{3}` };
        }
    } else if (selectedTangent.quadrant === 3) {
        // III чверть: a < 0, b < 0
        if (selectedTangent.tan === 1) {
            // phi = -3π/4, z = -k - ki
            scaledAValue = -scale;
            numBValue = -scale;
            numAObj = { value: scaledAValue, display: `-${scale}` };
            numBObj = { value: numBValue, display: `-${scale}` };
        } else if (selectedTangent.tan === 1 / Math.sqrt(3)) {
            // phi = -5π/6, z = -k\sqrt{3} - ki
            scaledAValue = -scale * Math.sqrt(3);
            numBValue = -scale;
            numAObj = { value: scaledAValue, display: `-${scale}\\sqrt{3}` };
            numBObj = { value: numBValue, display: `-${scale}` };
        } else {
            // phi = -2π/3, z = -k - k\sqrt{3}i
            scaledAValue = -scale;
            numBValue = -scale * Math.sqrt(3);
            numAObj = { value: scaledAValue, display: `-${scale}` };
            numBObj = { value: numBValue, display: `-${scale}\\sqrt{3}` };
        }
    } else {
        // IV чверть: a > 0, b < 0
        if (selectedTangent.tan === -Math.sqrt(3)) {
            // phi = -π/3, z = k - k\sqrt{3}i
            scaledAValue = scale;
            numBValue = -scale * Math.sqrt(3);
            numAObj = { value: scaledAValue, display: `${scale}` };
            numBObj = { value: numBValue, display: `-${scale}\\sqrt{3}` };
        } else if (selectedTangent.tan === -1 / Math.sqrt(3)) {
            // phi = -π/6, z = k\sqrt{3} - ki
            scaledAValue = scale * Math.sqrt(3);
            numBValue = -scale;
            numAObj = { value: scaledAValue, display: `${scale}\\sqrt{3}` };
            numBObj = { value: numBValue, display: `-${scale}` };
        } else {
            // phi = -π/4, z = k - ki
            scaledAValue = scale;
            numBValue = -scale;
            numAObj = { value: scaledAValue, display: `${scale}` };
            numBObj = { value: numBValue, display: `-${scale}` };
        }
    }

    // Перевірка коректності phi за формулами
    let computedPhi;
if (numAObj.value > 0 && numBObj.value >= 0) {
    computedPhi = Math.atan(numBObj.value / numAObj.value); // I чверть
} else if (numAObj.value < 0 && numBObj.value >= 0) {
    computedPhi = Math.atan(numBObj.value / numAObj.value) + Math.PI; // II чверть
} else if (numAObj.value < 0 && numBObj.value < 0) {
    computedPhi = Math.atan(numBObj.value / numAObj.value) - Math.PI; // III чверть
} else {
    computedPhi = Math.atan(numBObj.value / numAObj.value); // IV чверть
}
    if (computedPhi > Math.PI) computedPhi -= 2 * Math.PI;
    if (computedPhi < -Math.PI) computedPhi += 2 * Math.PI;

    // Використовуємо phi з tangentValues, якщо воно збігається
    let phi = selectedTangent.phi;
    if (Math.abs(computedPhi - phi) > 0.0001) {
        console.warn(`Розбіжність phi: обчислено ${computedPhi}, очікувано ${phi}`);
        phi = computedPhi; // Використовуємо обчислене, якщо є помилка
    }

    let zDisplay;
    if (Math.abs(numBObj.value) === 1) {
        zDisplay = `${numAObj.display} ${numBObj.value < 0 ? '-' : '+'} i`;
    } else {
        zDisplay = `${numAObj.display} ${numBObj.value < 0 ? '-' : '+'} ${numBObj.display.replace('-', '')}i`;
    }

    const possibleAnswers = [
        { value: 0, display: '0' },
        { value: Math.PI / 4, display: '\\frac{\\pi}{4}' },
        { value: -Math.PI / 4, display: '-\\frac{\\pi}{4}' },
        { value: Math.PI / 3, display: '\\frac{\\pi}{3}' },
        { value: -Math.PI / 3, display: '-\\frac{\\pi}{3}' },
        { value: Math.PI / 6, display: '\\frac{\\pi}{6}' },
        { value: -Math.PI / 6, display: '-\\frac{\\pi}{6}' },
        { value: 2 * Math.PI / 3, display: '\\frac{2\\pi}{3}' },
        { value: -2 * Math.PI / 3, display: '-\\frac{2\\pi}{3}' },
        { value: 3 * Math.PI / 4, display: '\\frac{3\\pi}{4}' },
        { value: -3 * Math.PI / 4, display: '-\\frac{3\\pi}{4}' },
        { value: 5 * Math.PI / 6, display: '\\frac{5\\pi}{6}' },
        { value: -5 * Math.PI / 6, display: '-\\frac{5\\pi}{6}' },
        { value: Math.PI / 2, display: '\\frac{\\pi}{2}' },
        { value: -Math.PI / 2, display: '-\\frac{\\pi}{2}' }
    ].filter(ans => Math.abs(ans.value - phi) > 0.0001);

    const shuffledAnswers = possibleAnswers.sort(() => Math.random() - 0.5).slice(0, 3);
    const phiDisplay = formatPhi(phi);
    shuffledAnswers.push({ value: phi, display: phiDisplay });
    shuffledAnswers.sort(() => Math.random() - 0.5);

    currentAnswer = phi;
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';
    questionText.innerHTML = `Головним значенням аргументу комплексного числа \\( z = ${zDisplay} \\) є:`;
    optionsContainer.innerHTML = '';
    shuffledAnswers.forEach(ans => {
        const option = document.createElement('div');
        option.className = 'trainer-option';
        option.innerHTML = `\\(${ans.display}\\)`;
        option.dataset.value = ans.value;
        option.addEventListener('click', () => {
            document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            selectedOption = ans.value;
        });
        optionsContainer.appendChild(option);
    });

    document.getElementById('questionCircle').innerText = 'Питання 3';
    document.getElementById('feedback').innerText = '';
    selectedOption = null;

    waitForMathJax().then(() => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            MathJax.typesetPromise([document.getElementById('trainerContent')]).then(() => {
                questionText.style.display = 'block';
                optionsContainer.style.display = 'grid';
            }).catch(err => console.error('Помилка MathJax:', err));
        }
    });
}
      function waitForMathJax() {
    return new Promise((resolve) => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            resolve();
        } else {
            const interval = setInterval(() => {
                if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                    clearInterval(interval);
                    resolve();
                }
            }, 100);
        }
    });
}

function renderLatexToCanvas(latex, x, y, ctx, fontSize = 14) {
    const tempDiv = document.createElement('div');
    const uniqueId = 'tempMathJaxDiv_' + Math.random().toString(36).substring(7);
    tempDiv.id = uniqueId;
    tempDiv.style.position = 'absolute';
    tempDiv.style.visibility = 'hidden';
    tempDiv.style.fontSize = `${fontSize}px`;
    tempDiv.innerHTML = `\\(${latex}\\)`;
    document.body.appendChild(tempDiv);

    return waitForMathJax().then(() => {
        return MathJax.typesetPromise([tempDiv]).then(() => {
            const mathElement = tempDiv.querySelector('mjx-container');
            if (!mathElement) {
                console.error(`MathJax не створив елемент для LaTeX: ${latex}`);
                renderFallback(latex, x, y, ctx, fontSize);
                document.body.removeChild(tempDiv);
                return;
            }

            const svg = mathElement.querySelector('svg');
            if (!svg) {
                console.error(`SVG не знайдено для LaTeX: ${latex}`);
                renderFallback(latex, x, y, ctx, fontSize);
                document.body.removeChild(tempDiv);
                return;
            }

            const img = new Image();
            const svgData = new XMLSerializer().serializeToString(svg);
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));

            img.onload = () => {
                const scaleFactor = fontSize / (parseFloat(svg.getAttribute('height')) || 20);
                const width = img.width * scaleFactor;
                const height = img.height * scaleFactor;
                ctx.drawImage(img, x - width / 2, y - height / 2, width, height);
                document.body.removeChild(tempDiv);
                console.log(`Рендеринг LaTeX: ${latex} -> SVG (x=${x}, y=${y})`);
            };

            img.onerror = () => {
                console.error(`Помилка завантаження SVG для LaTeX: ${latex}`);
                renderFallback(latex, x, y, ctx, fontSize);
                document.body.removeChild(tempDiv);
            };
        }).catch(err => {
            console.error(`Помилка рендерингу LaTeX "${latex}":`, err);
            renderFallback(latex, x, y, ctx, fontSize);
            document.body.removeChild(tempDiv);
        });
    });

    function renderFallback(latex, x, y, ctx, fontSize) {
        ctx.font = `${fontSize}px Inter`;
        ctx.fillStyle = '#000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        // Замінюємо LaTeX-вирази на читабельний текст
        let displayText = latex
            .replace(/\\sqrt\{(\d+)\}/g, '√$1') // \\sqrt{3} → √3
            .replace(/^-\\sqrt\{(\d+)\}/g, '-√$1') // -\\sqrt{3} → -√3
            .replace(/(\d+)\\sqrt\{(\d+)\}/g, '$1√$2'); // 2\\sqrt{3} → 2√3
        ctx.fillText(displayText, x, y);
    }
}

function drawComplexPlane(canvas, a, b, aDisplay, bDisplay) {
    const ctx = canvas.getContext('2d');
    if (!ctx) {
        console.error("Контекст канвасу не знайдено!");
        return;
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const range = 6; // Діапазон від -6 до 6
    const scale = canvas.width / (2 * range); // 250 / 12 ≈ 20.83 пікселів на одиницю
    const arrowSize = 10; // Фіксований розмір стрілки для вектора
    const fontSize = 14;
    const labelOffset = 15; // Базовий зсув

    // Малюємо осі
    ctx.beginPath();
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.moveTo(0, centerY);
    ctx.lineTo(canvas.width, centerY);
    ctx.moveTo(centerX, canvas.height);
    ctx.lineTo(centerX, 0);
    ctx.stroke();

    // Стрілки на осях
    ctx.beginPath();
    ctx.moveTo(canvas.width - arrowSize, centerY);
    ctx.lineTo(canvas.width - arrowSize - 10, centerY - 5);
    ctx.lineTo(canvas.width - arrowSize - 10, centerY + 5);
    ctx.lineTo(canvas.width - arrowSize, centerY);
    ctx.moveTo(centerX, arrowSize);
    ctx.lineTo(centerX - 5, arrowSize + 10);
    ctx.lineTo(centerX + 5, arrowSize + 10);
    ctx.lineTo(centerX, arrowSize);
    ctx.fillStyle = '#000';
    ctx.fill();

    // Штрихпунктирні перпендикуляри
    const endX = centerX + a * scale;
    const endY = centerY - b * scale; // Y перевернута в canvas
    if (a !== 0 || b !== 0) {
        ctx.beginPath();
        ctx.strokeStyle = '#888';
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]);
        ctx.moveTo(endX, centerY);
        ctx.lineTo(endX, endY);
        ctx.lineTo(centerX, endY);
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // Малюємо радіус-вектор
    ctx.strokeStyle = '#ff0000';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.lineTo(endX, endY);
    ctx.stroke();

    // Додаємо стрілку на кінці вектора
    const vectorAngle = Math.atan2(endY - centerY, endX - centerX);
    ctx.beginPath();
    ctx.moveTo(endX, endY);
    ctx.lineTo(
        endX - arrowSize * Math.cos(vectorAngle - Math.PI / 6),
        endY - arrowSize * Math.sin(vectorAngle - Math.PI / 6)
    );
    ctx.lineTo(
        endX - arrowSize * Math.cos(vectorAngle + Math.PI / 6),
        endY - arrowSize * Math.sin(vectorAngle + Math.PI / 6)
    );
    ctx.lineTo(endX, endY);
    ctx.fillStyle = '#ff0000';
    ctx.fill();

    // Додаємо надпис z біля стрілки вектора
    const labelX = endX + (arrowSize + 5) * Math.cos(vectorAngle); // Зсув від кінця стрілки
    const labelY = endY - (arrowSize + 5) * Math.sin(vectorAngle); // Корекція для Y
    ctx.font = `${fontSize}px Inter`;
    ctx.fillStyle = '#000';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('z', labelX, labelY);

    // Динамічний зсув для позначки a залежно від чверті
    const aLabelY = b < 0 ? centerY - labelOffset : centerY + labelOffset; // Над віссю, якщо b < 0
    // Динамічний зсув для позначки b: ліворуч у 1-й і 4-й чвертях, правіше у 2-й
    const bLabelX = (a > 0 && b >= 0) || (a > 0 && b < 0) 
        ? centerX - labelOffset 
        : (a < 0 && b > 0) 
            ? centerX + labelOffset * 1.3 // Трохи правіше у 2-й чверті
            : centerX + labelOffset;
    Promise.all([
        renderLatexToCanvas(aDisplay, endX, aLabelY, ctx, fontSize),
        renderLatexToCanvas(bDisplay, bLabelX, endY, ctx, fontSize)
    ]).catch(err => console.error('Помилка рендерингу чисел:', err));
}

function generateQuestion4() {
    const canvas = document.getElementById('complexPlaneCanvas');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const feedback = document.getElementById('feedback');
    if (!canvas || !questionText || !optionsContainer || !feedback) {
        console.error('Елементи canvas, questionText, optionsContainer або feedback не знайдені!');
        return;
    }

    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';
    canvas.style.display = 'block';

    // Використовуємо ту саму логіку чвертей і тангенсів, як у питанні 2
    const tangentValues = [
        { tan: 1, phi: Math.PI / 4, phiDisplay: '\\frac{\\pi}{4}', quadrant: 1 },
        { tan: -1, phi: -Math.PI / 4, phiDisplay: '-\\frac{\\pi}{4}', quadrant: 4 },
        { tan: Math.sqrt(3), phi: Math.PI / 3, phiDisplay: '\\frac{\\pi}{3}', quadrant: 1 },
        { tan: -Math.sqrt(3), phi: -Math.PI / 3, phiDisplay: '-\\frac{\\pi}{3}', quadrant: 4 },
        { tan: 1 / Math.sqrt(3), phi: Math.PI / 6, phiDisplay: '\\frac{\\pi}{6}', quadrant: 1 },
        { tan: -1 / Math.sqrt(3), phi: -Math.PI / 6, phiDisplay: '-\\frac{\\pi}{6}', quadrant: 4 },
        { tan: -1, phi: 3 * Math.PI / 4, phiDisplay: '\\frac{3\\pi}{4}', quadrant: 2 },
        { tan: 1, phi: -3 * Math.PI / 4, phiDisplay: '-\\frac{3\\pi}{4}', quadrant: 3 },
        { tan: -1 / Math.sqrt(3), phi: 5 * Math.PI / 6, phiDisplay: '\\frac{5\\pi}{6}', quadrant: 2 },
        { tan: 1 / Math.sqrt(3), phi: -5 * Math.PI / 6, phiDisplay: '-\\frac{5\\pi}{6}', quadrant: 3 },
        { tan: -Math.sqrt(3), phi: 2 * Math.PI / 3, phiDisplay: '\\frac{2\\pi}{3}', quadrant: 2 },
        { tan: Math.sqrt(3), phi: -2 * Math.PI / 3, phiDisplay: '-\\frac{2\\pi}{3}', quadrant: 3 }
    ];
    const selectedTangent = tangentValues[Math.floor(Math.random() * tangentValues.length)];
    const scale = Math.floor(Math.random() * 3) + 1; // Масштаб від 1 до 3

    let numAObj, numBObj, a, b;
    if (selectedTangent.quadrant === 1) {
        if (selectedTangent.tan === Math.sqrt(3)) {
            a = scale;
            b = scale * Math.sqrt(3);
            numAObj = { value: a, display: scale === 1 ? '\\sqrt{3}' : `${scale}` };
            numBObj = { value: b, display: scale === 1 ? '\\sqrt{3}' : `${scale}\\sqrt{3}` };
        } else if (selectedTangent.tan === 1 / Math.sqrt(3)) {
            a = scale * Math.sqrt(3);
            b = scale;
            numAObj = { value: a, display: scale === 1 ? '\\sqrt{3}' : `${scale}\\sqrt{3}` };
            numBObj = { value: b, display: `${scale}` };
        } else {
            a = scale;
            b = scale;
            numAObj = { value: a, display: `${scale}` };
            numBObj = { value: b, display: `${scale}` };
        }
    } else if (selectedTangent.quadrant === 2) {
        if (selectedTangent.tan === -1) {
            a = -scale;
            b = scale;
            numAObj = { value: a, display: `-${scale}` };
            numBObj = { value: b, display: `${scale}` };
        } else if (selectedTangent.tan === -1 / Math.sqrt(3)) {
            a = -scale * Math.sqrt(3);
            b = scale;
            numAObj = { value: a, display: scale === 1 ? '-\\sqrt{3}' : `-${scale}\\sqrt{3}` };
            numBObj = { value: b, display: `${scale}` };
        } else {
            a = -scale;
            b = scale * Math.sqrt(3);
            numAObj = { value: a, display: `-${scale}` };
            numBObj = { value: b, display: scale === 1 ? '\\sqrt{3}' : `${scale}\\sqrt{3}` };
        }
    } else if (selectedTangent.quadrant === 3) {
        if (selectedTangent.tan === 1) {
            a = -scale;
            b = -scale;
            numAObj = { value: a, display: `-${scale}` };
            numBObj = { value: b, display: `-${scale}` };
        } else if (selectedTangent.tan === 1 / Math.sqrt(3)) {
            a = -scale * Math.sqrt(3);
            b = -scale;
            numAObj = { value: a, display: scale === 1 ? '-\\sqrt{3}' : `-${scale}\\sqrt{3}` };
            numBObj = { value: b, display: `-${scale}` };
        } else {
            a = -scale;
            b = -scale * Math.sqrt(3);
            numAObj = { value: a, display: `-${scale}` };
            numBObj = { value: b, display: scale === 1 ? '-\\sqrt{3}' : `-${scale}\\sqrt{3}` };
        }
    } else {
        if (selectedTangent.tan === -Math.sqrt(3)) {
            a = scale;
            b = -scale * Math.sqrt(3);
            numAObj = { value: a, display: `${scale}` };
            numBObj = { value: b, display: scale === 1 ? '-\\sqrt{3}' : `-${scale}\\sqrt{3}` };
        } else if (selectedTangent.tan === -1 / Math.sqrt(3)) {
            a = scale * Math.sqrt(3);
            b = -scale;
            numAObj = { value: a, display: scale === 1 ? '\\sqrt{3}' : `${scale}\\sqrt{3}` };
            numBObj = { value: b, display: `-${scale}` };
        } else {
            a = scale;
            b = -scale;
            numAObj = { value: a, display: `${scale}` };
            numBObj = { value: b, display: `-${scale}` };
        }
    }

    let aDisplay = numAObj.display;
    let bDisplay = numBObj.display;

    // Корекція формату для LaTeX, щоб уникнути зайвих дужок
    aDisplay = aDisplay.replace(/1\\sqrt\{(\d+)\}/, '\\sqrt{$1}'); // Прибираємо "1" перед коренем
    bDisplay = bDisplay.replace(/1\\sqrt\{(\d+)\}/, '\\sqrt{$1}'); // Прибираємо "1" перед коренем

    console.log("Generated: a =", a, "aDisplay =", aDisplay, "b =", b, "bDisplay =", bDisplay);

    let phi = selectedTangent.phi; // Використовуємо фіксоване phi з tangentValues
    const phiDisplay = selectedTangent.phiDisplay;

    drawComplexPlane(canvas, a, b, aDisplay, bDisplay);

    const possibleAnswers = [
        { value: 0, display: '0' },
        { value: Math.PI / 4, display: '\\frac{\\pi}{4}' },
        { value: -Math.PI / 4, display: '-\\frac{\\pi}{4}' },
        { value: Math.PI / 3, display: '\\frac{\\pi}{3}' },
        { value: -Math.PI / 3, display: '-\\frac{\\pi}{3}' },
        { value: Math.PI / 6, display: '\\frac{\\pi}{6}' },
        { value: -Math.PI / 6, display: '-\\frac{\\pi}{6}' },
        { value: 2 * Math.PI / 3, display: '\\frac{2\\pi}{3}' },
        { value: -2 * Math.PI / 3, display: '-\\frac{2\\pi}{3}' },
        { value: 3 * Math.PI / 4, display: '\\frac{3\\pi}{4}' },
        { value: -3 * Math.PI / 4, display: '-\\frac{3\\pi}{4}' },
        { value: 5 * Math.PI / 6, display: '\\frac{5\\pi}{6}' },
        { value: -5 * Math.PI / 6, display: '-\\frac{5\\pi}{6}' },
        { value: Math.PI / 2, display: '\\frac{\\pi}{2}' },
        { value: -Math.PI / 2, display: '-\\frac{\\pi}{2}' },
        { value: Math.PI, display: '\\pi' }
    ].filter(ans => Math.abs(ans.value - phi) > 0.0001);

    const shuffledAnswers = possibleAnswers.sort(() => Math.random() - 0.5).slice(0, 3);
    shuffledAnswers.push({ value: phi, display: phiDisplay });
    shuffledAnswers.sort(() => Math.random() - 0.5);

    currentAnswer = phi;
    questionText.innerHTML = `На комплексній площині зображено вектор, що відповідає комплексному числу \\( z \\). Визначте його головне значення аргументу \\( φ \\) у радіанах (інтервал \\( (-\\pi, \\pi] \\)).`;
    optionsContainer.innerHTML = '';
    shuffledAnswers.forEach(ans => {
        const option = document.createElement('div');
        option.className = 'trainer-option';
        option.innerHTML = `\\(${ans.display}\\)`;
        option.dataset.value = ans.value;
        option.addEventListener('click', () => {
            document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            selectedOption = ans.value;
        });
        optionsContainer.appendChild(option);
    });

    document.getElementById('questionCircle').innerText = 'Питання 4';
    feedback.innerText = '';
    selectedOption = null;

    waitForMathJax().then(() => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            MathJax.typesetPromise([document.getElementById('trainerContent')]).then(() => {
                questionText.style.display = 'block';
                optionsContainer.style.display = 'grid';
                canvas.style.display = 'block';
            }).catch(err => {
                console.error('Помилка MathJax:', err);
                questionText.style.display = 'block';
                optionsContainer.style.display = 'grid';
                canvas.style.display = 'block';
            });
        } else {
            questionText.style.display = 'block';
            optionsContainer.style.display = 'grid';
            canvas.style.display = 'block';
        }
    });
}



// Оновлена функція generateQuestion
function generateQuestion() {
    const trainerContent = document.getElementById('trainerContent');
    if (!trainerContent) {
        console.error('trainerContent не знайдено!');
        return;
    }

    // Скидаємо вміст trainerContent до початкового стану
    trainerContent.innerHTML = `
        <div class="question-circle" id="questionCircle">Питання ${currentQuestionNumber}</div>
        <canvas id="complexPlaneCanvas" width="250" height="250" style="display: none;"></canvas>
        <div class="trainer-question" id="questionText"></div>
        <div class="trainer-options" id="optionsContainer"></div>
        <button class="trainer-submit" id="submitAnswer">Перевірити</button>
        <div class="trainer-feedback" id="feedback"></div>
    `;



   // Прив’язуємо обробник для submitAnswer
    const submitButton = document.getElementById('submitAnswer');
    if (submitButton) {
        submitButton.addEventListener('click', () => {
            const feedback = document.getElementById('feedback');
            if (selectedOption === null) {
                showFeedback('Будь ласка, виберіть відповідь!', false, () => {});
                return;
            }
            if (Math.abs(selectedOption - currentAnswer) < 0.0001 || selectedOption === currentAnswer) {
                if (currentQuestionNumber === 1) {
                    showFeedback('✅ Правильно! Переходимо до питання 2.', true, () => {
                        currentQuestionNumber = 2;
                        selectedOption = null;
                        generateQuestion();
                    });
                } else if (currentQuestionNumber === 2) {
                    showFeedback('✅ Правильно! Переходимо до питання 3.', true, () => {
                        currentQuestionNumber = 3;
                        selectedOption = null;
                        generateQuestion();
                    });
                } else if (currentQuestionNumber === 3) {
                    showFeedback('✅ Правильно! Переходимо до питання 4.', true, () => {
                        currentQuestionNumber = 4;
                        selectedOption = null;
                        generateQuestion();
                    });
                } else if (currentQuestionNumber === 4) {
                    showFeedback('✅ Правильно! Тренування завершено!', true, () => {
                        currentQuestionNumber = 5;
                        selectedOption = null;
                        generateQuestion();
                    });
                }
            } else {
                showFeedback(`❌ Неправильно. Спробуйте ще раз для питання ${currentQuestionNumber}.`, false, () => {
                    selectedOption = null;
                    generateQuestion();
                });
            }
        });
    } else {
        console.error('Кнопка submitAnswer не знайдена!');
    }

    trainerContent.style.display = 'block';
    if (currentQuestionNumber === 1) {
        document.getElementById('complexPlaneCanvas').style.display = 'none';
        generateQuestion1();
    } else if (currentQuestionNumber === 2) {
        document.getElementById('complexPlaneCanvas').style.display = 'none';
        generateQuestion2();
    } else if (currentQuestionNumber === 3) {
        document.getElementById('complexPlaneCanvas').style.display = 'none';
        generateQuestion3();
    } else if (currentQuestionNumber === 4) {
        generateQuestion4();
    } else if (currentQuestionNumber === 5) {
        // Завершення тренажера
        trainerContent.innerHTML = `
            <div class="completion-emoji">🎉</div>
            <div class="completion-message">
                <h2>Тренування завершено!</h2>
                <p>Молодець!</p>
                <button id="resetTrainerBtn">Спробувати ще раз</button>
            </div>
        `;
        const resetBtn = document.getElementById('resetTrainerBtn');
        if (resetBtn) {
            resetBtn.addEventListener('click', () => {
                console.log('Скидання тренажера до питання 1'); // Для дебагу
                currentQuestionNumber = 1;
                currentAnswer = null;
                selectedOption = null;
                trainerContent.innerHTML = ''; // Очищаємо вміст
                generateQuestion();
                adjustModalHeight(modals.trainer); // Адаптуємо висоту модального вікна
            });
        } else {
            console.error('Кнопка resetTrainerBtn не знайдена!');
        }
        waitForMathJax().then(() => {
            adjustModalHeight(modals.trainer);
        });
        return;
    }

    // Викликаємо adjustModalHeight після рендерингу MathJax
    waitForMathJax().then(() => {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
            MathJax.typesetPromise([trainerContent]).then(() => {
                adjustModalHeight(modals.trainer);
            }).catch(err => {
                console.error('Помилка MathJax:', err);
                adjustModalHeight(modals.trainer);
            });
        } else {
            adjustModalHeight(modals.trainer);
        }
    });
}

// Ініціалізація тренажера
if (buttons.openTrainer) {
    buttons.openTrainer.addEventListener('click', () => {
        openModal(modals.trainer, buttons.openTrainer);
        currentQuestionNumber = 1;
        currentAnswer = null;
        selectedOption = null;
        generateQuestion();
    });
}

</script>
</body>
</html>
