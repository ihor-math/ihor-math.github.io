<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18. Дії над матрицями</title>
    <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)']],
            displayMath: [['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            ignoreHtmlClass: 'tex2jax_ignore',
            processHtmlClass: 'tex2jax_process'
        }
    };
    window.mathJaxReady = true;
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        *, *:before, ::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(135deg, #1c2b1a, #3a4c36);
            font-family: 'Poppins', sans-serif;
            color: #e8e8e8;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100dvh;
        }
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: linear-gradient(135deg, #2b2b2b, #4c6b3a);
            border-radius: 25px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            font-size: 28px;
            color: #d4d4d4;
            text-shadow: 0 0 10px rgba(212, 212, 212, 0.5);
            font-weight: 800;
        }
            .figure.figure-5-1 {
    width: 700px;
    height: 70px;
}
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: linear-gradient(135deg, #2e4c2b, #4c6b3a);
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3), inset 0 0 8px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: inherit;
            border: 1px solid rgba(163, 166, 139, 0.3);
        }
        .section:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), inset 0 0 12px rgba(163, 166, 139, 0.2);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 5px rgba(163, 166, 139, 0.3));
        }
        .section h2 {
            font-size: 20px;
            color: #e8e8e8;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 95%;
            max-width: 95vw;
            height: 95vh;
            max-height: 95vh;
            background: linear-gradient(135deg, #1c2b1a, #3a4c36);
            z-index: 1001;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            transition: opacity 0.25s ease, transform 0.25s ease;
            opacity: 0;
            border-radius: 15px;
            overflow: hidden;
            transform: translateZ(0);
        }
        .modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        .modal-header {
            background: linear-gradient(90deg, #2b2b2b, #4c6b3a);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
        }
        .close-btn {
            background: #a3a68b;
            color: #1c2b1a;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .close-btn:hover {
            background: #7a7d66;
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: linear-gradient(135deg, #4c6b3a, #2b2b2b);
            border-radius: 10px;
            margin: 10px;
            color: #e8e8e8;
            width: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: linear-gradient(135deg, #2e4c2b, #4c6b3a);
            border-radius: 15px;
            border: 1px solid rgba(163, 166, 139, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #e8e8e8;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
        }
        .video-player-container {
            max-width: 95%;
            margin: 0 auto;
        }
        .video-player-container iframe {
            width: 100%;
            aspect-ratio: 16 / 9;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .glow-title {
            text-align: center;
            font-size: 2em;
            color: #e8e8e8;
            font-family: 'Verdana', sans-serif;
            text-shadow: 0 0 10px #e8e8e8, 0 0 20px #a3a68b, 0 0 30px #a3a68b;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #e8e8e8, 0 0 10px #a3a68b;
            }
            to {
                text-shadow: 0 0 20px #e8e8e8, 0 0 30px #a3a68b;
            }
        }
        #theoryModal .modal-content p {
            font-size: 18px !important;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: justify;
            max-width: 100%;
        }
        #theoryModal .modal-content ul {
            list-style: none;
            padding-left: 20px;
        }
        #theoryModal .modal-content li {
            color: #e8e8e8;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
        }
        #theoryModal .modal-content li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #a3a68b;
            font-size: 16px;
        }
        #theoryModal .modal-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        #theoryModal .math-notation-centered {
            display: block !important;
            color: #FFFF00 !important;
            text-align: center !important;
            max-width: 100%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
        }
        #theoryModal mjx-container {
            color: #FFFF00 !important;
            font-size: clamp(16px, 2.8vw, 18px);
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 100% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        #trainerModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
            text-align: center;
        }
        #trainerModal mjx-container[jax="CHTML"][display="true"] {
            font-size: clamp(18px, 3vw, 20px) !important;
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        .mathjax-loading::before {
            content: 'Завантаження формул...';
            display: block;
            text-align: center;
            color: #e8e8e8;
            margin: 10px 0;
        }
        #questionsModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 5px auto;
            padding: 3px;
            box-sizing: border-box;
            text-align: center;
            overflow: visible !important;
        }
        #questionsModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 5px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 3px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            transition: opacity 0.25s ease;
            transform: translateZ(0);
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 95%;
            height: 200px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 12px;
            border-radius: 15px;
            font-size: clamp(16px, 3vw, 18px);
            line-height: 1.5;
            border: 1px solid rgba(163, 166, 139, 0.3);
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
        }
        .card-front {
            background: linear-gradient(135deg, #2e4c2b, #4c6b3a);
            color: #e8e8e8;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-wrap: wrap;
            overflow-wrap: break-word;
            word-break: break-word;
            padding: 12px 15px;
            max-width: 100%;
        }
        .card-back {
            background: linear-gradient(135deg, #3a3a3a, #575a4b);
            color: #e8e8e8;
            transform: rotateY(180deg);
            overflow-y: auto;
            text-align: justify;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
            padding: 12px 15px;
            max-width: 100%;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .card-back::-webkit-scrollbar {
            width: 6px;
        }
        .card-back::-webkit-scrollbar-track {
            background: transparent;
        }
        .card-back::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .card-back::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .question-card .card-front {
            white-space: normal;
            overflow-wrap: break-word;
            word-break: break-word;
            flex-wrap: wrap;
        }
        .card-back p {
            margin: 5px 0;
            font-size: clamp(16px, 3vw, 18px);
            color: #e8e8e8;
            box-sizing: border-box;
            width: 100%;
            text-align: center;
        }
        .card-front span.yellow {
            color: #FFFF00;
            font-weight: 600;
            display: inline;
            margin-right: 0.1em;
        }
        .trainer-container {
            width: 95%;
            max-width: 900px;
            padding: 4vw 5vw;
            text-align: center;
            background: linear-gradient(135deg, #2e4c2b, #4c6b3a);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(163, 166, 139, 0.3);
            box-sizing: border-box;
            margin: auto;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .trainer-container::-webkit-scrollbar {
            width: 6px;
        }
        .trainer-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .trainer-container::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .trainer-container::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .trainer-container p {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin: 10px 0;
        }
        .trainer-container .math-notation-centered {
            text-align: center !important;
            margin: 10px 0;
            max-width: 90%;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin-bottom: 15px;
            text-align: center;
        }
        .question-number {
            width: 100px;
            height: 100px;
            line-height: 100px;
            background: linear-gradient(135deg, #a3a68b, #7a7d66);
            color: #1c2b1a;
            border-radius: 50%;
            font-size: clamp(16px, 2.8vw, 18px);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
            white-space: nowrap;
        }
        .answer-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        .answer-btn {
             background: #3b4a5a;
    border: 1.5px solid #a855f7;
            color: #e8e8e8;
           
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(17px, 2.6vw, 18px);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            touch-action: manipulation;
        }
        .answer-btn:hover {
            background: linear-gradient(135deg, #4c6b3a, #575a4b);
            transform: scale(1.05);
        }
        .answer-btn:disabled {
            background: #575a4b;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .answer-btn.selected {
            background: #6f2c42 !important;
    border: 2px solid #FFD700 !important;
}
        .submit-btn {
            background: #556832;
            color: #fbec5d;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            margin: 15px auto;
            display: block;
        }
        .submit-btn:hover {
            background: linear-gradient(135deg, #7a7d66, #a3a68b);
            transform: scale(1.05);
        }
        .submit-btn:disabled {
            background: #c3ceb9;
            cursor: not-allowed;
            opacity: 0.6;
            color: #2e4c2b;
        }
        #feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
            padding: 15px 25px;
            max-width: 400px;
            min-height: 80px;
            width: 90%;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            font-size: clamp(16px, 2.8vw, 18px);
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #feedback.show {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
        #feedback.correct {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        #feedback.incorrect {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        #resetTrainerBtn {
            background: #a3a68b;
            color: #2e4c2b;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #resetTrainerBtn:hover {
            background: #7a7d66;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #2b2b2b, #4c6b3a);
            color: #d4d4d4;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(163, 166, 139, 0.3);
            text-decoration: none;
        }
        .nav-button:hover {
            background: linear-gradient(135deg, #4c6b3a, #575a4b);
            color: #e8e8e8;
            text-decoration: none;
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(135deg, #2e4c2b, #4c6b3a);
            cursor: pointer;
            border: 1px solid rgba(163, 166, 139, 0.3);
        }
        summary {
            font-weight: 600;
            padding: 10px;
            background: linear-gradient(90deg, #3a3a3a, #575a4b);
            border-radius: 10px;
            color: #d4d4d4;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        summary:hover {
            background: linear-gradient(90deg, #575a4b, #7a7d66);
        }
        details p {
            padding: 0 20px 10px;
            color: #e8e8e8;
        }
        .solution {
            color: #F4A261 !important;
            font-weight: bold;
        }
        .example-title {
            color: #F4A261 !important;
            font-weight: bold;
        }
        .example-condition {
            color: #e8e8e8 !important;
        }
        /* Об'єднання стилів для .completion-emoji */
.completion-emoji {
    width: clamp(80px, 15vw, 120px);
    height: clamp(80px, 15vw, 120px);
    margin: 0 auto 3vw;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    border: 2px dashed #fb7185;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
}

.completion-emoji::after {
    content: '🎉';
    font-size: clamp(40px, 8vw, 60px);
    color: #ffff00;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
}

#completionScreen {
    z-index: 10; /* Вищий z-index, щоб уникнути перекриття */
    width: 100%;
    max-width: 90%;
    margin: 20px auto;
    text-align: center;
    position: relative; /* Забезпечує правильне позиціонування в modal-content */
}

.completion-message {
    text-align: center;
    padding: 20px;
    background: #144748;
    border-radius: 15px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(110, 231, 183, 0.3);
    max-width: 90%;
    margin: 20px auto;
}

.completion-message h2 {
    font-size: clamp(20px, 3.5vw, 24px);
    color: #e6e6e6;
    margin-bottom: 10px;
}

.completion-message p {
    font-size: clamp(18px, 3vw, 20px);
    color: #FFFF00;
}

.completion-message button {
    margin-top: 20px;
    background: #a3a68b;
    color: #2e4c2b;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: clamp(14px, 2.5vw, 16px);
    cursor: pointer;
    transition: background 0.3s ease;
}

.completion-message button:hover {
    background: #7a7d66;
}
            .hidden {
    display: none !important;
}
            
        @media (max-width: 768px) {
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            .modal-content {
                padding: 15px;
                max-height: calc(100dvh - 60px);
                overflow-x: auto;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 18px !important;
                line-height: 1.7;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            .question-card {
                height: 220px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(16px, 2.9vw, 18px);
                padding: 10px 12px;
                overflow-wrap: break-word;
                word-break: break-word;
            }
            .card-back {
                padding: 10px 12px;
                font-size: clamp(16px, 2.9vw, 18px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(16px, 2.9vw, 18px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 4vw 5vw;
                width: 95%;
                max-width: 800px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .question-number {
                width: 80px;
                height: 80px;
                line-height: 80px;
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .answer-btn, .submit-btn, #resetTrainerBtn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 8px 15px;
                min-width: 100px;
            }
            .feedback {
                font-size: clamp(14px, 2.6vw, 16px);
            }
           .completion-emoji {
        width: clamp(60px, 12vw, 100px);
        height: clamp(60px, 12vw, 100px);
    }
    .completion-emoji::after {
        font-size: clamp(30px, 6vw, 50px);
    }
    .completion-message h2 {
        font-size: clamp(18px, 3vw, 20px);
    }
    .completion-message p {
        font-size: clamp(16px, 2.8vw, 18px);
    }
    .completion-message button {
        font-size: clamp(12px, 2.3vw, 14px);
        padding: 8px 16px;
    }
            .navigation-buttons {
                margin: 22px auto;
                gap: 16px;
            }
            .nav-button {
                font-size: 18px;
                padding: 8px 18px;
            }
            .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .submit-btn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 12px 24px;
                min-width: 120px;
                border-radius: 10px;
            }
        }
        @media (max-width: 480px) {
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 22px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 20px;
            }
            .modal-content {
                padding: 10px;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 16px !important;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(16px, 2.8vw, 18px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(15px, 2.7vw, 17px) !important;
            }
            .question-card {
                height: 240px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 8px 10px;
            }
            .card-back {
                padding: 8px 10px;
                font-size: clamp(15px, 2.8vw, 17px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(15px, 2.8vw, 17px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 5vw 6vw;
                width: 95%;
                max-width: 700px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(15px, 2.7vw, 17px);
            }
            .question-number {
                width: 70px;
                height: 70px;
                line-height: 70px;
                font-size: clamp(12px, 2.3vw, 14px);
            }
            .answer-btn, .submit-btn, #resetTrainerBtn {
                font-size: clamp(14px, 2.6vw, 16px);
                padding: 6px 12px;
                min-width: 80px;
            }
            #feedback {
                padding: 10px 15px;
                font-size: clamp(14px, 2.6vw, 16px);
                width: 80%;
                max-width: 300px;
                min-height: 60px;
            }
            .completion-emoji {
        width: clamp(50px, 10vw, 80px);
        height: clamp(50px, 10vw, 80px);
    }
    .completion-emoji::after {
        font-size: clamp(25px, 5vw, 40px);
    }
    .completion-message h2 {
        font-size: clamp(16px, 2.8vw, 18px);
    }
    .completion-message p {
        font-size: clamp(14px, 2.6vw, 16px);
    }
    .completion-message button {
        font-size: clamp(12px, 2.3vw, 14px);
        padding: 6px 12px;
    }
            .nav-button {
                font-size: 16px;
                padding: 8px 16px;
            }
            .submit-btn {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 10px 20px;
                min-width: 100px;
                border-radius: 8px;
            }
            .figure.figure-5-1 {
    width: 350px;
    height: 350px;
}
        }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>18. Дії над матрицями</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
       <a class="nav-button" href='tema5.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6l6-6"/>
            </svg>
            До теми 5
        </a>
        <a class="nav-button" href='index.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>

    <div id="modalOverlay"></div>

    <div id="theoryModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
          <details>
    <summary>Транспонування</summary>
    <p>Транспонована матриця – це матриця, яку отримують із даної матриці \( A \), замінюючи її рядки відповідними стовпцями. Така матриця позначається \( A^T \).</p>
    <p>Якщо матриця \( A \) має розмір \( m \times n \) (тобто \( m \) рядків і \( n \) стовпців), то після транспонування стає матрицею \( A^T \) розміром \( n \times m \). При цьому елемент \( a_{ij} \) у вихідній матриці \( A \) переміщується на позицію \( a_{ji} \) у транспонованій матриці \( A^T \).</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix}, \quad
        A^T = \begin{pmatrix}
            a_{11} & a_{21} & \cdots & a_{m1} \\
            a_{12} & a_{22} & \cdots & a_{m2} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{1n} & a_{2n} & \cdots & a_{mn}
        \end{pmatrix}
    \]</p>
    <p><span class="example-title">Приклад 5.2.</span> <span class="example-condition">Транспонувати матрицю \( A = \begin{pmatrix} 1 & -2 & 5 & 3 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Оскільки матриця має один рядок, його елементи записуємо у стовпець:</p>
    <p class="math-notation-centered">\[
        A^T = \begin{pmatrix} 1 \\ -2 \\ 5 \\ 3 \end{pmatrix}
    \]</p>
    <p><span class="example-title">Приклад 5.3.</span> <span class="example-condition">Транспонувати матрицю \( B = \begin{pmatrix} 2 & 0 & -1 \\ -5 & 4 & 6 \\ 1 & -3 & -2 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Перший рядок матриці \( B \) стає першим стовпцем матриці \( B^T \), другий рядок – другим стовпцем, третій рядок – третім стовпцем.</p>
    <p class="math-notation-centered">\[
        B^T = \begin{pmatrix}
            2 & -5 & 1 \\
            0 & 4 & -3 \\
            -1 & 6 & -2
        \end{pmatrix}
    \]</p>
</details>
          <details>
    <summary>Множення матриці на число</summary>
    <p>Щоб помножити матрицю на число, потрібно кожен її елемент помножити на це число. Добутком матриці \( A \) на число \( \lambda \) є матриця \( B = \lambda A \), де кожен елемент \( b_{ij} = \lambda a_{ij} \) для \( i = 1, 2, \ldots, m \); \( j = 1, 2, \ldots, n \).</p>
    <p>Тобто, для матриці</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix},
    \]</p>
    <p>добуток на число \( \lambda \) визначається як:</p>
    <p class="math-notation-centered">\[
        B = \lambda A = \begin{pmatrix}
            \lambda a_{11} & \lambda a_{12} & \cdots & \lambda a_{1n} \\
            \lambda a_{21} & \lambda a_{22} & \cdots & \lambda a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            \lambda a_{m1} & \lambda a_{m2} & \cdots & \lambda a_{mn}
        \end{pmatrix}, \quad \lambda \in \mathbb{R}.
    \]</p>
    <p><strong>Протилежна матриця.</strong> Протилежна матриця \( -A \) – це матриця, отримана множенням усіх елементів матриці \( A \) на \(-1\). Елементи \( -A \) мають протилежні знаки до елементів \( A \).</p>
    <p>Наприклад, для матриці</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            1 & -2 \\
            -3 & -4 \\
            6 & -7
        \end{pmatrix},
    \]</p>
    <p>протилежна матриця:</p>
    <p class="math-notation-centered">\[
        -A = \begin{pmatrix}
            -1 & 2 \\
            3 & 4 \\
            -6 & 7
        \end{pmatrix}.
    \]</p>
    <p><span class="example-title">Приклад 5.4.</span> <span class="example-condition">Помножити матрицю \( A = \begin{pmatrix} 12 & -1 \\ 0 & 5 \end{pmatrix} \) на число \( 3 \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Кожен елемент матриці \( A \) множимо на \( 3 \):</p>
    <p class="math-notation-centered">\[
        3A = 3 \cdot \begin{pmatrix} 12 & -1 \\ 0 & 5 \end{pmatrix} = \begin{pmatrix} 3 \cdot 12 & 3 \cdot (-1) \\ 3 \cdot 0 & 3 \cdot 5 \end{pmatrix} = \begin{pmatrix} 36 & -3 \\ 0 & 15 \end{pmatrix}.
    \]</p>
    <p><strong>Відповідь.</strong> \( 3A = \begin{pmatrix} 36 & -3 \\ 0 & 15 \end{pmatrix} \).</p>
</details>
           <details>
    <summary>Додавання та віднімання матриць</summary>
    <p>Додавання та віднімання матриць – це прості операції, які полягають у додаванні або відніманні відповідних елементів двох матриць. Однак, для того щоб виконати ці дії, матриці повинні бути однакового розміру (мати однакову кількість рядків і стовпців). Наприклад, матрицю розміром \( 3 \times 2 \) можна додавати чи віднімати лише з іншою матрицею розміру \( 3 \times 2 \).</p>
    <p><strong>Додавання матриць.</strong> Якщо матриці \( A \) і \( B \) мають однакові розміри \( m \times n \), то їхня сума \( C = A + B \) також буде матриця розміру \( m \times n \), де кожен елемент \( c_{ij} \) визначається як сума відповідних елементів матриць \( A \) і \( B \):</p>
    <p class="math-notation-centered">\[ c_{ij} = a_{ij} + b_{ij} \]</p>
    <p>Тобто для матриць</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix}, \quad
        B = \begin{pmatrix}
            b_{11} & b_{12} & \cdots & b_{1n} \\
            b_{21} & b_{22} & \cdots & b_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            b_{m1} & b_{m2} & \cdots & b_{mn}
        \end{pmatrix},
    \]</p>
    <p>сума матриць буде:</p>
    <p class="math-notation-centered">\[
        C = A + B = \begin{pmatrix}
            a_{11} + b_{11} & a_{12} + b_{12} & \cdots & a_{1n} + b_{1n} \\
            a_{21} + b_{21} & a_{22} + b_{22} & \cdots & a_{2n} + b_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} + b_{m1} & a_{m2} + b_{m2} & \cdots & a_{mn} + b_{mn}
        \end{pmatrix}.
    \]</p>
    <p><strong>Віднімання матриць.</strong> Якщо матриці \( A \) і \( B \) мають однакові розміри \( m \times n \), то їхня різниця \( C = A - B \) також буде матриця розміру \( m \times n \), де кожен елемент \( c_{ij} \) визначається як різниця відповідних елементів матриць \( A \) і \( B \):</p>
    <p class="math-notation-centered">\[ c_{ij} = a_{ij} - b_{ij} \]</p>
    <p>Тобто для матриць</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix}, \quad
        B = \begin{pmatrix}
            b_{11} & b_{12} & \cdots & b_{1n} \\
            b_{21} & b_{22} & \cdots & b_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            b_{m1} & b_{m2} & \cdots & b_{mn}
        \end{pmatrix},
    \]</p>
    <p>різниця матриць буде:</p>
    <p class="math-notation-centered">\[
        C = A - B = \begin{pmatrix}
            a_{11} - b_{11} & a_{12} - b_{12} & \cdots & a_{1n} - b_{1n} \\
            a_{21} - b_{21} & a_{22} - b_{22} & \cdots & a_{2n} - b_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} - b_{m1} & a_{m2} - b_{m2} & \cdots & a_{mn} - b_{mn}
        \end{pmatrix}.
    \]</p>
    <p><span class="example-title">Приклад 5.5.</span> <span class="example-condition">Додати матриці \( A = \begin{pmatrix} 12 & -1 \\ -5 & 0 \end{pmatrix} \) і \( B = \begin{pmatrix} -4 & -3 \\ 15 & 7 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Додаємо відповідні елементи матриць \( A \) і \( B \):</p>
    <p class="math-notation-centered">\[
        A + B = \begin{pmatrix} 12 & -1 \\ -5 & 0 \end{pmatrix} + \begin{pmatrix} -4 & -3 \\ 15 & 7 \end{pmatrix} = \begin{pmatrix} 12 + (-4) & -1 + (-3) \\ -5 + 15 & 0 + 7 \end{pmatrix} = \begin{pmatrix} 8 & -4 \\ 10 & 7 \end{pmatrix}.
    \]</p>
    <p>Додавання матриць відбувається за правилом покомпонентного додавання. Головне – щоб матриці мали однаковий розмір.</p>
    <p><strong>Відповідь.</strong> \( A + B = \begin{pmatrix} 8 & -4 \\ 10 & 7 \end{pmatrix} \).</p>
    <p><span class="example-title">Приклад 5.6.</span> <span class="example-condition">Знайти різницю матриць \( C = \begin{pmatrix} 3 & 5 & -17 \\ -1 & 0 & 10 \end{pmatrix} \) і \( D = \begin{pmatrix} -4 & 3 & -15 \\ -5 & -7 & 0 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p><strong>Спосіб 1. Безпосереднє віднімання.</strong> Віднімаємо відповідні елементи матриць \( C \) і \( D \):</p>
    <p class="math-notation-centered">\[
        C - D = \begin{pmatrix} 3 & 5 & -17 \\ -1 & 0 & 10 \end{pmatrix} - \begin{pmatrix} -4 & 3 & -15 \\ -5 & -7 & 0 \end{pmatrix} = \begin{pmatrix} 3 - (-4) & 5 - 3 & -17 - (-15) \\ -1 - (-5) & 0 - (-7) & 10 - 0 \end{pmatrix} = \begin{pmatrix} 7 & 2 & -2 \\ 4 & 7 & 10 \end{pmatrix}.
    \]</p>
    <p><strong>Спосіб 2. Через додавання протилежної матриці.</strong> Щоб спростити, запишемо протилежну матрицю \( -D \), замінивши знаки елементів матриці \( D \):</p>
    <p class="math-notation-centered">\[
        -D = \begin{pmatrix} 4 & -3 & 15 \\ 5 & 7 & 0 \end{pmatrix}.
    \]</p>
    <p>Тоді:</p>
    <p class="math-notation-centered">\[
        C - D = C + (-D) = \begin{pmatrix} 3 & 5 & -17 \\ -1 & 0 & 10 \end{pmatrix} + \begin{pmatrix} 4 & -3 & 15 \\ 5 & 7 & 0 \end{pmatrix} = \begin{pmatrix} 7 & 2 & -2 \\ 4 & 7 & 10 \end{pmatrix}.
    \]</p>
    <p><strong>Відповідь.</strong> \( C - D = \begin{pmatrix} 7 & 2 & -2 \\ 4 & 7 & 10 \end{pmatrix} \).</p>
</details>
           <details>
    <summary>Властивості лінійних операцій над матрицями</summary>
    <p>Дії додавання, віднімання та множення матриць на число (скаляр, позначений як \( \lambda \) або \( \mu \)) називаються лінійними операціями над матрицями. Ці операції мають певні властивості, які можна перевірити, а саме:</p>
    <ol>
        <li>\( A + B = B + A \).</li>
        <li>\( (A + B) + C = A + (B + C) \).</li>
        <li>\( A + O = A \), де \( O \) – нульова матриця.</li>
        <li>\( A + (-A) = O \).</li>
        <li>\( E \cdot A = A \), де \( E \) – одинична матриця.</li>
        <li>\( \lambda (\mu A) = (\lambda \mu) A \).</li>
        <li>\( \lambda (A + B) = \lambda A + \lambda B \).</li>
        <li>\( (\lambda + \mu) A = \lambda A + \mu A \).</li>
        <li>\( (A^T)^T = A \).</li>
        <li>\( (\lambda A)^T = \lambda A^T \).</li>
        <li>\( (A + B)^T = A^T + B^T \).</li>
    </ol>
    <p><span class="example-title">Приклад 5.7.</span> <span class="example-condition">Задані матриці \( A = \begin{pmatrix} -4 & 6 \\ 2 & 3 \\ 5 & 7 \end{pmatrix} \), \( B = \begin{pmatrix} 2 & -3 \\ 0 & 8 \\ 1 & 4 \end{pmatrix} \). Знайти: \( 2A - \frac{1}{2} B \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Спочатку обчислимо добутки \( 2A \) і \( -\frac{1}{2} B \):</p>
    <p class="math-notation-centered">\[
        2A = \begin{pmatrix} 2 \cdot (-4) & 2 \cdot 6 \\ 2 \cdot 2 & 2 \cdot 3 \\ 2 \cdot 5 & 2 \cdot 7 \end{pmatrix} = \begin{pmatrix} -8 & 12 \\ 4 & 6 \\ 10 & 14 \end{pmatrix},
    \]</p>
    <p class="math-notation-centered">\[
        -\frac{1}{2} B = \begin{pmatrix} -\frac{1}{2} \cdot 2 & -\frac{1}{2} \cdot (-3) \\ -\frac{1}{2} \cdot 0 & -\frac{1}{2} \cdot 8 \\ -\frac{1}{2} \cdot 1 & -\frac{1}{2} \cdot 4 \end{pmatrix} = \begin{pmatrix} -1 & \frac{3}{2} \\ 0 & -4 \\ -\frac{1}{2} & -2 \end{pmatrix}.
    \]</p>
    <p>Далі знаходимо різницю матриць \( 2A - \frac{1}{2} B \), що є сумою матриць \( 2A + \left(-\frac{1}{2} B\right) \):</p>
    <p class="math-notation-centered">\[
        2A - \frac{1}{2} B = 2A + \left(-\frac{1}{2} B\right) = \begin{pmatrix} -8 & 12 \\ 4 & 6 \\ 10 & 14 \end{pmatrix} + \begin{pmatrix} -1 & \frac{3}{2} \\ 0 & -4 \\ -\frac{1}{2} & -2 \end{pmatrix} = \begin{pmatrix} -8 + (-1) & 12 + \frac{3}{2} \\ 4 + 0 & 6 + (-4) \\ 10 + \left(-\frac{1}{2}\right) & 14 + (-2) \end{pmatrix} = \begin{pmatrix} -9 & \frac{27}{2} \\ 4 & 2 \\ \frac{19}{2} & 12 \end{pmatrix}.
    \]</p>
    <p><strong>Відповідь.</strong> \( 2A - \frac{1}{2} B = \begin{pmatrix} -9 & \frac{27}{2} \\ 4 & 2 \\ \frac{19}{2} & 12 \end{pmatrix} \).</p>
</details>
            <details>
    <summary>Множення матриць</summary>
    <p>Множення матриць – це ключова операція, яка вимагає дотримання певних умов щодо розмірності матриць. На відміну від додавання, віднімання, результат множення залежить від порядку матриць.</p>
    <p><strong>Умови множення.</strong> Щоб помножити дві матриці, кількість стовпців першої матриці має дорівнювати кількості рядків другої – лише тоді добуток буде визначений.</p>
    <p>Для множення матриць \( A \) (розміру \( m \times k \)) і \( B \) (розміру \( k \times n \)):</p>
    <p>кількість стовпців першої матриці (\( k \)) має дорівнювати кількості рядків другої матриці (\( k \)). Результат \( C = A \cdot B \) буде матрицею розміру \( m \times n \). Тобто</p>
    <p class="math-notation-centered">\[ A_{m \times k} \cdot B_{k \times n} = C_{m \times n}. \]</p>
    <p>Наприклад, розглянемо матриці \( A = \begin{pmatrix} -2 & 1 \\ 5 & 4 \end{pmatrix} \) (розмір \( 2 \times 2 \)) і \( B = \begin{pmatrix} 3 \\ -1 \end{pmatrix} \) (розмір \( 2 \times 1 \)):</p>
    <p>Чи можна виконати множення \( A \cdot B \)? Так, адже кількість стовпців матриці \( A \) (2 стовпці) дорівнює кількості рядків матриці \( B \) (2 рядки). Результатом множення \( A \cdot B \) буде нова матриця розміру \( 2 \times 1 \).</p>
    <p>А якщо поміняти матриці місцями, тобто спробувати помножити \( B \cdot A \), чи буде таке множення можливим? Ні, адже кількість стовпців матриці \( B \) (1 стовпець) не збігається з кількістю рядків матриці \( A \) (2 рядки). Отже, добуток \( B \cdot A \) не визначений.</p>
    <p><strong>Множення матриці-рядка на матрицю-стовпець.</strong> Розглянемо операцію множення матриці-рядка \( A \) на матрицю-стовпець \( B \). Припустимо, що матриця \( A \) є рядком розмірності \( 1 \times n \):</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix} a_{11} & a_{12} & \cdots & a_{1n} \end{pmatrix},
    \]</p>
    <p>а матриця \( B \) є стовпцем розмірності \( n \times 1 \):</p>
    <p class="math-notation-centered">\[
        B = \begin{pmatrix} b_{11} \\ b_{21} \\ \vdots \\ b_{n1} \end{pmatrix}.
    \]</p>
    <p>Добуток \( A \cdot B \) є матрицею розмірності \( 1 \times 1 \), тобто скалярним значенням (числом). Цей добуток обчислюється за формулою:</p>
    <p class="math-notation-centered">\[
        A \cdot B = \begin{pmatrix} a_{11} & a_{12} & \cdots & a_{1n} \end{pmatrix} \cdot \begin{pmatrix} b_{11} \\ b_{21} \\ \vdots \\ b_{n1} \end{pmatrix} = a_{11} b_{11} + a_{12} b_{21} + \cdots + a_{1n} b_{n1}.
    \]</p>
    <p>Ця формула відповідає скалярному добуту векторів, які представлені матрицею-рядком \( A \) та матрицею-стовпцем \( B \) у \( n \)-вимірному просторі.</p>
    <p><span class="example-title">Приклад 5.8.</span> <span class="example-condition">Задано матриці \( A = \begin{pmatrix} -1 & 3 & 2 \end{pmatrix} \) та \( B = \begin{pmatrix} 4 \\ -5 \\ 1 \end{pmatrix} \). Необхідно знайти \( A \cdot B \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Оскільки кількість стовпців у матриці \( A \) (3) дорівнює кількості рядків у \( B \) (3), множення можливе, і результат буде матрицею розміром \( 1 \times 1 \), тобто числом.</p>
    <p class="math-notation-centered">\[
        A \cdot B = \begin{pmatrix} -1 & 3 & 2 \end{pmatrix} \cdot \begin{pmatrix} 4 \\ -5 \\ 1 \end{pmatrix} = (-1) \cdot 4 + 3 \cdot (-5) + 2 \cdot 1 = -4 - 15 + 2 = -17.
    \]</p>
    <p><strong>Відповідь.</strong> \( A \cdot B = -17 \).</p>
    <p><strong>Множення матриці на матрицю-стовпець.</strong> Множення матриці на матрицю-стовпець виконується за правилом «рядок на стовпець». Нехай дана матриця \( A \) розмірності \( m \times n \) і матриця-стовпець \( B \) розмірності \( n \times 1 \). Наприклад:</p>
    <p class="math-notation-centered">\[
        A = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix}, \quad
        B = \begin{pmatrix} b_{11} \\ b_{21} \\ \vdots \\ b_{n1} \end{pmatrix}.
    \]</p>
    <p>Добуток \( A \cdot B \) є матрицею розмірності \( m \times 1 \) (стовпцем із \( m \) елементів). Кожен елемент результату обчислюється як сума добутків елементів \( i \)-го рядка матриці \( A \) на відповідні елементи стовпця \( B \):</p>
    <p class="math-notation-centered">\[
        A \cdot B = \begin{pmatrix}
            a_{11} & a_{12} & \cdots & a_{1n} \\
            a_{21} & a_{22} & \cdots & a_{2n} \\
            \vdots & \vdots & \ddots & \vdots \\
            a_{m1} & a_{m2} & \cdots & a_{mn}
        \end{pmatrix} \cdot \begin{pmatrix} b_{11} \\ b_{21} \\ \vdots \\ b_{n1} \end{pmatrix} = \begin{pmatrix}
            a_{11} b_{11} + a_{12} b_{21} + \cdots + a_{1n} b_{n1} \\
            a_{21} b_{11} + a_{22} b_{21} + \cdots + a_{2n} b_{n1} \\
            \vdots \\
            a_{m1} b_{11} + a_{m2} b_{21} + \cdots + a_{mn} b_{n1}
        \end{pmatrix}.
    \]</p>
    <p><span class="example-title">Приклад 5.9.</span> <span class="example-condition">Помножити матрицю \( A = \begin{pmatrix} -2 & 1 \\ 5 & 4 \end{pmatrix} \) на матрицю \( B = \begin{pmatrix} 3 \\ -1 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Згідно з правилом множення матриці на матрицю-стовпець, кожен елемент результату – це сума добутків елементів рядка матриці \( A \) на відповідні елементи стовпця \( B \):</p>
    <p class="math-notation-centered">\[
        A \cdot B = \begin{pmatrix} -2 & 1 \\ 5 & 4 \end{pmatrix} \cdot \begin{pmatrix} 3 \\ -1 \end{pmatrix} = \begin{pmatrix} (-2) \cdot 3 + 1 \cdot (-1) \\ 5 \cdot 3 + 4 \cdot (-1) \end{pmatrix} = \begin{pmatrix} -7 \\ 11 \end{pmatrix}.
    \]</p>
    <p><strong>Відповідь.</strong> \( A \cdot B = \begin{pmatrix} -7 \\ 11 \end{pmatrix} \).</p>
    <p><strong>Множення матриці на матрицю.</strong> Добутком матриці \( A_{m \times k} \) на матрицю \( B_{k \times n} \) називають матрицю \( C_{m \times n} \), кожен елемент \( c_{ij} \) якої дорівнює сумі добутків елементів \( i \)-го рядка матриці \( A \) на відповідні елементи \( j \)-го стовпця матриці \( B \). Це записується так:</p>
    <p class="math-notation-centered">\[
        c_{ij} = a_{i1} b_{1j} + a_{i2} b_{2j} + \dots + a_{ik} b_{kj},
    \]</p>
    <p>де \( i = 1, 2, \dots, m \), \( j = 1, 2, \dots, n \).</p>
    <p>Процес множення матриць \( A_{m \times k} \cdot B_{k \times n} = C_{m \times n} \) можна наочно проілюструвати за допомогою схеми (рис. 5.1), на якій стрілки показують, як \( i \)-й рядок матриці \( A \) перемножується з \( j \)-им стовпцем матриці \( B \), утворюючи елемент \( c_{ij} \) матриці \( C \).</p>
    <p style="text-align: center;"><img src="static/figure5.1.jpg" alt="Схема множення матриць" class="figure figure-5-1"></p>
    <p><strong>Властивості множення.</strong> Множення матриць, як правило, не є комутативним, тобто \( A \cdot B \neq B \cdot A \). Для квадратних матриць розмірності \( n \times n \) обидва добутки \( A \cdot B \) і \( B \cdot A \) завжди визначені, проте зазвичай дають різні результати. Для неквадратних матриць добуток \( B \cdot A \) може бути невизначеним, якщо їхні розмірності не дозволяють операцію множення (наприклад, коли \( n \neq m \)). Якщо ж для деяких матриць \( A \) і \( B \) виконується рівність \( A \cdot B = B \cdot A \), такі матриці називають переставними. Варто зазначити, що цей випадок є рідкісним і не характерним для загальної ситуації.</p>
    <p><span class="example-title">Приклад 5.10.</span> <span class="example-condition">Помножити матрицю \( A = \begin{pmatrix} 5 & 8 & -4 \\ 6 & 9 & -5 \\ 4 & 7 & -3 \end{pmatrix} \) на матрицю \( B = \begin{pmatrix} 3 & 2 & 5 \\ 4 & -1 & 3 \\ 9 & 6 & 5 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Множення матриць \( A \) та \( B \) можливе, оскільки кількість стовпців матриці \( A \) (3) дорівнює кількості рядків матриці \( B \) (3). Результатом буде матриця розмірності \( 3 \times 3 \).</p>
    <p>За правилом множення матриць, кожен елемент результуючої матриці \( C = A \cdot B \) обчислюється як сума добутків елементів \( i \)-го рядка матриці \( A \) на відповідні елементи \( j \)-го стовпця матриці \( B \). Розпишемо покроково:</p>
    <p class="math-notation-centered">\[
        A \cdot B = \begin{pmatrix} 5 & 8 & -4 \\ 6 & 9 & -5 \\ 4 & 7 & -3 \end{pmatrix} \cdot \begin{pmatrix} 3 & 2 & 5 \\ 4 & -1 & 3 \\ 9 & 6 & 5 \end{pmatrix}.
    \]</p>
    <p>Обчислюємо елементи \( c_{ij} \) матриці \( C \). <strong>Перший рядок:</strong></p>
    <p class="math-notation-centered">\[
        c_{11} = 5 \cdot 3 + 8 \cdot 4 + (-4) \cdot 9 = 15 + 32 - 36 = 11,
    \]</p>
    <p class="math-notation-centered">\[
        c_{12} = 5 \cdot 2 + 8 \cdot (-1) + (-4) \cdot 6 = 10 - 8 - 24 = -22,
    \]</p>
    <p class="math-notation-centered">\[
        c_{13} = 5 \cdot 5 + 8 \cdot 3 + (-4) \cdot 5 = 25 + 24 - 20 = 29.
    \]</p>
    <p><strong>Другий рядок:</strong></p>
    <p class="math-notation-centered">\[
        c_{21} = 6 \cdot 3 + 9 \cdot 4 + (-5) \cdot 9 = 18 + 36 - 45 = 9,
    \]</p>
    <p class="math-notation-centered">\[
        c_{22} = 6 \cdot 2 + 9 \cdot (-1) + (-5) \cdot 6 = 12 - 9 - 30 = -27,
    \]</p>
    <p class="math-notation-centered">\[
        c_{23} = 6 \cdot 5 + 9 \cdot 3 + (-5) \cdot 5 = 30 + 27 - 25 = 32.
    \]</p>
    <p><strong>Третій рядок:</strong></p>
    <p class="math-notation-centered">\[
        c_{31} = 4 \cdot 3 + 7 \cdot 4 + (-3) \cdot 9 = 12 + 28 - 27 = 13,
    \]</p>
    <p class="math-notation-centered">\[
        c_{32} = 4 \cdot 2 + 7 \cdot (-1) + (-3) \cdot 6 = 8 - 7 - 18 = -17,
    \]</p>
    <p class="math-notation-centered">\[
        c_{33} = 4 \cdot 5 + 7 \cdot 3 + (-3) \cdot 5 = 20 + 21 - 15 = 26.
    \]</p>
    <p>Отже, результуюча матриця має вигляд:</p>
    <p class="math-notation-centered">\[
        C = A \cdot B = \begin{pmatrix} 11 & -22 & 29 \\ 9 & -27 & 32 \\ 13 & -17 & 26 \end{pmatrix}.
    \]</p>
    <p><strong>Відповідь.</strong> \( A \cdot B = \begin{pmatrix} 11 & -22 & 29 \\ 9 & -27 & 32 \\ 13 & -17 & 26 \end{pmatrix} \).</p>
    <p style="text-align: center;"><strong>Властивості множення матриць.</strong></p>

    <ol>
        <li>\( (A \cdot B) \cdot C = A \cdot (B \cdot C) \).</li>
        <li>\( (\lambda A) \cdot B = A \cdot (\lambda B) \), де \( \lambda \) – скаляр (число).</li>
        <li>\( (A + B) \cdot C = A \cdot C + B \cdot C \).</li>
        <li>\( C \cdot (A + B) = C \cdot A + C \cdot B \).</li>
        <li>\( A^k = A \cdot A \cdot \dots \cdot A \), де \( A \) – квадратна матриця і \( k \in \mathbb{N} \).</li>
        <li>\( (A \cdot B)^T = B^T \cdot A^T \).</li>
        <li>\( A \cdot E = E \cdot A = A \), де \( A \) – квадратна матриця, \( E \) – одинична матриця відповідного розміру.</li>
    </ol>
</details>
        </div>
    </div>

    <div id="videoModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <h2 class="glow-title">Оберіть відео</h2>
        <div class="video-card-container">
            <div class="video-card" data-video="1">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Транспонування прямокутної матриці</h3>
            </div>
            <div class="video-card" data-video="2">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Множення матриці на число (скаляр)</h3>
            </div>
            <div class="video-card" data-video="3">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Додавання та віднімання матриць</h3>
            </div>
            <div class="video-card" data-video="4">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Множення матриці на матрицю</h3>
            </div>
            <div class="video-card" data-video="5">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Множення матриць</h3>
            </div>
        </div>
    </div>
</div>

<div id="videoPlayerModal1" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer1" width="100%" src="https://www.youtube.com/embed/W-FcaquDpjo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal2" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer2" width="100%" src="https://www.youtube.com/embed/syJdUa-QYVc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal3" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn3">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer3" width="100%" src="https://www.youtube.com/embed/llxi11Yuucw" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal4" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn4">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer4" width="100%" src="https://www.youtube.com/embed/GyJfT9uWgZ8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal5" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn5">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer5" width="100%" src="https://www.youtube.com/embed/36nNdwS-TxY" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

    <div id="questionsModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeQuestionsBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    1. Що таке транспонування матриці?
                </div>
                <div class="card-back">
                    <p>Транспонування матриці – це операція, при якій рядки матриці перетворюються на стовпці, а стовпці – на рядки. Транспонована матриця позначається \( A^T \). Якщо матриця \( A \) має розмір \( m \times n \), то після транспонування вона матиме розмір \( n \times m \).</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    2. Як помножити матрицю на число?
                </div>
                <div class="card-back">
                    <p>Щоб помножити матрицю на число, потрібно кожен її елемент помножити на це число. Якщо \( \lambda \in \mathbb{R} \) і матриця \( A = (a_{ij}) \), то добуток \( \lambda A = (\lambda a_{ij}) \).</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    3. Які умови потрібні для додавання матриць?
                </div>
                <div class="card-back">
                    <p>Матриці повинні мати однаковий розмір, тобто однакову кількість рядків і стовпців.</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    4. Як знайти суму та різницю двох матриць?
                </div>
                <div class="card-back">
                    <p>Додавання та віднімання матриць виконується покомпонентно: кожен елемент результату дорівнює сумі або різниці відповідних елементів двох матриць. Умова: матриці повинні мати однаковий розмір.</p>
                    <p>Формули:</p>
                    <p class="math-notation-centered">\[
                        (A + B)_{ij} = a_{ij} + b_{ij}, \quad (A - B)_{ij} = a_{ij} - b_{ij}.
                    \]</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    5. Яка умова множення двох матриць?
                </div>
                <div class="card-back">
                    <p>Кількість стовпців першої матриці має дорівнювати кількості рядків другої матриці.</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    6. Що таке добуток матриць?
                </div>
                <div class="card-back">
                    <p>Добутком матриці \( A_{m \times k} \) на матрицю \( B_{k \times n} \) називають матрицю \( C_{m \times n} \), елементи якої обчислюються за формулою:</p>
                    <p class="math-notation-centered">\[
                        c_{ij} = a_{i1} b_{1j} + a_{i2} b_{2j} + \dots + a_{ik} b_{kj},
                    \]</p>
                    <p>де \( i = 1, 2, \dots, m \), \( j = 1, 2, \dots, n \).</p>
                </div>
            </div>
        </div>
    </div>
</div>

  <div id="trainerModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeTrainerBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container" id="trainerContent">
            <div class="question-number" id="questionNumber">Питання 1</div>
            <p class="trainer-question" id="trainerQuestion"></p>
            <div id="matrixDisplay" class="math-notation-centered"></div>
            <div class="answer-buttons" id="answerButtons"></div>
            <button class="submit-btn" id="submitAnswerBtn" disabled>Відповісти</button>
            <p id="feedback"></p>
        </div>
        <div id="completionScreen" class="completion-message hidden">
            <div class="completion-emoji"></div>
            <h2>Тестування завершено!</h2>
            <p>Молодець!</p>
            <button id="resetTrainerBtn">Спробувати ще раз</button>
        </div>
    </div>
</div>

  <script>
// Ініціалізація модальних вікон
const modals = {
    theory: document.getElementById('theoryModal'),
    video: document.getElementById('videoModal'),
    questions: document.getElementById('questionsModal'),
    trainer: document.getElementById('trainerModal'),
    videoPlayer1: document.getElementById('videoPlayerModal1'),
    videoPlayer2: document.getElementById('videoPlayerModal2'),
    videoPlayer3: document.getElementById('videoPlayerModal3'),
    videoPlayer4: document.getElementById('videoPlayerModal4'),
    videoPlayer5: document.getElementById('videoPlayerModal5')
};

// Ініціалізація кнопок
const buttons = {
    openTheory: document.getElementById('openTheoryBtn'),
    openVideo: document.getElementById('openVideoBtn'),
    openQuestions: document.getElementById('openQuestionsBtn'),
    openTrainer: document.getElementById('openTrainerBtn'),
    closeTheory: document.getElementById('closeTheoryBtn'),
    closeVideo: document.getElementById('closeVideoBtn'),
    closeQuestions: document.getElementById('closeQuestionsBtn'),
    closeTrainer: document.getElementById('closeTrainerBtn'),
    closeVideoPlayer1: document.getElementById('closeVideoPlayerBtn1'),
    closeVideoPlayer2: document.getElementById('closeVideoPlayerBtn2'),
    closeVideoPlayer3: document.getElementById('closeVideoPlayerBtn3'),
    closeVideoPlayer4: document.getElementById('closeVideoPlayerBtn4'),
    closeVideoPlayer5: document.getElementById('closeVideoPlayerBtn5'),
    submitAnswer: document.getElementById('submitAnswerBtn')
};

// Оверлей
const overlay = document.getElementById('modalOverlay');

// Ініціалізація YouTube-плеєрів
const youtubePlayers = {
    1: document.getElementById('youtubePlayer1'),
    2: document.getElementById('youtubePlayer2'),
    3: document.getElementById('youtubePlayer3'),
    4: document.getElementById('youtubePlayer4'),
    5: document.getElementById('youtubePlayer5')
};

// Ініціалізація елементів тренажера
const trainerContent = document.getElementById('trainerContent');
const questionNumber = document.getElementById('questionNumber');
const trainerQuestion = document.getElementById('trainerQuestion');
const matrixDisplay = document.getElementById('matrixDisplay');
const answerButtons = document.getElementById('answerButtons');
const feedback = document.getElementById('feedback');
const completionScreen = document.getElementById('completionScreen');
const resetTrainerBtn = document.getElementById('resetTrainerBtn');
const submitAnswerBtn = document.getElementById('submitAnswerBtn');

// Ініціалізація змінних тренажера
let currentQuestion = 1;
let selectedAnswer = null;
let incorrectAttempts = 0;
const maxIncorrectAttempts = 3;
let scrollPosition = 0;
let correctAnswerLatex = ''; // Зберігаємо правильну відповідь

// Перевірка наявності елементів
function checkElements() {
    Object.entries(modals).forEach(([key, modal]) => {
        if (!modal) console.error(`Modal ${key} not found`);
    });
    Object.entries(buttons).forEach(([key, button]) => {
        if (!button) console.error(`Button ${key} not found`);
    });
    if (!overlay) console.error('Overlay not found');
    if (!trainerContent) console.error('trainerContent not found');
    if (!questionNumber) console.error('questionNumber not found');
    if (!trainerQuestion) console.error('trainerQuestion not found');
    if (!matrixDisplay) console.error('matrixDisplay not found');
    if (!answerButtons) console.error('answerButtons not found');
    if (!feedback) console.error('feedback not found');
    if (!completionScreen) console.error('completionScreen not found');
    if (!resetTrainerBtn) console.error('resetTrainerBtn not found');
    if (!submitAnswerBtn) console.error('submitAnswerBtn not found');
    if (!completionScreen.querySelector('.completion-emoji')) console.error('completion-emoji not found');
    if (!completionScreen.querySelector('.completion-message h2')) console.error('completion-message h2 not found');
    if (!completionScreen.querySelector('.completion-message p')) console.error('completion-message p not found');
}
checkElements();

// Функція для відкриття модального вікна
function openModal(modal) {
    console.log('Opening modal:', modal.id);
    overlay.style.display = 'block';
    modal.style.display = 'flex';
    modal.classList.add('show');
    scrollPosition = window.pageYOffset;
    document.body.classList.add('modal-open');
    document.body.style.top = `-${scrollPosition}px`;
}

// Функція для закриття модального вікна
function closeModal(modal) {
    console.log('Closing modal:', modal.id);
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
        if (modal.id.includes('videoPlayer')) {
            const iframe = modal.querySelector('iframe');
            if (iframe) iframe.src = iframe.src;
            openModal(modals.video);
        } else {
            overlay.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo(0, scrollPosition);
        }
    }, 250);
}

// Функція для генерації випадкового цілого числа
function getRandomInt(min = -9, max = 9) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Функція для перемішування масиву
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Функція для вибору відповіді
function selectAnswer(btn) {
    console.log('Answer selected:', btn.innerHTML);
    document.querySelectorAll('.answer-btn').forEach(button => {
        button.classList.remove('selected');
    });
    btn.classList.add('selected');
    selectedAnswer = btn;
    submitAnswerBtn.disabled = false;
}

// Функція для рендерингу MathJax
function typesetMath(context = 'general', elements = null) {
    if (window.mathJaxReady && typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function') {
        console.log(`Starting MathJax typeset for ${context}`);
        MathJax.typesetClear(elements || undefined);
        MathJax.typesetPromise(elements || undefined).then(() => {
            console.log(`MathJax typeset complete for ${context}`);
        }).catch(err => {
            console.error(`MathJax typesetting error in ${context}:`, err);
            feedback.textContent = 'Помилка рендерингу формули. Спробуйте ще раз!';
            feedback.className = 'feedback incorrect';
        });
    } else {
        console.warn(`MathJax not ready or typesetPromise unavailable in ${context}`);
        feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
        feedback.className = 'feedback incorrect';
    }
}

// Функція для очікування MathJax
function waitForMathJax(callback, context = 'general', maxAttempts = 100, interval = 200) {
    let attempts = 0;
    console.log(`Waiting for MathJax in ${context}`);
    const checkMathJax = setInterval(() => {
        if (window.mathJaxReady && typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function') {
            clearInterval(checkMathJax);
            console.log(`MathJax ready for ${context}, executing callback`);
            callback();
        } else if (attempts >= maxAttempts) {
            clearInterval(checkMathJax);
            console.warn(`MathJax not loaded after ${maxAttempts * interval}ms in ${context}`);
            feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
            feedback.className = 'feedback incorrect';
            callback();
        }
        attempts++;
    }, interval);
}

// Функція для генерації питання 1
function generateQuestion1() {
    try {
        // Визначаємо можливі розмірності
        const dimensions = [
            { rows: 1, cols: 3 },
            { rows: 2, cols: 3 },
            { rows: 3, cols: 3 },
            { rows: 3, cols: 1 },
            { rows: 3, cols: 2 },
            { rows: 2, cols: 2 }
        ];
        const { rows, cols } = dimensions[Math.floor(Math.random() * dimensions.length)];

        // Генеруємо матрицю з числами від -9 до 9
        const matrix = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );

        // Правильна відповідь: транспонована матриця
        const correctTranspose = Array.from({ length: cols }, (v, i) =>
            Array.from({ length: rows }, (w, j) => matrix[j][i])
        );
        const correctLatex = `\\begin{pmatrix} ${correctTranspose.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        correctAnswerLatex = correctLatex; // Зберігаємо для перевірки

        // Генеруємо неправильні відповіді
        const incorrectAnswers = [];

        // Неправильна 1: поміняти місцями рядки (якщо можливо)
        let incorrect1;
        if (rows > 1) {
            incorrect1 = [...matrix].reverse(); // Реверс рядків
        } else {
            incorrect1 = [...matrix]; // Якщо 1 рядок, копіюємо матрицю
            incorrect1[0] = [...incorrect1[0]].reverse(); // Реверс елементів у рядку
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect1.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 2: поміняти місцями стовпці транспонованої матриці (якщо можливо)
        let incorrect2 = [...correctTranspose];
        if (cols > 1) {
            incorrect2 = incorrect2.map(row => [...row].reverse()); // Реверс стовпців
        } else {
            incorrect2 = [...incorrect2];
            incorrect2[0] = [...incorrect2[0]].reverse(); // Реверс елементів у стовпці
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect2.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 3: транспонована матриця з двома елементами, поміняними місцями
        let incorrect3 = correctTranspose.map(row => [...row]);
        if (rows * cols >= 2) {
            let pos1, pos2;
            do {
                pos1 = { row: Math.floor(Math.random() * cols), col: Math.floor(Math.random() * rows) };
                pos2 = { row: Math.floor(Math.random() * cols), col: Math.floor(Math.random() * rows) };
            } while (pos1.row === pos2.row && pos1.col === pos2.col);
            [incorrect3[pos1.row][pos1.col], incorrect3[pos2.row][pos2.col]] = [
                incorrect3[pos2.row][pos2.col],
                incorrect3[pos1.row][pos1.col]
            ];
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect3.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Перевіряємо унікальність відповідей
        const uniqueAnswers = new Set();
        incorrectAnswers.forEach(ans => uniqueAnswers.add(ans.text));
        uniqueAnswers.add(correctLatex);
        if (uniqueAnswers.size < 4) {
            console.log('Duplicate answers detected, regenerating question');
            return generateQuestion1(); // Рекурсивно генеруємо, якщо є дублі
        }

        // Додаємо правильну відповідь
        const answerOptions = [
            { text: correctLatex, correct: true },
            ...incorrectAnswers
        ];

        // Перемішуємо відповіді
        const shuffledOptions = shuffleArray(answerOptions);

        // Відображаємо питання
        const matrixLatex = `\\begin{pmatrix} ${matrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 1';
        trainerQuestion.textContent = 'Знайдіть транспоновану матрицю для:';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `\\(${option.text}\\)`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        // Скидаємо стан
        submitAnswerBtn.disabled = true;
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';

        // Рендеринг MathJax
        waitForMathJax(() => typesetMath('trainer question 1', [matrixDisplay, answerButtons]), 'trainer question 1');
    } catch (err) {
        console.error('Error in generateQuestion1:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect';
    }
}

// Функція для генерації питання 2
function generateQuestion2() {
    try {
        // Визначаємо можливі розмірності
        const dimensions = [
            { rows: 1, cols: 3 },
            { rows: 2, cols: 3 },
            { rows: 3, cols: 3 },
            { rows: 3, cols: 1 },
            { rows: 3, cols: 2 },
            { rows: 2, cols: 2 }
        ];
        const { rows, cols } = dimensions[Math.floor(Math.random() * dimensions.length)];

        // Вибираємо випадковий множник
        const multipliers = [-5, -4, -3, -2, -1, 2, 3, 4, 5];
        const multiplier = multipliers[Math.floor(Math.random() * multipliers.length)];

        // Генеруємо матрицю з числами від -9 до 9
        const matrix = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );

        // Правильна відповідь: матриця, помножена на множник
        const correctMatrix = matrix.map(row => row.map(val => val * multiplier));
        const correctLatex = `\\begin{pmatrix} ${correctMatrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        correctAnswerLatex = correctLatex; // Зберігаємо для перевірки

        // Генеруємо неправильні відповіді
        const incorrectAnswers = [];

        // Неправильна 1: помножити лише перший стовпець
        let incorrect1 = matrix.map(row => [...row]);
        for (let i = 0; i < rows; i++) {
            incorrect1[i][0] *= multiplier; // Множимо перший стовпець
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect1.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 2: помножити лише діагональ (якщо є)
        let incorrect2 = matrix.map(row => [...row]);
        const diagLength = Math.min(rows, cols);
        for (let i = 0; i < diagLength; i++) {
            incorrect2[i][i] *= multiplier; // Множимо діагональні елементи
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect2.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 3: помножити лише перший рядок
        let incorrect3 = matrix.map(row => [...row]);
        if (rows > 0) {
            incorrect3[0] = incorrect3[0].map(val => val * multiplier); // Множимо перший рядок
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect3.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Перевіряємо унікальність відповідей
        const uniqueAnswers = new Set();
        incorrectAnswers.forEach(ans => uniqueAnswers.add(ans.text));
        uniqueAnswers.add(correctLatex);
        if (uniqueAnswers.size < 4) {
            console.log('Duplicate answers detected, regenerating question 2');
            return generateQuestion2(); // Рекурсивно генеруємо, якщо є дублі
        }

        // Додаємо правильну відповідь
        const answerOptions = [
            { text: correctLatex, correct: true },
            ...incorrectAnswers
        ];

        // Перемішуємо відповіді
        const shuffledOptions = shuffleArray(answerOptions);

        // Відображаємо питання
        const matrixLatex = `\\begin{pmatrix} ${matrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 2';
        trainerQuestion.textContent = `Помножте матрицю на число ${multiplier}:`;
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `\\(${option.text}\\)`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        // Скидаємо стан
        submitAnswerBtn.disabled = true;
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';

        // Рендеринг MathJax
        waitForMathJax(() => typesetMath('trainer question 2', [matrixDisplay, answerButtons]), 'trainer question 2');
    } catch (err) {
        console.error('Error in generateQuestion2:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect';
    }
}

// Функція для генерації питання 3
function generateQuestion3() {
    try {
        // Визначаємо можливі розмірності
        const dimensions = [
            { rows: 2, cols: 3 },
            { rows: 3, cols: 3 },
            { rows: 3, cols: 2 },
            { rows: 2, cols: 2 }
        ];
        const { rows, cols } = dimensions[Math.floor(Math.random() * dimensions.length)];

        // Генеруємо дві матриці з числами від -9 до 9
        const matrixA = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );
        const matrixB = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );

        // Правильна відповідь: сума матриць
        const correctSum = matrixA.map((row, i) =>
            row.map((val, j) => val + matrixB[i][j])
        );
        const correctLatex = `\\begin{pmatrix} ${correctSum.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        correctAnswerLatex = correctLatex; // Зберігаємо для перевірки

        // Генеруємо неправильні відповіді
        const incorrectAnswers = [];

        // Неправильна 1: додаємо лише перші стовпці
        let incorrect1 = matrixA.map(row => [...row]);
        for (let i = 0; i < rows; i++) {
            incorrect1[i][0] = matrixA[i][0] + matrixB[i][0]; // Додаємо лише перший стовпець
            for (let j = 1; j < cols; j++) {
                incorrect1[i][j] = matrixA[i][j]; // Решта елементів з matrixA
            }
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect1.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 2: додаємо усі елементи, крім останнього
        let incorrect2 = correctSum.map(row => [...row]);
        incorrect2[rows - 1][cols - 1] = matrixA[rows - 1][cols - 1]; // Останній елемент лише з matrixA
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect2.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 3: додаємо перші стовпці, а в другому стовпці перший елемент неправильний
        let incorrect3 = matrixA.map(row => [...row]);
        for (let i = 0; i < rows; i++) {
            incorrect3[i][0] = matrixA[i][0] + matrixB[i][0]; // Додаємо перший стовпець
        }
        if (cols > 1) {
            incorrect3[0][1] = matrixA[0][1] + getRandomInt(-9, 9); // Помилка в першому елементі другого стовпця
            for (let i = 1; i < rows; i++) {
                for (let j = 1; j < cols; j++) {
                    incorrect3[i][j] = matrixA[i][j]; // Решта елементів з matrixA
                }
            }
        }
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect3.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Перевіряємо унікальність відповідей
        const uniqueAnswers = new Set();
        incorrectAnswers.forEach(ans => uniqueAnswers.add(ans.text));
        uniqueAnswers.add(correctLatex);
        if (uniqueAnswers.size < 4) {
            console.log('Duplicate answers detected, regenerating question 3');
            return generateQuestion3(); // Рекурсивно генеруємо, якщо є дублі
        }

        // Додаємо правильну відповідь
        const answerOptions = [
            { text: correctLatex, correct: true },
            ...incorrectAnswers
        ];

        // Перемішуємо відповіді
        const shuffledOptions = shuffleArray(answerOptions);

        // Відображаємо питання
        const matrixALatex = `\\begin{pmatrix} ${matrixA.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        const matrixBLatex = `\\begin{pmatrix} ${matrixB.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 3';
        trainerQuestion.textContent = 'Знайдіть суму матриць:';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixALatex} + ${matrixBLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `\\(${option.text}\\)`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        // Скидаємо стан
        submitAnswerBtn.disabled = true;
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';

        // Рендеринг MathJax
        waitForMathJax(() => typesetMath('trainer question 3', [matrixDisplay, answerButtons]), 'trainer question 3');
    } catch (err) {
        console.error('Error in generateQuestion3:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect';
    }
}

// Функція для генерації питання 4
function generateQuestion4() {
    try {
        // Визначаємо можливі розмірності
        const dimensions = [
            { rows: 2, cols: 3 },
            { rows: 3, cols: 3 },
            { rows: 3, cols: 2 },
            { rows: 2, cols: 2 }
        ];
        const { rows, cols } = dimensions[Math.floor(Math.random() * dimensions.length)];

        // Генеруємо дві матриці з числами від -9 до 9
        const matrixA = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );
        const matrixB = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );

        // Правильна відповідь: різниця матриць
        const correctDiff = matrixA.map((row, i) =>
            row.map((val, j) => val - matrixB[i][j])
        );
        const correctLatex = `\\begin{pmatrix} ${correctDiff.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        correctAnswerLatex = correctLatex; // Зберігаємо для перевірки

        // Генеруємо неправильні відповіді
        const incorrectAnswers = [];

        // Неправильна 1: віднімаємо з помилками, де від'ємні числа віднімаємо як додатні
        let incorrect1 = matrixA.map((row, i) =>
            row.map((val, j) => {
                const diff = val - matrixB[i][j];
                return diff < 0 ? val + Math.abs(matrixB[i][j]) : diff;
            })
        );
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect1.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 2: помилка в одному елементі
        let incorrect2 = correctDiff.map(row => [...row]);
        const errorRow = Math.floor(Math.random() * rows);
        const errorCol = Math.floor(Math.random() * cols);
        incorrect2[errorRow][errorCol] = incorrect2[errorRow][errorCol] + getRandomInt(-9, 9);
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect2.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 3: три помилки в обчисленнях
        let incorrect3 = correctDiff.map(row => [...row]);
        let errorPositions = [];
        while (errorPositions.length < 3 && rows * cols >= 3) {
            const pos = { row: Math.floor(Math.random() * rows), col: Math.floor(Math.random() * cols) };
            if (!errorPositions.some(p => p.row === pos.row && p.col === pos.col)) {
                errorPositions.push(pos);
            }
        }
        errorPositions.forEach(pos => {
            incorrect3[pos.row][pos.col] = incorrect3[pos.row][pos.col] + getRandomInt(-9, 9);
        });
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect3.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Перевіряємо унікальність відповідей
        const uniqueAnswers = new Set();
        incorrectAnswers.forEach(ans => uniqueAnswers.add(ans.text));
        uniqueAnswers.add(correctLatex);
        if (uniqueAnswers.size < 4) {
            console.log('Duplicate answers detected, regenerating question 4');
            return generateQuestion4(); // Рекурсивно генеруємо, якщо є дублі
        }

        // Додаємо правильну відповідь
        const answerOptions = [
            { text: correctLatex, correct: true },
            ...incorrectAnswers
        ];

        // Перемішуємо відповіді
        const shuffledOptions = shuffleArray(answerOptions);

        // Відображаємо питання
        const matrixALatex = `\\begin{pmatrix} ${matrixA.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        const matrixBLatex = `\\begin{pmatrix} ${matrixB.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 4';
        trainerQuestion.textContent = 'Знайдіть різницю матриць:';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixALatex} - ${matrixBLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `\\(${option.text}\\)`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        // Скидаємо стан
        submitAnswerBtn.disabled = true;
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';

        // Рендеринг MathJax
        waitForMathJax(() => typesetMath('trainer question 4', [matrixDisplay, answerButtons]), 'trainer question 4');
    } catch (err) {
        console.error('Error in generateQuestion4:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect';
    }
}

// Функція для генерації питання 5
function generateQuestion5() {
    try {
        // Визначаємо розмірність (завжди 2×2)
        const rows = 2;
        const cols = 2;

        // Генеруємо дві матриці 2×2 з числами від -9 до 9
        const matrixA = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );
        const matrixB = Array.from({ length: rows }, () =>
            Array.from({ length: cols }, () => getRandomInt(-9, 9))
        );

        // Правильна відповідь: добуток матриць
        const correctProduct = [
            [
                matrixA[0][0] * matrixB[0][0] + matrixA[0][1] * matrixB[1][0],
                matrixA[0][0] * matrixB[0][1] + matrixA[0][1] * matrixB[1][1]
            ],
            [
                matrixA[1][0] * matrixB[0][0] + matrixA[1][1] * matrixB[1][0],
                matrixA[1][0] * matrixB[0][1] + matrixA[1][1] * matrixB[1][1]
            ]
        ];
        const correctLatex = `\\begin{pmatrix} ${correctProduct.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        correctAnswerLatex = correctLatex; // Зберігаємо для перевірки

        // Генеруємо неправильні відповіді
        const incorrectAnswers = [];

        // Неправильна 1: множення першого рядка на перший стовпець на a11, перший рядок на другий стовпець на a21, другий рядок на перший стовпець на a12, другий рядок на другий стовпець на a22
        const incorrect1 = [
            [matrixA[0][0] * matrixB[0][0] + matrixA[0][1] * matrixB[1][0], matrixA[1][0] * matrixB[0][0] + matrixA[1][1] * matrixB[1][0]],
            [matrixA[0][0] * matrixB[0][1] + matrixA[0][1] * matrixB[1][1], matrixA[1][0] * matrixB[0][1] + matrixA[1][1] * matrixB[1][1]]
        ];
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect1.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 2: множення a11 першої матриці на перший рядок другої матриці на a11, аналогічно інші
        const incorrect2 = [
            [matrixA[0][0] * matrixB[0][0], matrixA[0][0] * matrixB[0][1]],
            [matrixA[1][1] * matrixB[1][0], matrixA[1][1] * matrixB[1][1]]
        ];
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect2.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Неправильна 3: як правильна, але з однією помилкою у другому стовпці
        let incorrect3 = correctProduct.map(row => [...row]);
        incorrect3[Math.floor(Math.random() * 2)][1] += getRandomInt(-9, 9); // Помилка в другому стовпці
        incorrectAnswers.push({
            text: `\\begin{pmatrix} ${incorrect3.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`,
            correct: false
        });

        // Перевіряємо унікальність відповідей
        const uniqueAnswers = new Set();
        incorrectAnswers.forEach(ans => uniqueAnswers.add(ans.text));
        uniqueAnswers.add(correctLatex);
        if (uniqueAnswers.size < 4) {
            console.log('Duplicate answers detected, regenerating question 5');
            return generateQuestion5(); // Рекурсивно генеруємо, якщо є дублі
        }

        // Додаємо правильну відповідь
        const answerOptions = [
            { text: correctLatex, correct: true },
            ...incorrectAnswers
        ];

        // Перемішуємо відповіді
        const shuffledOptions = shuffleArray(answerOptions);

        // Відображаємо питання
        const matrixALatex = `\\begin{pmatrix} ${matrixA.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        const matrixBLatex = `\\begin{pmatrix} ${matrixB.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 5';
        trainerQuestion.textContent = 'Знайдіть добуток матриць:';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixALatex} \\cdot ${matrixBLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `\\(${option.text}\\)`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        // Скидаємо стан
        submitAnswerBtn.disabled = true;
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';

        // Рендеринг MathJax
        waitForMathJax(() => typesetMath('trainer question 5', [matrixDisplay, answerButtons]), 'trainer question 5');
    } catch (err) {
        console.error('Error in generateQuestion5:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect';
    }
}

// Обробник для кнопки "Відповісти"
buttons.submitAnswer.addEventListener('click', () => {
    console.log('Submit answer clicked', {
        currentQuestion: currentQuestion,
        selectedAnswer: selectedAnswer ? selectedAnswer.dataset.option : null,
        datasetCorrect: selectedAnswer ? selectedAnswer.dataset.correct : null
    });
    if (!selectedAnswer) {
        feedback.textContent = 'Будь ласка, виберіть відповідь!';
        feedback.className = 'feedback incorrect show';
        setTimeout(() => {
            feedback.className = 'feedback';
        }, 2000);
        return;
    }

    const isCorrect = selectedAnswer.dataset.correct === 'true';
    console.log('Answer evaluation', {
        isCorrect: isCorrect,
        selectedLatex: selectedAnswer.dataset.option,
        correctLatex: correctAnswerLatex
    });

    document.querySelectorAll('.answer-btn').forEach(btn => {
        if (btn.dataset.correct === 'true') {
            btn.classList.add('correct');
        } else if (btn === selectedAnswer) {
            btn.classList.add('incorrect');
        }
        btn.disabled = true;
        btn.style.pointerEvents = 'none';
    });

    feedback.textContent = isCorrect ? '✓ Правильно! Молодець!' : '✗ Неправильно, спробуй ще раз!';
    feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'} show`;
    submitAnswerBtn.disabled = true;

    setTimeout(() => {
        feedback.className = 'feedback';
        if (isCorrect) {
            incorrectAttempts = 0;
            if (currentQuestion === 1) {
                currentQuestion = 2;
                console.log('Moving to question 2');
                generateQuestion2();
            } else if (currentQuestion === 2) {
                currentQuestion = 3;
                console.log('Moving to question 3');
                generateQuestion3();
            } else if (currentQuestion === 3) {
                currentQuestion = 4;
                console.log('Moving to question 4');
                generateQuestion4();
            } else if (currentQuestion === 4) {
                currentQuestion = 5;
                console.log('Moving to question 5');
                generateQuestion5();
            } else {
                console.log('Showing completion screen');
                trainerContent.style.display = 'none';
                completionScreen.classList.remove('hidden');
                const emoji = completionScreen.querySelector('.completion-emoji');
                const heading = completionScreen.querySelector('.completion-message h2');
                const paragraph = completionScreen.querySelector('.completion-message p');
                if (emoji && heading && paragraph) {
                    heading.textContent = 'Тренування завершено!';
                    paragraph.textContent = 'Молодець!';
                    console.log('Completion screen updated', {
                        heading: heading.textContent,
                        paragraph: paragraph.textContent
                    });
                } else {
                    console.error('Completion screen elements missing', { emoji, heading, paragraph });
                }
                completionScreen.scrollIntoView({ behavior: 'smooth', block: 'center' });
                resetTrainerBtn.focus();
            }
        } else {
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('selected', 'correct', 'incorrect');
                btn.style.pointerEvents = 'auto';
                btn.style.background = '#3b4a5a';
                btn.style.border = '1.5px solid #a855f7';
            });
            submitAnswerBtn.disabled = true;
            selectedAnswer = null;
            if (currentQuestion === 1) {
                incorrectAttempts++;
                console.log('Incorrect attempts:', incorrectAttempts);
                if (incorrectAttempts >= maxIncorrectAttempts) {
                    incorrectAttempts = 0;
                    console.log('Max incorrect attempts reached, regenerating question 1');
                    generateQuestion1();
                } else {
                    console.log('Regenerating question 1');
                    generateQuestion1();
                }
            } else if (currentQuestion === 2 || currentQuestion === 3 || currentQuestion === 4 || currentQuestion === 5) {
                console.log(`Regenerating question ${currentQuestion}`);
                if (currentQuestion === 2) {
                    generateQuestion2();
                } else if (currentQuestion === 3) {
                    generateQuestion3();
                } else if (currentQuestion === 4) {
                    generateQuestion4();
                } else {
                    generateQuestion5();
                }
            }
        }
    }, 2000);
});

// Обробник для кнопки "Спробувати ще раз"
resetTrainerBtn.addEventListener('click', () => {
    console.log('Reset trainer clicked');
    currentQuestion = 1;
    incorrectAttempts = 0;
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    generateQuestion1();
});

// Обробники подій для кнопок відкриття модальних вікон
buttons.openTheory.addEventListener('click', () => {
    console.log('Open theory button clicked');
    openModal(modals.theory);
});

buttons.openVideo.addEventListener('click', () => {
    console.log('Open video button clicked');
    openModal(modals.video);
});

buttons.openQuestions.addEventListener('click', () => {
    console.log('Open questions button clicked');
    openModal(modals.questions);
});

buttons.openTrainer.addEventListener('click', () => {
    console.log('Open trainer clicked');
    openModal(modals.trainer);
    currentQuestion = 1;
    incorrectAttempts = 0;
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    generateQuestion1();
});

// Обробники для кнопок закриття
Object.values(buttons).forEach(button => {
    if (button && button.id.includes('close')) {
        button.addEventListener('click', () => {
            const modalId = button.id.replace('close', '').toLowerCase();
            const modalKey = modalId.includes('videoplayer') ? `videoPlayer${modalId.slice(-1)}` : modalId.replace('btn', '');
            console.log('Close button clicked for:', modalKey);
            closeModal(modals[modalKey]);
        });
    }
});

// Закриття модального вікна при кліку на оверлей
overlay.addEventListener('click', () => {
    Object.values(modals).forEach(modal => {
        if (modal && modal.classList.contains('show')) {
            console.log('Overlay clicked, closing modal:', modal.id);
            closeModal(modal);
        }
    });
});

// Обробники для карток відео
document.querySelectorAll('.video-card').forEach(card => {
    card.addEventListener('click', () => {
        const videoId = card.dataset.video;
        console.log('Video card clicked:', videoId);
        closeModal(modals.video);
        openModal(modals[`videoPlayer${videoId}`]);
    });
});

// Обробники для флеш-карток
document.querySelectorAll('.question-card .card-inner').forEach(card => {
    card.addEventListener('click', () => {
        console.log('Flipping card');
        card.classList.toggle('flipped');
    });
});

// Перевірка MathJax при завантаженні сторінки
window.addEventListener('load', () => {
    if (!window.mathJaxReady) {
        console.warn('MathJax not initialized after page load');
        feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
        feedback.className = 'feedback incorrect';
    }
});

// Закриття модального вікна при натисканні Escape
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
        Object.values(modals).forEach(modal => {
            if (modal && modal.classList.contains('show')) {
                console.log('Escape key pressed, closing modal:', modal.id);
                closeModal(modal);
            }
        });
    }
});
</script>
</body>
</html>

