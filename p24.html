   <!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
     <title>24. Розв’язування систем лінійних алгебраїчних рівнянь матричним методом</title><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
         :root {
            --bg-gradient: linear-gradient(135deg, #556B2F, #6B8E23);
--bg-hover: linear-gradient(135deg, #6B8E23, #808000);
--math-color: #FFFF00;
--text-color: #FFFFFF;

        }
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100dvh;
            font-size: 1rem;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: var(--bg-gradient);
            border-radius: 25px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            margin: 0;
            font-size: 1.6rem;
            color: #fff0f5;
            font-family: 'Lora', serif;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: var(--bg-gradient);
            border-radius: 20px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .section:hover {
            background: var(--bg-hover);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: brightness(1.2);
        }
        .section h2 {
            font-size: 1.25rem;
            color: var(--text-color);
            margin: 0;
            font-family: 'Lora', serif;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: var(--bg-gradient);
            color: var(--text-color);
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: bold;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid #ffff00;
            line-height: 1.2;
        }
        .nav-button:hover {
            background: #4b5320;
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
            width: 20px;
            height: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 95%;
            height: 95%;
            background: #6b8e23;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
            flex-direction: column;
        }
        .modal-content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            background: #4b5320;
            border-radius: 10px;
            margin: 10px;
            width: 100%;
            color: var(--text-color);
        }
        #trainerModal .modal-content {
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            padding: 20px;
        }
        .modal-header {
            display: flex;
            justify-content: flex-end;
            background: #4b5320;
            padding: 8px 10px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .close-btn {
            background: var(--text-color);
            color: #2C3E50;
            border: none;
            border-radius: 6px;
            padding: 5px 15px;
            font-size: 1rem;
            cursor: pointer;
        }
        .close-btn:hover {
            background: #eedc82;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .tab-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            background: var(--bg-gradient);
            color: #ffff00;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Lora', serif;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            text-align: left;
            position: relative;
        }
        .tab-button::after {
            content: '▶';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            color: #ffcc00;
        }
        .tab-button.active::after {
            content: '▼';
        }
        .tab-button.active {
            background: var(--bg-hover);
            color: #fff0f5;
            font-weight: 700;
        }
        .tab-button:hover {
            background: #b8860b;
            color: #ffd1dc;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border-radius: 10px;
            background: #4b5320;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .tab-content.active {
            display: block;
        }
        #theoryModal .modal-content p {
            text-align: justify;
            color: var(--text-color);
            font-size: 1.125rem;
            line-height: 1.6;
            white-space: normal;
        }
        #theoryModal .modal-content h3 {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: #9B59B6;
            margin-bottom: 15px;
            text-align: center;
        }
        #theoryModal .modal-content .example-title {
            color: #ff8c00;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 10px;
        }
        #theoryModal .modal-content .example-solution {
            color: #ff8c00;
            font-weight: bold;
            font-size: 1.125rem;
            text-align: left;
            margin: 15px 0;
        }
        #theoryModal .modal-content li {
            color: var(--text-color);
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
        .MathJax, mjx-container, mjx-math, mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
        }
        mjx-msub {
            font-size: 1.1em !important;
        }
        mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap;
            max-width: 100%;
            margin: 0 auto !important;
            padding: 5px;
            -webkit-overflow-scrolling: touch;
        }
        .flashcard-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .flashcard {
            perspective: 1000px;
            width: 100%;
            height: 230px;
            cursor: pointer;
            outline: none;
        }
        .flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    will-change: transform; /* Оптимізуємо рендеринг анімації */
}
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 15px;
            box-sizing: border-box;
            background: #6b8e23;
            color: var(--text-color);
        }
        .flashcard-back {
            transform: rotateY(180deg);
            background: #4f7942;
            color: var(--math-color);
            text-align: justify;
        }
        .flashcard-front p, .flashcard-back p {
            font-size: 1.4rem;
            margin: 0;
            font-family: 'Lora', serif;
            line-height: 1.5;
            text-align: center;
        }
        .flashcard-back p {
            font-family: 'Roboto', sans-serif;
            font-size: 1.4rem;
            line-height: 1.6;
            text-align: left;
            white-space: normal;
        }
        .flashcard-back li {
            color: var(--math-color);
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
        .trainer-container {
            width: 95%;
            max-width: 95%;
            padding: 25px;
            text-align: center;
            background: linear-gradient(135deg, #2e1065, #6b21a8);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(236, 72, 153, 0.5);
            position: relative;
            min-height: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-y: auto;
                                        box-sizing: border-box;
        }
        .solution {
            color: #ff8c00;
            font-weight: bold;
            text-align: center;
            display: block;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #f0e7ff;
            margin-bottom: 25px;
        }
        .trainer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 15px;
            max-width: 750px;
            margin: 25px auto;
            justify-items: center;
            align-items: stretch;
        }
        .trainer-option {
    background: linear-gradient(135deg, #1e40af, #3b82f6);
    color: #f0e7ff;
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    font-size: clamp(18px, 3vw, 20px);
    text-align: center;
    border: 2px solid rgba(167, 139, 250, 0.5);
    transition: background 0.3s ease, transform 0.2s ease;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80px;
}
.trainer-option mjx-container {
    font-size: 0.9em !important;
    text-align: center !important;
}
        .trainer-option:hover {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            transform: scale(1.03);
        }
        .trainer-option.selected {
            background: linear-gradient(135deg, #a78bfa, #c026d3);
            border-color: #facc15;
        }
            .trainer-option mjx-container[display="true"] {
    display: block !important;
    text-align: center !important;
    margin: 0 auto !important;
}
        .trainer-submit {
            background: linear-gradient(135deg, #22c55e, #86efac);
            color: #1e1e5f;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: clamp(18px, 2.8vw, 20px);
            cursor: pointer;
            margin-top: 25px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .trainer-submit:hover {
            background: linear-gradient(135deg, #86efac, #4ade80);
            transform: scale(1.05);
        }
        .trainer-feedback.correct {
            color: #3498DB !important;
            background: rgba(232, 245, 233, 0.95) !important;
            opacity: 1 !important;
            display: block !important;
        }
        .trainer-feedback.wrong {
            color: #E74C3C !important;
            background: rgba(255, 235, 238, 0.95) !important;
            opacity: 1 !important;
            display: block !important;
        }
          /* Стилізація смуги прокрутки для .trainer-container */
.trainer-container::-webkit-scrollbar {
    width: 12px; /* Ширина смуги прокрутки */
}

.trainer-container::-webkit-scrollbar-track {
    background: rgba(167, 139, 250, 0.2); /* Прозорий фон треку з легким фіолетовим відтінком */
    border-radius: 10px; /* Закруглення країв треку */
    margin: 5px; /* Відступи для естетичного вигляду */
}

.trainer-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #d81b60, #f06292); /* Градієнт від темно-рожевого до світло-рожевого */
    border-radius: 10px; /* Закруглення бігунка */
    border: 2px solid rgba(167, 139, 250, 0.3); /* Обведення для контрасту */
}

.trainer-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #f06292, #d81b60); /* Зміна градієнта при наведенні */
}

/* Стилі для Firefox */
.trainer-container {
    scrollbar-width: thin; /* Тонка смуга прокрутки */
    scrollbar-color: #f06292 rgba(167, 139, 250, 0.2); /* Колір бігунка і треку */
}  
       .question-circle {
    width: clamp(100px, 16vw, 130px);
    height: clamp(100px, 16vw, 130px);
    min-width: clamp(100px, 16vw, 130px); /* Додано */
    min-height: clamp(100px, 16vw, 130px); /* Додано */
    max-width: clamp(100px, 16vw, 130px); /* Додано */
    max-height: clamp(100px, 16vw, 130px); /* Додано */
    aspect-ratio: 1/1;
    background: linear-gradient(135deg, #d81b60, #f06292);
    border-radius: 50%;
    color: var(--math-color);
    font-family: 'Lora', serif;
    font-weight: 700;
    margin: 0 auto 25px;
    border: 3px dashed #a78bfa;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    padding: 0;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.0rem, 2.5vw, 1.1rem);
    text-align: center;
    white-space: nowrap;
    line-height: 1.2;
    overflow: hidden;
}
        .question-circle span {
    font-size: inherit;
    font-family: inherit;
    font-weight: inherit;
    color: inherit;
    margin: 0;
    padding: 0;
    text-align: center;
    display: flex; /* Змінено з inline-flex на flex */
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}
       .question-circle mjx-container,
.question-circle .MathJax {
    display: none !important; /* Уже є, але залишаємо для надійності */
}
    .trainer-input {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px 0;
    width: 100%;
    max-width: 300px;
}
.trainer-input label {
    font-family: 'Lora', serif;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
    margin-bottom: 10px;
    text-align: center;
}
.answer-input {
    background: #34495E;
    color: var(--text-color);
    border: 2px solid rgba(167, 139, 250, 0.5);
    border-radius: 8px;
    padding: 10px;
    font-size: clamp(1rem, 2.2vw, 1.1rem);
    font-family: 'Roboto', sans-serif;
    width: 100%;
    max-width: 180px;
    text-align: center;
    box-sizing: border-box;
}
.answer-input:focus {
    outline: none;
    border-color: #facc15;
    background: #4a5568;
}
.answer-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}
            #questionText {
            font-family: 'Lora', serif;
            font-size: clamp(1.2rem, 3vw, 1.3rem);
            color: #fffff0;
            font-weight: 700;
            line-height: 1.4;
            margin: 15px 0;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        #questionsModal mjx-container {
            font-size: clamp(24px, 3.2vw, 26px) !important;
            color: #ffff00 !important;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        #questionsModal .card-front mjx-container,
        #questionsModal .card-back mjx-container {
            display: inline !important;
            margin: 0 0.3em !important;
            padding: 0 !important;
            vertical-align: -0.1em !important;
        }
        #questionsModal .card-back mjx-container[display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 4px auto;
            padding: 4px;
        }
        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 20px 0;
            justify-items: center;
        }
        .answer-button {
            background: #34495E;
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: 'Roboto', sans-serif;
            font-size: 1.25rem;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            text-align: center;
        }
        .answer-button:hover:not(:disabled) {
            background: #9B59B6;
        }
        .answer-button.selected {
            background: #3498DB;
        }
        .answer-button.correct {
            background: #3498DB;
        }
        .answer-button.wrong {
            background: #E74C3C;
        }
        .answer-button:disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .answer-button .MathJax, .answer-button mjx-container, .answer-button mjx-math, .answer-button mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
        }
        /* Оновлені стилі для .result-message */
.result-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-family: 'Lora', serif;
    font-weight: bold;
    text-align: center;
    padding: 20px 40px;
    border-radius: 12px;
    min-width: 300px;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.1s ease; /* Зменшено до 0.1с для швидкої анімації */
    z-index: 1001;
    display: none;
}
.result-message.correct {
    color: #3498DB;
    background: rgba(232, 245, 233, 0.95);
    opacity: 1;
}
.result-message.wrong {
    color: #E74C3C;
    background: rgba(255, 235, 238, 0.95);
    opacity: 1;
}
            .system-equation {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 10px 0;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
}

.system-equation mjx-container {
    font-size: 1.2rem !important;
}

.system-equation .answer-input {
    margin-left: 10px;
    width: 80px;
    max-width: 80px;
    font-size: clamp(1rem, 2vw, 1.1rem);
}
            /* Для всіх пристроїв */
#systemEquations.trainer-options.question-4,
#systemEquations.trainer-options.question-5 {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 100%;
    align-items: center;
}

.trainer-inputs {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.trainer-input {
    width: 100%;
    max-width: 600px;
    min-height: 60px;
    box-sizing: border-box;
}

.input-row {
    display: flex;
    flex-direction: column !important; /* Примусово колонка */
    align-items: flex-start;
    gap: 5px;
    width: 100%;
}

.label-text {
    font-family: 'Lora', serif;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
    text-align: left;
}

.latex-input {
    display: flex;
    align-items: center;
    gap: 10px;
}

.latex-text {
    font-family: 'Lora', serif;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
    white-space: nowrap;
}

.latex-input .answer-input {
    background: #34495E;
    color: var(--text-color);
    border: 2px solid rgba(167, 139, 250, 0.5);
    border-radius: 8px;
    padding: 8px; /* Збільшено з 6px для пропорційності */
    font-size: clamp(1rem, 2.2vw, 1.1rem); /* Збільшено для кращої читабельності */
    font-family: 'Roboto', sans-serif;
    max-width: 170px; /* Збільшено з 120px */
    text-align: center;
    box-sizing: border-box;
}


.latex-input .answer-input:focus {
    outline: none;
    border-color: #facc15;
    background: #4a5568;
    animation: none; /* Видаляємо можливі анімації */
}

.latex-input .answer-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* Контроль MathJax */
.latex-text mjx-container {
    display: inline-block !important;
    vertical-align: middle !important;
    margin: 0 !important;
}


/* Видаляємо конфліктні стилі */
.system-equation .answer-input {
    display: none; /* Або видалити, якщо не використовується */
}

/* Перекриваємо старі стилі для .input-row */
#systemEquations.trainer-options.question-4 .input-row,
#systemEquations.trainer-options.question-5 .input-row {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
}

/* Видаляємо можливі анімації блимання */
.label-text, .latex-text, .latex-input .answer-input {
    animation: none !important;
    transition: none !important;
}
    

/* Базові стилі для completion-message (для десктопу) */
.completion-message {
    display: none; /* Приховано за замовчуванням */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #d0f0c0; /* Світло-зелений фон */
    border-radius: 10px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    padding: 20px;
    width: 80%;
    max-width: 500px;
    text-align: center;
    z-index: 1100; /* Вище за .trainer-container */
    flex-direction: column;
    gap: 15px;
    align-items: center;
}

.completion-message.active {
    display: flex; /* Відображаємо як flex, коли активне */
}

.completion-message h2 {
    margin: 0;
    font-size: 1.5rem;
    color: #FFD700;
}

.completion-message p {
    margin: 10px 0;
    font-size: 1rem;
    color: #FFD700;
}

/* === МЕДАЛЬ З ТРИЗУБОМ === */
    .completion-emoji {
        position: relative;
        display: inline-block;
        width: clamp(56px, 12vw, 96px);
        height: clamp(56px, 12vw, 96px);
        vertical-align: middle;
        margin: 0 auto 3vw;
        border-radius: 50%;
        background: linear-gradient(135deg, #2a2a2a, #3a454a);
        border: 3px dashed #ffd700;
        box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
        overflow: hidden;
        animation: medalAppear 0.8s ease-out;
    }
    .completion-emoji::after {
        content: '';
        position: absolute;
        inset: 0;
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'><defs><filter id='s' x='-50%' y='-50%' width='200%' height='200%'><feDropShadow dx='0' dy='2' stdDeviation='2' flood-color='%23000000' flood-opacity='0.25'/></filter></defs><rect x='30' y='0' width='60' height='40' rx='4' fill='%23007ACC'/><rect x='30' y='20' width='60' height='20' rx='4' fill='%23FFD700'/><g transform='translate(60,70)'><polygon points='0,-26 6,-6 26,-6 9,6 15,26 0,14 -15,26 -9,6 -26,-6 -6,-6' fill='%23FFD700' filter='url(%23s)'/></g></svg>");
       background-size: 75%;
        background-repeat: no-repeat;
        background-position: center 60%;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.25));
        animation: medalBounce 1.2s ease-out 0.3s both;
    }
    @keyframes medalAppear {
        0% { transform: scale(0.3) rotate(-180deg); opacity: 0; }
        60% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }
    @keyframes medalBounce {
        0% { transform: translateY(-120px) rotate(-30deg) scale(0.4); opacity: 0; }
        60% { transform: translateY(15px) rotate(10deg) scale(1.15); opacity: 1; }
        80% { transform: translateY(-8px) rotate(-5deg) scale(1.05); }
        100% { transform: translateY(0) rotate(0) scale(1); }
    }

    .completion-message {
        background: linear-gradient(145deg, #2a2a2a, #3a454a);
        border: 2.5px solid #ffffff;
        border-radius: 15px;
        padding: clamp(12px, 3vw, 18px);
        box-shadow: 0 6px 12px rgba(92,184,240,0.4);
        margin: 2vw auto;
        max-width: 90%;
        text-align: center;
    }

.completion-message button {
    padding: 10px 20px;
    background: #6b8e23;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.2s;
}

.completion-message button:hover {
    background: #556b2f;
}
       
        #resetTrainerBtn {
            display: block;
            margin: 20px auto;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            color: var(--text-color);
            background: #E74C3C;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #resetTrainerBtn:hover {
            background: #9B59B6;
        }
        .video-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: var(--bg-gradient);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: var(--text-color);
        }
        .video-card:hover {
            background: var(--bg-hover);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-player-container {
            width: 80vw;
            max-width: 960px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-player-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: block;
            border: none;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
            color: var(--text-color);
        }
        .glow-title {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: var(--math-color);
            text-align: center;
            margin-bottom: 20px;
        }
        .math-loading {
            visibility: hidden;
            opacity: 0;
        }
        .math-loaded {
            visibility: visible;
            opacity: 1;
        }
        .answer-select {
            background: #34495E;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px;
            font-family: 'Roboto', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            width: 150px;
            margin-left: 5px;
        }
        .answer-select:hover:not(:disabled) {
            background: #9B59B6;
        }
        .answer-select:disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .answer-options label {
            font-family: 'Lora', serif;
            font-size: 1.2rem;
            color: var(--math-color);
            margin-right: 5px;
        }
        #systemText {
            margin: 20px 0;
            font-size: 1.3rem;
            color: var(--math-color);
            text-align: center;
        }
        #systemText mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 0 auto !important;
        }
        .trainer-option.disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .trainer-option.correct {
            background: linear-gradient(135deg, #22c55e, #86efac);
            border-color: #facc15;
        }
        .trainer-option.wrong {
            background: linear-gradient(135deg, #E74C3C, #ff6b6b);
            border-color: #facc15;
        }
           

       /* Об'єднані медіа-запити для max-width: 768px */
@media (max-width: 768px) {
    .title-box {
        margin-top: 40px;
        padding: 15px 20px;
    }

    .title-box h1 {
        font-size: 1.5rem;
    }

    .section-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }

    .section {
        width: 80%;
        height: 180px;
    }

    .section h2 {
        font-size: 1.125rem;
    }

    .nav-button {
        font-size: 0.9rem;
        padding: 8px 16px;
    }

    .tab-button {
        font-size: 1rem;
        padding: 8px 16px;
    }

    .tab-content {
        padding: 15px;
    }

    .modal {
        top: 2%;
        left: 2%;
        width: 96%;
        height: 96%;
    }

    .trainer-container {
        width: 95%;
        padding: 4vw;
    }

   .trainer-options {
        display: flex !important;
        flex-direction: column !important;
        gap: 15px;
        max-width: 100%;
        align-items: center;
    }

    .trainer-options .trainer-option {
        width: 100%;
        max-width: 500px;
        min-height: 80px;
        font-size: clamp(16px, 2.8vw, 18px);
        box-sizing: border-box;
        text-align: center;
    }
    .trainer-input {
        max-width: 250px;
    }

    .answer-input {
        font-size: clamp(0.9rem, 2vw, 1rem);
        max-width: 150px;
    }

    .question-circle {
        width: clamp(80px, 15vw, 100px);
        height: clamp(80px, 15vw, 100px);
        font-size: clamp(1rem, 2.5vw, 1.25rem);
    }

    .video-card-container {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
    }

    .video-card {
        width: 260px;
        height: 160px;
        margin: 5px;
    }

    .video-card img {
        width: 40px;
        height: 40px;
        margin-bottom: 6px;
    }

    .video-player-container {
        width: 80vw;
        max-width: 600px;
        aspect-ratio: 16 / 9;
    }

    .video-card h3 {
        font-size: clamp(14px, 2.5vw, 16px);
    }

    .flashcard {
        height: 180px;
    }

    .flashcard-front p,
    .flashcard-back p {
        font-size: 1.125rem;
    }

    .flashcard-front,
    .flashcard-back {
        padding: 15px;
    }
    .answer-select {
        font-size: 1rem;
        width: 120px;
    }

    .answer-options label {
        font-size: 1rem;
    }

    #questionText {
        font-size: clamp(1.25rem, 3vw, 1.5rem);
    }

    #questionText .MathJax,
    #questionText mjx-container,
    #questionText mjx-math,
    #questionText mjx-mrow {
        font-size: clamp(1.1rem, 2.5vw, 1.3rem) !important;
    }

    .system-equation {
        font-size: clamp(1rem, 2.2vw, 1.1rem);
    }

    .system-equation .answer-input {
        width: 60px;
        font-size: clamp(0.9rem, 1.8vw, 1rem);
    }

    mjx-container[jax="CHTML"][display="true"] {
        display: block !important;
        text-align: center !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        white-space: nowrap;
        max-width: 100%;
        margin: 0 auto !important;
        padding: 8px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #f06292 rgba(167, 139, 250, 0.2);
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar {
        height: 10px;
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-track {
        background: rgba(167, 139, 250, 0.2);
        border-radius: 10px;
        margin: 5px;
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #d81b60, #f06292);
        border-radius: 10px;
        border: 2px solid rgba(167, 139, 250, 0.3);
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #f06292, #d81b60);
    }
        #trainerModal.modal {
        top: 1%;
        left: 1%;
        width: 98%;
        height: 98%;
        border-radius: 10px; /* Зменшуємо радіус для мобільних, щоб виглядало пропорційно */
        overflow-y: auto; /* Дозволяємо вертикальну прокрутку */
        -webkit-overflow-scrolling: touch; /* Плавна прокрутка на iOS */
    }

    #trainerModal .modal-content {
        padding: 15px;
        margin: 5px;
        width: calc(100% - 10px); /* Враховуємо відступи */
        box-sizing: border-box;
        min-height: calc(100% - 50px); /* Враховуємо висоту заголовка */
    }

    #trainerModal .trainer-container {
        width: 100%;
        max-width: 100%;
        padding: 10px;
        min-height: auto; /* Дозволяємо контейнеру адаптуватися до вмісту */
        overflow-y: visible; /* Запобігаємо обрізанню по вертикалі */
    }

    #trainerModal .trainer-options {
        gap: 10px;
        max-width: 100%;
        align-items: center;
    }

    #trainerModal .trainer-option {
        width: 100%;
        max-width: 100%;
        min-height: 70px;
        padding: 8px;
        font-size: clamp(14px, 2.5vw, 16px);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    #trainerModal mjx-container[jax="CHTML"][display="true"] {
        font-size: 0.85em !important; /* Зменшуємо розмір матриць для мобільних */
        padding: 4px;
        max-width: 100%;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        margin: 0 auto !important;
    }

    #trainerModal .question-circle {
        width: clamp(80px, 14vw, 90px);
        height: clamp(80px, 14vw, 90px);
        font-size: clamp(0.9rem, 2.2vw, 1rem);
    }

    #trainerModal .trainer-question {
        font-size: clamp(16px, 2.8vw, 18px);
    }
    .completion-message {
        width: 90%;
        max-width: 400px;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .completion-message h2 {
        font-size: clamp(1.2rem, 3vw, 1.4rem);
    }

    .completion-message p {
        font-size: clamp(0.9rem, 2.5vw, 1rem);
    }

    .completion-message .completion-emoji {
        font-size: clamp(2rem, 5vw, 2.2rem);
    }

    .completion-message button {
        padding: 8px 16px;
        font-size: clamp(0.85rem, 2.3vw, 0.95rem);
    }

    /* Приховуємо решту вмісту, коли completion-message активне */
    .completion-message.active ~ * {
        display: none;
    }
}

/* Об'єднані медіа-запити для max-width: 480px */
@media (max-width: 480px) {
    .title-box {
        margin-top: 20px;
        padding: 10px 15px;
    }

    .title-box h1 {
        font-size: 1.25rem;
    }

    .section {
        width: 90%;
        height: 150px;
    }

    .section img {
        width: 50px;
        height: 50px;
    }

    .section h2 {
        font-size: 1rem;
    }

    .video-card-container {
        gap: 10px;
        padding: 10px;
    }

    .video-card {
        width: 90%;
        max-width: 260px;
        height: 140px;
        margin: 5px;
    }

    .video-card img {
        width: 30px;
        height: 30px;
        margin-bottom: 5px;
    }

    .video-card h3 {
        font-size: clamp(12px, 2.5vw, 14px);
    }

    .video-player-container {
        width: 80vw;
        max-width: 400px;
        aspect-ratio: 16 / 9;
    }

    #theoryModal .modal-content h3 {
        font-size: 1.25rem;
    }

    .example-title {
        font-size: 1.0rem;
    }

    .example-solution {
        font-size: 1.0rem;
    }

    .MathJax, mjx-container, mjx-math, mjx-mrow {
        font-size: 1.0rem !important;
    }

    .trainer-options.question-2 {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 100%;
    }

    .trainer-options.question-2 .trainer-option {
        width: 100%;
        max-width: 400px;
        min-height: 70px;
        font-size: clamp(14px, 2.5vw, 16px);
        padding: 10px;
    }

    .trainer-input {
        max-width: 200px;
    }

    .answer-input {
        font-size: clamp(0.8rem, 1.8vw, 0.9rem);
        max-width: 120px;
    }

    .question-circle {
        width: clamp(70px, 14vw, 90px);
        height: clamp(70px, 14vw, 90px);
        font-size: clamp(0.9rem, 2.2vw, 1rem);
    }

    .question-circle h3 {
        font-size: clamp(0.9rem, 2.5vw, 1.0rem);
    }

    #questionText {
        font-size: clamp(1rem, 2.5vw, 1.25rem);
    }

    #questionText .MathJax,
    #questionText mjx-container,
    #questionText mjx-math,
    #questionText mjx-mrow {
        font-size: clamp(0.9rem, 2.2vw, 1.1rem) !important;
    }

    .answer-button {
        font-size: 1.0rem;
    }

    .answer-select {
        font-size: 0.9rem;
        width: 100px;
    }

    .answer-options label {
        font-size: 0.9rem;
    }

    #systemText {
        font-size: 0.9rem;
    }
.flashcard {
        height: 200px;
    }

    .flashcard-front p,
    .flashcard-back p {
        font-size: 1.1rem;
    }

    .flashcard-front,
    .flashcard-back {
        padding: 8px;
    }

       .system-equation {
        font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .system-equation .answer-input {
        width: 50px;
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
    }
     #trainerModal.modal {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 8px; /* Ще менший радіус для дуже малих екранів */
        box-shadow: none; /* Видаляємо тінь для максимального використання простору */
    }

    #trainerModal .modal-content {
        padding: 10px;
        margin: 0;
        width: 100%;
        min-height: calc(100% - 40px); /* Враховуємо менший заголовок */
    }

    #trainerModal .trainer-container {
        padding: 8px;
        width: 100%;
        max-width: 100%;
        border-radius: 8px;
    }

    #trainerModal .trainer-option {
        min-height: 60px;
        padding: 6px;
        font-size: clamp(12px, 2.3vw, 14px);
    }

    #trainerModal mjx-container[jax="CHTML"][display="true"] {
        font-size: 0.8em !important; /* Ще менший розмір для малих екранів */
        padding: 3px;
    }

    #trainerModal .question-circle {
        width: clamp(70px, 13vw, 80px);
        height: clamp(70px, 13vw, 80px);
        font-size: clamp(0.8rem, 2vw, 0.9rem);
    }

    #trainerModal .trainer-question {
        font-size: clamp(14px, 2.5vw, 16px);
    }
    .completion-message {
        width: 95%;
        max-width: 350px;
        padding: 12px;
        border-radius: 6px;
    }

    .completion-message h2 {
        font-size: clamp(1.1rem, 2.8vw, 1.3rem);
    }

    .completion-message p {
        font-size: clamp(0.85rem, 2.3vw, 0.95rem);
    }

    .completion-message .completion-emoji {
        font-size: clamp(1.8rem, 4.5vw, 2rem);
    }

    .completion-message button {
        padding: 7px 14px;
        font-size: clamp(0.8rem, 2.2vw, 0.9rem);
    }
}
    </style>
</head>
<body>
    <div class="title-box">
        <h1>24. Розв’язування систем лінійних алгебраїчних рівнянь матричним методом</h1>
    </div>
    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>
    <div class="navigation-buttons">
        <a class="nav-button" href='tema6.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 6
        </a>
       <a class="nav-button" href='zmist.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
  <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
</svg>
            До курсу
        </a>

    </div>
    <div id="modalOverlay"></div>
    
    <div id="theoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити документ" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="tab-container">
                <button class="tab-button" data-tab="matrix-representation" aria-expanded="false">Матричне представлення системи. Алгоритм розв’язування</button>
<div id="matrix-representation" class="tab-content">
    <p>Матричний метод є ефективним способом розв’язання систем лінійних алгебраїчних рівнянь (СЛАР), оскільки дозволяє компактно записати систему у вигляді матриць. У цьому пункті розглядається розв’язання СЛАР методом оберненої матриці, аналогічно розв’язуванню матричних рівнянь типу \( A \cdot X = B \) (див. Приклад 5.14, §5, п.20). Для застосування цього методу необхідно вміти обчислювати визначники, знаходити обернені матриці та виконувати матричне множення.</p>
      <p><span class="solution">Матричне представлення системи</span></p>
    <p>Розглянемо систему з трьома рівняннями:</p>
    <p class="math-equation center">\[ \begin{cases} a_{11}x + a_{12}y + a_{13}z = b_1 \\ a_{21}x + a_{22}y + a_{23}z = b_2 \\ a_{31}x + a_{32}y + a_{33}z = b_3 \end{cases} \tag{6.7} \]</p>
    <p>Цю систему можна записати у вигляді:</p>
    <p class="math-equation center">\[ A \cdot X = B, \tag{6.8} \]</p>
    <p>де:</p>
    <p class="math-equation center">\[ A = \begin{pmatrix} a_{11} & a_{12} & a_{13} \\ a_{21} & a_{22} & a_{23} \\ a_{31} & a_{32} & a_{33} \end{pmatrix}, \quad X = \begin{pmatrix} x \\ y \\ z \end{pmatrix}, \quad B = \begin{pmatrix} b_1 \\ b_2 \\ b_3 \end{pmatrix}. \]</p>
    <p>Таким чином, систему (6.7) можна записати у компактній матричній формі:</p>
    <p class="math-equation center">\[ \begin{pmatrix} a_{11} & a_{12} & a_{13} \\ a_{21} & a_{22} & a_{23} \\ a_{31} & a_{32} & a_{33} \end{pmatrix} \cdot \begin{pmatrix} x \\ y \\ z \end{pmatrix} = \begin{pmatrix} b_1 \\ b_2 \\ b_3 \end{pmatrix} \tag{6.9} \]</p>
    <p><span class="solution">Алгоритм розв’язування</span></p>
    <li><strong> 1) Обчислення визначника матриці \( A \).</strong>
            <p>Якщо визначник матриці \( A \) дорівнює нулю (\( |A| = 0 \)), тоді система немає єдиного розв’язку (або несумісна, або має безліч розв’язків).</p>
            <p>Якщо визначник матриці \( A \) не дорівнює нулю (\( |A| \neq 0 \)), тоді існує єдина обернена матриця.</p>
        </li>
        <li><strong> 2) Знаходження оберненої матриці \( A^{-1} \).</strong>
            <p>Обернена матриця знаходиться за формулою:</p>
            <p class="math-equation center">\[ A^{-1} = \frac{1}{|A|} \cdot \tilde{A}^T, \]</p>
            <p>де \( \tilde{A}^T \) – транспонована союзна матриця.</p>
        </li>
        <li><strong> 3) Знаходження розв’язку.</strong>
            <p>Помноживши обернену матрицю \( A^{-1} \) на матрицю-стовпець \( B \), отримуємо розв’язок системи:</p>
            <p class="math-equation center">\[ X = A^{-1} \cdot B. \tag{6.10} \]</p>
        </li>
</div>
               <button class="tab-button" data-tab="matrix-three" aria-expanded="false">Приклад</button>
<div id="matrix-three" class="tab-content">
    <p><strong><span class="example-title">Приклад 6.3.</span></strong> Розв’язати систему рівнянь матричним методом:</p>
    <p class="math-equation center">\[ \begin{cases} 2x + y - z = 0 \\ x + y + z = 3 \\ x - y = 1 \end{cases} \]</p>
    <p><span class="solution">Розв’язання</span></p>
    <p>Запишемо систему у вигляді матричного рівняння \( A \cdot X = B \), де</p>
    <p class="math-equation center">\[ A = \begin{pmatrix} 2 & 1 & -1 \\ 1 & 1 & 1 \\ 1 & -1 & 0 \end{pmatrix}, \quad X = \begin{pmatrix} x \\ y \\ z \end{pmatrix}, \quad B = \begin{pmatrix} 0 \\ 3 \\ 1 \end{pmatrix}. \]</p>
    <p>Обчислимо визначник матриці \( A \):</p>
    <p class="math-equation center">\[ |A| = \begin{vmatrix} 2 & 1 & -1 \\ 1 & 1 & 1 \\ 1 & -1 & 0 \end{vmatrix} = 0 + 1 + 1 + 1 - 0 + 2 = 5 \neq 0. \]</p>
    <p>Оскільки \( |A| \neq 0 \), тоді обернена матриця \( A^{-1} \) існує.</p>
    <p>Знаходимо обернену матрицю \( A^{-1} \):</p>
    <p>Обчислимо алгебраїчні доповнення елементів матриці \( A \):</p>
   <p class="math-equation center">\[ A_{11} = (-1)^{1+1} \cdot \begin{vmatrix} 1 & 1 \\ -1 & 0 \end{vmatrix} = 1, \]</p>
    <p class="math-equation center">\[ A_{12} = (-1)^{1+2} \cdot \begin{vmatrix} 1 & 1 \\ 1 & 0 \end{vmatrix} = 1, \]</p>
    <p class="math-equation center">\[ A_{13} = (-1)^{1+3} \cdot \begin{vmatrix} 1 & 1 \\ 1 & -1 \end{vmatrix} = -2, \]</p>
    <p>&nbsp;</p>
    <p class="math-equation center">\[ A_{21} = (-1)^{2+1} \cdot \begin{vmatrix} 1 & -1 \\ -1 & 0 \end{vmatrix} = 1, \]</p>
    <p class="math-equation center">\[ A_{22} = (-1)^{2+2} \cdot \begin{vmatrix} 2 & -1 \\ 1 & 0 \end{vmatrix} = 1, \]</p>
    <p class="math-equation center">\[ A_{23} = (-1)^{2+3} \cdot \begin{vmatrix} 2 & 1 \\ 1 & -1 \end{vmatrix} = 3, \]</p>
    <p>&nbsp;</p>
    <p class="math-equation center">\[ A_{31} = (-1)^{3+1} \cdot \begin{vmatrix} 1 & -1 \\ 1 & 1 \end{vmatrix} = 2, \]</p>
    <p class="math-equation center">\[ A_{32} = (-1)^{3+2} \cdot \begin{vmatrix} 2 & -1 \\ 1 & 1 \end{vmatrix} = -3, \]</p>
    <p class="math-equation center">\[ A_{33} = (-1)^{3+3} \cdot \begin{vmatrix} 2 & 1 \\ 1 & 1 \end{vmatrix} = 1. \]</p>
    <p>Запишемо союзну матрицю:</p>
    <p class="math-equation center">\[ \tilde{A} = \begin{pmatrix} 1 & 1 & -2 \\ 1 & 1 & 3 \\ 2 & -3 & 1 \end{pmatrix}. \]</p>
    <p>Транспонуємо її:</p>
    <p class="math-equation center">\[ \tilde{A}^T = \begin{pmatrix} 1 & 1 & 2 \\ 1 & 1 & -3 \\ -2 & 3 & 1 \end{pmatrix}. \]</p>
    <p>Отже, обернена матриця має вигляд:</p>
    <p class="math-equation center">\[ A^{-1} = \frac{1}{|A|} \cdot \tilde{A}^T = \frac{1}{5} \begin{pmatrix} 1 & 1 & 2 \\ 1 & 1 & -3 \\ -2 & 3 & 1 \end{pmatrix}. \]</p>
    <p>Знаходження розв’язку системи знайдемо за формулою (6.10) \( X = A^{-1} \cdot B \), маємо:</p>
    <p class="math-equation center">\[ \begin{pmatrix} x \\ y \\ z \end{pmatrix} = \frac{1}{5} \begin{pmatrix} 1 & 1 & 2 \\ 1 & 1 & -3 \\ -2 & 3 & 1 \end{pmatrix} \cdot \begin{pmatrix} 0 \\ 3 \\ 1 \end{pmatrix} = \frac{1}{5} \begin{pmatrix} 1 \cdot 0 + 1 \cdot 3 + 2 \cdot 1 \\ 1 \cdot 0 + 1 \cdot 3 + (-3) \cdot 1 \\ (-2) \cdot 0 + 3 \cdot 3 + 1 \cdot 1 \end{pmatrix} = \frac{1}{5} \begin{pmatrix} 5 \\ 0 \\ 10 \end{pmatrix} = \begin{pmatrix} 1 \\ 0 \\ 2 \end{pmatrix}. \]</p>
    <p class="example-solution">Відповідь. \( (1; 0; 2) \).</p>
    <p>Перевірка:</p>
    <p class="math-equation center">\[ \begin{cases} 2 \cdot 1 + 0 - 2 = 2 - 2 = 0 \\ 1 + 0 + 2 = 3 \\ 1 - 0 = 1 \end{cases} \]</p>
    <p>Розв’язок знайдено правильно.</p>
     <p><strong><span class="example-title">Зауваження:</span></strong> <em> Якщо \( |A| = 0 \), оберненої матриці не існує, тому систему слід розв’язувати іншим методом – наприклад, методом Гауса (розглядається у наступному пункті, п. 25). Крім того, для систем лінійних рівнянь із великою кількістю змінних метод оберненої матриці є менш ефективним, і в таких
     випадках також доцільно застосовувати метод Гауса.</em></p>
</div>
            </div>
        </div>
    </div>
    <div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 class="glow-title">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Запис систем рівнянь за допомогою матриць</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Матричний метод розв’язування СЛАР</h3>
                </div>
                            </div>
        </div>
    </div>
    <div id="videoPlayerModal1" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" width="100%" data-src="https://www.youtube.com/embed/Gz6v38UyS4c" src="https://www.youtube.com/embed/UVHweVUrgUM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    <div id="videoPlayerModal2" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer2" width="100%" data-src="https://www.youtube.com/embed/9R7W1WV6ye8" src="https://www.youtube.com/embed/zm55sT12X2w" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    
    <div id="questionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="questionsTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити питання" id="closeQuestionsBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="flashcard-container">
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>1. Що таке матричне представлення системи лінійних рівнянь?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Це запис системи у вигляді матричного рівняння \( A \cdot X = B \), де \( A \) – матриця, що містить коефіцієнти змінних; \( X \) – матриця-стовпець, що містить самі змінні; \( B \) – матриця-стовпець, що містить вільні члени.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>2. За якої умови система має єдиний розв’язок у матричному методі?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Якщо визначник матриці коефіцієнтів \( |A| \neq 0 \), тоді існує обернена матриця \( A^{-1} \) і система має єдиний розв’язок.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>3. Як обчислюється обернена матриця?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>За формулою \( A^{-1} = \frac{1}{|A|} \cdot \tilde{A}^T \), де \( \tilde{A}^T \) – транспонована союзна (приєднана) матриця.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>4. Як знайти розв’язок системи методом оберненої матриці?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Обчислити добуток \( X = A^{-1} \cdot B \).</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>5. Що робити, якщо \( |A| = 0 \)?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Обернена матриця не існує. Система або несумісна (немає розв’язків), або має безліч розв’язків. У такому випадку використовують інші методи (наприклад, метод Гауса).</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>6. Чому метод оберненої матриці не застосовують для великих систем?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Бо обчислення оберненої матриці для великої розмірності є складним і неефективним; простіше використовувати метод Гауса.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  <div id="trainerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити тренажер" id="closeTrainerBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container" id="trainerContent">
            <div class="question-circle" id="questionCircle"><span>Питання 1</span></div>
            <div class="trainer-question" id="questionText">Вкажіть вільні члени заданої системи лінійних рівнянь:</div>
            <div id="systemText"></div>
            <div class="trainer-options" id="optionsContainer"></div>
            <div class="system-equations" id="systemEquations" style="display: none;"></div>
            <div class="trainer-input" id="inputContainer" style="display: none;">
                <label for="determinantInput" class="trainer-question">Введіть значення визначника:</label>
                <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="determinantInput" class="answer-input" placeholder="Введіть число" aria-label="Введіть значення визначника">
                <label for="xInput" class="trainer-question" style="display: none;">Введіть значення \(x\):</label>
                <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="xInput" class="answer-input" placeholder="Введіть \(x\)" style="display: none;" aria-label="Введіть значення x">
                <label for="yInput" class="trainer-question" style="display: none;">Введіть значення \(y\):</label>
                <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="yInput" class="answer-input" placeholder="Введіть \(y\)" style="display: none;" aria-label="Введіть значення y">
            </div>
            <button class="trainer-submit" id="submitAnswer" aria-label="Перевірити обрану відповідь">Перевірити</button>
            <div class="trainer-feedback result-message" id="feedback"></div>
            <div class="completion-message" id="completionMessage" style="display: none;">
                <div class="completion-emoji"></div>
                <h2>МІСІЯ ВИКОНАНА!</h2>
                <p>Солдате, матричний метод переміг!</p>
                <p><strong>СЛАВА УКРАЇНІ!</strong></p>
                 <button id="resetTrainerBtn" aria-label="Повернутися на полігон">Повернутися на полігон!</button>
            </div>
        </div>
    </div>
</div>
       <script>
document.addEventListener('DOMContentLoaded', function () {
    const elements = {
    openTheoryBtn: document.getElementById('openTheoryBtn'),
    openVideoBtn: document.getElementById('openVideoBtn'),
    openQuestionsBtn: document.getElementById('openQuestionsBtn'),
    openTrainerBtn: document.getElementById('openTrainerBtn'),
    theoryModal: document.getElementById('theoryModal'),
    videoModal: document.getElementById('videoModal'),
    questionsModal: document.getElementById('questionsModal'),
    trainerModal: document.getElementById('trainerModal'),
    closeTheoryBtn: document.getElementById('closeTheoryBtn'),
    closeVideoBtn: document.getElementById('closeVideoBtn'),
    closeQuestionsBtn: document.getElementById('closeQuestionsBtn'),
    closeTrainerBtn: document.getElementById('closeTrainerBtn'),
    closeVideoPlayerBtn1: document.getElementById('closeVideoPlayerBtn1'),
    closeVideoPlayerBtn2: document.getElementById('closeVideoPlayerBtn2'),
    videoPlayerModal1: document.getElementById('videoPlayerModal1'),
    videoPlayerModal2: document.getElementById('videoPlayerModal2'),
    modalOverlay: document.getElementById('modalOverlay'),
    questionCircle: document.getElementById('questionCircle'),
    questionText: document.getElementById('questionText'),
    systemText: document.getElementById('systemText'),
    optionsContainer: document.getElementById('optionsContainer'),
    inputContainer: document.getElementById('inputContainer'),
    determinantInput: document.getElementById('determinantInput'),
    systemEquations: document.getElementById('systemEquations'),
    submitAnswer: document.getElementById('submitAnswer'),
    feedback: document.getElementById('feedback'),
    completionMessage: document.getElementById('completionMessage'),
    resetTrainerBtn: document.getElementById('resetTrainerBtn'),
    youtubePlayer1: document.getElementById('youtubePlayer1'),
    youtubePlayer2: document.getElementById('youtubePlayer2'),
    trainerContainer: document.getElementById('trainerContent'),
    correctAnswers: document.getElementById('correctAnswers'),
    totalQuestions: document.getElementById('totalQuestions')
};

    // Логіка для вкладок теорії
    const tabButtons = elements.theoryModal?.querySelectorAll('.tab-button');
    const tabContents = elements.theoryModal?.querySelectorAll('.tab-content');

    function closeAllTabs() {
        tabButtons?.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-expanded', 'false');
        });
        tabContents?.forEach(content => {
            content.classList.remove('active');
        });
    }

    function toggleTab(tabId, button) {
        const targetContent = elements.theoryModal?.querySelector(`#${tabId}`);
        if (!targetContent) return;

        const isActive = button.classList.contains('active');
        closeAllTabs();

        if (!isActive) {
            button.classList.add('active');
            button.setAttribute('aria-expanded', 'true');
            targetContent.classList.add('active');
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([targetContent]).then(() => {
                    elements.theoryModal.querySelector('.modal-content').scrollTop = 0;
                });
            }
        }
    }

    tabButtons?.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            toggleTab(tabId, button);
        });
    });

    closeAllTabs();

    // Логіка для YouTube-відео
    let players = {};
    const playerIds = {
        'youtubePlayer1': 'Gz6v38UyS4c',
        'youtubePlayer2': '9R7W1WV6ye8'
    };

    const playerSrcs = {
        'youtubePlayer1': elements.youtubePlayer1?.getAttribute('data-src') || '',
        'youtubePlayer2': elements.youtubePlayer2?.getAttribute('data-src') || ''
    };

    function loadYouTubeAPI() {
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
    }

    window.onYouTubeIframeAPIReady = function() {
        Object.keys(playerIds).forEach(playerId => {
            const element = elements[playerId];
            if (element) {
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => {
                            event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
                        }
                    }
                });
            }
        });
    };

    loadYouTubeAPI();

    function stopAllVideos() {
        Object.keys(players).forEach(playerId => {
            const player = players[playerId];
            const element = elements[playerId];
            if (player && typeof player.stopVideo === 'function') {
                player.stopVideo();
            }
            if (element) {
                element.src = '';
                const parent = element.parentNode;
                const newIframe = document.createElement('iframe');
                newIframe.id = playerId;
                newIframe.setAttribute('data-src', playerSrcs[playerId]);
                newIframe.setAttribute('frameborder', '0');
                newIframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
                newIframe.setAttribute('allowfullscreen', '');
                parent.replaceChild(newIframe, element);
                elements[playerId] = newIframe;
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 })
                    }
                });
            }
        });
    }

    function openVideoPlayerModal(videoModal, playerId) {
        stopAllVideos();
        toggleModal(elements.videoModal, false);
        toggleModal(videoModal, true);
        const element = elements[playerId];
        if (element && !element.src) {
            element.src = playerSrcs[playerId];
        }
        if (players[playerId] && typeof players[playerId].loadVideoById === 'function') {
            players[playerId].loadVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
        }
    }

    function toggleModal(modal, show) {
        if (!modal) return;
        const allModals = [
            elements.theoryModal,
            elements.videoModal,
            elements.questionsModal,
            elements.trainerModal,
            elements.videoPlayerModal1,
            elements.videoPlayerModal2,
            elements.videoPlayerModal3
        ].filter(Boolean);
        allModals.forEach(m => {
            if (m && m !== modal) m.style.display = 'none';
        });
        modal.style.display = show ? 'flex' : 'none';
        elements.modalOverlay.style.display = show ? 'block' : 'none';
        document.body.style.overflow = show ? 'hidden' : 'auto';
        if (show) {
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) closeBtn.focus();
            if (modal === elements.trainerModal) resetTrainer();
        }
    }

    elements.openTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, true));
    elements.openVideoBtn?.addEventListener('click', () => toggleModal(elements.videoModal, true));
    elements.openQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, true));
    elements.openTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, true));
    elements.closeTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, false));
    elements.closeVideoBtn?.addEventListener('click', () => toggleModal(elements.videoModal, false));
    elements.closeQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, false));
    elements.closeTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, false));
    elements.closeVideoPlayerBtn1?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoModal, true);
    });
    elements.closeVideoPlayerBtn2?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal2, false);
        toggleModal(elements.videoModal, true);
    });
        elements.modalOverlay?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.theoryModal, false);
        toggleModal(elements.videoModal, false);
        toggleModal(elements.questionsModal, false);
        toggleModal(elements.trainerModal, false);
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoPlayerModal2, false);
           });
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            stopAllVideos();
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.videoModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
            toggleModal(elements.videoPlayerModal1, false);
            toggleModal(elements.videoPlayerModal2, false);
                    }
    });

    document.querySelectorAll('.flashcard').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('flipped');
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([card]);
            }
        });
        card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.classList.toggle('flipped');
                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([card]);
                }
            }
        });
    });

    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoNumber = card.getAttribute('data-video');
            const videoModal = elements[`videoPlayerModal${videoNumber}`];
            const playerId = `youtubePlayer${videoNumber}`;
            if (videoModal && playerId) openVideoPlayerModal(videoModal, playerId);
        });
    });

    // Логіка тренажера
    let currentQuestion = 1;
let selectedOption = null;
let currentSystem = null;
let correctAnswer = null;
let correctAnswersCount = 0;
let totalQuestionsAnswered = 0;

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

   function generateSystem2x2() {
    let coefficients, constants, det, x, y, isCoprime;
    do {
        x = getRandomInt(-3, 3);
        y = getRandomInt(-3, 3);
        coefficients = Array(2).fill().map(() => Array(2).fill(0));
        do {
            coefficients[0][0] = getRandomInt(-5, 5); // a
            coefficients[0][1] = getRandomInt(-5, 5); // b
            coefficients[1][0] = getRandomInt(-5, 5); // c
            coefficients[1][1] = getRandomInt(-5, 5); // d
            det = coefficients[0][0] * coefficients[1][1] - coefficients[0][1] * coefficients[1][0]; // ad - bc
        } while (det !== 1 && det !== -1 || coefficients.some(row => row.every(coef => coef === 0)));
        constants = [
            coefficients[0][0] * x + coefficients[0][1] * y,
            coefficients[1][0] * x + coefficients[1][1] * y
        ];
        const equation1 = [coefficients[0][0], coefficients[0][1], constants[0]];
        const equation2 = [coefficients[1][0], coefficients[1][1], constants[1]];
        isCoprime = gcdArray(equation1) === 1 && gcdArray(equation2) === 1;
    } while (constants[0] === 0 || constants[1] === 0 || Math.abs(constants[0]) > 20 || Math.abs(constants[1]) > 20 || !isCoprime);

    const [a, b] = coefficients[0];
    const [c, d] = coefficients[1];
    const inverse = [
        [d / det, -b / det],
        [-c / det, a / det]
    ].map(row => row.map(val => Math.round(val)));

    return {
        coefficients,
        constants,
        determinants: { delta: det },
        roots: { x, y },
        inverse
    };
}
        function generateSystem3x3() {
    let coefficients, constants, det, isCoprime;
    const isDeterminantZero = Math.random() < 0.5; // 50% шанс, що det = 0

    if (isDeterminantZero) {
        // Генерація системи з det(A) = 0
        let a1, a2, a3;
        do {
            // Перше рівняння: коефіцієнти від -3 до 3
            a1 = [
                getRandomInt(-3, 3),
                getRandomInt(-3, 3),
                getRandomInt(-3, 3)
            ];
            while (a1.every(coef => coef === 0)) {
                a1 = [
                    getRandomInt(-3, 3),
                    getRandomInt(-3, 3),
                    getRandomInt(-3, 3)
                ];
            }

            // Друге рівняння: коефіцієнти від -5 до 5
            a2 = [
                getRandomInt(-5, 5),
                getRandomInt(-5, 5),
                getRandomInt(-5, 5)
            ];
            while (a2.every(coef => coef === 0)) {
                a2 = [
                    getRandomInt(-5, 5),
                    getRandomInt(-5, 5),
                    getRandomInt(-5, 5)
                ];
            }

            // Третє рівняння: лінійна комбінація a1 і a2 для det = 0
            let k1 = getRandomInt(-3, 3);
            let k2 = getRandomInt(-3, 3);
            while (k1 === 0 && k2 === 0) { // Уникаємо тривіальної комбінації
                k1 = getRandomInt(-3, 3);
                k2 = getRandomInt(-3, 3);
            }
            a3 = [
                k1 * a1[0] + k2 * a2[0],
                k1 * a1[1] + k2 * a2[1],
                k1 * a1[2] + k2 * a2[2]
            ];

            coefficients = [a1, a2, a3];

            // Генерація вільних членів
            constants = [
                getRandomInt(-10, 10),
                getRandomInt(-10, 10),
                0 // Буде обчислено нижче
            ];
            while (constants[0] === 0 || constants[1] === 0) {
                constants[0] = getRandomInt(-10, 10);
                constants[1] = getRandomInt(-10, 10);
            }
            constants[2] = k1 * constants[0] + k2 * constants[1]; // b3 = k1 * b1 + k2 * b2

            // Перевірка обмежень на вільні члени
            if (constants.some(b => Math.abs(b) > 20 || b === 0)) continue;

            // Обчислення визначника
            det = a1[0] * (a2[1] * a3[2] - a2[2] * a3[1]) -
                  a1[1] * (a2[0] * a3[2] - a2[2] * a3[0]) +
                  a1[2] * (a2[0] * a3[1] - a2[1] * a3[0]);

            const equation1 = [...a1, constants[0]];
            const equation2 = [...a2, constants[1]];
            const equation3 = [...a3, constants[2]];
            isCoprime = gcdArray(equation1) === 1 && gcdArray(equation2) === 1 && gcdArray(equation3) === 1;
        } while (Math.abs(det) > 0.01 || !isCoprime);
    } else {
        // Генерація системи з det(A) ≠ 0
        let x, y, z;
        do {
            x = getRandomInt(-3, 3);
            y = getRandomInt(-3, 3);
            z = getRandomInt(-3, 3);
            coefficients = Array(3).fill().map(() => Array(3).fill(0));
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    coefficients[i][j] = getRandomInt(-5, 5);
                    while (coefficients[i][j] === 0) {
                        coefficients[i][j] = getRandomInt(-5, 5);
                    }
                }
            }
            constants = [
                coefficients[0][0] * x + coefficients[0][1] * y + coefficients[0][2] * z,
                coefficients[1][0] * x + coefficients[1][1] * y + coefficients[1][2] * z,
                coefficients[2][0] * x + coefficients[2][1] * y + coefficients[2][2] * z
            ];
            const [a1, a2, a3] = coefficients;
            det = a1[0] * (a2[1] * a3[2] - a2[2] * a3[1]) -
                  a1[1] * (a2[0] * a3[2] - a2[2] * a3[0]) +
                  a1[2] * (a2[0] * a3[1] - a2[1] * a3[0]);
            const equation1 = [...a1, constants[0]];
            const equation2 = [...a2, constants[1]];
            const equation3 = [...a3, constants[2]];
            isCoprime = gcdArray(equation1) === 1 && gcdArray(equation2) === 1 && gcdArray(equation3) === 1;
        } while (det === 0 || !isCoprime || constants.some(b => b === 0 || Math.abs(b) > 20));
    }

    return {
        coefficients,
        constants,
        determinants: { delta: det }
    };
}
       
            // Нова функція для форматування матриці з круглими дужками
function matrixToLatexWithParentheses(matrix) {
    if (matrix.length === 2) {
        return `\\begin{pmatrix} ${matrix[0][0]} & ${matrix[0][1]} \\\\ ${matrix[1][0]} & ${matrix[1][1]} \\end{pmatrix}`;
    } else {
        return `\\begin{pmatrix} ${matrix[0][0]} & ${matrix[0][1]} & ${matrix[0][2]} \\\\ ${matrix[1][0]} & ${matrix[1][1]} & ${matrix[1][2]} \\\\ ${matrix[2][0]} & ${matrix[2][1]} & ${matrix[2][2]} \\end{pmatrix}`;
    }
}
        // Допоміжна функція для форматування рівнянь (вже є у вашому коді)
function formatEquation(a, b, c, d = null) {
    let parts = [];
    if (a !== 0) {
        parts.push(a === 1 ? 'x' : a === -1 ? '-x' : `${a}x`);
    }
    if (b !== 0) {
        let yPart = b === 1 ? 'y' : b === -1 ? '-y' : `${b}y`;
        if (parts.length > 0) {
            yPart = b > 0 ? ` + ${yPart}` : ` - ${Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y'}`;
        }
        parts.push(yPart);
    }
    if (d !== null && c !== 0) {
        let zPart = c === 1 ? 'z' : c === -1 ? '-z' : `${c}z`;
        if (parts.length > 0) {
            zPart = c > 0 ? ` + ${zPart}` : ` - ${Math.abs(c) === 1 ? 'z' : Math.abs(c) + 'z'}`;
        }
        parts.push(zPart);
    }
    if (parts.length === 0) parts.push('0');
    return `${parts.join('')} = ${d !== null ? d : c}`;
}
        // Функція для форматування системи рівнянь у LaTeX (вже є у вашому коді)
function systemToLatex(system, withInputs = false) {
    const size = system.coefficients.length;
    let latex = '\\begin{cases} ';
    let plainText = '';
    for (let i = 0; i < size; i++) {
        let equation = '';
        let plainEquation = '';
        let isFirstTerm = true;
        for (let j = 0; j < size; j++) {
            let coef = system.coefficients[i][j];
            let varName = ['x', 'y', 'z'][j];
            if (coef !== 0) {
                let sign = isFirstTerm ? (coef < 0 ? '-' : '') : (coef > 0 ? '+' : '-');
                if (Math.abs(coef) === 1) {
                    equation += `${sign}${varName}`;
                    plainEquation += `${sign}${varName}`;
                } else {
                    equation += `${sign}${Math.abs(coef)}${varName}`;
                    plainEquation += `${sign}${Math.abs(coef)}${varName}`;
                }
                isFirstTerm = false;
            }
        }
        if (withInputs) {
            equation += ` = \\text{ } \\input{input_b${i}}`;
            plainEquation += ` = `;
        } else {
            equation += ` = ${system.constants[i]}`;
            plainEquation += ` = ${system.constants[i]}`;
        }
        latex += equation.replace(/^\+/, '');
        plainText += plainEquation.replace(/^\+/, '') + '\n';
        if (i < size - 1) latex += ' \\\\ ';
    }
    latex += ' \\end{cases}';
    elements.systemText.dataset.plainText = plainText;
    return latex;
}

// Допоміжна функція для НСД (вже є у вашому коді)
function gcd(a, b) {
    return b === 0 ? Math.abs(a) : gcd(b, a % b);
}

function gcdArray(arr) {
    return arr.reduce((a, b) => gcd(a, Math.abs(b)), Math.abs(arr[0]));
}

function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}


    // Генерація питання 1 (оновлено для відповідності вашому новому питанню)
function generateQuestion1() {
    currentSystem = generateSystem2x2(); // Використовуємо вашу функцію для генерації системи 2x2
    const [a1, a2] = currentSystem.coefficients; // Матриця A (2x2)
    const [b1, b2] = currentSystem.constants; // Матриця B
    const roots = currentSystem.roots; // Корені x, y

    // Правильна система рівнянь
    const correctSystem = `\\begin{cases} ${formatEquation(a1[0], a1[1], b1)} \\\\ ${formatEquation(a2[0], a2[1], b2)} \\end{cases}`;
    const correctSystemPlain = `${formatEquation(a1[0], a1[1], b1)}\n${formatEquation(a2[0], a2[1], b2)}`;

    // Генерація неправильних відповідей
    let wrongSystems = [];
    while (wrongSystems.length < 3) {
        let wrongSystem, wrongSystemPlain, comment;
        const rand = Math.floor(Math.random() * 3); // Вибір типу помилки

        if (rand === 0) {
            // Помилка типу: неправильні коефіцієнти (аналогічно до -x + 3y = -5, 2x + 4y = -5)
            const wrongA1 = [a1[0], getRandomInt(-5, 5)]; // Змінюємо a1[1]
            const wrongA2 = [getRandomInt(-5, 5), a2[1]]; // Змінюємо a2[0]
            while (wrongA1[1] === a1[1] || wrongA2[0] === a2[0] || wrongA1[1] === 0 || wrongA2[0] === 0) {
                wrongA1[1] = getRandomInt(-5, 5);
                wrongA2[0] = getRandomInt(-5, 5);
            }
            wrongSystem = `\\begin{cases} ${formatEquation(wrongA1[0], wrongA1[1], b1)} \\\\ ${formatEquation(wrongA2[0], wrongA2[1], b2)} \\end{cases}`;
            wrongSystemPlain = `${formatEquation(wrongA1[0], wrongA1[1], b1)}\n${formatEquation(wrongA2[0], wrongA2[1], b2)}`;
            comment = '❌ Промах! Спробуй ще!';
        } else if (rand === 1) {
            // Помилка типу: протилежний знак у вільному члені (аналогічно до 3x + 4y = 5)
            wrongSystem = `\\begin{cases} ${formatEquation(a1[0], a1[1], b1)} \\\\ ${formatEquation(a2[0], a2[1], -b2)} \\end{cases}`;
            wrongSystemPlain = `${formatEquation(a1[0], a1[1], b1)}\n${formatEquation(a2[0], a2[1], -b2)}`;
            comment = '❌ Промах! Спробуй ще!';
        } else {
            // Помилка типу: протилежний знак коефіцієнта при y (аналогічно до 3x - 4y = -5)
            wrongSystem = `\\begin{cases} ${formatEquation(a1[0], a1[1], b1)} \\\\ ${formatEquation(a2[0], -a2[1], b2)} \\end{cases}`;
            wrongSystemPlain = `${formatEquation(a1[0], a1[1], b1)}\n${formatEquation(a2[0], -a2[1], b2)}`;
            comment = '❌ Промах! Спробуй ще!';
        }
        // Перевірка, чи неправильна відповідь унікальна і не збігається з правильною
        if (
            wrongSystem !== correctSystem &&
            !wrongSystems.some(ws => ws.text === wrongSystem)
        ) {
            wrongSystems.push({ text: wrongSystem, plainText: wrongSystemPlain, isCorrect: false, comment });
        }
    }
    // Формуємо варіанти відповідей
    const options = [
        { text: correctSystem, plainText: correctSystemPlain, isCorrect: true, comment: '✅ ВІРНО! Ціль уражена!' },
        ...wrongSystems
    ];

    return shuffleArray(options);
}

  // Нова функція generateQuestion2
function generateQuestion2() {
    currentSystem = generateSystem2x2();
    const [a1, a2] = currentSystem.coefficients; // Матриця A: [[a1[0], a1[1]], [a2[0], a2[1]]]
    const [b1, b2] = currentSystem.constants; // Матриця B: [b1, b2]

    // Правильна відповідь: A, X, B
    const correctAnswer = `A = ${matrixToLatexWithParentheses([a1, a2])}, \\quad X = \\begin{pmatrix} x \\\\ y \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b1} \\\\ ${b2} \\end{pmatrix}`;
    const correctPlainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], X = [x; y], B = [${b1}; ${b2}]`;

    // Неправильні відповіді
    let wrongAnswers = [];
    while (wrongAnswers.length < 3) {
        let wrongAnswer, wrongPlainText, comment;
        const rand = Math.floor(Math.random() * 3); // Вибір типу помилки

        if (rand === 0) {
            // Помилка 1: Коефіцієнти рівнянь записані як стовпці в A
            const wrongA = [[a1[0], a2[0]], [a1[1], a2[1]]]; // Транспонування A
            wrongAnswer = `A = ${matrixToLatexWithParentheses(wrongA)}, \\quad X = \\begin{pmatrix} x \\\\ y \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b1} \\\\ ${b2} \\end{pmatrix}`;
            wrongPlainText = `A = [${wrongA[0].join(', ')}; ${wrongA[1].join(', ')}], X = [x; y], B = [${b1}; ${b2}]`;
            comment = '❌ Промах! Спробуй ще!';
        } else if (rand === 1) {
            // Помилка 2: Поміняні місцями елементи матриці B
            wrongAnswer = `A = ${matrixToLatexWithParentheses([a1, a2])}, \\quad X = \\begin{pmatrix} x \\\\ y \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b2} \\\\ ${b1} \\end{pmatrix}`;
            wrongPlainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], X = [x; y], B = [${b2}; ${b1}]`;
            comment = '❌ Промах! Спробуй ще!';
        } else {
            // Помилка 3: Один елемент матриці A з протилежним знаком
            const wrongA = [a1.slice(), a2.slice()];
            const changeIndex = Math.floor(Math.random() * 4); // Вибір випадкового елемента A
            if (changeIndex === 0) wrongA[0][0] = -wrongA[0][0];
            else if (changeIndex === 1) wrongA[0][1] = -wrongA[0][1];
            else if (changeIndex === 2) wrongA[1][0] = -wrongA[1][0];
            else wrongA[1][1] = -wrongA[1][1];
            wrongAnswer = `A = ${matrixToLatexWithParentheses(wrongA)}, \\quad X = \\begin{pmatrix} x \\\\ y \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b1} \\\\ ${b2} \\end{pmatrix}`;
            wrongPlainText = `A = [${wrongA[0].join(', ')}; ${wrongA[1].join(', ')}], X = [x; y], B = [${b1}; ${b2}]`;
            comment = '❌ Промах! Спробуй ще!';
        }

        // Перевірка унікальності неправильної відповіді
        if (
            wrongAnswer !== correctAnswer &&
            !wrongAnswers.some(wa => wa.text === wrongAnswer)
        ) {
            wrongAnswers.push({ text: wrongAnswer, plainText: wrongPlainText, isCorrect: false, comment });
        }
    }

    // Формуємо варіанти відповідей
    const options = [
        { text: correctAnswer, plainText: correctPlainText, isCorrect: true, comment: '✅ ВІРНО! Ціль уражена!' },
        ...wrongAnswers
    ];

    return shuffleArray(options);
}

   // Нова функція generateQuestion3
function generateQuestion3() {
    currentSystem = generateSystem3x3();
    const { coefficients, constants, determinants: { delta: det } } = currentSystem;

    // Визначаємо правильну відповідь
    const isSolvable = Math.abs(det) > 0.01;
    const correctAnswerText = isSolvable ? 'Так' : 'Ні';
    const correctComment = '✅ ВІРНО! Ціль уражена!';

    // Формуємо варіанти відповідей
    const options = [
        { 
            text: '\\text{Так}', // Прямий шрифт
            plainText: 'Так', // Для порівняння і запасного варіанту
            isCorrect: isSolvable, 
            comment: isSolvable ? correctComment : '❌ Промах! Спробуй ще!'
        },
        { 
            text: '\\text{Ні}', 
            plainText: 'Ні',
            isCorrect: !isSolvable, 
            comment: !isSolvable ? correctComment : '❌ Промах! Спробуй ще!'
        },
        { 
            text: '\\text{Неможливо визначити}', 
            plainText: 'Неможливо визначити',
            isCorrect: false, 
            comment: '❌ Промах! Спробуй ще!'
        }
    ];

    return {
        question: 'Чи можна розв’язати систему рівнянь матричним методом за формулою \\( X = A^{-1} \\cdot B \\)?',
        options: shuffleArray(options),
        correctAnswer: correctAnswerText
    };
}
                 
    // Генерація питання 4
function generateQuestion4() {
    currentSystem = generateSystem2x2();
    if (!currentSystem || !currentSystem.coefficients || !currentSystem.constants || !currentSystem.inverse) {
        console.error('Помилка: generateSystem2x2 повернув некоректну систему', currentSystem);
        return null;
    }
    const { coefficients, inverse } = currentSystem;
    const [a1, a2] = coefficients;
    const [a, b] = a1;
    const [c, d] = a2;
    const [inv11, inv12] = inverse[0];
    const [inv21, inv22] = inverse[1];

    // Правильна відповідь
    const correctLatex = `A = \\begin{pmatrix} ${a} & ${b} \\\\ ${c} & ${d} \\end{pmatrix}, \\quad A^{-1} = \\begin{pmatrix} ${inv11} & ${inv12} \\\\ ${inv21} & ${inv22} \\end{pmatrix}`;
    const correctPlainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], A^(-1) = [${inverse[0].join(', ')}; ${inverse[1].join(', ')}]`;
    console.log('generateQuestion4: correctLatex:', correctLatex);

    // Неправильні відповіді
    let wrongAnswers = [];
    while (wrongAnswers.length < 3) {
        let wrongA, wrongA_inv, latex, plainText, comment;
        const rand = wrongAnswers.length;
        if (rand === 0) {
            // Помилка 1: Зміна знаку в другому стовпці A^{-1}
            wrongA = coefficients;
            wrongA_inv = [
                [inv11, -inv12],
                [inv21, -inv22]
            ];
            latex = `A = \\begin{pmatrix} ${a} & ${b} \\\\ ${c} & ${d} \\end{pmatrix}, \\quad A^{-1} = \\begin{pmatrix} ${inv11} & ${-inv12} \\\\ ${inv21} & ${-inv22} \\end{pmatrix}`;
            plainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], A^(-1) = [${wrongA_inv[0].join(', ')}; ${wrongA_inv[1].join(', ')}]`;
            comment = '❌ Промах! Спробуй ще!';
        } else if (rand === 1) {
            // Помилка 2: Зміна числа в першому стовпці A^{-1}
            const newInv11 = inv11 + (inv11 >= 0 ? 1 : -1);
            const newInv21 = inv21 + (inv21 >= 0 ? 1 : -1);
            wrongA = coefficients;
            wrongA_inv = [
                [newInv11, inv12],
                [newInv21, inv22]
            ];
            latex = `A = \\begin{pmatrix} ${a} & ${b} \\\\ ${c} & ${d} \\end{pmatrix}, \\quad A^{-1} = \\begin{pmatrix} ${newInv11} & ${inv12} \\\\ ${newInv21} & ${inv22} \\end{pmatrix}`;
            plainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], A^(-1) = [${wrongA_inv[0].join(', ')}; ${wrongA_inv[1].join(', ')}]`;
            comment = '❌ Промах! Спробуй ще!';
        } else {
            // Помилка 3: Зміна знаку в другому стовпці A
            wrongA = [
                [a, -b],
                [c, -d]
            ];
            wrongA_inv = inverse;
            latex = `A = \\begin{pmatrix} ${a} & ${-b} \\\\ ${c} & ${-d} \\end{pmatrix}, \\quad A^{-1} = \\begin{pmatrix} ${inv11} & ${inv12} \\\\ ${inv21} & ${inv22} \\end{pmatrix}`;
            plainText = `A = [${wrongA[0].join(', ')}; ${wrongA[1].join(', ')}], A^(-1) = [${inverse[0].join(', ')}; ${inverse[1].join(', ')}]`;
            comment = '❌ Промах! Спробуй ще!';
        }
        if (!wrongAnswers.some(wa => wa.text === latex)) {
            wrongAnswers.push({ text: latex, plainText, isCorrect: false, comment });
        }
    }

    // Формуємо варіанти відповідей
    const options = [
        { text: correctLatex, plainText: correctPlainText, isCorrect: true, comment: '✅ ВІРНО! Ціль уражена!' },
        ...wrongAnswers
    ];

    return {
        question: 'Виберіть правильну пару «головна матриця системи \\( A \\) та її обернена \\( A^{-1} \\)»:',
        systemLatex: systemToLatex(currentSystem),
        options: shuffleArray(options),
        correctAnswer: { A: coefficients, A_inv: inverse }
    };
}

// Генерація питання 5
function generateQuestion5() {
    currentSystem = generateSystem2x2();
    if (!currentSystem || !currentSystem.coefficients || !currentSystem.constants || !currentSystem.inverse) {
        console.error('Помилка: generateSystem2x2 повернув некоректну систему', currentSystem);
        return null;
    }
    const { coefficients, constants, inverse } = currentSystem;
    const [a1, a2] = coefficients;
    const [a, b] = a1;
    const [c, d] = a2;
    const [b1, b2] = constants;

    // Правильна система: A * X = B
    const correctSystem = {
        coefficients,
        constants
    };
    const correctLatex = systemToLatex(correctSystem);
    const correctPlainText = `${formatEquation(a, b, b1)}\n${formatEquation(c, d, b2)}`;

    // Неправильні системи
    let wrongAnswers = [];
    while (wrongAnswers.length < 3) {
        let wrongCoefficients, wrongConstants, latex, plainText, comment;
        const rand = wrongAnswers.length;
        if (rand === 0) {
            // Помилка 1: Перестановка коефіцієнтів і зміна знаків
            wrongCoefficients = [
                [2 * a, -b],
                [-a, b]
            ];
            wrongConstants = [b1, b2];
            latex = systemToLatex({ coefficients: wrongCoefficients, constants: wrongConstants });
            plainText = `${formatEquation(wrongCoefficients[0][0], wrongCoefficients[0][1], wrongConstants[0])}\n${formatEquation(wrongCoefficients[1][0], wrongCoefficients[1][1], wrongConstants[1])}`;
            comment = '❌ Промах! Спробуй ще!';
        } else if (rand === 1) {
            // Помилка 2: Перестановка правих частин
            wrongCoefficients = [
                [a, 2 * b],
                [c, a]
            ];
            wrongConstants = [b2, b1];
            latex = systemToLatex({ coefficients: wrongCoefficients, constants: wrongConstants });
            plainText = `${formatEquation(wrongCoefficients[0][0], wrongCoefficients[0][1], wrongConstants[0])}\n${formatEquation(wrongCoefficients[1][0], wrongCoefficients[1][1], wrongConstants[1])}`;
            comment = '❌ Промах! Спробуй ще!';
        } else {
            // Помилка 3: Зміна знаків і коефіцієнтів
            wrongCoefficients = [
                [a, -b],
                [2 * c, b]
            ];
            wrongConstants = [b1, b2];
            latex = systemToLatex({ coefficients: wrongCoefficients, constants: wrongConstants });
            plainText = `${formatEquation(wrongCoefficients[0][0], wrongCoefficients[0][1], wrongConstants[0])}\n${formatEquation(wrongCoefficients[1][0], wrongCoefficients[1][1], wrongConstants[1])}`;
            comment = '❌ Промах! Спробуй ще!';
        }
        if (!wrongAnswers.some(wa => wa.text === latex)) {
            wrongAnswers.push({ text: latex, plainText, isCorrect: false, comment });
        }
    }

    // Формуємо варіанти відповідей
    const options = [
        { text: correctLatex, plainText: correctPlainText, isCorrect: true, comment: '✅ ВІРНО! Ціль уражена!' },
        ...wrongAnswers
    ];

    // Матриця A^{-1} і вектор B для відображення
    const [inv1, inv2] = inverse;
    const inverseLatex = `A^{-1} = \\begin{pmatrix} ${inv1[0]} & ${inv1[1]} \\\\ ${inv2[0]} & ${inv2[1]} \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b1} \\\\ ${b2} \\end{pmatrix}`;
    const inversePlainText = `A^(-1) = [${inv1.join(', ')}; ${inv2.join(', ')}], B = [${b1}; ${b2}]`;

    return {
        question: 'Задано матриці: \\[' + inverseLatex + '.\\] Виберіть правильну систему лінійних рівнянь \\( A \\cdot X = B \\):',
        systemLatex: '', // Система буде в options, тому systemLatex порожній
        options: shuffleArray(options),
        correctAnswer: correctSystem,
        inverseLatex,
        inversePlainText
    };
}

// Оновлення resetTrainer для п’яти питань
function resetTrainer() {
    console.log('resetTrainer викликано');
    currentQuestion = 1;
    currentSystem = null;
    selectedOption = null;
    correctAnswer = null;
    correctAnswersCount = 0; // Скидаємо лічильник правильних відповідей
    totalQuestionsAnswered = 0; // Скидаємо лічильник загальних відповідей
    if (elements.correctAnswers) elements.correctAnswers.textContent = correctAnswersCount;
    if (elements.totalQuestions) elements.totalQuestions.textContent = totalQuestionsAnswered;
    elements.questionCircle.style.display = 'block';
    elements.questionText.style.display = 'block';
    elements.systemText.style.display = 'block';
    elements.optionsContainer.style.display = 'grid';
    elements.inputContainer.style.display = 'none';
    elements.systemEquations.style.display = 'none';
    elements.submitAnswer.style.display = 'block';
    elements.completionMessage.style.display = 'none';
    elements.trainerContainer.scrollTop = 0;
    displayQuestion();
}
function renderMath(elementsToRender) {
    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.startup.promise.then(() => {
            MathJax.typesetPromise(elementsToRender)
                .then(() => console.log('MathJax рендер завершено'))
                .catch(err => console.error('Помилка MathJax:', err));
        });
    } else {
        console.warn('MathJax ще не доступний');
    }
}
        
// Оновлена функція displayQuestion (лише частина для currentQuestion === 3 змінена)
function displayQuestion() {
    console.log('displayQuestion викликано, currentQuestion:', currentQuestion);

    if (!elements.questionCircle || !elements.questionText || !elements.systemText ||
        !elements.optionsContainer || !elements.inputContainer || !elements.systemEquations ||
        !elements.determinantInput || !elements.submitAnswer || !elements.feedback ||
        !elements.completionMessage || !elements.trainerContainer || !elements.resetTrainerBtn) {
        console.error('Один або кілька елементів тренажера відсутні в DOM');
        elements.questionText.textContent = 'Помилка: елементи інтерфейсу не знайдено';
        return;
    }

    selectedOption = null;
    correctAnswer = null;
    elements.optionsContainer.innerHTML = '';
    elements.inputContainer.style.display = 'none';
    elements.systemEquations.innerHTML = '';
    elements.systemEquations.style.display = 'none';
    elements.systemText.innerHTML = '';
    elements.determinantInput.value = '';
    elements.submitAnswer.disabled = true;
    elements.feedback.style.opacity = '0';
    elements.feedback.style.display = 'none';
    elements.completionMessage.style.display = 'none';
    elements.optionsContainer.classList.remove('question-1', 'question-2', 'question-3', 'question-4', 'question-5');
    elements.questionCircle.innerHTML = `<span>Питання ${currentQuestion}</span>`;
    elements.questionCircle.style.width = 'clamp(100px, 16vw, 130px)';
    elements.questionCircle.style.height = 'clamp(100px, 16vw, 130px)';

    let options;
    if (currentQuestion === 1) {
        elements.questionText.innerHTML = 'Виберіть систему рівнянь, яка відповідає рівності \\( A \\cdot X = B \\):';
        options = generateQuestion1();
        if (!options) {
            console.error('Помилка: generateQuestion1 не повернув даних');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 1');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        const [a1, a2] = currentSystem.coefficients;
        const [b1, b2] = currentSystem.constants;
        elements.systemText.innerHTML = `\\[ A = ${matrixToLatexWithParentheses([a1, a2])}, \\quad X = \\begin{pmatrix} x \\\\ y \\end{pmatrix}, \\quad B = \\begin{pmatrix} ${b1} \\\\ ${b2} \\end{pmatrix} \\]`;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-1');
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.setAttribute('data-plaintext', opt.plainText);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
        elements.systemText.dataset.plainText = `A = [${a1.join(', ')}; ${a2.join(', ')}], X = [x; y], B = [${b1}; ${b2}]`;
    } else if (currentQuestion === 2) {
        elements.questionText.innerHTML = 'Записати систему рівнянь у вигляді матричного рівняння \\( A \\cdot X = B \\):';
        options = generateQuestion2();
        if (!options) {
            console.error('Помилка: generateQuestion2 не повернув даних');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 2');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${systemToLatex(currentSystem)}\\]`;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-2');
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.setAttribute('data-plaintext', opt.plainText);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
        elements.systemText.dataset.plainText = currentSystem.coefficients.map((row, i) => 
            `${formatEquation(row[0], row[1], currentSystem.constants[i])}`).join('\n');
    } else if (currentQuestion === 3) {
        const q3 = generateQuestion3();
        if (!q3 || !q3.options || !q3.correctAnswer) {
            console.error('Помилка: generateQuestion3 не повернув даних або correctAnswer');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q3.question;
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 3');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${systemToLatex(currentSystem)}\\]`;
        correctAnswer = q3.correctAnswer;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-3');
        options = q3.options;
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.setAttribute('data-plaintext', opt.plainText || opt.text);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
        elements.systemText.dataset.plainText = currentSystem.coefficients.map((row, i) => 
            `${formatEquation(row[0], row[1], currentSystem.constants[i])}`).join('\n');
    } else if (currentQuestion === 4) {
        const q4 = generateQuestion4();
        if (!q4 || !q4.options || !q4.correctAnswer) {
            console.error('Помилка: generateQuestion4 не повернув даних або неправильна структура', q4);
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q4.question;
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 4');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${q4.systemLatex}\\]`;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-4');
        correctAnswer = q4.correctAnswer;
        options = q4.options;
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.setAttribute('data-plaintext', opt.plainText);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
        elements.systemText.dataset.plainText = currentSystem.coefficients.map((row, i) => 
            `${formatEquation(row[0], row[1], currentSystem.constants[i])}`).join('\n');
    } else if (currentQuestion === 5) {
        const q5 = generateQuestion5();
        if (!q5 || !q5.options || !q5.correctAnswer) {
            console.error('Помилка: generateQuestion5 не повернув даних або неправильна структура', q5);
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q5.question;
        elements.systemText.innerHTML = ''; // Не потрібен, бо A^{-1} і B у питанні
        elements.systemText.style.display = 'none';
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-5');
        correctAnswer = q5.correctAnswer;
        options = q5.options;
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.setAttribute('data-plaintext', opt.plainText);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
        elements.systemText.dataset.plainText = q5.inversePlainText;
    }
 renderMath([elements.systemText, elements.optionsContainer]);

    if (window.MathJax && MathJax.typesetPromise) {
        console.log('MathJax обробляє systemText, optionsContainer, questionText');
        setTimeout(() => {
            MathJax.typesetPromise([elements.systemText, elements.optionsContainer, elements.questionText])
                .then(() => {
                    console.log('MathJax успішно обробив елементи');
                    const firstOption = elements.optionsContainer.querySelector('.trainer-option');
                    if (firstOption) firstOption.focus();
                })
                .catch(err => {
                    console.error('Помилка MathJax у displayQuestion:', err);
                    elements.systemText.textContent = elements.systemText.dataset.plainText || 'Помилка відображення';
                    elements.optionsContainer.innerHTML = options?.map(opt => `<div class="trainer-option">${opt.plainText}</div>`).join('') || 'Помилка відображення варіантів';
                });
        }, 100);
    } else {
        console.warn('MathJax не доступний');
        elements.systemText.textContent = elements.systemText.dataset.plainText || 'Помилка: MathJax не завантажено';
        if (options) {
            elements.optionsContainer.innerHTML = options.map(opt => `<div class="trainer-option">${opt.plainText}</div>`).join('');
        }
    }

    elements.submitAnswer.style.display = 'block';
}
// Обробник для кнопки "Відповісти"
elements.submitAnswer?.addEventListener('click', () => {
    console.log('submitAnswer клікнуто, currentQuestion:', currentQuestion, 'selectedOption:', selectedOption, 'correctAnswer:', correctAnswer);

    if (!elements.feedback) {
        console.error('Елемент feedback відсутній у DOM');
        return;
    }

    let isCorrect;
    let feedbackText;

    // Усі питання (1–5) використовують вибір варіантів
    if (!selectedOption) {
        console.log(`Повернення: питання ${currentQuestion}, варіант не вибрано`);
        elements.feedback.textContent = '✗ Будь ласка, виберіть один із варіантів відповіді!';
        elements.feedback.className = 'trainer-feedback result-message wrong';
        elements.feedback.style.display = 'block';
        elements.feedback.style.opacity = '1';
        setTimeout(() => {
            elements.feedback.style.opacity = '0';
            setTimeout(() => {
                elements.feedback.style.display = 'none';
                elements.feedback.className = 'trainer-feedback result-message';
            }, 300);
        }, 2000);
        return;
    }

    isCorrect = selectedOption.isCorrect;
    feedbackText = selectedOption.comment;
    elements.feedback.textContent = feedbackText;
    elements.feedback.className = `trainer-feedback result-message ${isCorrect ? 'correct' : 'wrong'}`;
    elements.feedback.style.display = 'block';
    elements.feedback.style.opacity = '1';

    // Візуальна індикація вибраного варіанту
    document.querySelectorAll('.trainer-option').forEach(opt => {
        opt.classList.add('disabled');
        const optionPlainText = opt.getAttribute('data-plaintext')?.trim();
        if (optionPlainText === selectedOption.plainText?.trim()) {
            opt.classList.add(isCorrect ? 'correct' : 'wrong');
        }
    });

    // Оновлення лічильників
    if (isCorrect) correctAnswersCount++;
    totalQuestionsAnswered++;
    if (elements.correctAnswers) elements.correctAnswers.textContent = correctAnswersCount;
    if (elements.totalQuestions) elements.totalQuestions.textContent = totalQuestionsAnswered;

    // Обробка переходу до наступного питання або завершення
    const feedbackDuration = isCorrect ? 1000 : 2000;
    setTimeout(() => {
        elements.feedback.style.opacity = '0';
        setTimeout(() => {
            elements.feedback.style.display = 'none';
            elements.feedback.className = 'trainer-feedback result-message';
            document.querySelectorAll('.trainer-option').forEach(opt => {
                opt.classList.remove('disabled', 'correct', 'wrong', 'selected');
            });
            elements.submitAnswer.disabled = true;

            if (isCorrect) {
                if (currentQuestion < 5) {
                    currentQuestion += 1;
                    currentSystem = null;
                    displayQuestion();
                } else {
                    console.log('Завершення тренажера');
                    elements.questionCircle.style.display = 'none';
                    elements.questionText.style.display = 'none';
                    elements.systemText.style.display = 'none';
                    elements.optionsContainer.style.display = 'none';
                    elements.inputContainer.style.display = 'none';
                    elements.systemEquations.style.display = 'none';
                    elements.submitAnswer.style.display = 'none';
                    elements.completionMessage.style.display = 'block';
                    elements.trainerContainer.scrollTop = 0;
                    elements.resetTrainerBtn.focus();
                }
            } else {
                console.log('Неправильна відповідь, генерація нової системи');
                currentSystem = null;
                displayQuestion();
            }
        }, 300);
    }, feedbackDuration);

    // Оновлення MathJax для feedback
    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([elements.feedback]).catch(err => console.error('Помилка MathJax у feedback:', err));
    }
});
elements.resetTrainerBtn?.addEventListener('click', resetTrainer);
});
    </script>
</body>
</html>






