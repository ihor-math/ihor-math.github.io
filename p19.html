<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19. Обернена матриця</title>
   <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
        window.mathJaxReady = true;
    </script>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        *, *:before, ::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(135deg, #1a2b3a, #2e4c5a);
            font-family: 'Poppins', sans-serif;
            color: #e8e8e8;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100dvh;
        }
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: linear-gradient(135deg, #2b3a4c, #4c6b7a);
            border-radius: 25px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            font-size: 28px;
            color: #d4d4d4;
            text-shadow: 0 0 10px rgba(212, 212, 212, 0.5);
            font-weight: 800;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: linear-gradient(135deg, #2e4c5a, #4c6b7a);
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3), inset 0 0 8px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: inherit;
            border: 1px solid rgba(163, 166, 139, 0.3);
        }
        .section:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), inset 0 0 12px rgba(163, 166, 139, 0.2);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 5px rgba(163, 166, 139, 0.3));
        }
        .section h2 {
            font-size: 20px;
            color: #e8e8e8;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 95%;
            max-width: 95vw;
            height: 95vh;
            max-height: 95vh;
            background: linear-gradient(135deg, #1a2b3a, #2e4c5a);
            z-index: 1001;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            transition: opacity 0.25s ease, transform 0.25s ease;
            opacity: 0;
            border-radius: 15px;
            overflow: hidden;
            transform: translateZ(0);
        }
         .modal.show {
    display: flex;
    flex-direction: column;
    align-items: center;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

        .modal-header {
            background: linear-gradient(90deg, #2b3a4c, #4c6b7a);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
        }
        .close-btn {
            background: #6ee7b7;
            color: #1a2b3a;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .close-btn:hover {
            background: #4c9a7a;
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: linear-gradient(135deg, #4c6b7a, #2b3a4c);
            border-radius: 10px;
            margin: 10px;
            color: #e8e8e8;
            width: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: linear-gradient(135deg, #2e4c5a, #4c6b7a);
            border-radius: 15px;
            border: 1px solid rgba(163, 166, 139, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #e8e8e8;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
        }
        .video-player-container {
            max-width: 95%;
            margin: 0 auto;
        }
        .video-player-container iframe {
            width: 100%;
            aspect-ratio: 16 / 9;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .glow-title {
            text-align: center;
            font-size: 2em;
            color: #e8e8e8;
            font-family: 'Verdana', sans-serif;
            text-shadow: 0 0 10px #e8e8e8, 0 0 20px #6ee7b7, 0 0 30px #6ee7b7;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #e8e8e8, 0 0 10px #6ee7b7;
            }
            to {
                text-shadow: 0 0 20px #e8e8e8, 0 0 30px #6ee7b7;
            }
        }
        #theoryModal .modal-content p {
            font-size: 18px !important;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: justify;
            max-width: 100%;
        }
        #theoryModal .modal-content ul {
            list-style: none;
            padding-left: 20px;
        }
        #theoryModal .modal-content li {
            color: #e8e8e8;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
        }
        #theoryModal .modal-content li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #6ee7b7;
            font-size: 16px;
        }
        #theoryModal .modal-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        #theoryModal .math-notation-centered {
            display: block !important;
            color: #FFFF00 !important;
            text-align: center !important;
            max-width: 100%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
        }
        #theoryModal mjx-container {
            color: #FFFF00 !important;
            font-size: clamp(16px, 2.8vw, 18px);
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 100% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        #trainerModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
            text-align: center;
        }
        #trainerModal mjx-container[jax="CHTML"][display="true"] {
            font-size: clamp(18px, 3vw, 20px) !important;
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        .mathjax-loading::before {
            content: 'Завантаження формул...';
            display: block;
            text-align: center;
            color: #e8e8e8;
            margin: 10px 0;
        }
        .math-notation {
    font-size: 0.9em; /* Або ваш розмір шрифту */
    text-align: center; /* Якщо потрібно центроване вирівнювання */
}
        #questionsModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 5px auto;
            padding: 3px;
            box-sizing: border-box;
            text-align: center;
            overflow: visible !important;
        }
        #questionsModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 5px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 3px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            transition: opacity 0.25s ease;
            transform: translateZ(0);
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 95%;
            height: 200px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 12px;
            border-radius: 15px;
            font-size: clamp(16px, 3vw, 18px);
            line-height: 1.5;
            border: 1px solid rgba(163, 166, 139, 0.3);
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
        }
        .card-front {
            background: linear-gradient(135deg, #2e4c5a, #4c6b7a);
            color: #e8e8e8;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-wrap: wrap;
            overflow-wrap: break-word;
            word-break: break-word;
            padding: 12px 15px;
            max-width: 100%;
        }
        .card-back {
            background: linear-gradient(135deg, #3a4c5a, #575a7a);
            color: #e8e8e8;
            transform: rotateY(180deg);
            overflow-y: auto;
            text-align: justify;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
            padding: 12px 15px;
            max-width: 100%;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .card-back::-webkit-scrollbar {
            width: 6px;
        }
        .card-back::-webkit-scrollbar-track {
            background: transparent;
        }
        .card-back::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .card-back::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .question-card .card-front {
            white-space: normal;
            overflow-wrap: break-word;
            word-break: break-word;
            flex-wrap: wrap;
        }
        .card-back p {
            margin: 5px 0;
            font-size: clamp(16px, 3vw, 18px);
            color: #e8e8e8;
            box-sizing: border-box;
            width: 100%;
            text-align: center;
        }
        .card-front span.yellow {
            color: #FFFF00;
            font-weight: 600;
            display: inline;
            margin-right: 0.1em;
        }
        .trainer-container {
            width: 95%;
            max-width: 900px;
            padding: 4vw 5vw;
            text-align: center;
            background: linear-gradient(135deg, #2e4c5a, #4c6b7a);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(163, 166, 139, 0.3);
            box-sizing: border-box;
            margin: auto;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(163, 166, 139, 0.5) transparent;
        }
        .trainer-container::-webkit-scrollbar {
            width: 6px;
        }
        .trainer-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .trainer-container::-webkit-scrollbar-thumb {
            background: rgba(163, 166, 139, 0.5);
            border-radius: 3px;
        }
        .trainer-container::-webkit-scrollbar-thumb:hover {
            background: rgba(163, 166, 139, 0.8);
        }
        .trainer-container p {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin: 10px 0;
        }
        .trainer-container .math-notation-centered {
            text-align: center !important;
            margin: 10px 0;
            max-width: 90%;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin-bottom: 15px;
            text-align: center;
        }
        .question-number {
            width: 100px;
            height: 100px;
            line-height: 100px;
            background: linear-gradient(135deg, #6ee7b7, #4c9a7a);
            color: #1a2b3a;
            border-radius: 50%;
            font-size: clamp(16px, 2.8vw, 18px);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
            white-space: nowrap;
        }
        .answer-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        .answer-btn {
            background: #3b4a5a;
            border: 1.5px solid #FFD700;
            color: #e8e8e8;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(17px, 2.6vw, 18px);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            min-width: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            touch-action: manipulation;
        }
        .answer-btn:hover {
            background: linear-gradient(135deg, #4c6b7a, #575a7a);
            transform: scale(1.05);
        }
        .answer-btn:disabled {
            background: #575a7a;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .answer-btn.selected {
            background: #6f2c42 !important;
            border: 2px solid #FFD700 !important;
        }
        .submit-btn {
            background: #4c9a7a;
            color: #fbec5d;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            margin: 15px auto;
            display: block;
        }
        .submit-btn:hover {
            background: linear-gradient(135deg, #6ee7b7, #4c9a7a);
            transform: scale(1.05);
        }
        .submit-btn:disabled {
            background: #c3ceb9;
            cursor: not-allowed;
            opacity: 0.6;
            color: #2e4c5a;
        }
        #feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 10px 0;
            padding: 15px 25px;
            max-width: 400px;
            min-height: 80px;
            width: 90%;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            font-size: clamp(16px, 2.8vw, 18px);
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #feedback.show {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
        #feedback.correct {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        #feedback.incorrect {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        #resetTrainerBtn {
            background: #6ee7b7;
            color: #2e4c5a;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #resetTrainerBtn:hover {
            background: #4c9a7a;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #2b3a4c, #4c6b7a);
            color: #d4d4d4;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(163, 166, 139, 0.3);
            text-decoration: none;
        }
        .nav-button:hover {
            background: linear-gradient(135deg, #4c6b7a, #575a7a);
            color: #e8e8e8;
            text-decoration: none;
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(135deg, #2e4c5a, #4c6b7a);
            cursor: pointer;
            border: 1px solid rgba(163, 166, 139, 0.3);
        }
        summary {
            font-weight: 600;
            padding: 10px;
            background: linear-gradient(90deg, #3a4c5a, #575a7a);
            border-radius: 10px;
            color: #d4d4d4;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        summary:hover {
            background: linear-gradient(90deg, #575a7a, #4c9a7a);
        }
        details p {
            padding: 0 20px 10px;
            color: #e8e8e8;
        }
        .solution {
            color: #FFD700 !important;
            font-weight: bold;
        }
        .example-title {
            color: #FFD700 !important;
            font-weight: bold;
        }
        .example-condition {
            color: #e8e8e8 !important;
        }
       /* === СТИЛІ ДЛЯ МЕДАЛІ З ТРИЗУБОМ === */
.completion-emoji {
    position: relative;
    display: inline-block;
    width: clamp(56px, 12vw, 96px);
    height: clamp(56px, 12vw, 96px);
    vertical-align: middle;
    margin: 0 auto 3vw;
    border-radius: 50%;
    background: linear-gradient(135deg, #1c2526, #2e3a3b);
    border: 3px dashed #ffd700;
    box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
    overflow: hidden;
    animation: medalAppear 0.8s ease-out;
}

.completion-emoji::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'>\
<defs>\
<radialGradient id='goldShine' cx='40%' cy='35%' r='70%'>\
<stop offset='0%' stop-color='%23fff59d'/>\
<stop offset='40%' stop-color='%23ffeb3b'/>\
<stop offset='100%' stop-color='%23f9a825'/>\
</radialGradient>\
<filter id='s' x='-50%' y='-50%' width='200%' height='200%'>\
<feDropShadow dx='0' dy='2' stdDeviation='3' flood-color='%23000000' flood-opacity='0.4'/>\
</filter>\
</defs>\
<rect x='30' y='0' width='60' height='40' rx='4' fill='%23007ACC'/>\
<rect x='30' y='20' width='60' height='20' rx='4' fill='%23FFD700'/>\
<g transform='translate(60,70)'>\
<polygon points='0,-26 6,-6 26,-6 9,6 15,26 0,14 -15,26 -9,6 -26,-6 -6,-6' fill='url(%23goldShine)' filter='url(%23s)'/>\
</g>\
</svg>");
    background-size: 75%;
    background-repeat: no-repeat;
    background-position: center 60%;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.25));
    animation: medalBounce 1.2s ease-out 0.3s both;
}

/* Анімація появи кола */
@keyframes medalAppear {
    0% {
        transform: scale(0.3) rotate(-180deg);
        opacity: 0;
    }
    60% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* Анімація медалі — падає і блимає */
@keyframes medalBounce {
    0% {
        transform: translateY(-120px) rotate(-30deg) scale(0.4);
        opacity: 0;
    }
    60% {
        transform: translateY(15px) rotate(10deg) scale(1.15);
        opacity: 1;
    }
    80% {
        transform: translateY(-8px) rotate(-5deg) scale(1.05);
    }
    100% {
        transform: translateY(0) rotate(0) scale(1);
    }
}

        #completionScreen {
            z-index: 10;
            width: 100%;
            max-width: 90%;
            margin: 20px auto;
            text-align: center;
            position: relative;
        }
        .completion-message {
            text-align: center;
            padding: 20px;
            background: #144748;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(110, 231, 183, 0.3);
            max-width: 90%;
            margin: 20px auto;
        }
        .completion-message h2 {
            font-size: clamp(20px, 3.5vw, 24px);
            color: #e6e6e6;
            margin-bottom: 10px;
        }
        .completion-message p {
            font-size: clamp(18px, 3vw, 20px);
            color: #FFFF00;
        }
        .completion-message button {
            margin-top: 20px;
            background: #6ee7b7;
            color: #2e4c5a;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .completion-message button:hover {
            background: #4c9a7a;
        }
        .hidden {
            display: none !important;
        }
            .note-text {
    font-style: italic;
    color: #e2e8f0;
    text-align: justify;
   width: 100%;
}
           #submitAnswerBtn {
    display: inline-block;
    padding: 12px 24px; /* Збільшена область кліку */
    font-size: 16px; /* Чіткий текст */
    line-height: 1.5; /* Нормальна висота рядка */
    cursor: pointer;
    background-color: #3b4a5a;
    border: 1.5px solid #a855f7;
    color: white;
    border-radius: 5px; /* Закруглені кути */
    position: relative; /* Для контролю z-index */
    z-index: 100; /* Вище за інші елементи */
    transition: background-color 0.3s, transform 0.1s, opacity 0.3s;
}

#submitAnswerBtn:hover:not(:disabled) {
    background-color: #4b5a6a;
    transform: scale(1.05);
    opacity: 1;
}

#submitAnswerBtn:disabled {
    cursor: not-allowed;
    opacity: 0.6;
    pointer-events: none;
}

/* Додаткові стилі для уникнення перекриття */
#trainerContent {
    position: relative;
    z-index: 10;
}

#matrixDisplay, #answerButtons, #feedback {
    position: relative;
    z-index: 50; /* Нижче кнопки "Відповісти" */
}
        @media (max-width: 768px) {
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            .modal-content {
                padding: 15px;
                max-height: calc(100dvh - 60px);
                overflow-x: auto;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 18px !important;
                line-height: 1.7;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            .question-card {
                height: 220px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(16px, 2.9vw, 18px);
                padding: 10px 12px;
                overflow-wrap: break-word;
                word-break: break-word;
            }
            .card-back {
                padding: 10px 12px;
                font-size: clamp(16px, 2.9vw, 18px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(16px, 2.9vw, 18px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 4vw 5vw;
                width: 95%;
                max-width: 800px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .question-number {
                width: 80px;
                height: 80px;
                line-height: 80px;
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .answer-btn, .submit-btn, #resetTrainerBtn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 8px 15px;
                min-width: 100px;
            }
            .feedback {
                font-size: clamp(14px, 2.6vw, 16px);
            }
            .completion-emoji {
                width: clamp(60px, 12vw, 100px);
                height: clamp(60px, 12vw, 100px);
            }
            .completion-emoji::after {
                font-size: clamp(30px, 6vw, 50px);
            }
            .completion-message h2 {
                font-size: clamp(18px, 3vw, 20px);
            }
            .completion-message p {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .completion-message button {
                font-size: clamp(12px, 2.3vw, 14px);
                padding: 8px 16px;
            }
            .navigation-buttons {
                margin: 22px auto;
                gap: 16px;
            }
            .nav-button {
                font-size: 18px;
                padding: 8px 18px;
            }
            .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .submit-btn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 12px 24px;
                min-width: 120px;
                border-radius: 10px;
            }
        }
        @media (max-width: 480px) {
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 22px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 20px;
            }
            .modal-content {
                padding: 10px;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 16px !important;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(16px, 2.8vw, 18px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(15px, 2.7vw, 17px) !important;
            }
            .question-card {
                height: 240px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 8px 10px;
            }
            .card-back {
                padding: 8px 10px;
                font-size: clamp(15px, 2.8vw, 17px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(15px, 2.8vw, 17px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 5vw 6vw;
                width: 95%;
                max-width: 700px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(15px, 2.7vw, 17px);
            }
            .question-number {
                width: 70px;
                height: 70px;
                line-height: 70px;
                font-size: clamp(12px, 2.3vw, 14px);
            }
            .answer-btn, .submit-btn, #resetTrainerBtn {
                font-size: clamp(14px, 2.6vw, 16px);
                padding: 6px 12px;
                min-width: 80px;
            }
            #feedback {
                padding: 10px 15px;
                font-size: clamp(14px, 2.6vw, 16px);
                width: 80%;
                max-width: 300px;
                min-height: 60px;
            }
            .completion-emoji {
                width: clamp(50px, 10vw, 80px);
                height: clamp(50px, 10vw, 80px);
            }
            .completion-emoji::after {
                font-size: clamp(25px, 5vw, 40px);
            }
            .completion-message h2 {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .completion-message p {
                font-size: clamp(14px, 2.6vw, 16px);
            }
            .completion-message button {
                font-size: clamp(12px, 2.3vw, 14px);
                padding: 6px 12px;
            }
            .nav-button {
                font-size: 16px;
                padding: 8px 16px;
            }
            .submit-btn {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 10px 20px;
                min-width: 100px;
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>19. Обернена матриця</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
        <a class="nav-button" href='tema5.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6l6-6"/>
            </svg>
            До теми 5
        </a>
        <a class="nav-button" href='zmist.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
  <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
</svg>
            До курсу
        </a>

    </div>

    <div id="modalOverlay"></div>

    <div id="theoryModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <details>
                <summary>Поняття оберненої матриці. Умови існування</summary>
                <p>Обернена матриця є ключовим інструментом лінійної алгебри, який використовується для розв’язання систем лінійних рівнянь та інших матричних задач, і в цьому пункті ми детально розглянемо її опис, властивості, методи знаходження та наведемо приклади для кращого розуміння.</p>
                <p><span class="example-title">Поняття оберненої матриці.</span>  Обернена матриця – це матриця \( A^{-1} \), яка, помножена на вихідну квадратну матрицю \( A \), дає одиничну матрицю \( E \). Математично це записується так:</p>
                <p class="math-notation-centered">\[
                    A \cdot A^{-1} = A^{-1} \cdot A = E, \tag{5.16}
                \]</p>
                <p>де \( A \) – це квадратна матриця розмірності \( n \times n \), а \( E \) – одинична матриця того ж розміру.</p>
                <p>Аналогію можна провести з оберненими числами: якщо \( a = 5 \), то його обернене – \( \frac{1}{a} = \frac{1}{5} \), і їх добуток дорівнює одиниці \( 1 \) (\( 5 \cdot \frac{1}{5} = 1 \)). Для матриць добуток \( A \cdot A^{-1} \) також дає одиницю, але в матричному вигляді – одиничну матрицю.</p>
                <p><span class="example-title">Умови існування.</span> Обернена матриця існує лише для квадратних матриць \( A_{n \times n} \). Ключовою умовою для існування оберненої матриці є ненульовий визначник, тобто:</p>
                <p class="math-notation-centered">\[
                    |A| \neq 0,
                \]</p>
                <p>де \( |A| \) позначає визначник матриці \( A \). Якщо \( |A| = 0 \), то матриця називається особливою (виродженою), і оберненої матриці не існує. Якщо \( |A| \neq 0 \), то матриця є неособливою (невиродженою), і для неї можна знайти обернену матрицю.</p>
                <p class="note"><span class="example-title">Примітка.</span> <span class="note-text">Визначник матриці \( A \) – це числове значення, яке характеризує певні властивості матриці, зокрема її оберненість. Визначник матриці \( A \) зазвичай позначають як \( |A| \), хоча можливе використання й інших позначень, таких як \( \det(A) \) або \( \Delta A \).</span></p>
                <p>Щоб знайти обернену матрицю, необхідно знати та вміти обчислювати визначники. Також важливо розуміти, що таке матриця і вміти виконувати деякі основні дії з ними.</p>
            </details>
            <details>
    <summary>Методи знаходження оберненої матриці</summary>
    <p>Обернену матрицю \( A^{-1} \) можна знайти кількома способами, зокрема:</p>
    <p><span class="example-title">Методом Гаусса-Жордана.</span> Цей метод полягає у створенні розширеної матриці вигляду \( (A \mid E) \), де ліва частина містить елементи квадратної матриці \( A_{n \times n} \), а права – одинична матриця того ж розміру. Використовуючи елементарні перетворення над рядками (перестановка рядків, множення рядка на ненульове число, додавання кратного одного рядка до іншого), поступово приводять розширену матрицю до вигляду \( (E \mid A^{-1}) \). У цьому вигляді ліва частина стає одиничною матрицею, а права містить шукану обернену матрицю \( A^{-1} \). Метод застосовується лише для неособливих матриць, тобто таких, у яких визначник не дорівнює нулю (\( |A| \neq 0 \)).</p>
    <p><span class="example-title">За допомогою алгебраїчних доповнень.</span> Обернена матриця для квадратної матриці \( A_{n \times n} \) обчислюється за формулою:</p>
    <p class="math-notation-centered">\[
        A^{-1} = \frac{1}{|A|} \cdot \tilde{A}^T, \tag{5.17}
    \]</p>
    <p>де \( |A| \) – визначник матриці \( A \); \( \tilde{A} \) – союзна (або приєднана) матриця, елементами якої є алгебраїчні доповнення до відповідних елементів \( a_{ij} \) матриці \( A \); \( \tilde{A}^T \) – транспонована союзна матриця.</p>
    <p class="note"><span class="example-title">Примітка.</span> <span class="note-text">У цьому посібнику для знаходження оберненої матриці використовуватиметься метод алгебраїчних доповнень, оскільки це класичний аналітичний підхід, що допомагає краще зрозуміти структуру матриць і їхні властивості. Водночас метод Гаусса-Жордана є чисельно ефективним і широко застосовується в обчислювальній математиці.</span></p>
    <p><span class="example-title">Приклад 5.11.</span> <span class="example-condition">Знайти обернену матрицю для матриці \( A = \begin{pmatrix} 1 & 2 \\ 3 & 4 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Згідно формули (5.17) для оберненої матриці:</p>
    <p class="math-notation-centered">\[
        A^{-1} = \frac{1}{|A|} \cdot \tilde{A}^T,
    \]</p>
    <p>де \( |A| \) – визначник матриці \( A \), а \( \tilde{A}^T \) – транспонована союзна матриця.</p>
    <p>Обчислимо визначник матриці \( A \):</p>
    <p class="math-notation-centered">\[
        |A| = \begin{vmatrix} 1 & 2 \\ 3 & 4 \end{vmatrix} = 1 \cdot 4 - 2 \cdot 3 = 4 - 6 = -2.
    \]</p>
    <p>Оскільки \( |A| = -2 \neq 0 \), обернена матриця існує.</p>
    <p>Знаходимо алгебраїчні доповнення \( A_{ij} \) для кожного елемента \( a_{ij} \) матриці \( A \):</p>
   <div class="matrix-formulas">
    <p class="matrix-formula">\( A_{11} = (-1)^{1+1} \cdot M_{11} = 1 \cdot 4 = 4 \)</p>
    <p class="matrix-formula">\( A_{12} = (-1)^{1+2} \cdot M_{12} = -1 \cdot 3 = -3 \)</p>
    <p class="matrix-formula">\( A_{21} = (-1)^{2+1} \cdot M_{21} = -1 \cdot 2 = -2 \)</p>
    <p class="matrix-formula">\( A_{22} = (-1)^{2+2} \cdot M_{22} = 1 \cdot 1 = 1 \)</p>
</div>
    <p>Формуємо союзну матрицю:</p>
    <p class="math-notation-centered">\[
        \tilde{A} = \begin{pmatrix} 4 & -3 \\ -2 & 1 \end{pmatrix}.
    \]</p>
    <p>Транспонуємо матрицю \( \tilde{A} \):</p>
    <p class="math-notation-centered">\[
        \tilde{A}^T = \begin{pmatrix} 4 & -2 \\ -3 & 1 \end{pmatrix}.
    \]</p>
    <p>Підставимо у формулу для оберненої матриці:</p>
    <p class="math-notation-centered">\[
        A^{-1} = \frac{1}{-2} \cdot \begin{pmatrix} 4 & -2 \\ -3 & 1 \end{pmatrix} = \begin{pmatrix} -2 & 1 \\ 1.5 & -0.5 \end{pmatrix}.
    \]</p>
    <p>Перевіримо правильність розв’язання, обчисливши \( A^{-1} \cdot A = E \) (де \( E \) – одинична матриця):</p>
    <p class="math-notation-centered">\[
        A^{-1} \cdot A = \begin{pmatrix} -2 & 1 \\ 1.5 & -0.5 \end{pmatrix} \cdot \begin{pmatrix} 1 & 2 \\ 3 & 4 \end{pmatrix} = \begin{pmatrix} (-2) \cdot 1 + 1 \cdot 3 & (-2) \cdot 2 + 1 \cdot 4 \\ 1.5 \cdot 1 + (-0.5) \cdot 3 & 1.5 \cdot 2 + (-0.5) \cdot 4 \end{pmatrix} = \begin{pmatrix} 1 & 0 \\ 0 & 1 \end{pmatrix} = E.
    \]</p>
    <p>Отримано одиничну матрицю \( E \), що підтверджує правильність обчислень.</p>
    <p><strong>Відповідь.</strong> \( A^{-1} = \begin{pmatrix} -2 & 1 \\ 1.5 & -0.5 \end{pmatrix} \).</p>
    <p><span class="example-title">Приклад 5.12.</span> <span class="example-condition">Знайти обернену матрицю для матриці \( B = \begin{pmatrix} 2 & 5 & 7 \\ 6 & 3 & 4 \\ 5 & -2 & -3 \end{pmatrix} \).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Згідно формули (5.17) для оберненої матриці:</p>
    <p class="math-notation-centered">\[
        B^{-1} = \frac{1}{|B|} \cdot \tilde{B}^T,
    \]</p>
    <p>де \( |B| \) – визначник матриці \( B \), а \( \tilde{B}^T \) – транспонована союзна матриця.</p>
    <p>Обчислимо визначник матриці \( B \), розклавши за елементами першого рядка:</p>
    <p class="math-notation-centered">\[
        |B| = \begin{vmatrix} 2 & 5 & 7 \\ 6 & 3 & 4 \\ 5 & -2 & -3 \end{vmatrix} = 2 \cdot \begin{vmatrix} 3 & 4 \\ -2 & -3 \end{vmatrix} - 5 \cdot \begin{vmatrix} 6 & 4 \\ 5 & -3 \end{vmatrix} + 7 \cdot \begin{vmatrix} 6 & 3 \\ 5 & -2 \end{vmatrix} =  2 \cdot (-1) - 5 \cdot (-38) + 7 \cdot (-27) = -2 + 190 - 189 = -1.
    \]</p>
    <p>Оскільки \( |B| = -1 \neq 0 \), обернена матриця існує.</p>
    <p>Знаходимо алгебраїчні доповнення \( B_{ij} \) для кожного елемента \( b_{ij} \) матриці \( B \):</p>
   <div class="matrix-formulas">
    <p class="matrix-formula">\( B_{11} = (-1)^{1+1} \cdot M_{11} = \begin{vmatrix} 3 & 4 \\ -2 & -3 \end{vmatrix} = -9 + 8 = -1 \)</p>
    <p class="matrix-formula">\( B_{12} = (-1)^{1+2} \cdot M_{12} = -\begin{vmatrix} 6 & 4 \\ 5 & -3 \end{vmatrix} = -(-18 - 20) = 38 \)</p>
    <p class="matrix-formula">\( B_{13} = (-1)^{1+3} \cdot M_{13} = \begin{vmatrix} 6 & 3 \\ 5 & -2 \end{vmatrix} = -12 - 15 = -27 \)</p>
    <p class="matrix-formula">\( B_{21} = (-1)^{2+1} \cdot M_{21} = -\begin{vmatrix} 5 & 7 \\ -2 & -3 \end{vmatrix} = -(-15 + 14) = 1 \)</p>
    <p class="matrix-formula">\( B_{22} = (-1)^{2+2} \cdot M_{22} = \begin{vmatrix} 2 & 7 \\ 5 & -3 \end{vmatrix} = -6 - 35 = -41 \)</p>
    <p class="matrix-formula">\( B_{23} = (-1)^{2+3} \cdot M_{23} = -\begin{vmatrix} 2 & 5 \\ 5 & -2 \end{vmatrix} = -(-4 - 25) = 29 \)</p>
    <p class="matrix-formula">\( B_{31} = (-1)^{3+1} \cdot M_{31} = \begin{vmatrix} 5 & 7 \\ 3 & 4 \end{vmatrix} = 20 - 21 = -1 \)</p>
    <p class="matrix-formula">\( B_{32} = (-1)^{3+2} \cdot M_{32} = -\begin{vmatrix} 2 & 7 \\ 6 & 4 \end{vmatrix} = -(8 - 42) = 34 \)</p>
    <p class="matrix-formula">\( B_{33} = (-1)^{3+3} \cdot M_{33} = \begin{vmatrix} 2 & 5 \\ 6 & 3 \end{vmatrix} = 6 - 30 = -24 \)</p>
</div>
    <p>Формуємо союзну матрицю:</p>
    <p class="math-notation-centered">\[
        \tilde{B} = \begin{pmatrix} -1 & 38 & -27 \\ 1 & -41 & 29 \\ -1 & 34 & -24 \end{pmatrix}.
    \]</p>
    <p>Транспонуємо матрицю \( \tilde{B} \):</p>
    <p class="math-notation-centered">\[
        \tilde{B}^T = \begin{pmatrix} -1 & 1 & -1 \\ 38 & -41 & 34 \\ -27 & 29 & -24 \end{pmatrix}.
    \]</p>
    <p>Підставимо у формулу для оберненої матриці:</p>
    <p class="math-notation-centered">\[
        B^{-1} = \frac{1}{-1} \cdot \begin{pmatrix} -1 & 1 & -1 \\ 38 & -41 & 34 \\ -27 & 29 & -24 \end{pmatrix} = \begin{pmatrix} 1 & -1 & 1 \\ -38 & 41 & -34 \\ 27 & -29 & 24 \end{pmatrix}.
    \]</p>
    <p>Перевіримо правильність розв’язання, обчисливши \( B^{-1} \cdot B = E \) (де \( E \) – одинична матриця):</p>
    <p class="math-notation-centered">\[
        B^{-1} \cdot B = \begin{pmatrix} 1 & -1 & 1 \\ -38 & 41 & -34 \\ 27 & -29 & 24 \end{pmatrix} \cdot \begin{pmatrix} 2 & 5 & 7 \\ 6 & 3 & 4 \\ 5 & -2 & -3 \end{pmatrix} =
    \]</p>
    <p class="math-notation-centered">\[=
        \begin{pmatrix} 1 \cdot 2 + (-1) \cdot 6 + 1 \cdot 5 & 1 \cdot 5 + (-1) \cdot 3 + 1 \cdot (-2) & 1 \cdot 7 + (-1) \cdot 4 + 1 \cdot (-3) \\ -38 \cdot 2 + 41 \cdot 6 + (-34) \cdot 5 & -38 \cdot 5 + 41 \cdot 3 + (-34) \cdot (-2) & -38 \cdot 7 + 41 \cdot 4 + (-34) \cdot (-3) \\ 27 \cdot 2 + (-29) \cdot 6 + 24 \cdot 5 & 27 \cdot 5 + (-29) \cdot 3 + 24 \cdot (-2) & 27 \cdot 7 + (-29) \cdot 4 + 24 \cdot (-3) \end{pmatrix} =
    \]</p>
    <p class="math-notation-centered">\[=
        \begin{pmatrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{pmatrix}.
    \]</p>
    <p>Повне множення дає одиничну матрицю \( E \), що підтверджує правильність.</p>
    <p><strong>Відповідь.</strong> \( B^{-1} = \begin{pmatrix} 1 & -1 & 1 \\ -38 & 41 & -34 \\ 27 & -29 & 24 \end{pmatrix} \).</p>
</details>
        </div>
    </div>

   <div id="videoModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <h2 class="glow-title">Оберіть відео</h2>
        <div class="video-card-container">
            <div class="video-card" data-video="1">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Знайомство з оберненими матрицями</h3>
            </div>
            <div class="video-card" data-video="2">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Знаходження оберненої матриці 2x2</h3>
            </div>
            <div class="video-card" data-video="3">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Обернена матриця 3x3</h3>
            </div>
            <div class="video-card" data-video="4">
                <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                <h3>Приклад оберненої матриці 3x3 двома методами</h3>
            </div>
        </div>
    </div>
</div>

<div id="videoPlayerModal1" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer1" width="100%" src="https://www.youtube.com/embed/TcDMUJn0Ugs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal2" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer2" width="100%" src="https://www.youtube.com/embed/0EhTko6cAA4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal3" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn3">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer3" width="100%" src="https://www.youtube.com/embed/y-NqkEyxHnI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal4" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn4">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer4" width="100%" src="https://www.youtube.com/embed/KF6ZHm-M4lw" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="questionsModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeQuestionsBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    1. Що таке обернена матриця?
                </div>
                <div class="card-back">
                    <p>Обернена матриця \( A^{-1} \) – це матриця, яка, помножена на вихідну квадратну матрицю \( A \), дає одиничну матрицю \( E \). Математично це записується так:</p>
                    <p class="math-notation-centered">\[
                        A \cdot A^{-1} = A^{-1} \cdot A = E,
                    \]</p>
                    <p>де \( E \) – одинична матриця того ж розміру.</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    2. Які умови існування оберненої матриці?
                </div>
                <div class="card-back">
                    <p>Обернена матриця існує лише для квадратних матриць \( A_{n \times n} \). Ключовою умовою є ненульовий визначник, тобто:</p>
                    <p class="math-notation-centered">\[
                        |A| \neq 0.
                    \]</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    3. Як знайти обернену матрицю методом алгебраїчних доповнень?
                </div>
                <div class="card-back">
                    <p>Обчисити визначник матриці \( |A| \); скласти матрицю алгебраїчних доповнень та транспонувати її, щоб отримати приєднану матрицю \( A \tilde{} \), і помножити \( A \tilde{} \) на \( \frac{1}{|A|} \), тобто \( A^{-1} = \frac{1}{|A|} \cdot A \tilde{} \).</p>
                </div>
            </div>
        </div>
        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    4. Як працює метод Гаусса-Жордана для знаходження оберненої матриці?
                </div>
                <div class="card-back">
                    <p>Складається розширена матриця \( [A | E] \). За допомогою елементарних перетворень рядків ліва частина зводиться до одиничної матриці \( E \), а права частина стає \( A^{-1} \).</p>
                </div>
            </div>
        </div>
    </div>
</div>

    <div id="trainerModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTrainerBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="trainer-container" id="trainerContent">
                <div class="question-number" id="questionNumber">Питання 1</div>
                <p class="trainer-question" id="trainerQuestion"></p>
                <div id="matrixDisplay" class="math-notation-centered"></div>
                <div class="answer-buttons" id="answerButtons"></div>
                <button class="submit-btn" id="submitAnswerBtn" disabled>Відповісти</button>
                <p id="feedback"></p>
            </div>
            <div id="completionScreen" class="completion-message hidden">
                <div class="completion-emoji"></div>
                <h2>МІСІЯ ВИКОНАНА!</h2>
     <p>Солдате, шлях назад знайдено! Обернену матрицю опановано!</p>
    <p><strong>СЛАВА УКРАЇНІ!</strong></p>
    <button id="resetTrainerBtn">Повернутися на полігон!</button>
            </div>
        </div>
    </div>

<script>
// Ініціалізація модальних вікон
const modals = {
    theory: document.getElementById('theoryModal'),
    video: document.getElementById('videoModal'),
    questions: document.getElementById('questionsModal'),
    trainer: document.getElementById('trainerModal'),
    videoPlayer1: document.getElementById('videoPlayerModal1'),
    videoPlayer2: document.getElementById('videoPlayerModal2'),
    videoPlayer3: document.getElementById('videoPlayerModal3'),
    videoPlayer4: document.getElementById('videoPlayerModal4')
};

// Ініціалізація кнопок
const buttons = {
    openTheory: document.getElementById('openTheoryBtn'),
    openVideo: document.getElementById('openVideoBtn'),
    openQuestions: document.getElementById('openQuestionsBtn'),
    openTrainer: document.getElementById('openTrainerBtn'),
    closeTheory: document.getElementById('closeTheoryBtn'),
    closeVideo: document.getElementById('closeVideoBtn'),
    closeQuestions: document.getElementById('closeQuestionsBtn'),
    closeTrainer: document.getElementById('closeTrainerBtn'),
    closeVideoPlayer1: document.getElementById('closeVideoPlayerBtn1'),
    closeVideoPlayer2: document.getElementById('closeVideoPlayerBtn2'),
    closeVideoPlayer3: document.getElementById('closeVideoPlayerBtn3'),
    closeVideoPlayer4: document.getElementById('closeVideoPlayerBtn4'),
    submitAnswer: document.getElementById('submitAnswerBtn'),
    resetTrainer: document.getElementById('resetTrainerBtn')
};

// Оверлей
const overlay = document.getElementById('modalOverlay');

// Ініціалізація YouTube-плеєрів
const youtubePlayers = {
    1: document.getElementById('youtubePlayer1'),
    2: document.getElementById('youtubePlayer2'),
    3: document.getElementById('youtubePlayer3'),
    4: document.getElementById('youtubePlayer4')
};

// Ініціалізація елементів тренажера
const trainerContent = document.getElementById('trainerContent');
const questionNumber = document.getElementById('questionNumber');
const trainerQuestion = document.getElementById('trainerQuestion');
const matrixDisplay = document.getElementById('matrixDisplay');
const answerButtons = document.getElementById('answerButtons');
const feedback = document.getElementById('feedback');
const completionScreen = document.getElementById('completionScreen');
const resetTrainerBtn = document.getElementById('resetTrainerBtn');
const submitAnswerBtn = document.getElementById('submitAnswerBtn');

// Ініціалізація змінних тренажера
let currentQuestion = 1;
let selectedAnswer = null;
let incorrectAttempts = 0;
let scrollPosition = 0;
let correctAnswerLatex = '';
let currentXPosition = null;

// Масив із готовими матрицями та відповідями для питання 5
const predefinedMatricesQ5 = [
    {
        matrix: [[2, 1, 0], [1, 1, 1], [0, 1, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ -1 & 2 & -1 \\\\ 1 & -2 & 2 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ 1 & -2 & 2 \\\\ -1 & 2 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & -1 & 1 \\\\ 1 & 2 & -2 \\\\ -1 & -1 & 2 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ -1 & 2 & -1 \\\\ 1 & -2 & 2 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 2, 3], [0, 1, 4], [0, 0, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -2 & 5 \\\\ 0 & 1 & -4 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -2 & 5 \\\\ 0 & 0 & 1 \\\\ 0 & 1 & -4 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 5 & -2 \\\\ 0 & -4 & 1 \\\\ 0 & 1 & 0 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -2 & 5 \\\\ 0 & 1 & -4 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[2, 1, 1], [1, 2, 1], [1, 1, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 0 & 1 & 1 \\\\ -1 & -1 & 3 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 0 & 1 & -1 \\\\ -1 & -1 & 3 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ -1 & -1 & 3 \\\\ 0 & 1 & -1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 0 & 1 & -1 \\\\ -1 & 1 & 3 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 1, 1], [1, 2, 1], [0, 1, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ -1 & 1 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 1 & -1 & 0 \\\\ -1 & 1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 0 & -1 \\\\ 1 & 1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 1 & 1 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 0, -1], [2, 1, 1], [1, 1, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ 1 & -2 & 3 \\\\ -1 & 1 & -1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ 1 & 2 & 3 \\\\ -1 & 1 & -1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & -1 & 1 \\\\ 1 & 3 & -2 \\\\ -1 & -1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ 1 & 1 & 3 \\\\ -1 & 1 & -1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 1, 0], [0, 1, 1], [0, 0, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & -1 \\\\ 0 & 1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 0 & -1 \\\\ 0 & 1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 0 & 1 \\\\ 0 & 1 & -1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 1, 1], [1, 2, 1], [0, 1, 1]], // Ідентична матриця 4
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ -1 & 1 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 1 & 1 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 1 & -1 \\\\ -1 & 0 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ -1 & 1 & 0 \\\\ 1 & -1 & 1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 1, 0], [1, 2, 0], [0, -1, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ -1 & 1 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 2 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ -1 & -1 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 2 & -1 & 0 \\\\ 1 & -1 & 0 \\\\ -1 & 1 & 1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 0, 1], [0, 1, 1], [0, 0, 1]],
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 0 & 1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 0 & 1 & -1 \\\\ 1 & 0 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 1 & -1 \\\\ 0 & 1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & 0 & -1 \\\\ 0 & -1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: false }
        ]
    },
    {
        matrix: [[1, 1, 0], [0, 1, 1], [0, 0, 1]], // Ідентична матриця 6
        answers: [
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: true },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & -1 \\\\ 0 & 1 & 0 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & 1 \\\\ 0 & 0 & -1 \\end{pmatrix}`, correct: false },
            { latex: `A^{-1} = \\begin{pmatrix} 1 & -1 & 1 \\\\ 0 & 1 & -1 \\\\ 0 & 0 & 1 \\end{pmatrix}`, correct: false }
        ]
    }
];

// Приклади для питання 3
const question3Examples = [
    {
        matrixA: [['7', '4'], ['x', '3']],
        inverseMatrix: [['3', '-4'], ['-5', '7']],
        options: ['-5', '5', '-3', '3'],
        correctX: '5'
    },
    {
        matrixA: [['-3', 'x'], ['-2', '3']],
        inverseMatrix: [['-3', '4'], ['-2', '3']],
        options: ['-4', '4', '-3', '-2'],
        correctX: '4'
    },
    {
        matrixA: [['1', '2'], ['x', '7']],
        inverseMatrix: [['7', '-2'], ['-3', '1']],
        options: ['-7', '-3', '3', '7'],
        correctX: '3'
    },
    {
        matrixA: [['2', '-9'], ['1', 'x']],
        inverseMatrix: [['-4', '9'], ['-1', '2']],
        options: ['-4', '3', '-1', '-2'],
        correctX: '-4'
    },
    {
        matrixA: [['-9', '7'], ['-5', 'x']],
        inverseMatrix: [['-4', '7'], ['-5', '9']],
        options: ['-4', '-7', '5', '4'],
        correctX: '4'
    },
    {
        matrixA: [['x', '2'], ['-3', '5']],
        inverseMatrix: [['5', '-2'], ['3', '-1']],
        options: ['1', '-1', '-5', '-2'],
        correctX: '-1'
    },
    {
        matrixA: [['8', '-3'], ['x', '-2']],
        inverseMatrix: [['2', '-3'], ['5', '-8']],
        options: ['2', '-5', '5', '3'],
        correctX: '5'
    },
    {
        matrixA: [['x', '3'], ['7', '-4']],
        inverseMatrix: [['4', '3'], ['7', '5']],
        options: ['5', '-7', '-3', '-5'],
        correctX: '-5'
    },
    {
        matrixA: [['-3', '4'], ['x', '3']],
        inverseMatrix: [['-3', '4'], ['-2', '3']],
        options: ['3', '-4', '2', '-2'],
        correctX: '-2'
    },
    {
        matrixA: [['-4', 'x'], ['-5', '9']],
        inverseMatrix: [['-9', '7'], ['-5', '4']],
        options: ['7', '4', '5', '-7'],
        correctX: '4'
    }
];

// Перевірка наявності елементів
function checkElements() {
    Object.entries(modals).forEach(([key, modal]) => {
        if (!modal) console.error(`Modal ${key} not found`);
    });
    Object.entries(buttons).forEach(([key, button]) => {
        if (!button) console.error(`Button ${key} not found`);
    });
    if (!overlay) console.error('Overlay not found');
    if (!trainerContent) console.error('trainerContent not found');
    if (!questionNumber) console.error('questionNumber not found');
    if (!trainerQuestion) console.error('trainerQuestion not found');
    if (!matrixDisplay) console.error('matrixDisplay not found');
    if (!answerButtons) console.error('answerButtons not found');
    if (!feedback) console.error('feedback not found');
    if (!completionScreen) console.error('completionScreen not found');
    if (!resetTrainerBtn) console.error('resetTrainerBtn not found');
    if (!completionScreen.querySelector('.completion-emoji')) console.error('completion-emoji not found');
    if (!completionScreen.querySelector('.completion-message h2')) console.error('completion-message h2 not found');
    if (!completionScreen.querySelector('.completion-message p')) console.error('completion-message p not found');
}
checkElements();

// Функція для відкриття модального вікна
function openModal(modal) {
    if (!modal) {
        console.error('Modal is undefined or null');
        if (feedback) {
            feedback.textContent = 'Помилка: модальне вікно не знайдено!';
            feedback.className = 'feedback incorrect show';
        }
        return;
    }
    if (!overlay) {
        console.error('Overlay element not found');
        if (feedback) {
            feedback.textContent = 'Помилка: оверлей не знайдено!';
            feedback.className = 'feedback incorrect show';
        }
        return;
    }
    console.log('Opening modal:', modal.id);
    overlay.style.display = 'block';
    modal.style.display = 'flex';
    modal.classList.add('show');
    scrollPosition = window.pageYOffset;
    document.body.classList.add('modal-open');
    document.body.style.top = `-${scrollPosition}px`;
}

// Функція для закриття модального вікна
function closeModal(modal) {
    if (!modal) {
        console.error('Modal is undefined or null');
        return;
    }
    console.log('Closing modal:', modal.id);
    modal.classList.remove('show');
    setTimeout(() => {
        modal.style.display = 'none';
        if (modal.id.includes('videoPlayer')) {
            const iframe = modal.querySelector('iframe');
            if (iframe) iframe.src = iframe.src;
            openModal(modals.video);
        } else {
            overlay.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo(0, scrollPosition);
        }
    }, 250);
}

// Функція для генерації випадкового цілого числа
function getRandomInt(min = -9, max = 9) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Функція для перемішування масиву
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Функція для вибору відповіді
function selectAnswer(btn) {
    console.log('Answer selected:', btn.innerHTML, { currentQuestion });
    document.querySelectorAll('.answer-btn').forEach(button => {
        button.classList.remove('selected');
    });
    btn.classList.add('selected');
    selectedAnswer = btn;
    submitAnswerBtn.disabled = false;
    submitAnswerBtn.style.pointerEvents = 'auto';
    submitAnswerBtn.style.opacity = '1';
    console.log('Submit button enabled:', {
        disabled: submitAnswerBtn.disabled,
        pointerEvents: submitAnswerBtn.style.pointerEvents,
        opacity: submitAnswerBtn.style.opacity
    });
}

// Функція для рендерингу MathJax
function typesetMath(context = 'general', elements = null) {
    if (window.mathJaxReady && typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function') {
        console.log(`Starting MathJax typeset for ${context}`);
        MathJax.typesetClear(elements || undefined);
        MathJax.typesetPromise(elements || undefined).then(() => {
            console.log(`MathJax typeset complete for ${context}`);
        }).catch(err => {
            console.error(`MathJax typesetting error in ${context}:`, err);
            if (feedback) {
                feedback.textContent = 'Помилка рендерингу формули. Спробуйте ще раз!';
                feedback.className = 'feedback incorrect show';
            }
        });
    } else {
        console.warn(`MathJax not ready or typesetPromise unavailable in ${context}`);
        if (feedback) {
            feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
            feedback.className = 'feedback incorrect show';
        }
    }
}

// Функція для очікування MathJax
function waitForMathJax(callback, context = 'general', maxAttempts = 100, interval = 200) {
    let attempts = 0;
    console.log(`Waiting for MathJax in ${context}`);
    const checkMathJax = setInterval(() => {
        if (window.mathJaxReady && typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function') {
            clearInterval(checkMathJax);
            console.log(`MathJax ready for ${context}, executing callback`);
            callback();
        } else if (attempts >= maxAttempts) {
            clearInterval(checkMathJax);
            console.warn(`MathJax not loaded after ${maxAttempts * interval}ms in ${context}`);
            if (feedback) {
                feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
                feedback.className = 'feedback incorrect show';
            }
            callback();
        }
        attempts++;
    }, interval);
}

// Функція для обчислення детермінанта матриці 2x2
function det2x2(matrix) {
    return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
}

// Функція для обчислення детермінанта матриці 3x3
function det3x3(matrix) {
    const [a, b, c] = matrix[0];
    const [d, e, f] = matrix[1];
    const [g, h, i] = matrix[2];
    return a * (e * i - f * h) - b * (d * i - f * g) + c * (d * h - e * g);
}

// Функція для генерації оберненої матриці 2x2
function inverse2x2(matrix) {
    const det = det2x2(matrix);
    if (det === 0) return null;
    return [
        [matrix[1][1] / det, -matrix[0][1] / det],
        [-matrix[1][0] / det, matrix[0][0] / det]
    ];
}

// Функція для перевірки, чи матриця містить цілі числа від -9 до 9
function isValidMatrix(matrix) {
    return matrix.every(row =>
        row.every(val => Number.isInteger(val) && val >= -9 && val <= 9)
    );
}

// Функція для генерації матриці 2x2 із детермінантом ±1
function generateMatrix2x2WithDetOne() {
    let matrix, det;
    let attempts = 0;
    const maxAttempts = 100;
    do {
        matrix = Array.from({ length: 2 }, () =>
            Array.from({ length: 2 }, () => getRandomInt(-9, 9))
        );
        det = det2x2(matrix);
        attempts++;
        if (attempts >= maxAttempts) {
            console.warn('Failed to generate matrix with det ±1 after', maxAttempts, 'attempts');
            return null;
        }
    } while (det !== 1 && det !== -1);
    console.log('Generated 2x2 matrix with det ±1', { matrix, det });
    return matrix;
}

// Функція для генерації матриці 2x2 із заданим детермінантом (нульовий чи ненульовий)
function generateMatrix2x2(isZeroDeterminant) {
    let matrix;
    if (isZeroDeterminant) {
        const row1 = [getRandomInt(-9, 9), getRandomInt(-9, 9)];
        const k = getRandomInt(-9, 9) || 1;
        const row2 = [row1[0] * k, row1[1] * k];
        matrix = [row1, row2];
        const det = det2x2(matrix);
        if (det !== 0) {
            console.warn('Failed to generate zero determinant for 2x2, retrying', { det });
            return generateMatrix2x2(true);
        }
    } else {
        do {
            matrix = Array.from({ length: 2 }, () =>
                Array.from({ length: 2 }, () => getRandomInt(-9, 9))
            );
        } while (det2x2(matrix) === 0);
    }
    console.log('Generated 2x2 matrix', { matrix, det: det2x2(matrix) });
    return matrix;
}

// Функція для генерації матриці 3x3 із заданим детермінантом (нульовий чи ненульовий)
function generateMatrix3x3(isZeroDeterminant) {
    let matrix;
    if (isZeroDeterminant) {
        const row1 = [getRandomInt(-7, 7), getRandomInt(-7, 7), getRandomInt(-7, 7)];
        const row2 = [getRandomInt(-7, 7), getRandomInt(-7, 7), getRandomInt(-7, 7)];
        const k = getRandomInt(-7, 7) || 1;
        const row3 = row1.map((val, i) => val * k);
        matrix = [row1, row2, row3];
        const det = det3x3(matrix);
        if (det !== 0) {
            console.warn('Failed to generate zero determinant for 3x3, retrying', { det });
            return generateMatrix3x3(true);
        }
    } else {
        do {
            matrix = Array.from({ length: 3 }, () =>
                Array.from({ length: 3 }, () => getRandomInt(-7, 7))
            );
        } while (det3x3(matrix) === 0);
    }
    console.log('Generated 3x3 matrix', { matrix, det: det3x3(matrix) });
    return matrix;
}

// Функція для генерації питання 1: перевірка існування оберненої матриці (2x2)
function generateQuestion1() {
    try {
        console.log('Generating question 1', { currentQuestion });
        const isZeroDeterminant = Math.random() < 0.5;
        const matrix = generateMatrix2x2(isZeroDeterminant);
        const det = det2x2(matrix);
        const correctAnswer = det !== 0 ? 'Існує' : 'Не існує';
        correctAnswerLatex = correctAnswer;
        const answerOptions = [
            { text: 'Існує', correct: det !== 0 },
            { text: 'Не існує', correct: det === 0 },
            { text: 'Не можливо визначити', correct: false }
        ];
        const shuffledOptions = shuffleArray(answerOptions);
        const matrixLatex = `\\begin{pmatrix} ${matrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 1';
        trainerQuestion.innerHTML = '<div class="math-notation">Чи існує обернена матриця для:</div>';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = option.text;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });
        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.pointerEvents = 'none';
        submitAnswerBtn.style.opacity = '0.6';
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';
        console.log('Question 1 generated', { matrix, det, correctAnswer });
        waitForMathJax(() => typesetMath('trainer question 1', [trainerQuestion, matrixDisplay]), 'trainer question 1');
    } catch (err) {
        console.error('Error in generateQuestion1:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect show';
    }
}

// Функція для генерації питання 2: перевірка існування оберненої матриці (3x3)
function generateQuestion2() {
    try {
        console.log('Generating question 2', { currentQuestion });
        const isZeroDeterminant = Math.random() < 0.5;
        const matrix = generateMatrix3x3(isZeroDeterminant);
        const det = det3x3(matrix);
        const correctAnswer = det !== 0 ? 'Існує' : 'Не існує';
        correctAnswerLatex = correctAnswer;
        const answerOptions = [
            { text: 'Існує', correct: det !== 0 },
            { text: 'Не існує', correct: det === 0 },
            { text: 'Не можливо визначити', correct: false }
        ];
        const shuffledOptions = shuffleArray(answerOptions);
        const matrixLatex = `\\begin{pmatrix} ${matrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 2';
        trainerQuestion.innerHTML = '<div class="math-notation">Чи існує обернена матриця для:</div>';
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[${matrixLatex}\\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = option.text;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });
        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.pointerEvents = 'none';
        submitAnswerBtn.style.opacity = '0.6';
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';
        console.log('Question 2 generated', { matrix, det, correctAnswer });
        waitForMathJax(() => typesetMath('trainer question 2', [trainerQuestion, matrixDisplay]), 'trainer question 2');
    } catch (err) {
        console.error('Error in generateQuestion2:', err);
        feedback.textContent = 'Помилка генерації питання. Спробуйте ще раз!';
        feedback.className = 'feedback incorrect show';
    }
}

// Функція для генерації питання 3: знайти x, при якому A має задану обернену матрицю
function generateQuestion3() {
    console.log('Generating question 3', { currentQuestion });
    try {
        const example = question3Examples[Math.floor(Math.random() * question3Examples.length)];
        const { matrixA, inverseMatrix, options, correctX } = example;
        correctAnswerLatex = correctX;
        const matrixALatex = `\\begin{pmatrix} ${matrixA.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        const inverseLatex = `\\begin{pmatrix} ${inverseMatrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 3';
        trainerQuestion.innerHTML = `<div class="math-notation">Знайдіть значення \\( x \\), при якому матриця \\( A \\) має обернену матрицю \\( A^{-1} \\):</div>`;
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[ A = ${matrixALatex}, \\quad A^{-1} = ${inverseLatex} \\]</div>`;
        answerButtons.innerHTML = '';
        const shuffledOptions = shuffleArray([...options]).map(x => ({
            text: `${x}`,
            correct: x === correctX
        }));
        shuffledOptions.forEach((option) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = option.text;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.text;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });
        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.pointerEvents = 'none';
        submitAnswerBtn.style.opacity = '0.6';
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';
        console.log('Question 3 successfully generated', { correctX, matrixA, inverseMatrix });
        waitForMathJax(() => typesetMath('trainer question 3', [trainerQuestion, matrixDisplay]), 'trainer question 3');
    } catch (err) {
        console.error('Error in generateQuestion3:', err);
        feedback.textContent = 'Помилка генерації питання 3. Повторіть спробу!';
        feedback.className = 'feedback incorrect show';
        setTimeout(() => {
            feedback.textContent = '';
            feedback.className = 'feedback';
            generateQuestion3();
        }, 2000);
    }
}

// Функція для генерації питання 4: знайти обернену матрицю для A з детермінантом ±1
function generateQuestion4() {
    console.log('Generating question 4', { currentQuestion });
    try {
        const matrixA = generateMatrix2x2WithDetOne();
        if (!matrixA) {
            console.warn('Failed to generate valid matrix A for question 4');
            feedback.textContent = 'Не вдалося згенерувати питання 4. Повторіть спробу!';
            feedback.className = 'feedback incorrect show';
            setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'feedback';
                generateQuestion4();
            }, 2000);
            return;
        }
        const det = det2x2(matrixA);
        const inverseMatrix = [
            [matrixA[1][1] / det, -matrixA[0][1] / det],
            [-matrixA[1][0] / det, matrixA[0][0] / det]
        ].map(row => row.map(val => Math.round(val * 1000000) / 1000000)); // Уникаємо дробів
        if (!isValidMatrix(inverseMatrix)) {
            console.warn('Inverse matrix has invalid elements', { inverseMatrix });
            feedback.textContent = 'Не вдалося згенерувати питання 4. Повторіть спробу!';
            feedback.className = 'feedback incorrect show';
            setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'feedback';
                generateQuestion4();
            }, 2000);
            return;
        }

        const correctAnswer = inverseMatrix.map(row => row.map(val => Math.round(val))); // Цілі числа
        const wrongSign = correctAnswer.map(row => row.map(val => -val));
        const wrongColumns = [
            [correctAnswer[0][1], correctAnswer[0][0]],
            [correctAnswer[1][1], correctAnswer[1][0]]
        ];
        const wrongRows = [
            correctAnswer[1],
            correctAnswer[0]
        ];
        const answerOptions = [
            { matrix: correctAnswer, latex: `A^{-1} = \\begin{pmatrix} ${correctAnswer.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`, correct: true },
            { matrix: wrongSign, latex: `A^{-1} = \\begin{pmatrix} ${wrongSign.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`, correct: false },
            { matrix: wrongColumns, latex: `A^{-1} = \\begin{pmatrix} ${wrongColumns.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`, correct: false },
            { matrix: wrongRows, latex: `A^{-1} = \\begin{pmatrix} ${wrongRows.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`, correct: false }
        ];
        const shuffledOptions = shuffleArray(answerOptions);
        correctAnswerLatex = answerOptions[0].latex;

        const matrixALatex = `\\begin{pmatrix} ${matrixA.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 4';
        trainerQuestion.innerHTML = `<div class="math-notation">Знайдіть обернену матрицю \\( A^{-1} \\) до матриці \\( A \\):</div>`;
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[ A = ${matrixALatex} \\]</div>`;
        answerButtons.innerHTML = '';
        shuffledOptions.forEach((option) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `<div class="math-notation">\\[${option.latex}\\]</div>`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.latex;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });
        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.pointerEvents = 'none';
        submitAnswerBtn.style.opacity = '0.6';
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';
        console.log('Question 4 successfully generated', { matrixA, inverseMatrix, det });
        waitForMathJax(() => typesetMath('trainer question 4', [trainerQuestion, matrixDisplay, answerButtons]), 'trainer question 4');
    } catch (err) {
        console.error('Error in generateQuestion4:', err);
        feedback.textContent = 'Помилка генерації питання 4. Повторіть спробу!';
        feedback.className = 'feedback incorrect show';
        setTimeout(() => {
            feedback.textContent = '';
            feedback.className = 'feedback';
            generateQuestion4();
        }, 2000);
    }
}

// Функція для генерації питання 5: знайти обернену матрицю для A 3x3 з детермінантом ±1
function generateQuestion5() {
    console.log('Generating question 5', { currentQuestion });
    try {
        const example = predefinedMatricesQ5[Math.floor(Math.random() * predefinedMatricesQ5.length)];
        const { matrix, answers } = example;
        correctAnswerLatex = answers.find(ans => ans.correct).latex;

        const matrixALatex = `\\begin{pmatrix} ${matrix.map(row => row.join(' & ')).join(' \\\\ ')} \\end{pmatrix}`;
        questionNumber.textContent = 'Питання 5';
        trainerQuestion.innerHTML = `<div class="math-notation">Знайдіть обернену матрицю \\( A^{-1} \\) до матриці \\( A \\):</div>`;
        matrixDisplay.innerHTML = `<div style="display: block;" id="matrix-${Date.now()}">\\[ A = ${matrixALatex} \\]</div>`;
        answerButtons.innerHTML = '';

        const shuffledOptions = shuffleArray([...answers]);
        shuffledOptions.forEach((option) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerHTML = `<div class="math-notation">\\[${option.latex}\\]</div>`;
            btn.dataset.correct = option.correct.toString();
            btn.dataset.option = option.latex;
            btn.addEventListener('click', () => selectAnswer(btn));
            answerButtons.appendChild(btn);
        });

        submitAnswerBtn.disabled = true;
        submitAnswerBtn.style.pointerEvents = 'none';
        submitAnswerBtn.style.opacity = '0.6';
        selectedAnswer = null;
        feedback.textContent = '';
        feedback.className = 'feedback';
        completionScreen.classList.add('hidden');
        trainerContent.style.display = 'block';
        console.log('Question 5 successfully generated', { matrix, correctAnswer: correctAnswerLatex });
        waitForMathJax(() => typesetMath('trainer question 5', [trainerQuestion, matrixDisplay, answerButtons]), 'trainer question 5');
    } catch (err) {
        console.error('Error in generateQuestion5:', err);
        feedback.textContent = 'Помилка генерації питання 5. Повторіть спробу!';
        feedback.className = 'feedback incorrect show';
        setTimeout(() => {
            feedback.textContent = '';
            feedback.className = 'feedback';
            generateQuestion5();
        }, 2000);
    }
}

// Обробник для кнопки "Відповісти"
buttons.submitAnswer.addEventListener('click', () => {
    console.log('Submit answer clicked', {
        currentQuestion,
        selectedAnswer: selectedAnswer ? selectedAnswer.dataset.option : null,
        datasetCorrect: selectedAnswer ? selectedAnswer.dataset.correct : null
    });

    if (!selectedAnswer) {
        feedback.textContent = 'Будь ласка, виберіть відповідь!';
        feedback.className = 'feedback incorrect show';
        setTimeout(() => {
            feedback.className = 'feedback';
            feedback.textContent = '';
        }, 2000);
        return;
    }

    const isCorrect = selectedAnswer.dataset.correct === 'true';
    console.log('Answer evaluation', {
        isCorrect,
        selectedLatex: selectedAnswer.dataset.option,
        correctLatex: correctAnswerLatex
    });

    document.querySelectorAll('.answer-btn').forEach(btn => {
        if (btn.dataset.correct === 'true') {
            btn.classList.add('correct');
        } else if (btn === selectedAnswer) {
            btn.classList.add('incorrect');
        }
        btn.disabled = true;
        btn.style.pointerEvents = 'none';
    });

    feedback.textContent = isCorrect ? '✅ ВІРНО! Ціль уражена!' : `❌ Промах! Спробуй ще!`;
    feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'} show`;
    submitAnswerBtn.disabled = true;
    submitAnswerBtn.style.pointerEvents = 'none';
    submitAnswerBtn.style.opacity = '0.6';

    setTimeout(() => {
        feedback.className = 'feedback';
        feedback.textContent = '';
        document.querySelectorAll('.answer-btn').forEach(btn => {
            btn.disabled = false;
            btn.classList.remove('selected', 'correct', 'incorrect');
            btn.style.pointerEvents = 'auto';
            btn.style.background = '#3b4a5a';
            btn.style.border = '1.5px solid #a855f7';
        });

        matrixDisplay.innerHTML = '';
        answerButtons.innerHTML = '';
        trainerQuestion.textContent = '';
        questionNumber.textContent = '';

        if (isCorrect) {
            incorrectAttempts = 0;
            currentXPosition = null;
            console.log(`Correct answer, advancing from question ${currentQuestion}`);
            try {
                if (currentQuestion === 1) {
                    currentQuestion = 2;
                    console.log('Moving to question 2');
                    generateQuestion2();
                } else if (currentQuestion === 2) {
                    currentQuestion = 3;
                    console.log('Moving to question 3');
                    generateQuestion3();
                } else if (currentQuestion === 3) {
                    currentQuestion = 4;
                    console.log('Moving to question 4');
                    generateQuestion4();
                } else if (currentQuestion === 4) {
                    currentQuestion = 5;
                    console.log('Moving to question 5');
                    generateQuestion5();
                } else if (currentQuestion === 5) {
                    console.log('Showing completion screen');
                    trainerContent.style.display = 'none';
                    completionScreen.classList.remove('hidden');
                    const emoji = completionScreen.querySelector('.completion-emoji');
                    const heading = completionScreen.querySelector('.completion-message h2');
                    const paragraph = completionScreen.querySelector('.completion-message p');
                    if (emoji && heading && paragraph) {
                        heading.textContent = 'МІСІЯ ВИКОНАНА!';
                        paragraph.textContent = 'Солдате, шлях назад знайдено! Обернену матрицю опановано!';
                        console.log('Completion screen updated', {
                            heading: heading.textContent,
                            paragraph: paragraph.textContent
                        });
                    } else {
                        console.error('Completion screen elements missing', { emoji, heading, paragraph });
                    }
                    completionScreen.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    resetTrainerBtn.focus();
                } else {
                    console.error('Invalid currentQuestion value:', currentQuestion);
                    feedback.textContent = 'Помилка: некоректний номер питання. Починаємо заново!';
                    feedback.className = 'feedback incorrect show';
                    currentQuestion = 1;
                    generateQuestion1();
                }
            } catch (err) {
                console.error('Error during question transition:', err);
                feedback.textContent = 'Помилка при переході до наступного питання. Повторіть спробу!';
                feedback.className = 'feedback incorrect show';
                setTimeout(() => {
                    feedback.textContent = '';
                    feedback.className = 'feedback';
                    if (currentQuestion === 5) generateQuestion5();
                    else if (currentQuestion === 4) generateQuestion4();
                    else if (currentQuestion === 3) generateQuestion3();
                    else generateQuestion2();
                }, 2000);
            }
        } else {
            incorrectAttempts++;
            console.log('Incorrect attempts:', incorrectAttempts, { currentQuestion });
            try {
                if (currentQuestion === 1) {
                    console.log('Regenerating question 1');
                    generateQuestion1();
                } else if (currentQuestion === 2) {
                    console.log('Regenerating question 2');
                    generateQuestion2();
                } else if (currentQuestion === 3) {
                    console.log('Regenerating question 3');
                    generateQuestion3();
                } else if (currentQuestion === 4) {
                    console.log('Regenerating question 4');
                    generateQuestion4();
                } else if (currentQuestion === 5) {
                    console.log('Regenerating question 5');
                    generateQuestion5();
                } else {
                    console.error('Invalid currentQuestion value on incorrect answer:', currentQuestion);
                    feedback.textContent = 'Помилка: некоректний номер питання. Починаємо заново!';
                    feedback.className = 'feedback incorrect show';
                    currentQuestion = 1;
                    generateQuestion1();
                }
            } catch (err) {
                console.error('Error regenerating question:', err);
                feedback.textContent = 'Помилка при генерації питання. Повторіть спробу!';
                feedback.className = 'feedback incorrect show';
                setTimeout(() => {
                    feedback.textContent = '';
                    feedback.className = 'feedback';
                    if (currentQuestion === 5) generateQuestion5();
                    else if (currentQuestion === 4) generateQuestion4();
                    else if (currentQuestion === 3) generateQuestion3();
                    else generateQuestion2();
                }, 2000);
            }
        }
    }, 2000);
});

// Обробник для кнопки "Спробувати ще раз"
resetTrainerBtn.addEventListener('click', () => {
    console.log('Reset trainer clicked');
    currentQuestion = 1;
    incorrectAttempts = 0;
    currentXPosition = null;
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    matrixDisplay.innerHTML = '';
    answerButtons.innerHTML = '';
    trainerQuestion.textContent = '';
    questionNumber.textContent = '';
    feedback.textContent = '';
    feedback.className = 'feedback';
    generateQuestion1();
});

// Обробники подій для кнопок відкриття модальних вікон
buttons.openTheory.addEventListener('click', () => {
    console.log('Open theory button clicked');
    openModal(modals.theory);
});

buttons.openVideo.addEventListener('click', () => {
    console.log('Open video button clicked');
    openModal(modals.video);
});

buttons.openQuestions.addEventListener('click', () => {
    console.log('Open questions button clicked');
    openModal(modals.questions);
});

buttons.openTrainer.addEventListener('click', () => {
    console.log('Open trainer clicked');
    if (!modals.trainer || !overlay) {
        console.error('Trainer modal or overlay not found');
        feedback.textContent = 'Помилка: модаль тренажера або оверлей не знайдено!';
        feedback.className = 'feedback incorrect show';
        return;
    }
    currentQuestion = 1;
    incorrectAttempts = 0;
    currentXPosition = null;
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    matrixDisplay.innerHTML = '';
    answerButtons.innerHTML = '';
    trainerQuestion.textContent = '';
    questionNumber.textContent = '';
    feedback.textContent = '';
    feedback.className = 'feedback';
    openModal(modals.trainer);
    try {
        generateQuestion1();
    } catch (err) {
        console.error('Error initializing trainer:', err);
        feedback.textContent = 'Помилка ініціалізації тренажера!';
        feedback.className = 'feedback incorrect show';
    }
});

// Обробники для кнопок закриття
Object.values(buttons).forEach(button => {
    if (button && button.id.includes('close')) {
        const modalId = button.id.replace('close', '').toLowerCase();
        const modalKey = modalId.includes('videoplayer') ? `videoPlayer${modalId.slice(-1)}` : modalId.replace('btn', '');
        console.log('Setting up close button for:', modalKey);
        button.addEventListener('click', () => closeModal(modals[modalKey]));
    }
});

// Закриття модального вікна при кліку на оверлей
overlay.addEventListener('click', () => {
    Object.values(modals).forEach(modal => {
        if (modal && modal.classList.contains('show')) {
            console.log('Overlay clicked, closing modal:', modal.id);
            closeModal(modal);
        }
    });
});

// Обробники для карток відео
document.querySelectorAll('.video-card').forEach(card => {
    card.addEventListener('click', () => {
        const videoId = card.dataset.video;
        console.log('Video card clicked:', videoId);
        closeModal(modals.video);
        openModal(modals[`videoPlayer${videoId}`]);
    });
});

// Обробники для флеш-карток
document.querySelectorAll('.question-card .card-inner').forEach(card => {
    card.addEventListener('click', () => {
        console.log('Flipping card');
        card.classList.toggle('flipped');
    });
});

// Перевірка MathJax при завантаженні сторінки
window.addEventListener('load', () => {
    console.log('MathJax loaded:', typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function');
    if (!window.mathJaxReady || typeof MathJax === 'undefined') {
        console.warn('MathJax not initialized after page load');
        feedback.textContent = 'MathJax не завантажено. Спробуйте оновити сторінку!';
        feedback.className = 'feedback incorrect show';
    }
});

// Закриття модального вікна при натисканні Escape
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
        Object.values(modals).forEach(modal => {
            if (modal && modal.classList.contains('show')) {
                console.log('Escape key pressed, closing modal:', modal.id);
                closeModal(modal);
            }
        });
    }
});
</script>
</body>
</html>





