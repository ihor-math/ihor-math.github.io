<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>29. –ö—É—Ç –º—ñ–∂ –¥–≤–æ–º–∞ –≤–µ–∫—Ç–æ—Ä–∞–º–∏</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: () => {
                    console.log("MathJax is loaded and ready!");
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" onerror="console.error('Failed to load MathJax')"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            font-family: 'Roboto', sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100vh;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        body.loaded {
            visibility: visible;
            opacity: 1;
        }
        .title-box {
            margin-top: 60px;
            padding: 20px 40px;
            background: linear-gradient(135deg, #5f27cd, #341f97);
            border-radius: 15px;
            box-shadow: 0 6px 16px rgba(95, 39, 205, 0.3);
            max-width: 90%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .title-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .title-box h1 {
            margin: 0;
            font-size: 24px;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            font-family: 'Merriweather', serif;
            position: relative;
            z-index: 1;
        }
        .section-container {
            margin-top: 80px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .section {
            width: 260px;
            height: 200px;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #ffffff;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(95, 39, 205, 0.2);
        }
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(95, 39, 205, 0.1), transparent);
            transition: left 0.5s;
        }
        .section:hover::before {
            left: 100%;
        }
        .section:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 8px 20px rgba(95, 39, 205, 0.25);
            background: linear-gradient(45deg, #3498db, #5f27cd);
            border-color: rgba(95, 39, 205, 0.4);
        }
        .section img {
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 5px rgba(52, 152, 219, 0.3));
            transition: filter 0.3s ease;
        }
        .section:hover img {
            filter: drop-shadow(0 0 10px rgba(95, 39, 205, 0.5));
        }
        .section h2 {
            font-size: 20px;
            margin: 0;
            font-family: 'Merriweather', serif;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(95, 39, 205, 0.2);
            z-index: 1001;
            overflow: hidden;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            border: 1px solid rgba(95, 39, 205, 0.1);
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.8);
            z-index: 999;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: #2c3e50;
            border-radius: 10px;
            margin: 10px;
            color: #ffffff;
            width: calc(100% - 20px);
            overflow-y: auto;
            display: block;
            max-height: calc(100% - 60px);
        }
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #3498db, #5f27cd);
            border-radius: 3px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #2980b9, #8e44ad);
        }
        .modal-header {
            background: linear-gradient(0deg, #2c3e50, #34495e);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 1002;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            border-bottom: 1px solid rgba(95, 39, 205, 0.2);
        }
        #trainerModal .modal-header {
            background: linear-gradient(0deg, #3498db, #5f27cd);
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .close-btn {
            background: linear-gradient(135deg, #3498db, #5f27cd);
            color: #ffffff;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Roboto', sans-serif;
            z-index: 1003;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        .close-btn:hover {
            background: linear-gradient(135deg, #2980b9, #8e44ad);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.4);
        }
        #trainerModal .close-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        #trainerModal .close-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            background: #34495e;
            cursor: pointer;
            border: 1px solid rgba(95, 39, 205, 0.2);
        }
        summary {
            font-weight: bold;
            padding: 8px;
            background: linear-gradient(135deg, #3498db, #5f27cd);
            border-radius: 6px;
            color: #ffffff;
            font-family: 'Merriweather', serif;
            transition: all 0.3s ease;
        }
        summary:hover {
            background: linear-gradient(135deg, #2980b9, #8e44ad);
            transform: scale(1.02);
        }
        details p {
            padding: 0 15px 10px;
            color: #ecf0f1;
            margin: 8px 0;
            line-height: 1.6;
        }
        /* –ü—Ä–æ—Å—Ç–∏–π —Å—Ç–∏–ª—å –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏—Ö –ø–æ–∑–Ω–∞—á–µ–Ω—å –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ */
       .math-notation {
    font-style: italic;
    color: #f1c40f;
    display: inline !important; /* –ó–∞–±–µ–∑–ø–µ—á—É—î –≤–±—É–¥–æ–≤–∞–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è */
}
            #questionsModal .math-notation-centered {
    display: none !important; /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ */
}

        /* –°—Ç–∏–ª—å –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–∏—Ö —Ç–µ—Ä–º—ñ–Ω—ñ–≤ –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ */
        .highlight-term {
            color: #3498db;
            font-weight: bold;
        }
        .formula-line {
            display: inline-block;
            white-space: nowrap;
        }
        .question-block {
            margin: 15px 0;
            padding: 10px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            border: 1px solid rgba(95, 39, 205, 0.2);
        }
        .question-block summary {
            font-size: 16px;
            background: linear-gradient(135deg, #3498db, #5f27cd);
            color: #ffffff;
        }
        .question-block details summary {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .question-block details p {
            color: #ecf0f1;
            background: #2c3e50;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #27ae60;
        }
#questionsModal mjx-container {
    display: inline !important;
    vertical-align: middle !important;
    font-size: clamp(16px, 2.8vw, 18px) !important;
    color: #f1c40f !important;
    background: none !important;
    font-style: italic !important;
    margin: 0 2px !important;
    padding: 0 !important;
}
        .trainer-container {
            width: 90%;
            max-width: 800px;
            padding: 3vw 4vw;
            text-align: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(95, 39, 205, 0.2);
            transition: all 0.3s ease;
            margin: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            border: 1px solid rgba(95, 39, 205, 0.2);
        }
        .question-circle {
            width: clamp(80px, 15vw, 120px);
            height: clamp(80px, 15vw, 120px);
            margin: 0 auto 3vw;
            background: linear-gradient(135deg, #3498db, #5f27cd);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
            position: relative;
            overflow: hidden;
        }
        .question-circle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .question-circle:hover::before {
            left: 100%;
        }
        .question-circle h3 {
            color: #ffffff;
            font-family: 'Lora', serif;
            font-size: clamp(16px, 2.5vw, 20px);
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
           .cube-formula, .vector-formula  {
    color: #ffff00; /* –ñ–æ–≤—Ç–∏–π –∫–æ–ª—ñ—Ä */
    display: inline-block; /* –î–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è LaTeX */
}
            /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–π —Ñ–æ–Ω —ñ –º–æ–¥–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç */
#completionBlock.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–π —Ñ–æ–Ω */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

/* –í–º—ñ—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ */
#completionBlock .modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    max-width: 400px;
    width: 90%;
}
            
        .completion-emoji {
            width: clamp(80px, 15vw, 120px);
            height: clamp(80px, 15vw, 120px);
            margin: 0 auto 3vw;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
            border: 2px dashed #f1c40f;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .completion-emoji::after {
            content: 'üéâ';
            font-size: clamp(40px, 8vw, 60px);
            color: #f1c40f;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2vw;
            justify-content: center;
            margin-bottom: 3vw;
            width: 100%;
        }
        .option {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.5vw 3vw;
            border: 1.5px solid #3498db;
            border-radius: 8px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            cursor: pointer;
            font-size: clamp(15px, 3.5vw, 18px);
            min-height: 45px;
            min-width: 90px;
            max-width: 45%;
            text-align: center;
            font-family: 'Lora', serif;
            position: relative;
            z-index: 1;
            overflow: hidden;
            box-sizing: border-box;
            touch-action: manipulation;
            pointer-events: auto !important;
            user-select: none;
            transition: all 0.3s ease;
            color: #ecf0f1;
        }
        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.2), transparent);
            transition: left 0.5s;
        }
        .option:hover::before {
            left: 100%;
        }
        .option:hover {
            background: linear-gradient(135deg, #3498db, #5f27cd);
            transform: scale(1.03);
            border-color: #f1c40f;
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
        }
        .option.selected {
            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
            color: #ffffff !important;
            border: 2px solid #f1c40f !important;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }
        .option:focus {
            outline: 2px solid #f1c40f;
            outline-offset: 2px;
        }
        .option {
            min-height: 50px !important;
            padding: 12px 20px !important;
        }
        mjx-container, mjx-container * {
            pointer-events: none !important;
            user-select: none !important;
        }
        mjx-frac {
            font-size: 1.2em !important;
            padding: 2px !important;
        }
        mjx-num, mjx-den {
            padding: 2px !important;
        }
        button {
            background: linear-gradient(135deg, #3498db, #5f27cd);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            padding: clamp(10px, 2vw, 12px) clamp(20px, 4vw, 24px);
            font-size: clamp(16px, 3vw, 18px);
            font-family: 'Lora', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
        }
        button:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #8e44ad);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(95, 39, 205, 0.4);
        }
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result {
            margin-top: 3vw;
            font-size: clamp(16px, 2.5vw, 18px);
            font-family: 'Lora', serif;
            color: #ffffff;
        }
        .completion-message {
            font-family: 'Lora', serif;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border: 2.5px solid #27ae60;
            border-radius: 15px;
            padding: clamp(12px, 3vw, 18px);
            box-shadow: 0 6px 12px rgba(46, 204, 113, 0.3);
            margin: 2vw auto;
            max-width: 90%;
            position: relative;
            overflow: hidden;
        }
        .completion-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 1s;
            animation: completionShine 2s infinite;
        }
        @keyframes completionShine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }
        .completion-message h2 {
            font-size: clamp(22px, 4.5vw, 30px);
            margin: 0 0 1vw;
            color: #f1c40f;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }
        .completion-message p {
            font-size: clamp(18px, 3.5vw, 22px);
            margin: 0;
            color: #ffffff;
        }
        /* –°–ø—Ä–æ—â–µ–Ω–∏–π —Å—Ç–∏–ª—å –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω–∏—Ö —Ñ–æ—Ä–º—É–ª - –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ —Ç–∞ —Ä–∞–º–æ–∫ */
        .math-notation-centered {
            display: block;
            text-align: center;
            width: 100%;
            font-size: clamp(18px, 3vw, 20px);
            margin: 10px 0;
            line-height: 1.6;
            font-family: 'Roboto', sans-serif;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è MathJax –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ —É math-notation-centered */
        mjx-container.math-notation-centered {
            display: inline-block !important;
            text-align: center !important;
            vertical-align: middle !important;
            white-space: nowrap !important;
            line-height: 1.4 !important;
            font-size: clamp(18px, 3vw, 20px) !important;
            color: #f1c40f !important;
            background: none !important; /* –ü—Ä–∏–±—Ä–∞–Ω–æ —Å–∏–Ω—é –∑–∞–ª–∏–≤–∫—É */
            margin: 0 !important;
            padding: 0 !important;
        }
        mjx-container.math-notation-centered * {
            color: #f1c40f !important;
            font-style: italic !important;
        }
        /* –î–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ - –±–µ–∑ —Ä–∞–º–æ–∫ */
       #trainerModal .math-notation-centered {
    font-size: clamp(16px, 3vw, 18px);
    color: #ffffff;
    font-family: 'Roboto', sans-serif;
    line-height: 1.5;
    text-align: center;
    margin: 5px 0;
    display: block; /* –î–ª—è –ø–∏—Ç–∞–Ω–Ω—è, —è–∫–µ —Å—Ç–æ—ó—Ç—å –æ–∫—Ä–µ–º–æ */
}

       #trainerModal .options-container mjx-container {
    display: inline !important;
    vertical-align: middle !important;
    font-size: clamp(14px, 3vw, 16px) !important;
    color: #f1c40f !important;
    background: none !important;
    font-style: italic !important;
    margin: 0 2px !important;
    padding: 0 !important;
}
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(24px, 5.8vw, 30px);
            font-family: 'Lora', serif;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            text-align: center;
            border: 2px solid transparent;
        }
        .feedback.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.05);
        }
        .correct-feedback {
            color: #ffffff;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border: 2px solid #27ae60;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }
        .incorrect-feedback {
            color: #ffffff;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: 2px solid #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px auto;
            max-width: 1000px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ffff00;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        .nav-button:hover {
            background: linear-gradient(135deg, #3498db, #5f27cd);
            color: #ffffff;
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
            transition: fill 0.3s ease;
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 964px;
            width: 100%;
            min-height: 150px;
            transition: transform 0.3s ease, opacity 0.3s ease;
            cursor: pointer;
        }
        .card-inner {
            position: relative;
            width: 100%;
            min-height: 150px;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: inherit;
        }
        .question-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
    position: absolute;
    width: 100%;
    min-height: 150px;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    text-align: center;
    cursor: inherit;
    border: 1px solid rgba(95, 39, 205, 0.2);
}

.card-front {
    background: #0c486e; /* –°—É—á–∞—Å–Ω–∏–π —Å–∏–Ω—ñ–π –≥—Ä–∞–¥—ñ—î–Ω—Ç */
    color: #ffffff;
}
        .card-back {
    background: linear-gradient(135deg, #111827, #1f2937); /* –¢–µ–º–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç */
    color: #ecf0f1;
    transform: rotateY(180deg);
    text-align: justify;
    padding: 20px;
    overflow: auto;
    white-space: normal;
}

       /* –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ –¥–ª—è span —É —Ñ–ª–µ—à-–∫–∞—Ä—Ç–∫–∞—Ö */
.card-front span, .card-back span {
    font-family: 'Lora', serif;
    font-size: clamp(16px, 2.8vw, 18px);
    line-height: 1.6;
    display: inline; /* –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ inline –¥–ª—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è */
    color: inherit; /* –£—Å–ø–∞–¥–∫–æ–≤—É—î –∫–æ–ª—ñ—Ä –≤—ñ–¥ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ */
    text-align: center; /* –î–ª—è —Ñ—Ä–æ–Ω—Ç—É */
}

.card-back span {
    text-align: justify; /* –î–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏ */
    word-wrap: break-word;
    overflow-wrap: break-word;
}
        .hidden {
            display: none !important;
        }
        
        .theory-content h2 {
            color: #f1c40f;
            text-align: center;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
            margin-bottom: 20px;
            font-family: 'Merriweather', serif;
        }
        .theory-content h3 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        .theory-content p, .theory-content li {
            color: #ecf0f1;
            font-size: clamp(18px, 3vw, 20px);
            line-height: 1.7;
        }
        .example {
            color: #e67e22;
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #e67e22;
            margin: 15px 0;
        }
        .solution {
            color: #27ae60;
            font-weight: bold;
            text-align: center;
            display: block;
            padding: 10px;
            border-radius: 6px;
            border: 2px solid #27ae60;
            margin: 15px 0;
        }
        .note {
            color: #9b59b6;
            font-weight: bold;
        }
        .note-text {
            font-style: italic;
            color: #bdc3c7;
            text-align: justify;
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #9b59b6;
            margin: 10px 0;
        }
        .theory-content p:not(.math-notation-centered),
        .theory-content li {
            text-align: justify;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–∏—Ö –ø–æ–∑–Ω–∞—á–µ–Ω—å –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ */
        .vector-type {
            font-style: italic;
            color: #f1c40f;
        }
        .main-types {
            font-weight: bold;
            color: #3498db;
        }
        ol {
            color: #ecf0f1;
        }
        ol li::marker {
            color: #f1c40f;
        }
        /* –ë–∞–∑–æ–≤–∏–π —Å—Ç–∏–ª—å –¥–ª—è MathJax –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ */
        mjx-container {
            color: #f1c40f !important;
            background: none !important;
            font-style: italic !important;
        }
        /* –î–ª—è —Ñ–æ—Ä–º—É–ª –≤ —Ç–µ–æ—Ä—ñ—ó - –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏ */
        .theory-content mjx-container {
            color: #f1c40f !important;
            background: none !important;
        }
        .modal-content::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #2c3e50;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #3498db, #5f27cd);
            border-radius: 10px;
            border: 2px solid #2c3e50;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #2980b9, #8e44ad);
        }
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #2c3e50;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #3498db, #5f27cd);
            border-radius: 10px;
            border: 2px solid #2c3e50;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #2980b9, #8e44ad);
        }
        .modal-content {
            scrollbar-color: #3498db #2c3e50;
            scrollbar-width: thin;
        }
        .glow-title {
            text-align: center;
            color: #ffffff;
            font-family: 'Merriweather', serif;
            font-size: clamp(20px, 3vw, 24px);
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(95, 39, 205, 0.5);
            background: linear-gradient(135deg, #3498db, #5f27cd);
            padding: 10px 20px;
            border-radius: 25px;
            display: block;
        }
        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            width: 100%;
            max-width: 300px;
            background: rgba(44, 62, 80, 0.5);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(95, 39, 205, 0.3);
        }
        #answerInput {
            padding: 8px;
            font-size: clamp(14px, 3vw, 16px);
            width: 100px;
            border: 2px solid #3498db;
            border-radius: 6px;
            background: #34495e;
            color: #ecf0f1;
            text-align: center;
            font-family: 'Roboto', sans-serif;
        }
        #answerInput:focus {
            outline: none;
            border-color: #f1c40f;
            box-shadow: 0 0 8px rgba(241, 196, 15, 0.3);
        }
        .option.text-option {
            font-size: clamp(14px, 3vw, 16px);
            padding: 10px 20px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .figure-reference {
            color: #e67e22;
            font-style: italic;
            font-weight: bold;
        }
        .angle-notation {
            color: #9b59b6;
            font-weight: bold;
        }
        .vector-relation {
            color: #27ae60;
            font-weight: bold;
        }
        /* –°—Ç–∏–ª—ñ –¥–ª—è canvas —É —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ */
#vectorCanvas {
    display: block;
    margin: 20px auto;
    border: 1px solid rgba(95, 39, 205, 0.2);
    background: #2c3e50;
    border-radius: 8px;
    width: 400px;
    height: 300px;
}
#optionsContainer {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

#submitAnswer {
    margin-top: 20px;
    padding: clamp(10px, 2vw, 12px) clamp(20px, 4vw, 24px);
    background: linear-gradient(135deg, #3498db, #5f27cd);
    color: #ffffff;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: clamp(16px, 3vw, 18px);
    font-family: 'Lora', serif;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
}

#submitAnswer:disabled {
    background: #7f8c8d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

#submitAnswer:hover:not(:disabled) {
    background: linear-gradient(135deg, #2980b9, #8e44ad);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(95, 39, 205, 0.4);
}
            
        @media (max-width: 768px) {
            .close-btn {
                font-size: 16px;
                padding: 6px 12px;
                border-radius: 8px;
            }
            .theory-content p, .theory-content li {
                font-size: clamp(18px, 3vw, 20px);
            }
            .theory-content mjx-container {
                font-size: clamp(16px, 3vw, 18px) !important;
            }
            .theory-content h2, .theory-content h3 {
                font-size: clamp(20px, 3vw, 24px);
            }
            .question-block summary {
                font-size: clamp(18px, 3vw, 20px);
            }
            .question-block details p {
                font-size: clamp(18px, 3vw, 20px);
            }
            #questionsModal mjx-container {
                font-size: 20px !important;
            }
            #submitAnswer {
                font-size: clamp(16px, 3.5vw, 18px);
                padding: clamp(12px, 3vw, 14px) clamp(24px, 5vw, 28px);
            }
            #answerInput {
                width: 80px;
                padding: 8px;
                font-size: clamp(16px, 3vw, 18px);
            }
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            .modal {
                top: 2%;
                left: 2%;
                width: 96%;
                height: 96%;
            }
            .modal-header {
                padding: 5px 8px;
            }
            .modal-content {
                max-height: calc(100% - 50px);
            }
            .question-card {
                min-height: 180px;
            }
           .card-front, .card-back {
        font-size: clamp(15px, 3vw, 17px);
        padding: 12px;
        line-height: 1.4;
    }
    .card-front span, .card-back span {
        font-size: clamp(15px, 3vw, 17px);
        line-height: 1.4;
    }
    #questionsModal mjx-container {
        font-size: clamp(15px, 3vw, 17px) !important;
    }
            .trainer-container {
                width: 95%;
                padding: 4vw;
            }
            .question-circle, .completion-emoji {
                width: 25vw;
                height: 25vw;
                min-width: 80px;
                min-height: 80px;
            }
            .question-circle h3 {
                font-size: clamp(14px, 3vw, 16px);
            }
            .completion-emoji::after {
                font-size: clamp(30px, 7vw, 40px);
            }
            .options-container {
                gap: 1.5vw;
                flex-direction: column;
                align-items: center;
            }
            .option {
                font-size: clamp(14px, 4vw, 16px);
                padding: 10px !important;
                min-height: 60px !important;
                min-width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                overflow: hidden;
            }
            .option mjx-container {
                font-size: clamp(14px, 4vw, 16px) !important;
                width: 100% !important;
                text-align: center;
                overflow: hidden;
            }
            button {
                padding: 3vw 5vw;
                font-size: clamp(12px, 3vw, 14px);
            }
            .feedback {
                font-size: clamp(24px, 5.8vw, 32px);
                padding: clamp(12px, 3.5vw, 18px) clamp(18px, 5vw, 25px);
                max-width: 95vw;
                word-wrap: break-word;
            }
            .completion-message {
                padding: clamp(10px, 3vw, 15px);
            }
            .completion-message h2 {
                font-size: clamp(20px, 4vw, 26px);
            }
            .completion-message p {
                font-size: clamp(16px, 3vw, 20px);
            }
            .navigation-buttons {
                margin: 20px auto;
                gap: 15px;
            }
            .nav-button {
                font-size: 16px;
                padding: 10px 20px;
            }
            .math-notation-centered {
                font-size: clamp(16px, 2.5vw, 18px);
            }
            mjx-container.math-notation-centered {
                font-size: clamp(16px, 2.5vw, 18px) !important;
            }
            .input-container {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
     #vectorCanvas {
        width: 300px;
        height: 225px;
    }
    #trainerModal .options-container mjx-container {
        font-size: clamp(13px, 3vw, 15px) !important;
    }
        }
        @media (max-width: 480px) {
            .close-btn {
                font-size: 14px;
                padding: 5px 10px;
                border-radius: 6px;
            }
            .theory-content p, .theory-content li {
                font-size: clamp(17px, 3.2vw, 19px);
            }
            .theory-content mjx-container {
                font-size: clamp(17px, 3.2vw, 19px) !important;
            }
            .theory-content h2, .theory-content h3 {
                font-size: clamp(20px, 3vw, 24px);
            }
            .question-block summary {
                font-size: clamp(17px, 3.2vw, 19px);
            }
            .question-block details p {
                font-size: clamp(17px, 3.2vw, 19px);
            }
            #questionsModal mjx-container {
                font-size: 18px !important;
            }
            #submitAnswer {
                font-size: clamp(14px, 3.5vw, 16px);
                padding: clamp(10px, 3vw, 12px) clamp(20px, 5vw, 24px);
            }
            #answerInput {
                width: 70px;
                padding: 6px;
                font-size: clamp(14px, 3vw, 16px);
            }
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 20px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 18px;
            }
            .modal-header {
                padding: 4px 6px;
            }
            .modal-content {
                max-height: calc(100% - 40px);
            }
            .question-card {
                min-height: 200px;
            }
            .card-front, .card-back {
        font-size: clamp(14px, 3vw, 16px);
        padding: 10px;
        line-height: 1.3;
    }
    .card-front span, .card-back span {
        font-size: clamp(14px, 3vw, 16px);
        line-height: 1.3;
    }
    #questionsModal mjx-container {
        font-size: clamp(14px, 3vw, 16px) !important;
    }
           
            .card-inner {
                min-height: 200px;
            }
            .trainer-container {
                padding: 5vw;
            }
            .question-circle, .completion-emoji {
                width: 25vw;
                height: 25vw;
                min-width: 60px;
                min-height: 60px;
            }
            .completion-emoji::after {
                font-size: clamp(25px, 6vw, 35px);
            }
            .option {
                font-size: 16px !important;
                padding: 10px !important;
                min-height: 60px !important;
                min-width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                overflow: hidden;
            }
            .option mjx-container {
                font-size: clamp(13px, 4vw, 15px) !important;
                width: 100% !important;
                text-align: center;
                overflow: hidden;
            }
            .feedback {
                font-size: clamp(22px, 5.2vw, 28px);
                padding: clamp(10px, 3vw, 15px) clamp(15px, 4.5vw, 20px);
                max-width: 95vw;
            }
            .completion-message {
                padding: clamp(10px, 3vw, 15px);
            }
            .completion-message h2 {
                font-size: clamp(18px, 3.5vw, 22px);
            }
            .completion-message p {
                font-size: clamp(14px, 3vw, 18px);
            }
            .navigation-buttons {
                margin: 15px auto;
                gap: 10px;
            }
            .nav-button {
                font-size: 14px;
                padding: 8px 16px;
            }
            .math-notation-centered {
                font-size: clamp(14px, 2.5vw, 16px);
                line-height: 1.2;
            }
            mjx-container.math-notation-centered {
                font-size: clamp(14px, 2.5vw, 16px) !important;
                line-height: 1.2 !important;
            }
            mjx-container {
                font-size: 13px !important;
            }
            .input-container {
                gap: 6px;
            }
            #vectorCanvas {
        width: 300px;
        height: 225px;
    }
    #trainerModal .options-container mjx-container {
        font-size: clamp(12px, 3vw, 14px) !important;
    }
        }
    </style>

</head>
<body>
    <div class="title-box">
        <h1>29. –ö—É—Ç –º—ñ–∂ –¥–≤–æ–º–∞ –≤–µ–∫—Ç–æ—Ä–∞–º–∏</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="–ö–Ω–∏–≥–∞">
            <h2>–¢–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ</h2>
        </div>
        
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="–ö–∞—Ä—Ç–∫–∏">
            <h2>–ü–∏—Ç–∞–Ω–Ω—è —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="–¢—Ä–µ–Ω–∞–∂–µ—Ä">
            <h2>–¢—Ä–µ–Ω–∞–∂–µ—Ä</h2>
        </div>
    </div>

    <div class="navigation-buttons">
        <a class="nav-button" href='tema7.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            –î–æ —Ç–µ–º–∏ 7
        </a>
        <a class="nav-button" href='index.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            –ù–∞ –≥–æ–ª–æ–≤–Ω—É
        </a>
    </div>

   <div id="theoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="theoryTitle">
    <div class="modal-header">
        <button class="close-btn" id="closeTheoryBtn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
    <div class="modal-content">
        <div class="theory-content">
            <h2>–ö—É—Ç –º—ñ–∂ –¥–≤–æ–º–∞ –≤–µ–∫—Ç–æ—Ä–∞–º–∏</h2>
            
            <p>–ö—É—Ç–æ–º –º—ñ–∂ –¥–≤–æ–º–∞ –Ω–µ–Ω—É–ª—å–æ–≤–∏–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å –≤–µ–ª–∏—á–∏–Ω—É –∫—É—Ç–∞ –º—ñ–∂ –Ω–∏–º–∏, –∫–æ–ª–∏ –≤–æ–Ω–∏ –≤—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ –∑—ñ —Å–ø—ñ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏ –ø–æ—á–∞—Ç–∫—É. –¶–µ–π –∫—É—Ç –ª–µ–∂–∏—Ç—å —É –º–µ–∂–∞—Ö –≤—ñ–¥ \( 0^\circ \) –¥–æ \( 180^\circ \) (–∞–±–æ –≤—ñ–¥ 0 –¥–æ œÄ —Ä–∞–¥—ñ–∞–Ω) —ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—î –≤–∑–∞—î–º–Ω—É –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—é –≤–µ–∫—Ç–æ—Ä—ñ–≤ —É –ø—Ä–æ—Å—Ç–æ—Ä—ñ.</p>
            
            <p>–ö—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ \( \vec{a} \) —ñ \( \vec{b} \) –ø–æ–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ <span class="angle-notation">\( \angle(\vec{a};\vec{b}) \)</span>, —Ö–æ—á–∞ —ñ–Ω–æ–¥—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∑–∞–ø–∏—Å <span class="angle-notation">\( (\vec{a};\vec{b})^{\hat{}} \)</span>. –î–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –≤–≤–µ–¥–µ–º–æ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è: \( \varphi = \angle(\vec{a};\vec{b}) \).</p>
            
            <h3>–ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫—É—Ç—ñ–≤ –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏</h3>
            <p>–Ø–∫—â–æ –∫—É—Ç \( \varphi \) –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ \( \vec{a} \) —ñ \( \vec{b} \) –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—î —É–º–æ–≤—É \( 0^\circ < \varphi < 90^\circ \) (\( 0 < \varphi < \pi/2 \)), —Ç–æ –≤—ñ–Ω —î <span class="highlight-term">–≥–æ—Å—Ç—Ä–∏–º</span>. –Ø–∫—â–æ \( 90^\circ < \varphi < 180^\circ \) (\( \pi/2 < \varphi < \pi \)), —Ç–æ –∫—É—Ç —î <span class="highlight-term">—Ç—É–ø–∏–º</span> (—Ä–∏—Å. 7.24).</p>
            
            <p>–Ø–∫—â–æ –∫—É—Ç \( \varphi \) –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ \( \vec{a} \) —ñ \( \vec{b} \) –¥–æ—Ä—ñ–≤–Ω—é—î \( 90^\circ \) (\( \varphi = \pi/2 \)), —Ç–æ —Ü—ñ –≤–µ–∫—Ç–æ—Ä–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å <span class="highlight-term">–ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω–∏–º–∏</span> (–∞–±–æ <span class="highlight-term">–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏–º–∏</span>) —ñ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å <span class="vector-relation">\( \vec{a} \perp \vec{b} \)</span>.</p>
            
            <h3>–°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –≤–∏–ø–∞–¥–∫–∏</h3>
            <p>–Ø–∫—â–æ –≤–µ–∫—Ç–æ—Ä–∏ \( \vec{a} \) —ñ \( \vec{b} \) <span class="vector-relation">–ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —Ç–∞ —Å–ø—ñ–≤–Ω–∞–ø—Ä—è–º–ª–µ–Ω—ñ</span> (\( \vec{a} \uparrow\uparrow \vec{b} \)), —Ç–æ –∫—É—Ç –º—ñ–∂ –Ω–∏–º–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å \( 0^\circ \) (\( \varphi = 0 \)). –Ø–∫—â–æ –≤–æ–Ω–∏ <span class="vector-relation">–ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ, –∞–ª–µ —Å–ø—Ä—è–º–æ–≤–∞–Ω—ñ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ –±–æ–∫–∏</span> (\( \vec{a} \uparrow\downarrow \vec{b} \)), —Ç–æ –∫—É—Ç –¥–æ—Ä—ñ–≤–Ω—é—î \( 180^\circ \) (\( \varphi = \pi \)).</p>
            
            <div class="note">–ü—Ä–∏–º—ñ—Ç–∫–∞:</div>
            <p class="note-text">–Ø–∫—â–æ —Ö–æ—á–∞ –± –æ–¥–∏–Ω —ñ–∑ –≤–µ–∫—Ç–æ—Ä—ñ–≤ —î –Ω—É–ª—å–æ–≤–∏–º, —Ç–æ –∫—É—Ç –º—ñ–∂ –Ω–∏–º–∏ –≤–≤–∞–∂–∞—î—Ç—å—Å—è —Ä—ñ–≤–Ω–∏–º –Ω—É–ª—é (—Ä–∏—Å. 7.25).</p>
            
             <h2>–ö—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–æ–º —ñ –≤—ñ—Å—Å—é</h2>
            <p>–†–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—Ä—è–º—É \( l \), –Ω–∞ —è–∫—ñ–π –∑–∞–¥–∞–Ω–æ –æ–¥–∏–Ω–∏—Ü—é –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏. –í—ñ–∑—å–º–µ–º–æ –¥–≤—ñ —Ç–æ—á–∫–∏ \( A \) —ñ \( B \) –Ω–∞ —Ü—ñ–π –ø—Ä—è–º—ñ–π —Ç–∞–∫—ñ, —â–æ –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –Ω–∏–º–∏ \( |AB| = 1 \). –¢–æ–¥—ñ –≤–µ–∫—Ç–æ—Ä–∏ \( \overrightarrow{AB} \) —ñ \( \overrightarrow{BA} \) –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è <span class="highlight-term">–æ–¥–∏–Ω–∏—á–Ω–∏–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ –ø—Ä—è–º–æ—ó</span> \( l \), –æ—Å–∫—ñ–ª—å–∫–∏ —ó—Ö–Ω—è –¥–æ–≤–∂–∏–Ω–∞ –¥–æ—Ä—ñ–≤–Ω—é—î 1 (—Ä–∏—Å. 7.26).</p>
            
            <p>–¶—ñ –æ–¥–∏–Ω–∏—á–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å –¥–≤–∞ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ –Ω–∞–ø—Ä—è–º–∏ –Ω–∞ –ø—Ä—è–º—ñ–π: –æ–¥–∏–Ω —ñ–∑ –Ω–∏—Ö –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <span class="highlight-term">–¥–æ–¥–∞—Ç–Ω–∏–º</span>, –∞ —ñ–Ω—à–∏–π ‚Äì <span class="highlight-term">–≤—ñ–¥'—î–º–Ω–∏–º</span>.</p>
            
            <p>–Ø–∫—â–æ –Ω–∞ –ø—Ä—è–º—ñ–π \( l \) –≤–∏–±—Ä–∞–Ω–æ —Ç–æ—á–∫—É \( O \) —è–∫ –ø–æ—á–∞—Ç–æ–∫ –≤—ñ–¥–ª—ñ–∫—É, –∑–∞–¥–∞–Ω–æ –¥–æ–¥–∞—Ç–Ω–∏–π –Ω–∞–ø—Ä—è–º —ñ –æ–¥–∏–Ω–∏—Ü—é –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏, —Ç–æ —Ç–∞–∫–∞ –ø—Ä—è–º–∞ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <span class="highlight-term">–≤—ñ—Å—Å—é</span>. –í–µ–∫—Ç–æ—Ä \( \vec{e} \), —è–∫–∏–π –º–∞—î –¥–æ–≤–∂–∏–Ω—É \( |\vec{e}| = 1 \) —ñ –≤–∏–∑–Ω–∞—á–∞—î –¥–æ–¥–∞—Ç–Ω–∏–π –Ω–∞–ø—Ä—è–º –æ—Å—ñ, –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è —ó—ó <span class="highlight-term">–æ–¥–∏–Ω–∏—á–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º</span> (—Ä–∏—Å. 7.27).</p>
            
            <p><span class="highlight-term">–ö—É—Ç–æ–º –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–æ–º —ñ –≤—ñ—Å—Å—é</span> –Ω–∞–∑–∏–≤–∞—é—Ç—å –≤–µ–ª–∏—á–∏–Ω—É –∫—É—Ç–∞ –º—ñ–∂ —Ü–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º —ñ –æ–¥–∏–Ω–∏—á–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º –æ—Å—ñ \( \vec{e} \), –∫–æ–ª–∏ –≤–æ–Ω–∏ –≤—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ –∑—ñ —Å–ø—ñ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏ –ø–æ—á–∞—Ç–∫—É (—Ä–∏—Å. 7.28). –¶–µ–π –∫—É—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—î –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—é –≤–µ–∫—Ç–æ—Ä–∞ –≤—ñ–¥–Ω–æ—Å–Ω–æ –æ—Å—ñ —Ç–∞ –ª–µ–∂–∏—Ç—å —É –º–µ–∂–∞—Ö –≤—ñ–¥ \( 0^\circ \) –¥–æ \( 180^\circ \) (–∞–±–æ –≤—ñ–¥ 0 –¥–æ \( \pi \) —Ä–∞–¥—ñ–∞–Ω).</p>
            
            
            <h3>–ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è</h3>
            <ul>
                <li><span class="highlight-term">\( \varphi = 0^\circ \)</span> ‚Äî –≤–µ–∫—Ç–æ—Ä–∏ —Å–ø—ñ–≤–Ω–∞–ø—Ä—è–º–ª–µ–Ω—ñ</li>
                <li><span class="highlight-term">\( 0^\circ < \varphi < 90^\circ \)</span> ‚Äî –≥–æ—Å—Ç—Ä–∏–π –∫—É—Ç</li>
                <li><span class="highlight-term">\( \varphi = 90^\circ \)</span> ‚Äî –≤–µ–∫—Ç–æ—Ä–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ (\( \vec{a} \perp \vec{b} \))</li>
                <li><span class="highlight-term">\( 90^\circ < \varphi < 180^\circ \)</span> ‚Äî —Ç—É–ø–∏–π –∫—É—Ç</li>
                <li><span class="highlight-term">\( \varphi = 180^\circ \)</span> ‚Äî –≤–µ–∫—Ç–æ—Ä–∏ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–Ω–∞–ø—Ä—è–º–ª–µ–Ω—ñ</li>
            </ul>
            
          
            <h3>–û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ —Å–∏–º–≤–æ–ª—ñ–∫–∞</h3>
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0; background: rgba(52, 152, 219, 0.1); border-radius: 8px; overflow: hidden;">
                <tr style="background: linear-gradient(135deg, #3498db, #5f27cd);">
                    <th style="padding: 10px; text-align: left; color: white;">–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è</th>
                    <th style="padding: 10px; text-align: left; color: white;">–ó–Ω–∞—á–µ–Ω–Ω—è</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);"><span class="angle-notation">\( \angle(\vec{a};\vec{b}) \)</span></td>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);">–ö—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);"><span class="vector-relation">\( \vec{a} \perp \vec{b} \)</span></td>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);">–í–µ–∫—Ç–æ—Ä–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);"><span class="vector-relation">\( \vec{a} \uparrow\uparrow \vec{b} \)</span></td>
                    <td style="padding: 10px; border-bottom: 1px solid rgba(95, 39, 205, 0.2);">–°–ø—ñ–≤–Ω–∞–ø—Ä—è–º–ª–µ–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏</td>
                </tr>
                <tr>
                    <td style="padding: 10px;"><span class="vector-relation">\( \vec{a} \uparrow\downarrow \vec{b} \)</span></td>
                    <td style="padding: 10px;">–ü—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–Ω–∞–ø—Ä—è–º–ª–µ–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏</td>
                </tr>
            </table>
            
            <p>–¶—ñ –ø–æ–Ω—è—Ç—Ç—è —î –æ—Å–Ω–æ–≤–æ—é –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–≤—á–µ–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –∞–ª–≥–µ–±—Ä–∏ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ—ó –≥–µ–æ–º–µ—Ç—Ä—ñ—ó.</p>
        </div>
    </div>
</div>
   

 <div id="questionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="questionsTitle">
    <div class="modal-header">
        <button class="close-btn" id="closeQuestionsBtn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
    <div class="modal-content">
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>1. –Ø–∫ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å –∫—É—Ç –º—ñ–∂ –¥–≤–æ–º–∞ –Ω–µ–Ω—É–ª—å–æ–≤–∏–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –≤–µ–ª–∏—á–∏–Ω–∞ –∫—É—Ç–∞ –º—ñ–∂ –Ω–∏–º–∏, –∫–æ–ª–∏ –≤–æ–Ω–∏ –≤—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ –∑—ñ —Å–ø—ñ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏ –ø–æ—á–∞—Ç–∫—É; –∫—É—Ç –ª–µ–∂–∏—Ç—å —É –º–µ–∂–∞—Ö –≤—ñ–¥ <span class="math-notation">\( 0^\circ \)</span> –¥–æ <span class="math-notation">\( 180^\circ \)</span> (–∞–±–æ –≤—ñ–¥ <span class="math-notation">\( 0 \)</span> –¥–æ <span class="math-notation">\( \pi \)</span> —Ä–∞–¥—ñ–∞–Ω).</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>2. –Ø–∫–µ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–ª—è –∫—É—Ç–∞ –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ \( \vec{a} \)—ñ \( \vec{b} \)?</span>
                </div>
                <div class="card-back">
                    <span><span class="math-notation">\( \varphi = \angle(\vec{a}; \vec{b}) \)</span>; —ñ–Ω–æ–¥—ñ <span class="math-notation">\( (\vec{a}; \vec{b})^{\hat{}} \)</span>.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>3. –Ø–∫–∏–º —î –∫—É—Ç, —è–∫—â–æ <span class="math-notation">\( 0^\circ < \varphi < 90^\circ \)</span> (<span class="math-notation">\( 0 < \varphi < \pi/2 \)</span>)?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –≥–æ—Å—Ç—Ä–∏–π –∫—É—Ç.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>4. –Ø–∫–∏–º —î –∫—É—Ç, —è–∫—â–æ <span class="math-notation">\( 90^\circ < \varphi < 180^\circ \)</span> (<span class="math-notation">\( \pi/2 < \varphi < \pi \)</span>)?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ —Ç—É–ø–∏–π –∫—É—Ç.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>5. –Ø–∫—ñ –≤–µ–∫—Ç–æ—Ä–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω–∏–º–∏ (–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏–º–∏)?</span>
                </div>
                <div class="card-back">
                    <span>–Ø–∫—â–æ –∫—É—Ç –º—ñ–∂ –Ω–∏–º–∏ –¥–æ—Ä—ñ–≤–Ω—é—î <span class="math-notation">\( 90^\circ \)</span> (<span class="math-notation">\( \varphi = \pi/2 \)</span>), –ø–æ–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ <span class="vector-relation">\( \vec{a} \perp \vec{b} \)</span>.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>6. –Ø–∫–∏–π –∫—É—Ç –º—ñ–∂ —Å–ø—ñ–≤–Ω–∞–ø—Ä—è–º–ª–µ–Ω–∏–º–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏?</span>
                </div>
                <div class="card-back">
                    <span><span class="math-notation">\( 0^\circ \)</span> (<span class="math-notation">\( \varphi = 0 \)</span>), –ø–æ–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ <span class="vector-relation">\( \vec{a} \uparrow\uparrow \vec{b} \)</span>.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>7. –Ø–∫–∏–π –∫—É—Ç –º—ñ–∂ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–º–∏, –∞–ª–µ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ –Ω–∞–ø—Ä—è–º–ª–µ–Ω–∏–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏?</span>
                </div>
                <div class="card-back">
                    <span><span class="math-notation">\( 180^\circ \)</span> (<span class="math-notation">\( \varphi = \pi \)</span>), –ø–æ–∑–Ω–∞—á–∞—î—Ç—å—Å—è —è–∫ <span class="vector-relation">\( \vec{a} \uparrow\downarrow \vec{b} \)</span>.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>8. –Ø–∫–∏–π –∫—É—Ç –≤–≤–∞–∂–∞—î—Ç—å—Å—è –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏, —è–∫—â–æ —Ö–æ—á–∞ –± –æ–¥–∏–Ω —ñ–∑ –Ω–∏—Ö –Ω—É–ª—å–æ–≤–∏–π?</span>
                </div>
                <div class="card-back">
                    <span>–ö—É—Ç –¥–æ—Ä—ñ–≤–Ω—é—î <span class="math-notation">\( 0 \)</span>.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>9.–©–æ —Ç–∞–∫–µ –æ–¥–∏–Ω–∏—á–Ω–∏–π –≤–µ–∫—Ç–æ—Ä –ø—Ä—è–º–æ—ó?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –≤–µ–∫—Ç–æ—Ä –¥–æ–≤–∂–∏–Ω–∏ <span class="math-notation">\( 1 \)</span>, —è–∫–∏–π –≤–∏–∑–Ω–∞—á–∞—î –æ–¥–∏–Ω —ñ–∑ –¥–≤–æ—Ö –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏—Ö –Ω–∞–ø—Ä—è–º—ñ–≤ –Ω–∞ –ø—Ä—è–º—ñ–π.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>10. –Ø–∫ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –≤—ñ—Å—å?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –ø—Ä—è–º–∞ –∑ –æ–±—Ä–∞–Ω–∏–º –ø–æ—á–∞—Ç–∫–æ–º –≤—ñ–¥–ª—ñ–∫—É, –¥–æ–¥–∞—Ç–Ω–∏–º –Ω–∞–ø—Ä—è–º–æ–º —ñ –æ–¥–∏–Ω–∏—Ü–µ—é –¥–æ–≤–∂–∏–Ω–∏.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>11. –©–æ —Ç–∞–∫–µ –æ–¥–∏–Ω–∏—á–Ω–∏–π –≤–µ–∫—Ç–æ—Ä –æ—Å—ñ?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –≤–µ–∫—Ç–æ—Ä <span class="math-notation">\( \vec{e} \)</span>, –¥–ª—è —è–∫–æ–≥–æ <span class="math-notation">\( |\vec{e}| = 1 \)</span>, —ñ —è–∫–∏–π –∑–∞–¥–∞—î –¥–æ–¥–∞—Ç–Ω–∏–π –Ω–∞–ø—Ä—è–º –æ—Å—ñ.</span>
                </div>
            </div>
        </div>
        <div class="question-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <span>12. –Ø–∫ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–æ–º —ñ –≤—ñ—Å—Å—é?</span>
                </div>
                <div class="card-back">
                    <span>–¶–µ –∫—É—Ç –º—ñ–∂ –¥–∞–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º —ñ –æ–¥–∏–Ω–∏—á–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º –æ—Å—ñ <span class="math-notation">\( \vec{e} \)</span>, –∫–æ–ª–∏ –≤–æ–Ω–∏ –º–∞—é—Ç—å —Å–ø—ñ–ª—å–Ω–∏–π –ø–æ—á–∞—Ç–æ–∫; –ª–µ–∂–∏—Ç—å —É –º–µ–∂–∞—Ö –≤—ñ–¥ <span class="math-notation">\( 0^\circ \)</span> –¥–æ <span class="math-notation">\( 180^\circ \)</span> (–∞–±–æ –≤—ñ–¥ <span class="math-notation">\( 0 \)</span> –¥–æ <span class="math-notation">\( \pi \)</span> —Ä–∞–¥—ñ–∞–Ω).</span>
                </div>
            </div>
        </div>
    </div>
</div>
   <div id="trainerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
    <div class="modal-header">
        <button class="close-btn" id="closeTrainerBtn" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container" id="trainerContent">
            <div class="question-circle">
                <h3 id="questionNumber"></h3>
            </div>
            <canvas id="vectorCanvas" width="300" height="200"></canvas>
            <p id="questionText" class="math-notation-centered">–í–∏–∑–Ω–∞—á—Ç–µ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏:</p>
            <div class="options-container" id="optionsContainer"></div>
            <button id="submitAnswer" disabled>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
            <div id="feedback" class="feedback"></div>
            <div id="completionBlock" class="completion-message hidden">
                <div class="completion-emoji"></div>
                <h2>–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
                <p>–ú–æ–ª–æ–¥–µ—Ü—å!</p>
                <button id="resetTrainerBtn">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
            </div>
        </div>
    </div>
</div>
    <div id="modalOverlay"></div>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    document.body.classList.add('loaded');

    const elements = {
        openTheoryBtn: document.getElementById('openTheoryBtn'),
        openQuestionsBtn: document.getElementById('openQuestionsBtn'),
        openTrainerBtn: document.getElementById('openTrainerBtn'),
        theoryModal: document.getElementById('theoryModal'),
        questionsModal: document.getElementById('questionsModal'),
        trainerModal: document.getElementById('trainerModal'),
        closeTheoryBtn: document.getElementById('closeTheoryBtn'),
        closeQuestionsBtn: document.getElementById('closeQuestionsBtn'),
        closeTrainerBtn: document.getElementById('closeTrainerBtn'),
        modalOverlay: document.getElementById('modalOverlay'),
        questionNumber: document.getElementById('questionNumber'),
        questionText: document.getElementById('questionText'),
        optionsContainer: document.getElementById('optionsContainer'),
        feedback: document.getElementById('feedback'),
        completionBlock: document.getElementById('completionBlock'),
        resetTrainerBtn: document.getElementById('resetTrainerBtn'),
        vectorCanvas: document.getElementById('vectorCanvas'),
        submitAnswer: document.getElementById('submitAnswer')
    };

    const ctx = elements.vectorCanvas?.getContext('2d');
    if (!ctx) console.error('–ö–æ–Ω—Ç–µ–∫—Å—Ç canvas –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');

    let questions = [];
    let currentQuestionIndex = 0;
    let selectedOption = null;
    let usedCombinations = new Set();
    let useDegrees = Math.random() > 0.5;

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

 function calculateAngleBetweenVectors(vec1, vec2, useDegrees = true) {
    if (!vec1 || !vec2 || vec1.length !== 3 || vec2.length !== 3) {
        console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏:', { vec1, vec2 });
        return useDegrees ? '0^\\circ' : '0';
    }

    const dot = vec1[0] * vec2[0] + vec1[1] * vec2[1] + vec1[2] * vec2[2];
    const mag1 = Math.sqrt(vec1[0] ** 2 + vec1[1] ** 2 + vec1[2] ** 2);
    const mag2 = Math.sqrt(vec2[0] ** 2 + vec2[1] ** 2 + vec2[2] ** 2);
    if (mag1 === 0 || mag2 === 0) {
        console.error('–ù—É–ª—å–æ–≤–∞ –¥–æ–≤–∂–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞:', { mag1, mag2 });
        return useDegrees ? '0^\\circ' : '0';
    }

    const cosTheta = Math.min(1, Math.max(-1, dot / (mag1 * mag2)));
    const angleRad = Math.acos(cosTheta);
    const angleDeg = angleRad * (180 / Math.PI);

    // –ü–æ—Ä–æ–≥–∏ –¥–ª—è —Ç–æ—á–Ω—ñ—à–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—É—Ç—ñ–≤
    if (Math.abs(cosTheta - 1) < 0.01) {
        console.log('–í–µ–∫—Ç–æ—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ñ:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '0^\\circ' : '0';
    } else if (Math.abs(cosTheta + 1) < 0.01) {
        console.log('–í–µ–∫—Ç–æ—Ä–∏ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ñ:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '180^\\circ' : '\\pi';
    } else if (Math.abs(cosTheta) < 0.01) {
        console.log('–í–µ–∫—Ç–æ—Ä–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ñ:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '90^\\circ' : '\\pi/2';
    } else if (Math.abs(cosTheta - 0.5) < 0.01) {
        console.log('–ö—É—Ç 60¬∞:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '60^\\circ' : '\\pi/3';
    } else if (Math.abs(cosTheta + 0.5) < 0.01) {
        console.log('–ö—É—Ç 120¬∞:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '120^\\circ' : '2\\pi/3';
    } else if (Math.abs(Math.abs(cosTheta) - 0.707) < 0.01) {
        console.log('–ö—É—Ç 45¬∞ –∞–±–æ 135¬∞:', { vec1, vec2, cosTheta, angleDeg });
        return useDegrees ? '45^\\circ' : '\\pi/4';
    }

    // –Ø–∫—â–æ –∫—É—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ç–æ—á–Ω–∏–º –ø–æ—Ä–æ–≥–∞–º, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–π–±–ª–∏–∂—á–∏–π
    const possibleAnglesDeg = [0, 45, 60, 90, 120, 180];
    const possibleAnglesRad = [0, Math.PI / 4, Math.PI / 3, Math.PI / 2, 2 * Math.PI / 3, Math.PI];
    let closestAngle = useDegrees ? possibleAnglesDeg[0] : possibleAnglesRad[0];
    let minDiff = useDegrees ? Math.abs(angleDeg - possibleAnglesDeg[0]) : Math.abs(angleRad - possibleAnglesRad[0]);

    for (let i = 1; i < possibleAnglesDeg.length; i++) {
        const diff = useDegrees ? Math.abs(angleDeg - possibleAnglesDeg[i]) : Math.abs(angleRad - possibleAnglesRad[i]);
        if (diff < minDiff) {
            minDiff = diff;
            closestAngle = useDegrees ? possibleAnglesDeg[i] : possibleAnglesRad[i];
        }
    }

    console.log('–û–±—á–∏—Å–ª–µ–Ω–∏–π –∫—É—Ç:', { vec1, vec2, cosTheta, angleDeg, closestAngle });
    return useDegrees ? `${closestAngle}^\\circ` : closestAngle === 0 ? '0' : 
           closestAngle === Math.PI ? '\\pi' : 
           closestAngle === Math.PI / 2 ? '\\pi/2' : 
           closestAngle === Math.PI / 3 ? '\\pi/3' : 
           closestAngle === 2 * Math.PI / 3 ? '2\\pi/3' : '\\pi/4';
}


    
function generatePerpendicularVectors() {
    const height = 1.5;
    const shortY = 0.8;
    const longY = 0.88;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ (0)
        [1, 0, 0],               // D‚ÇÅ (1)
        [1, longY, 0],           // D (2)
        [0, longY, 0],           // A (3)
        [0, 0, height * shortZ], // B‚ÇÅ (4)
        [1, 0, height * shortZ], // C‚ÇÅ (5)
        [1, longY, height * shortZ], // C (6)
        [0, longY, height * shortZ]  // B (7)
    ];

    const sideEdges = [
        { start: 3, end: 0, desc: '\\vec{AA_1}', vec: [0, -longY, 0] },
        { start: 7, end: 4, desc: '\\vec{BB_1}', vec: [0, -longY, 0] },
        { start: 6, end: 5, desc: '\\vec{CC_1}', vec: [0, -longY, 0] },
        { start: 2, end: 1, desc: '\\vec{DD_1}', vec: [0, -longY, 0] },
        { start: 0, end: 3, desc: '\\vec{A_1A}', vec: [0, longY, 0] },
        { start: 4, end: 7, desc: '\\vec{B_1B}', vec: [0, longY, 0] },
        { start: 5, end: 6, desc: '\\vec{C_1C}', vec: [0, longY, 0] },
        { start: 1, end: 2, desc: '\\vec{D_1D}', vec: [0, longY, 0] }
    ];

    const baseEdges = [
        { start: 3, end: 7, desc: '\\vec{AB}', vec: [0, 0, height * shortZ] },
        { start: 7, end: 6, desc: '\\vec{BC}', vec: [1, 0, 0] },
        { start: 6, end: 2, desc: '\\vec{CD}', vec: [0, 0, -height * shortZ] },
        { start: 2, end: 3, desc: '\\vec{DA}', vec: [-1, 0, 0] },
        { start: 0, end: 4, desc: '\\vec{A_1B_1}', vec: [0, 0, height * shortZ] },
        { start: 4, end: 5, desc: '\\vec{B_1C_1}', vec: [1, 0, 0] },
        { start: 5, end: 1, desc: '\\vec{C_1D_1}', vec: [0, 0, -height * shortZ] },
        { start: 1, end: 0, desc: '\\vec{D_1A_1}', vec: [-1, 0, 0] }
    ];

    const additionalPerpendiculars = [
        { start: 2, end: 5, desc: '\\vec{DC_1}', vec: [0, 0, -height * shortZ], start2: 5, end2: 4, desc2: '\\vec{C_1B_1}', vec2: [-1, 0, 0] },
        { start: 2, end: 5, desc: '\\vec{DC_1}', vec: [0, 0, -height * shortZ], start2: 2, end2: 3, desc2: '\\vec{DA}', vec2: [-1, 0, 0] },
        { start: 3, end: 4, desc: '\\vec{AB_1}', vec: [0, -longY, height * shortZ], start2: 3, end2: 2, desc2: '\\vec{AD}', vec2: [1, 0, 0] },
        { start: 3, end: 4, desc: '\\vec{AB_1}', vec: [0, -longY, height * shortZ], start2: 4, end2: 5, desc2: '\\vec{B_1C_1}', vec2: [1, 0, 0] },
        { start: 3, end: 4, desc: '\\vec{AB_1}', vec: [0, -longY, height * shortZ], start2: 7, end2: 6, desc2: '\\vec{BC}', vec2: [1, 0, 0] },
        { start: 5, end: 2, desc: '\\vec{C_1D}', vec: [0, longY, -height * shortZ], start2: 3, end2: 7, desc2: '\\vec{AB}', vec2: [0, 0, height * shortZ] }
    ];

    const allPairs = [
        ...sideEdges.map(side => baseEdges.map(base => ({
            vec1: side.vec,
            start1: side.start,
            end1: side.end,
            vec2: base.vec,
            start2: base.start,
            end2: base.end,
            desc: `\\vec{${side.desc}} \\, \\text{—ñ} \\, \\vec{${base.desc}}`,
            sharedOrigin: false,
            offset: [0, 0]
        }))).flat(),
        ...additionalPerpendiculars.map(p => ({
            vec1: p.vec,
            start1: p.start,
            end1: p.end,
            vec2: p.vec2,
            start2: p.start2,
            end2: p.end2,
            desc: `\\vec{${p.desc}} \\, \\text{—ñ} \\, \\vec{${p.desc2}}`,
            sharedOrigin: false,
            offset: [0, 0]
        }))
    ];

    const validPairs = allPairs.filter(pair => {
        const angle = calculateAngleBetweenVectors(pair.vec1, pair.vec2, useDegrees);
        return angle === (useDegrees ? '90^\\circ' : '\\frac{\\pi}{2}');
    });

    const filteredPairs = validPairs.filter(pair => 
        !(pair.start1 === 3 && pair.end1 === 4 && pair.start2 === 4 && pair.end2 === 1) && // AB‚ÇÅ —ñ B‚ÇÅD‚ÇÅ
        !(pair.start1 === 4 && pair.end1 === 1 && pair.start2 === 3 && pair.end2 === 4) && // B‚ÇÅD‚ÇÅ —ñ AB‚ÇÅ
        !(pair.start1 === 0 && pair.end1 === 4 && pair.start2 === 4 && pair.end2 === 1) && // A‚ÇÅB‚ÇÅ —ñ B‚ÇÅD‚ÇÅ
        !(pair.start1 === 4 && pair.end1 === 1 && pair.start2 === 0 && pair.end2 === 4)   // B‚ÇÅD‚ÇÅ —ñ A‚ÇÅB‚ÇÅ
    );

    const pair = filteredPairs[getRandomInt(0, filteredPairs.length - 1)];
    const correctAnswer = calculateAngleBetweenVectors(pair.vec1, pair.vec2, useDegrees);
    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (90¬∞):', { desc: pair.desc, correctAnswer });
    return {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(A \\, BCD \\, A_1 B_1 C_1 D_1\\)</span>.
        –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${pair.desc}\\)</span>.`,
        vectors: [pair.vec1, pair.vec2],
        startIndices: [[pair.start1, pair.end1], [pair.start2, pair.end2]],
        sharedOrigin: pair.sharedOrigin,
        offset: pair.offset,
        correct: correctAnswer,
        options: useDegrees ? ['90^\\circ', '0^\\circ', '180^\\circ', '45^\\circ'] : ['\\pi/2', '0', '\\pi', '\\pi/4'],
        angleType: 'perpendicular'
    };
}
    
 function generateParallelSameVectors(attempt = 0, maxAttempts = 5) {
    if (attempt >= maxAttempts) {
        console.error('–î–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—Ä–æ–± –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è parallelSame');
        return null;
    }

    const height = 1.111;
    const shortY = 0.8;
    const longY = 1;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ (0)
        [1, 0, 0],               // D‚ÇÅ (1)
        [1, longY, 0],           // D (2)
        [0, longY, 0],           // A (3)
        [0, 0, height * shortZ], // B‚ÇÅ (4)
        [1, 0, height * shortZ], // C‚ÇÅ (5)
        [1, longY, height * shortZ], // C (6)
        [0, longY, height * shortZ]  // B (7)
    ];

    const types = [
        { vec1: [0, 0, height * shortZ], start1: 0, end1: 4, vec2: [0, 0, height * shortZ], start2: 3, end2: 7, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{AB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 0, end1: 1, vec2: [1, 0, 0], start2: 7, end2: 6, desc: '\\vec{A_1D_1} \\text{ —ñ } \\vec{BC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, 0], start1: 6, end1: 5, vec2: [0, -longY, 0], start2: 2, end2: 1, desc: '\\vec{CC_1} \\text{ —ñ } \\vec{DD_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, height * shortZ], start1: 3, end1: 7, vec2: [0, 0, height * shortZ], start2: 2, end2: 6, desc: '\\vec{AB} \\text{ —ñ } \\vec{DC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -height * shortZ], start1: 6, end1: 2, vec2: [0, 0, -height * shortZ], start2: 5, end2: 1, desc: '\\vec{CD} \\text{ —ñ } \\vec{C_1D_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 0, end1: 2, vec2: [1, longY, 0], start2: 4, end2: 6, desc: '\\vec{A_1D} \\text{ —ñ } \\vec{B_1C}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 0, end1: 5, vec2: [1, 0, height * shortZ], start2: 3, end2: 6, desc: '\\vec{A_1C_1} \\text{ —ñ } \\vec{AC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, height * shortZ], start1: 1, end1: 4, vec2: [-1, 0, height * shortZ], start2: 2, end2: 7, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{DB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -height * shortZ], start1: 7, end1: 2, vec2: [1, 0, -height * shortZ], start2: 4, end2: 1, desc: '\\vec{BD} \\text{ —ñ } \\vec{B_1D_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, height * shortZ], start1: 1, end1: 4, vec2: [-1, 0, height * shortZ], start2: 2, end2: 7, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{DB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, 0], start1: 4, end1: 7, vec2: [0, longY, 0], start2: 0, end2: 3, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{A_1A}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, 0], start1: 7, end1: 4, vec2: [0, -longY, 0], start2: 3, end2: 0, desc: '\\vec{BB_1} \\text{ —ñ } \\vec{AA_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, -height * shortZ], start1: 5, end1: 2, vec2: [0, longY, -height * shortZ], start2: 4, end2: 3, desc: '\\vec{C_1D} \\text{ —ñ } \\vec{B_1A}', sharedOrigin: false, offset: [0, 0] }
    ];

    const type = types[getRandomInt(0, types.length - 1)];
    const correctAnswer = calculateAngleBetweenVectors(type.vec1, type.vec2, useDegrees);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –∫—É—Ç–∞
    if (correctAnswer !== (useDegrees ? '0^\\circ' : '0')) {
        console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫—É—Ç –¥–ª—è parallelSame:', { attempt: attempt + 1, correctAnswer, vec1: type.vec1, vec2: type.vec2, desc: type.desc });
        return generateParallelSameVectors(attempt + 1, maxAttempts);
    }

    const questionData = {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(A \\, BCD \\, A_1 B_1 C_1 D_1\\)</span>. –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${type.desc}\\)</span>.`,
        vectors: [type.vec1, type.vec2],
        startIndices: [[type.start1, type.end1], [type.start2, type.end2]],
        sharedOrigin: type.sharedOrigin,
        offset: type.offset,
        correct: correctAnswer,
        options: useDegrees ? ['0^\\circ', '90^\\circ', '180^\\circ', '45^\\circ'] : ['0', '\\pi/2', '\\pi', '\\pi/4'],
        angleType: 'parallelSame'
    };

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
    if (!questionData.vectors || !questionData.vectors[0] || !questionData.vectors[1] ||
        !questionData.startIndices || !questionData.startIndices[0] || !questionData.startIndices[1] ||
        !questionData.correct || !questionData.options || questionData.options.length === 0) {
        console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ:', { attempt: attempt + 1, questionData });
        return generateParallelSameVectors(attempt + 1, maxAttempts);
    }

    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (0¬∞):', { desc: type.desc, correctAnswer, questionData });

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
    if (usedCombinations && usedCombinations.has(type.desc)) {
        console.log('–ü–∞—Ä–∞ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞, –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤—É:', type.desc);
        return generateParallelSameVectors(attempt + 1, maxAttempts);
    }
    if (usedCombinations) {
        usedCombinations.add(type.desc);
    }

    return questionData;
}

function generateParallelOppositeVectors(attempt = 0, maxAttempts = 5) {
    if (attempt >= maxAttempts) {
        console.error('–î–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—Ä–æ–± –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è parallelOpposite');
        return null;
    }

    const height = 1.111;
    const shortY = 0.8;
    const longY = 1;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ (0)
        [1, 0, 0],               // D‚ÇÅ (1)
        [1, longY, 0],           // D (2)
        [0, longY, 0],           // A (3)
        [0, 0, height * shortZ], // B‚ÇÅ (4)
        [1, 0, height * shortZ], // C‚ÇÅ (5)
        [1, longY, height * shortZ], // C (6)
        [0, longY, height * shortZ]  // B (7)
    ];

    const types = [
        { vec1: [0, 0, height * shortZ], start1: 0, end1: 4, vec2: [0, 0, -height * shortZ], start2: 6, end2: 2, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, height * shortZ], start1: 0, end1: 4, vec2: [0, 0, -height * shortZ], start2: 7, end2: 3, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{BA}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 0, end1: 1, vec2: [-1, 0, 0], start2: 6, end2: 7, desc: '\\vec{A_1D_1} \\text{ —ñ } \\vec{CB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, 0], start1: 6, end1: 5, vec2: [0, longY, 0], start2: 1, end2: 2, desc: '\\vec{CC_1} \\text{ —ñ } \\vec{D_1D}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, height * shortZ], start1: 3, end1: 7, vec2: [0, 0, -height * shortZ], start2: 6, end2: 2, desc: '\\vec{AB} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -height * shortZ], start1: 2, end1: 5, vec2: [0, 0, height * shortZ], start2: 0, end2: 4, desc: '\\vec{DC} \\text{ —ñ } \\vec{A_1B_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -height * shortZ], start1: 6, end1: 2, vec2: [0, 0, height * shortZ], start2: 1, end2: 5, desc: '\\vec{CD} \\text{ —ñ } \\vec{D_1C_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 0, end1: 2, vec2: [-1, -longY, 0], start2: 6, end2: 4, desc: '\\vec{A_1D} \\text{ —ñ } \\vec{CB_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 0, end1: 5, vec2: [-1, 0, -height * shortZ], start2: 3, end2: 6, desc: '\\vec{A_1C_1} \\text{ —ñ } \\vec{CA}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -height * shortZ], start1: 7, end1: 2, vec2: [1, 0, height * shortZ], start2: 1, end2: 5, desc: '\\vec{DB} \\text{ —ñ } \\vec{D_1C_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, height * shortZ], start1: 1, end1: 4, vec2: [1, 0, -height * shortZ], start2: 7, end2: 2, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{BD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, 0], start1: 4, end1: 7, vec2: [0, -longY, 0], start2: 3, end2: 0, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{AA_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, 0], start1: 4, end1: 7, vec2: [0, -longY, 0], start2: 2, end2: 1, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{DD_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, 0], start1: 3, end1: 0, vec2: [0, longY, 0], start2: 5, end2: 6, desc: '\\vec{AA_1} \\text{ —ñ } \\vec{C_1C}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, height * shortZ], start1: 1, end1: 5, vec2: [0, 0, -height * shortZ], start2: 6, end2: 2, desc: '\\vec{D_1C_1} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] }
    ];

    const type = types[getRandomInt(0, types.length - 1)];
    const correctAnswer = calculateAngleBetweenVectors(type.vec1, type.vec2, useDegrees);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –∫—É—Ç–∞
    if (correctAnswer !== (useDegrees ? '180^\\circ' : '\\pi')) {
        console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫—É—Ç –¥–ª—è parallelOpposite:', { attempt: attempt + 1, correctAnswer, vec1: type.vec1, vec2: type.vec2, desc: type.desc });
        return generateParallelOppositeVectors(attempt + 1, maxAttempts);
    }

    const questionData = {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(A \\, BCD \\, A_1 B_1 C_1 D_1\\)</span>. –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${type.desc}\\)</span>.`,
        vectors: [type.vec1, type.vec2],
        startIndices: [[type.start1, type.end1], [type.start2, type.end2]],
        sharedOrigin: type.sharedOrigin,
        offset: type.offset,
        correct: correctAnswer,
        options: useDegrees ? ['180^\\circ', '0^\\circ', '90^\\circ', '45^\\circ'] : ['\\pi', '0', '\\pi/2', '\\pi/4'],
        angleType: 'parallelOpposite'
    };

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
    if (!questionData.vectors || !questionData.vectors[0] || !questionData.vectors[1] ||
        !questionData.startIndices || !questionData.startIndices[0] || !questionData.startIndices[1] ||
        !questionData.correct || !questionData.options || questionData.options.length === 0) {
        console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ:', { attempt: attempt + 1, questionData });
        return generateParallelOppositeVectors(attempt + 1, maxAttempts);
    }

    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (180¬∞):', { desc: type.desc, correctAnswer, questionData });

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
    if (usedCombinations && usedCombinations.has(type.desc)) {
        console.log('–ü–∞—Ä–∞ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞, –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤—É:', type.desc);
        return generateParallelOppositeVectors(attempt + 1, maxAttempts);
    }
    if (usedCombinations) {
        usedCombinations.add(type.desc);
    }

    return questionData;
}

    
   function generateFaceDiagonalVectors() {
    const vertices = [
        [0, 0, 0], // A‚ÇÅ (0)
        [1, 0, 0], // D‚ÇÅ (1)
        [1, 1, 0], // D (2)
        [0, 1, 0], // A (3)
        [0, 0, 1], // B‚ÇÅ (4)
        [1, 0, 1], // C‚ÇÅ (5)
        [1, 1, 1], // C (6)
        [0, 1, 1]  // B (7)
    ];

    const faceDiagonals = [
        { start1: 0, end1: 2, start2: 1, end2: 3, desc: '\\\\vec{A_1D} \\\\text{ —ñ } \\\\vec{D_1A}' }, // –≥—Ä–∞–Ω—å A‚ÇÅD‚ÇÅDA
        { start1: 4, end1: 6, start2: 5, end2: 7, desc: '\\\\vec{B_1C} \\\\text{ —ñ } \\\\vec{C_1B}' }, // –≥—Ä–∞–Ω—å B‚ÇÅC‚ÇÅCB
        { start1: 0, end1: 5, start2: 4, end2: 1, desc: '\\\\vec{A_1C_1} \\\\text{ —ñ } \\\\vec{B_1D_1}' }, // –≥—Ä–∞–Ω—å A‚ÇÅB‚ÇÅC‚ÇÅD‚ÇÅ
        { start1: 3, end1: 6, start2: 7, end2: 2, desc: '\\\\vec{AC} \\\\text{ —ñ } \\\\vec{BD}' }, // –≥—Ä–∞–Ω—å ABCD
        { start1: 0, end1: 7, start2: 3, end2: 4, desc: '\\\\vec{A_1B} \\\\text{ —ñ } \\\\vec{AB_1}' }, // –≥—Ä–∞–Ω—å A‚ÇÅAB‚ÇÅB
        { start1: 1, end1: 6, start2: 5, end2: 2, desc: '\\\\vec{D_1C} \\\\text{ —ñ } \\\\vec{C_1D}' }  // –≥—Ä–∞–Ω—å D‚ÇÅDC‚ÇÅC
    ];

    // –í–∏–±—ñ—Ä –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –ø–∞—Ä–∏
    const pair = faceDiagonals[getRandomInt(0, faceDiagonals.length - 1)];

    // –§–æ—Ä–º—É—î–º–æ –≤–µ–∫—Ç–æ—Ä–∏ –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    const vec1 = [
        vertices[pair.end1][0] - vertices[pair.start1][0],
        vertices[pair.end1][1] - vertices[pair.start1][1],
        vertices[pair.end1][2] - vertices[pair.start1][2]
    ];
    const vec2 = [
        vertices[pair.end2][0] - vertices[pair.start2][0],
        vertices[pair.end2][1] - vertices[pair.start2][1],
        vertices[pair.end2][2] - vertices[pair.start2][2]
    ];

    // –û–±—á–∏—Å–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    const correctAnswer = calculateAngleBetweenVectors(vec1, vec2, useDegrees);
    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (–¥—ñ–∞–≥–æ–Ω–∞–ª—ñ –≥—Ä–∞–Ω—ñ):', { desc: pair.desc, correctAnswer });

    return {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\\\(A B C D A_1 B_1 C_1 D_1\\\\)</span>. 
                   –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\\\(${pair.desc}\\\\)</span>.`,
        vectors: [vec1, vec2],
        startIndices: [[pair.start1, pair.end1], [pair.start2, pair.end2]],
        sharedOrigin: false,
        offset: [0, 0],
        correct: correctAnswer,
        options: useDegrees ? ['90^\\\\circ', '0^\\\\circ', '180^\\\\circ', '45^\\\\circ'] : ['\\\\pi/2', '0', '\\\\pi', '\\\\pi/4'],
        angleType: 'faceDiagonal'
    };
}

  function generateThreePerpendicularsVectors() {
    const vertices = [
        [0, 0, 0], // A‚ÇÅ (0)
        [1, 0, 0], // D‚ÇÅ (1)
        [1, 1, 0], // D (2)
        [0, 1, 0], // A (3)
        [0, 0, 1], // B‚ÇÅ (4)
        [1, 0, 1], // C‚ÇÅ (5)
        [1, 1, 1], // C (6)
        [0, 1, 1]  // B (7)
    ];

    const perpendicularTriads = [
        { start1: 1, end1: 0, start2: 0, end2: 4, desc: '\\vec{D_1A_1} \\text{ —ñ } \\vec{A_1B_1}' },
        { start1: 5, end1: 2, start2: 3, end2: 2, desc: '\\vec{C_1D} \\text{ —ñ } \\vec{AD}' },
        { start1: 4, end1: 6, start2: 6, end2: 2, desc: '\\vec{B_1C} \\text{ —ñ } \\vec{CD}' },
        { start1: 5, end1: 7, start2: 3, end2: 7, desc: '\\vec{C_1B} \\text{ —ñ } \\vec{AB}' },
        { start1: 3, end1: 4, start2: 4, end2: 5, desc: '\\vec{AB_1} \\text{ —ñ } \\vec{B_1C_1}' },
        { start1: 4, end1: 3, start2: 3, end2: 2, desc: '\\vec{B_1A} \\text{ —ñ } \\vec{AD}' },
        { start1: 0, end1: 7, start2: 7, end2: 6, desc: '\\vec{A_1B} \\text{ —ñ } \\vec{BC}' }
    ];

    const pair = perpendicularTriads[getRandomInt(0, perpendicularTriads.length - 1)];

    // –§–æ—Ä–º—É—î–º–æ –≤–µ–∫—Ç–æ—Ä–∏ –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    const vec1 = [
        vertices[pair.end1][0] - vertices[pair.start1][0],
        vertices[pair.end1][1] - vertices[pair.start1][1],
        vertices[pair.end1][2] - vertices[pair.start1][2]
    ];
    const vec2 = [
        vertices[pair.end2][0] - vertices[pair.start2][0],
        vertices[pair.end2][1] - vertices[pair.start2][1],
        vertices[pair.end2][2] - vertices[pair.start2][2]
    ];

    const correctAnswer = calculateAngleBetweenVectors(vec1, vec2, useDegrees);
    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (—Ç—Ä–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–∏):', { desc: pair.desc, correctAnswer });

    return {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(ABCD A_1B_1C_1D_1\\)</span>. –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${pair.desc}\\)</span>.`,
        vectors: [vec1, vec2],
        startIndices: [[pair.start1, pair.end1], [pair.start2, pair.end2]],
        sharedOrigin: false,
        offset: [0, 0],
        correct: correctAnswer,
        options: useDegrees ? ['90^\\circ', '0^\\circ', '180^\\circ', '45^\\circ'] : ['\\pi/2', '0', '\\pi', '\\pi/4'],
        angleType: 'threePerpendiculars'
    };
}
    function verifyThreePerpendicularsFormatting() {
    const perpendicularTriads = [
        { start1: 1, end1: 0, start2: 0, end2: 4, desc: '\\vec{D_1A_1} \\text{ —ñ } \\vec{A_1B_1}' },
        { start1: 5, end1: 2, start2: 3, end2: 2, desc: '\\vec{C_1D} \\text{ —ñ } \\vec{AD}' },
        { start1: 4, end1: 6, start2: 6, end2: 2, desc: '\\vec{B_1C} \\text{ —ñ } \\vec{CD}' },
        { start1: 5, end1: 7, start2: 3, end2: 7, desc: '\\vec{C_1B} \\text{ —ñ } \\vec{AB}' },
        { start1: 3, end1: 4, start2: 4, end2: 5, desc: '\\vec{AB_1} \\text{ —ñ } \\vec{B_1C_1}' },
        { start1: 4, end1: 3, start2: 3, end2: 2, desc: '\\vec{B_1A} \\text{ —ñ } \\vec{AD}' },
        { start1: 0, end1: 7, start2: 7, end2: 6, desc: '\\vec{A_1B} \\text{ —ñ } \\vec{BC}' }
    ];

    console.log('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è threePerpendiculars:');
    perpendicularTriads.forEach((pair, index) => {
        console.log(`–ü–∞—Ä–∞ ${index + 1}: ${pair.desc}`);
    });
}
  
    
function generate45DegreeVectors(attempt = 0, maxAttempts = 5) {
    if (attempt >= maxAttempts) {
        console.error('–î–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—Ä–æ–± –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è 45¬∞');
        return null;
    }

    const height = 1.111;
    const shortY = 0.8;
    const longY = 1;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ (0)
        [1, 0, 0],               // D‚ÇÅ (1)
        [1, longY, 0],           // D (2)
        [0, longY, 0],           // A (3)
        [0, 0, height * shortZ], // B‚ÇÅ (4)
        [1, 0, height * shortZ], // C‚ÇÅ (5)
        [1, longY, height * shortZ], // C (6)
        [0, longY, height * shortZ]  // B (7)
    ];

    const types = [
        { vec1: [1, longY, 0], start1: 0, end1: 2, vec2: [1, 0, 0], start2: 0, end2: 1, desc: '\\(\\vec{A_1D} \\, \\text{—ñ} \\, \\vec{A_1D_1}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 0, end1: 2, vec2: [1, 0, 0], start2: 7, end2: 6, desc: '\\(\\vec{A_1D} \\, \\text{—ñ} \\, \\vec{BC}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, 0], start1: 0, end1: 3, vec2: [1, longY, 0], start2: 0, end2: 2, desc: '\\(\\vec{A_1A} \\, \\text{—ñ} \\, \\vec{A_1D}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, -longY, 0], start1: 3, end1: 1, vec2: [1, 0, 0], start2: 3, end2: 2, desc: '\\(\\vec{AD_1} \\, \\text{—ñ} \\, \\vec{AD}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 0, end1: 5, vec2: [1, 0, 0], start2: 0, end2: 1, desc: '\\(\\vec{A_1C_1} \\, \\text{—ñ} \\, \\vec{A_1D_1}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 0, end1: 5, vec2: [1, 0, 0], start2: 4, end2: 5, desc: '\\(\\vec{A_1C_1} \\, \\text{—ñ} \\, \\vec{B_1C_1}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [0, 0, height * shortZ], start2: 3, end2: 7, desc: '\\(\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{AB}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 3, end1: 6, vec2: [1, 0, 0], start2: 7, end2: 6, desc: '\\(\\vec{AC} \\, \\text{—ñ} \\, \\vec{BC}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 4, end1: 6, vec2: [-1, 0, 0], start2: 2, end2: 3, desc: '\\(\\vec{B_1C} \\, \\text{—ñ} \\, \\vec{DA}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, -longY, 0], start1: 3, end1: 1, vec2: [0, -longY, 0], start2: 2, end2: 1, desc: '\\(\\vec{AD_1} \\, \\text{—ñ} \\, \\vec{DD_1}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 2, end1: 5, vec2: [0, 0, -height * shortZ], start2: 7, end2: 3, desc: '\\(\\vec{DC_1} \\, \\text{—ñ} \\, \\vec{BA}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -height * shortZ], start1: 4, end1: 1, vec2: [0, 0, -height * shortZ], start2: 5, end2: 1, desc: '\\(\\vec{B_1D_1} \\, \\text{—ñ} \\, \\vec{C_1D_1}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, height * shortZ], start1: 0, end1: 4, vec2: [1, 0, -height * shortZ], start2: 4, end2: 1, desc: '\\(\\vec{A_1B_1} \\, \\text{—ñ} \\, \\vec{B_1D_1}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [0, 0, -height * shortZ], start2: 6, end2: 2, desc: '\\(\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{CD}\\)', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -height * shortZ], start1: 7, end1: 3, vec2: [1, 0, 0], start2: 3, end2: 2, desc: '\\(\\vec{BA} \\, \\text{—ñ} \\, \\vec{AD}\\)', sharedOrigin: true, offset: [0, 0] },
        { vec1: [0, longY, -height * shortZ], start1: 4, end1: 3, vec2: [1, longY, 0], start2: 0, end2: 2, desc: '\\(\\vec{B_1A} \\, \\text{—ñ} \\, \\vec{A_1D}\\)', sharedOrigin: false, offset: [0, 0] }
    ];

    const type = types[getRandomInt(0, types.length - 1)];
    const correctAnswer = calculateAngleBetweenVectors(type.vec1, type.vec2, useDegrees);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –∫—É—Ç–∞
    if (correctAnswer !== (useDegrees ? '45^\\circ' : '\\pi/4')) {
        console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫—É—Ç –¥–ª—è 45¬∞:', { attempt: attempt + 1, correctAnswer, vec1: type.vec1, vec2: type.vec2, desc: type.desc });
        return generate45DegreeVectors(attempt + 1, maxAttempts); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è
    }

    const questionData = {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(A \\, BCD \\, A_1 B_1 C_1 D_1\\)</span>. 
        –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">${type.desc}</span>.`,
        vectors: [type.vec1, type.vec2],
        startIndices: [[type.start1, type.end1], [type.start2, type.end2]],
        sharedOrigin: type.sharedOrigin,
        offset: type.offset,
        correct: correctAnswer,
        options: useDegrees ? ['45^\\circ', '90^\\circ', '0^\\circ', '60^\\circ'] : ['\\pi/4', '\\pi/2', '0', '\\pi/3'],
        angleType: '45degrees'
    };

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
    if (!questionData.vectors || !questionData.vectors[0] || !questionData.vectors[1] ||
        !questionData.startIndices || !questionData.startIndices[0] || !questionData.startIndices[1] ||
        !questionData.correct || !questionData.options || questionData.options.length === 0) {
        console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ:', { attempt: attempt + 1, questionData });
        return generate45DegreeVectors(attempt + 1, maxAttempts); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è
    }

    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (45¬∞):', { desc: type.desc, correctAnswer, questionData });

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è usedCombinations)
    if (usedCombinations && usedCombinations.has(type.desc)) {
        console.log('–ü–∞—Ä–∞ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞, –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤—É:', type.desc);
        return generate45DegreeVectors(attempt + 1, maxAttempts);
    }
    if (usedCombinations) {
        usedCombinations.add(type.desc);
    }

    return questionData;
}

  function generate60DegreeVectors() {
    const height = 1.111;
    const shortY = 0.8;
    const longY = 1;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ (0)
        [1, 0, 0],               // D‚ÇÅ (1)
        [1, longY, 0],           // D (2)
        [0, longY, 0],           // A (3)
        [0, 0, height * shortZ], // B‚ÇÅ (4)
        [1, 0, height * shortZ], // C‚ÇÅ (5)
        [1, longY, height * shortZ], // C (6)
        [0, longY, height * shortZ]  // B (7)
    ];

    const types = [
        { vec1: [1, -longY, 0], start1: 3, end1: 1, vec2: [0, -longY, -height * shortZ], start2: 6, end2: 1, desc: '\\vec{AD_1} \\, \\text{—ñ} \\, \\vec{CD_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 2, end1: 5, vec2: [-1, 0, -height * shortZ], start2: 5, end2: 0, desc: '\\vec{DC_1} \\, \\text{—ñ} \\, \\vec{C_1A_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [1, 0, -height * shortZ], start2: 4, end2: 1, desc: '\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{B_1D_1}', sharedOrigin: true, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [1, -longY, 0], start2: 3, end2: 1, desc: '\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{AD_1}', sharedOrigin: true, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [1, 0, height * shortZ], start2: 3, end2: 6, desc: '\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{AC}', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 4, end1: 5, vec2: [0, longY, -height * shortZ], start2: 5, end2: 2, desc: '\\vec{BC_1} \\, \\text{—ñ} \\, \\vec{C_1D}', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, 0, -height * shortZ], start1: 7, end1: 2, vec2: [0, longY, -height * shortZ], start2: 5, end2: 2, desc: '\\vec{BD} \\, \\text{—ñ} \\, \\vec{C_1D}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 4, end1: 5, vec2: [1, 0, -height * shortZ], start2: 7, end2: 2, desc: '\\vec{BC_1} \\, \\text{—ñ} \\, \\vec{BD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 4, end1: 6, vec2: [0, longY, -height * shortZ], start2: 4, end2: 3, desc: '\\vec{B_1C} \\, \\text{—ñ} \\, \\vec{B_1A}', sharedOrigin: true, offset: [0, 0] },
        { vec1: [1, longY, 0], start1: 4, end1: 6, vec2: [0, longY, -height * shortZ], start2: 5, end2: 2, desc: '\\vec{B_1C} \\, \\text{—ñ} \\, \\vec{C_1D}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, longY, -height * shortZ], start1: 4, end1: 3, vec2: [1, longY, 0], start2: 0, end2: 2, desc: '\\vec{BA_1} \\, \\text{—ñ} \\, \\vec{A_1D}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 0, end1: 5, vec2: [0, -longY, height * shortZ], start2: 3, end2: 4, desc: '\\vec{A_1C_1} \\, \\text{—ñ} \\, \\vec{AB_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -height * shortZ], start1: 7, end1: 2, vec2: [1, longY, 0], start2: 4, end2: 6, desc: '\\vec{BD} \\, \\text{—ñ} \\, \\vec{B_1C}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, height * shortZ], start1: 3, end1: 6, vec2: [0, -longY, height * shortZ], start2: 2, end2: 5, desc: '\\vec{AC} \\, \\text{—ñ} \\, \\vec{DC_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -longY, height * shortZ], start1: 3, end1: 4, vec2: [1, 0, height * shortZ], start2: 0, end2: 5, desc: '\\vec{AB_1} \\, \\text{—ñ} \\, \\vec{A_1C_1}', sharedOrigin: false, offset: [0, 0] }
    ];

    const type = types[getRandomInt(0, types.length - 1)];
    const correctAnswer = calculateAngleBetweenVectors(type.vec1, type.vec2, useDegrees);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –∫—É—Ç–∞
    if (correctAnswer !== (useDegrees ? '60^\\circ' : '\\pi/3')) {
        console.error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫—É—Ç –¥–ª—è 60¬∞:', { correctAnswer, vec1: type.vec1, vec2: type.vec2, desc: type.desc });
        return generate60DegreeVectors(); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è
    }

    const questionData = {
        type: 'options',
        question: `–î–∞–Ω–æ –∫—É–± <span class="cube-formula">\\(A \\, BCD \\, A_1 B_1 C_1 D_1\\)</span>. 
        –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${type.desc}\\)</span>.`,
        vectors: [type.vec1, type.vec2],
        startIndices: [[type.start1, type.end1], [type.start2, type.end2]],
        sharedOrigin: type.sharedOrigin,
        offset: type.offset,
        correct: correctAnswer,
        options: useDegrees ? ['60^\\circ', '90^\\circ', '45^\\circ', '0^\\circ'] : ['\\pi/3', '\\pi/2', '\\pi/4', '0'],
        angleType: '60degrees'
    };

    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞ (60¬∞):', { desc: type.desc, correctAnswer, questionData });
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
    if (!questionData.vectors || !questionData.vectors[0] || !questionData.vectors[1] ||
        !questionData.startIndices || !questionData.startIndices[0] || !questionData.startIndices[1] ||
        !questionData.correct || !questionData.options || questionData.options.length === 0) {
        console.error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ:', questionData);
        return generate60DegreeVectors(); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è
    }

    return questionData;
}

function verifyVectorFormatting() {
    const typesSame = [
        { vec1: [0, 0, 1.111 * 0.9], start1: 0, end1: 4, vec2: [0, 0, 1.111 * 0.9], start2: 3, end2: 7, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{AB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 0, end1: 1, vec2: [1, 0, 0], start2: 7, end2: 6, desc: '\\vec{A_1D_1} \\text{ —ñ } \\vec{BC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -1, 0], start1: 6, end1: 5, vec2: [0, -1, 0], start2: 2, end2: 1, desc: '\\vec{CC_1} \\text{ —ñ } \\vec{DD_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, 1.111 * 0.9], start1: 3, end1: 7, vec2: [0, 0, 1.111 * 0.9], start2: 2, end2: 6, desc: '\\vec{AB} \\text{ —ñ } \\vec{DC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -1.111 * 0.9], start1: 6, end1: 2, vec2: [0, 0, -1.111 * 0.9], start2: 5, end2: 1, desc: '\\vec{CD} \\text{ —ñ } \\vec{C_1D_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 1, 0], start1: 0, end1: 2, vec2: [1, 1, 0], start2: 4, end2: 6, desc: '\\vec{A_1D} \\text{ —ñ } \\vec{B_1C}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 1.111 * 0.9], start1: 0, end1: 5, vec2: [1, 0, 1.111 * 0.9], start2: 3, end2: 6, desc: '\\vec{A_1C_1} \\text{ —ñ } \\vec{AC}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, 1.111 * 0.9], start1: 1, end1: 4, vec2: [-1, 0, 1.111 * 0.9], start2: 2, end2: 7, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{DB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -1.111 * 0.9], start1: 7, end1: 2, vec2: [1, 0, -1.111 * 0.9], start2: 4, end2: 1, desc: '\\vec{BD} \\text{ —ñ } \\vec{B_1D_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, 1.111 * 0.9], start1: 1, end1: 4, vec2: [-1, 0, 1.111 * 0.9], start2: 2, end2: 7, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{DB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 1, 0], start1: 4, end1: 7, vec2: [0, 1, 0], start2: 0, end2: 3, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{A_1A}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -1, 0], start1: 7, end1: 4, vec2: [0, -1, 0], start2: 3, end2: 0, desc: '\\vec{BB_1} \\text{ —ñ } \\vec{AA_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 1, -1.111 * 0.9], start1: 5, end1: 2, vec2: [0, 1, -1.111 * 0.9], start2: 4, end2: 3, desc: '\\vec{C_1D} \\text{ —ñ } \\vec{B_1A}', sharedOrigin: false, offset: [0, 0] }
    ];

    const typesOpposite = [
        { vec1: [0, 0, 1.111 * 0.9], start1: 0, end1: 4, vec2: [0, 0, -1.111 * 0.9], start2: 6, end2: 2, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, 1.111 * 0.9], start1: 0, end1: 4, vec2: [0, 0, -1.111 * 0.9], start2: 7, end2: 3, desc: '\\vec{A_1B_1} \\text{ —ñ } \\vec{BA}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 0], start1: 0, end1: 1, vec2: [-1, 0, 0], start2: 6, end2: 7, desc: '\\vec{A_1D_1} \\text{ —ñ } \\vec{CB}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -1, 0], start1: 6, end1: 5, vec2: [0, 1, 0], start2: 1, end2: 2, desc: '\\vec{CC_1} \\text{ —ñ } \\vec{D_1D}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, 1.111 * 0.9], start1: 3, end1: 7, vec2: [0, 0, -1.111 * 0.9], start2: 6, end2: 2, desc: '\\vec{AB} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -1.111 * 0.9], start1: 2, end1: 5, vec2: [0, 0, 1.111 * 0.9], start2: 0, end2: 4, desc: '\\vec{DC} \\text{ —ñ } \\vec{A_1B_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, -1.111 * 0.9], start1: 6, end1: 2, vec2: [0, 0, 1.111 * 0.9], start2: 1, end2: 5, desc: '\\vec{CD} \\text{ —ñ } \\vec{D_1C_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 1, 0], start1: 0, end1: 2, vec2: [-1, -1, 0], start2: 6, end2: 4, desc: '\\vec{A_1D} \\text{ —ñ } \\vec{CB_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, 1.111 * 0.9], start1: 0, end1: 5, vec2: [-1, 0, -1.111 * 0.9], start2: 3, end2: 6, desc: '\\vec{A_1C_1} \\text{ —ñ } \\vec{CA}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [1, 0, -1.111 * 0.9], start1: 7, end1: 2, vec2: [1, 0, 1.111 * 0.9], start2: 1, end2: 5, desc: '\\vec{DB} \\text{ —ñ } \\vec{D_1C_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [-1, 0, 1.111 * 0.9], start1: 1, end1: 4, vec2: [1, 0, -1.111 * 0.9], start2: 7, end2: 2, desc: '\\vec{D_1B_1} \\text{ —ñ } \\vec{BD}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 1, 0], start1: 4, end1: 7, vec2: [0, -1, 0], start2: 3, end2: 0, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{AA_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 1, 0], start1: 4, end1: 7, vec2: [0, -1, 0], start2: 2, end2: 1, desc: '\\vec{B_1B} \\text{ —ñ } \\vec{DD_1}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, -1, 0], start1: 3, end1: 0, vec2: [0, 1, 0], start2: 5, end2: 6, desc: '\\vec{AA_1} \\text{ —ñ } \\vec{C_1C}', sharedOrigin: false, offset: [0, 0] },
        { vec1: [0, 0, 1.111 * 0.9], start1: 1, end1: 5, vec2: [0, 0, -1.111 * 0.9], start2: 6, end2: 2, desc: '\\vec{D_1C_1} \\text{ —ñ } \\vec{CD}', sharedOrigin: false, offset: [0, 0] }
    ];

    console.log('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è parallelSame:');
    typesSame.forEach((type, index) => {
        console.log(`–ü–∞—Ä–∞ ${index + 1}: ${type.desc}`);
    });

    console.log('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è parallelOpposite:');
    typesOpposite.forEach((type, index) => {
        console.log(`–ü–∞—Ä–∞ ${index + 1}: ${type.desc}`);
    });
}

    

   function drawCube(ctx, canvasWidth, canvasHeight) {
    if (!ctx) return;

    const height = 1.5;
    const shortY = 0.8;
    const longY = 0.88;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ
        [1, 0, 0],               // D‚ÇÅ
        [1, longY, 0],           // D
        [0, longY, 0],           // A
        [0, 0, height * shortZ], // B‚ÇÅ
        [1, 0, height * shortZ], // C‚ÇÅ
        [1, longY, height * shortZ], // C
        [0, longY, height * shortZ]  // B
    ];

    const scale = 100;
    const offsetX = canvasWidth / 2 - 50;
    const offsetY = canvasHeight / 2 - 30;
    const angle = Math.PI / 4;
    const k = 0.5;

    const projected = vertices.map(([x, y, z]) => {
        const px = x + k * z * Math.cos(angle);
        const py = y - k * z * Math.sin(angle);
        return [px * scale + offsetX, py * scale + offsetY];
    });

    // –†–µ–±—Ä–∞
    const dashedEdges = [
        [3,7], // AB
        [7,6], // BC
        [7,4]  // BB‚ÇÅ
    ];

    const solidEdges = [
        [0,1],[1,2],[2,3],[0,3], // –Ω–∏–∂–Ω—è
        [4,5],[5,6],[6,7],[4,7], // –≤–µ—Ä—Ö–Ω—è
        [0,4],[1,5],[2,6],[3,7]  // –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
    ].filter(edge => !dashedEdges.some(d => (d[0]===edge[0] && d[1]===edge[1]) || (d[0]===edge[1] && d[1]===edge[0])));

    // –ú–∞–ª—é–≤–∞–Ω–Ω—è —à—Ç—Ä–∏—Ö–ø—É–Ω–∫—Ç–∏—Ä–Ω–∏—Ö
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 1;
    ctx.setLineDash([5,5]);
    dashedEdges.forEach(([i,j])=>{
        ctx.beginPath();
        ctx.moveTo(...projected[i]);
        ctx.lineTo(...projected[j]);
        ctx.stroke();
    });

    // –ú–∞–ª—é–≤–∞–Ω–Ω—è —Å—É—Ü—ñ–ª—å–Ω–∏—Ö
    ctx.setLineDash([]);
    solidEdges.forEach(([i,j])=>{
        ctx.beginPath();
        ctx.moveTo(...projected[i]);
        ctx.lineTo(...projected[j]);
        ctx.stroke();
    });

    const labels = ['A‚ÇÅ','D‚ÇÅ','D','A','B‚ÇÅ','C‚ÇÅ','C','B'];

    // –ó—Å—É–≤–∏ –ø—ñ–¥–ø–∏—Å—ñ–≤
    const labelOffsets = [
        [-17, 0],  // A‚ÇÅ –ª—ñ–≤—ñ—à–µ
        [10, 2],   // D‚ÇÅ –ø—Ä–∞–≤—ñ—à–µ
        [8, 10],   // D –ø—Ä–∞–≤—ñ—à–µ —ñ —Ç—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ
        [-15, 10], // A –ª—ñ–≤—ñ—à–µ —ñ –Ω–∏–∂—á–µ
        [-15, -2], // B‚ÇÅ –ª—ñ–≤—ñ—à–µ
        [5, -2],   // C‚ÇÅ –ø—Ä–∞–≤—ñ—à–µ
        [5, -2],   // C –ø—Ä–∞–≤—ñ—à–µ
        [-13, -2]  // B —Ç—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ
    ];

    ctx.fillStyle = "yellow";
    ctx.font = "14px Arial";
    projected.forEach(([x, y], i) => {
        const [dx, dy] = labelOffsets[i];
        ctx.fillText(labels[i], x + dx, y + dy);
    });
}
    
 function drawCube(ctx, canvasWidth, canvasHeight) {
    if (!ctx) return;

    const height = 1.5;
    const shortY = 0.8;
    const longY = 0.88;
    const shortZ = 0.9;

    const vertices = [
        [0, 0, 0],               // A‚ÇÅ
        [1, 0, 0],               // D‚ÇÅ
        [1, longY, 0],           // D
        [0, longY, 0],           // A
        [0, 0, height * shortZ], // B‚ÇÅ
        [1, 0, height * shortZ], // C‚ÇÅ
        [1, longY, height * shortZ], // C
        [0, longY, height * shortZ]  // B
    ];

    const scale = 100;
    const offsetX = canvasWidth / 2 - 50;
    const offsetY = canvasHeight / 2 - 30;
    const angle = Math.PI / 4;
    const k = 0.5;

    const projected = vertices.map(([x, y, z]) => {
        const px = x + k * z * Math.cos(angle);
        const py = y - k * z * Math.sin(angle);
        return [px * scale + offsetX, py * scale + offsetY];
    });

    // –†–µ–±—Ä–∞
    const dashedEdges = [
        [3,7], // AB
        [7,6], // BC
        [7,4]  // BB‚ÇÅ
    ];

    const solidEdges = [
        [0,1],[1,2],[2,3],[0,3], // –Ω–∏–∂–Ω—è
        [4,5],[5,6],[6,7],[4,7], // –≤–µ—Ä—Ö–Ω—è
        [0,4],[1,5],[2,6],[3,7]  // –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
    ].filter(edge => !dashedEdges.some(d => (d[0]===edge[0] && d[1]===edge[1]) || (d[0]===edge[1] && d[1]===edge[0])));

    // –ú–∞–ª—é–≤–∞–Ω–Ω—è —à—Ç—Ä–∏—Ö–ø—É–Ω–∫—Ç–∏—Ä–Ω–∏—Ö
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 1;
    ctx.setLineDash([5,5]);
    dashedEdges.forEach(([i,j])=>{
        ctx.beginPath();
        ctx.moveTo(...projected[i]);
        ctx.lineTo(...projected[j]);
        ctx.stroke();
    });

    // –ú–∞–ª—é–≤–∞–Ω–Ω—è —Å—É—Ü—ñ–ª—å–Ω–∏—Ö
    ctx.setLineDash([]);
    solidEdges.forEach(([i,j])=>{
        ctx.beginPath();
        ctx.moveTo(...projected[i]);
        ctx.lineTo(...projected[j]);
        ctx.stroke();
    });

    const labels = ['A‚ÇÅ','D‚ÇÅ','D','A','B‚ÇÅ','C‚ÇÅ','C','B'];

    // –ó—Å—É–≤–∏ –ø—ñ–¥–ø–∏—Å—ñ–≤
    const labelOffsets = [
        [-17, 0],  // A‚ÇÅ –ª—ñ–≤—ñ—à–µ
        [10, 2],   // D‚ÇÅ –ø—Ä–∞–≤—ñ—à–µ
        [8, 10],   // D –ø—Ä–∞–≤—ñ—à–µ —ñ —Ç—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ
        [-15, 10], // A –ª—ñ–≤—ñ—à–µ —ñ –Ω–∏–∂—á–µ
        [-15, -2], // B‚ÇÅ –ª—ñ–≤—ñ—à–µ
        [5, -2],   // C‚ÇÅ –ø—Ä–∞–≤—ñ—à–µ
        [5, -2],   // C –ø—Ä–∞–≤—ñ—à–µ
        [-13, -2]  // B —Ç—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ
    ];

    ctx.fillStyle = "yellow";
    ctx.font = "14px Arial";
    projected.forEach(([x, y], i) => {
        const [dx, dy] = labelOffsets[i];
        ctx.fillText(labels[i], x + dx, y + dy);
    });
}

function generateTetrahedronQuestion(useDegrees = true) {
    const edgeLength = 1; // –ë–∞–∑–æ–≤–∞ –¥–æ–≤–∂–∏–Ω–∞ —Ä–µ–±—Ä–∞

    // –í–µ—Ä—à–∏–Ω–∏ —Ç–µ—Ç—Ä–∞–µ–¥—Ä–∞: –æ—Å–Ω–æ–≤–∞ ABC —É–≥–æ—Ä—ñ, –≤–µ—Ä—à–∏–Ω–∞ D –≤–∏—â–µ –æ—Å–Ω–æ–≤–∏
    const vertices = [
        [0, 0, 0], // A (0)
        [edgeLength * 1, 0, edgeLength * Math.sqrt(2 / 3)], // B (1)
        [edgeLength * 0.9 / 2, edgeLength * 0.9 * Math.sqrt(3) / 2, edgeLength * Math.sqrt(2 / 3) * 1.5], // C (2)
        [-edgeLength * 0.5, edgeLength * 0.9 * Math.sqrt(3) / 6, edgeLength * Math.sqrt(2 / 3) * 4] // D (3)
    ];

    // –î–æ–¥–∞—î–º–æ —Ç–æ—á–∫–∏ K (—Å–µ—Ä–µ–¥–∏–Ω–∞ AC) —ñ M (—Å–µ—Ä–µ–¥–∏–Ω–∞ BC)
    const k = [
        (vertices[0][0] + vertices[2][0]) / 2,
        (vertices[0][1] + vertices[2][1]) / 2,
        (vertices[0][2] + vertices[2][2]) / 2
    ];
    const m = [
        (vertices[1][0] + vertices[2][0]) / 2,
        (vertices[1][1] + vertices[2][1]) / 2,
        (vertices[1][2] + vertices[2][2]) / 2
    ];
    vertices.push(k, m); // –¥–æ–¥–∞—î–º–æ K (4), M (5)

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // –í–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –ø–∞—Ä–∏ –≤–µ–∫—Ç–æ—Ä—ñ–≤: start‚Üíend –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –æ–ø–∏—Å—É
   const edgePairs = [
    // 60¬∞
    { start1: 3, end1: 0, start2: 3, end2: 1, desc: '\\vec{DA} \\text{ —ñ } \\vec{DB}' }, // DA (D‚ÜíA), DB (D‚ÜíB)
    { start1: 0, end1: 3, start2: 0, end2: 2, desc: '\\vec{AD} \\text{ —ñ } \\vec{AC}' }, // AD (A‚ÜíD), AC (A‚ÜíC)
    { start1: 1, end1: 3, start2: 1, end2: 2, desc: '\\vec{BD} \\text{ —ñ } \\vec{BC}' }, // BD (B‚ÜíD), BC (B‚ÜíC)
    { start1: 1, end1: 3, start2: 1, end2: 0, desc: '\\vec{BD} \\text{ —ñ } \\vec{BA}' }, // BD (B‚ÜíD), BA (B‚ÜíA)
    { start1: 2, end1: 0, start2: 2, end2: 1, desc: '\\vec{CA} \\text{ —ñ } \\vec{CB}' }, // CA (C‚ÜíA), CB (C‚ÜíB)
    { start1: 0, end1: 1, start2: 0, end2: 2, desc: '\\vec{AB} \\text{ —ñ } \\vec{AC}' }, // AB (A‚ÜíB), AC (A‚ÜíC)
    { start1: 1, end1: 2, start2: 1, end2: 0, desc: '\\vec{BC} \\text{ —ñ } \\vec{BA}' }, // BC (B‚ÜíC), BA (B‚ÜíA)
    { start1: 2, end1: 3, start2: 3, end2: 0, desc: '\\vec{CD} \\text{ —ñ } \\vec{DA}' }, // CD (C‚ÜíD), DA (D‚ÜíA)
    { start1: 3, end1: 2, start2: 3, end2: 1, desc: '\\vec{DC} \\text{ —ñ } \\vec{DB}' }, // DC (D‚ÜíC), DB (D‚ÜíB)
    { start1: 3, end1: 0, start2: 2, end2: 3, desc: '\\vec{DA} \\text{ —ñ } \\vec{CD}' }, // DA (D‚ÜíA), CD (C‚ÜíD)
    { start1: 1, end1: 3, start2: 1, end2: 5, desc: '\\vec{BD} \\text{ —ñ } \\vec{BM}' }, // BD (B‚ÜíD), BM (B‚ÜíM)
    { start1: 2, end1: 3, start2: 2, end2: 5, desc: '\\vec{CD} \\text{ —ñ } \\vec{CM}' }, // CD (C‚ÜíD), CM (C‚ÜíM)
    { start1: 4, end1: 3, start2: 4, end2: 0, desc: '\\vec{KD} \\text{ —ñ } \\vec{KA}' }, // KD (K‚ÜíD), KA (K‚ÜíA)
    { start1: 4, end1: 3, start2: 4, end2: 2, desc: '\\vec{KD} \\text{ —ñ } \\vec{KC}' }, // KD (K‚ÜíD), KC (K‚ÜíC)

    // 30¬∞
    { start1: 3, end1: 4, start2: 2, end2: 3, desc: '\\vec{DK} \\text{ —ñ } \\vec{CD}' }, // DK (D‚ÜíK), CD (C‚ÜíD)
    { start1: 3, end1: 4, start2: 3, end2: 0, desc: '\\vec{DK} \\text{ —ñ } \\vec{DA}' }, // DK (D‚ÜíK), DA (D‚ÜíA)
    { start1: 3, end1: 5, start2: 2, end2: 3, desc: '\\vec{DM} \\text{ —ñ } \\vec{CD}' }, // DM (D‚ÜíM), CD (C‚ÜíD)
    { start1: 3, end1: 5, start2: 3, end2: 1, desc: '\\vec{DM} \\text{ —ñ } \\vec{DB}' }, // DM (D‚ÜíM), DB (D‚ÜíB)

    // 90¬∞
    { start1: 5, end1: 3, start2: 5, end2: 1, desc: '\\vec{MD} \\text{ —ñ } \\vec{MB}' }, // MD (M‚ÜíD), MB (M‚ÜíB)
    { start1: 5, end1: 3, start2: 5, end2: 2, desc: '\\vec{MD} \\text{ —ñ } \\vec{MC}' }, // MD (M‚ÜíD), MC (M‚ÜíC)
    { start1: 4, end1: 3, start2: 4, end2: 2, desc: '\\vec{KD} \\text{ —ñ } \\vec{KC}' }, // KD (K‚ÜíD), KC (K‚ÜíC)
    { start1: 4, end1: 3, start2: 4, end2: 0, desc: '\\vec{KD} \\text{ —ñ } \\vec{KA}' }  // KD (K‚ÜíD), KA (K‚ÜíA)
];


    const pair = edgePairs[getRandomInt(0, edgePairs.length - 1)];

    // –í–µ–∫—Ç–æ—Ä–∏
    const vec1 = [
        vertices[pair.end1][0] - vertices[pair.start1][0],
        vertices[pair.end1][1] - vertices[pair.start1][1],
        vertices[pair.end1][2] - vertices[pair.start1][2]
    ];
    const vec2 = [
        vertices[pair.end2][0] - vertices[pair.start2][0],
        vertices[pair.end2][1] - vertices[pair.start2][1],
        vertices[pair.end2][2] - vertices[pair.start2][2]
    ];

    function calculateAngleBetweenVectors(v1, v2, inDegrees = true) {
        if ([
            '\\vec{DK} \\text{ —ñ } \\vec{DC}', '\\vec{DK} \\text{ —ñ } \\vec{DA}',
            '\\vec{DM} \\text{ —ñ } \\vec{DC}', '\\vec{DM} \\text{ —ñ } \\vec{DB}'
        ].includes(pair.desc)) {
            return inDegrees ? '30^\\circ' : '\\pi/6';
        } else if ([
            '\\vec{MD} \\text{ —ñ } \\vec{MB}', '\\vec{MD} \\text{ —ñ } \\vec{MC}',
            '\\vec{KD} \\text{ —ñ } \\vec{KC}', '\\vec{KD} \\text{ —ñ } \\vec{KA}'
        ].includes(pair.desc)) {
            return inDegrees ? '90^\\circ' : '\\pi/2';
        } else {
            return inDegrees ? '60^\\circ' : '\\pi/3';
        }
    }

    const correctAnswer = calculateAngleBetweenVectors(vec1, vec2, useDegrees);

    const centerX = (Math.max(...vertices.map(v => v[0])) + Math.min(...vertices.map(v => v[0]))) / 2;
    const centerY = (Math.max(...vertices.map(v => v[1])) + Math.min(...vertices.map(v => v[1]))) / 2;
    const centerZ = (Math.max(...vertices.map(v => v[2])) + Math.min(...vertices.map(v => v[2]))) / 2;
    const offset = [-centerX - 20, -centerY + 50];

    return {
        type: 'options',
        question: `–î–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ç–µ—Ç—Ä–∞–µ–¥—Ä <span class="cube-formula">\\(ABCD\\)</span>. –¢–æ—á–∫–∏ <span class="cube-formula">\\(K\\)</span> —ñ <span class="cube-formula">\\(M\\)</span>
        —î —Å–µ—Ä–µ–¥–∏–Ω–∞–º–∏ —Å—Ç–æ—Ä—ñ–Ω <span class="cube-formula">\\(AC\\)</span> —ñ <span class="cube-formula">\\(BC\\)</span>.
        –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—É—Ç –º—ñ–∂ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ <span class="vector-formula">\\(${pair.desc}\\)</span>.`,
        vectors: [vec1, vec2],
        startIndices: [[pair.start1, pair.end1], [pair.start2, pair.end2]],
        sharedOrigin: pair.start1 === pair.start2,
        offset: offset,
        correct: correctAnswer,
        options: useDegrees ? ['30^\\circ', '60^\\circ', '90^\\circ', '45^\\circ'] : ['\\pi/6', '\\pi/3', '\\pi/2', '\\pi/4'],
        angleType: 'tetrahedron',
        vertices: vertices
    };
}

const drawVectors = (vectors, startIndices, sharedOrigin, offset = [0, 0], vertices, ctx = elements.vectorCanvas.getContext('2d')) => {
    if (!ctx) {
        console.error('–ö–æ–Ω—Ç–µ–∫—Å—Ç canvas –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π —É drawVectors');
        return;
    }
    console.log('–ü–æ—á–∏–Ω–∞—î–º–æ –º–∞–ª—é–≤–∞—Ç–∏ –≤–µ–∫—Ç–æ—Ä–∏:', { vectors, startIndices, sharedOrigin, offset, vertices });

    // –û—á–∏—â–∞—î–º–æ canvas
    ctx.clearRect(0, 0, elements.vectorCanvas.width, elements.vectorCanvas.height);

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è —ñ–∑–æ–º–µ—Ç—Ä–∏—á–Ω–æ—ó –ø—Ä–æ—î–∫—Ü—ñ—ó
    const scale = 100;
    const offsetX = elements.vectorCanvas.width / 2 - 50 + offset[0];
    const offsetY = elements.vectorCanvas.height / 2 - 30 + offset[1];
    const angle = Math.PI / 4;
    const k = 0.5;

    // –í–∏–±–∏—Ä–∞—î–º–æ –≤–µ—Ä—à–∏–Ω–∏
    const isTetrahedron = questions[currentQuestionIndex]?.angleType === 'tetrahedron';
    const selectedVertices = isTetrahedron ? vertices : [
        [0, 0, 0], [1, 0, 0], [1, 0.88, 0], [0, 0.88, 0],
        [0, 0, 1.5 * 0.9], [1, 0, 1.5 * 0.9], [1, 0.88, 1.5 * 0.9], [0, 0.88, 1.5 * 0.9]
    ];
    console.log('Selected vertices:', selectedVertices);

    // –ü—Ä–æ—î–∫—Ç—É—î–º–æ –≤–µ—Ä—à–∏–Ω–∏
    const projected = selectedVertices.map(([x, y, z], i) => {
        if (!Number.isFinite(x) || !Number.isFinite(y) || !Number.isFinite(z)) {
            console.error(`–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–µ—Ä—à–∏–Ω–∏ ${i}: [${x}, ${y}, ${z}]`);
            return [0, 0];
        }
        const px = x + k * z * Math.cos(angle);
        const py = y - k * z * Math.sin(angle);
        return [px * scale + offsetX, py * scale + offsetY];
    });
    console.log('Projected vertices length:', projected.length, 'Projected vertices:', projected);

    // –ú–∞–ª—é—î–º–æ —Ñ—ñ–≥—É—Ä—É
    if (isTetrahedron) {
        const edges = [
            [0, 1], [0, 2], [1, 2], [0, 3], [1, 3], [2, 3], // AB, AC, BC, AD, BD, CD
            [0, 4], [2, 4], // AK, CK
            [1, 5], [2, 5]  // BM, CM
        ];
        const dashedEdges = [[0, 1]]; // –¢—ñ–ª—å–∫–∏ AB —è–∫ –ø—É–Ω–∫—Ç–∏—Ä

        // –ú–∞–ª—é—î–º–æ –ø—É–Ω–∫—Ç–∏—Ä–Ω—ñ —Ä–µ–±—Ä–∞
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]);
        dashedEdges.forEach(([i, j]) => {
            if (i < projected.length && j < projected.length) {
                ctx.beginPath();
                ctx.moveTo(...projected[i]);
                ctx.lineTo(...projected[j]);
                ctx.stroke();
            }
        });

        // –ú–∞–ª—é—î–º–æ —Å—É—Ü—ñ–ª—å–Ω—ñ —Ä–µ–±—Ä–∞
        ctx.setLineDash([]);
        edges.forEach(([i, j]) => {
            if (!dashedEdges.some(([di, dj]) => (di === i && dj === j) || (di === j && dj === i))) {
                if (i < projected.length && j < projected.length) {
                    ctx.beginPath();
                    ctx.moveTo(...projected[i]);
                    ctx.lineTo(...projected[j]);
                    ctx.stroke();
                }
            }
        });

        // –ú—ñ—Ç–∫–∏ –≤–µ—Ä—à–∏–Ω –¥–ª—è —Ç–µ—Ç—Ä–∞–µ–¥—Ä–∞ (A, B, C —É–≥–æ—Ä—ñ, D –Ω–∏–∂—á–µ, K —ñ M)
        const labels = ['A', 'B', 'C', 'D', 'K', 'M'];
        const labelOffsets = [
            [-10, -10], [0, -10], [5, 15], [-20, 0], [-10, 15], [5, 12]
        ];
        ctx.fillStyle = 'yellow';
        ctx.font = '14px Arial';
        projected.forEach(([x, y], i) => {
            if (i < labels.length) {
                const [dx, dy] = labelOffsets[i];
                ctx.fillText(labels[i], x + dx, y + dy);
            }
        });
    } else {
        drawCube(ctx, elements.vectorCanvas.width, elements.vectorCanvas.height);
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–∞
   const drawVector = (startIdx, endIdx, color, offset = [0, 0]) => {
    console.log(`–ú–∞–ª—é—î–º–æ –≤–µ–∫—Ç–æ—Ä: startIdx=${startIdx}, endIdx=${endIdx}, color=${color}, offset=${offset}, projected.length=${projected.length}`);
    if (startIdx < 0 || startIdx >= projected.length || endIdx < 0 || endIdx >= projected.length) {
        console.error(`–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏: startIdx=${startIdx}, endIdx=${endIdx}, projected.length=${projected.length}`);
        return null;
    }
    const start = sharedOrigin ? projected[startIdx] : [projected[startIdx][0] + offset[0] * scale, projected[startIdx][1] + offset[1] * scale];
    const end = sharedOrigin ? projected[endIdx] : [projected[endIdx][0] + offset[0] * scale, projected[endIdx][1] + offset[1] * scale];
    ctx.beginPath();
    ctx.moveTo(start[0], start[1]);
    ctx.lineTo(end[0], end[1]);
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();
    if (typeof drawArrowHead === 'function') {
        drawArrowHead(ctx, start, end, color);
    } else {
        console.warn('–§—É–Ω–∫—Ü—ñ—è drawArrowHead –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–∞');
    }
    return { start, end };
};
    // –ú–∞–ª—é—î–º–æ –≤–µ–∫—Ç–æ—Ä–∏
    if (startIndices && startIndices.length >= 2 && vectors && vectors.length >= 2) {
        console.log('–î–∞–Ω—ñ –¥–ª—è –≤–µ–∫—Ç–æ—Ä—ñ–≤:', { startIndices, sharedOrigin, offset, projectedLength: projected.length });
       const redVector = drawVector(startIndices[0][0], startIndices[0][1], 'red', [0, 0]);
const greenVector = drawVector(startIndices[1][0], startIndices[1][1], 'green', [0, 0]);
        if (!redVector || !greenVector) {
            console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–º–∞–ª—é–≤–∞—Ç–∏ –æ–¥–∏–Ω —ñ–∑ –≤–µ–∫—Ç–æ—Ä—ñ–≤:', { redVector, greenVector, startIndices, projectedLength: projected.length });
        } else {
            console.log('–í–µ–∫—Ç–æ—Ä–∏ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω—ñ:', { redVector, greenVector });
        }
    } else {
        console.error('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä—ñ–≤:', { startIndices, vectors });
    }
};
    function drawArrowHead(ctx, start, end, color) {
    const dx = end[0] - start[0];
    const dy = end[1] - start[1];
    const angle = Math.atan2(dy, dx);
    const length = 10; // –î–æ–≤–∂–∏–Ω–∞ —Å—Ç—Ä—ñ–ª–∫–∏
    ctx.save();
    ctx.translate(end[0], end[1]);
    ctx.rotate(angle);
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(-length, -length / 2);
    ctx.lineTo(-length, length / 2);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    ctx.restore();
}
    function waitForMathJax(callback, maxAttempts = 10, attempt = 0) {
        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([elements.questionText, elements.optionsContainer]).then(() => {
                console.log("MathJax —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
                callback();
            }).catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ MathJax:', err));
        } else if (attempt < maxAttempts) {
            console.warn(`MathJax –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ, —Å–ø—Ä–æ–±–∞ ${attempt + 1}/${maxAttempts}`);
            setTimeout(() => waitForMathJax(callback, maxAttempts, attempt + 1), 200);
        } else {
            console.error('MathJax –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –ø—ñ—Å–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–ø—Ä–æ–±');
            callback();
        }
    }

   function initializeQuestions() {
    questions = [];
    usedCombinations.clear();
    useDegrees = Math.random() > 0.5;
    console.log('useDegrees:', useDegrees);
    currentQuestionIndex = 0;

    // –ì–µ–Ω–µ—Ä—É—î–º–æ –ø–µ—Ä—à–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è 1 (45¬∞)
    questions.push(generate45DegreeVectors());
    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è 1:', questions[0].question);
    displayQuestion();
}

function generateNextQuestion(level) {
    if (level === 0) {
        return generate45DegreeVectors(); // –†—ñ–≤–µ–Ω—å 1: 45¬∞ (–∑–∞–ª–∏—à–∞—î–º–æ —è–∫ —î)
    } else if (level === 1) {
        // –†—ñ–≤–µ–Ω—å 2: –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –≤–∏–±—ñ—Ä –º—ñ–∂ 0¬∞ —ñ 180¬∞
        return Math.random() > 0.5 ? generateParallelSameVectors() : generateParallelOppositeVectors();
    } else if (level === 2) {
        return generate60DegreeVectors(); // –†—ñ–≤–µ–Ω—å 3: 60¬∞
    } else if (level === 3) {
        return generateThreePerpendicularsVectors(); // –†—ñ–≤–µ–Ω—å 4: 90¬∞
    } else if (level === 4) {
        return generateTetrahedronQuestion(useDegrees); // –†—ñ–≤–µ–Ω—å 5: —Ç–µ—Ç—Ä–∞–µ–¥—Ä
    }
    console.error('–ù–µ–≤—ñ–¥–æ–º–∏–π —Ä—ñ–≤–µ–Ω—å:', level);
    return null;
}

function displayQuestion() {
    if (!elements.questionText || !elements.optionsContainer || !elements.questionNumber) {
        console.error('–ù–µ –≤–∏—Å—Ç–∞—á–∞—î –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω–Ω—è');
        return;
    }

    if (!questions[currentQuestionIndex]) {
        console.error('–ü–∏—Ç–∞–Ω–Ω—è –∑–∞ —ñ–Ω–¥–µ–∫—Å–æ–º', currentQuestionIndex, '–≤—ñ–¥—Å—É—Ç–Ω—î:', questions);
        showFeedback('–ü–æ–º–∏–ª–∫–∞: –ø–∏—Ç–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.', false);
        return;
    }

    console.log('–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω–Ω—è:', {
        index: currentQuestionIndex,
        question: questions[currentQuestionIndex].question,
        angleType: questions[currentQuestionIndex].angleType,
        vectors: questions[currentQuestionIndex].vectors,
        startIndices: questions[currentQuestionIndex].startIndices,
        vertices: questions[currentQuestionIndex].vertices
    });

    selectedOption = null;
    elements.submitAnswer.disabled = true;
    elements.optionsContainer.innerHTML = '';
    elements.feedback.innerHTML = '';
    elements.optionsContainer.style.display = 'none'; // –°–ø–æ—á–∞—Ç–∫—É —Ö–æ–≤–∞—î–º–æ
    elements.completionBlock.classList.add('hidden');
    elements.questionNumber.parentElement.style.display = 'flex';
    elements.questionNumber.textContent = `–ü–∏—Ç–∞–Ω–Ω—è ${currentQuestionIndex + 1}`;
    elements.questionText.style.opacity = '0'; // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
    elements.questionText.style.display = 'block';
    elements.submitAnswer.style.display = 'block';

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∏–ª—ñ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó (—è–∫—â–æ —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ)
    elements.questionText.style.transition = 'opacity 0.5s ease-in-out';
    elements.optionsContainer.style.transition = 'opacity 0.5s ease-in-out';

    // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø–∏—Ç–∞–Ω–Ω—è –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
    elements.questionText.innerHTML = questions[currentQuestionIndex].question;
    setTimeout(() => {
        elements.questionText.style.opacity = '1'; // –ü–ª–∞–≤–Ω–∞ –ø–æ—è–≤–∞ —Ç–µ–∫—Å—Ç—É
    }, 100);

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ vertices
    const verticesToUse = questions[currentQuestionIndex].angleType === 'tetrahedron'
        ? questions[currentQuestionIndex].vertices
        : [
            [0, 0, 0], [1, 0, 0], [1, 0.88, 0], [0, 0.88, 0],
            [0, 0, 1.5 * 0.9], [1, 0, 1.5 * 0.9], [1, 0.88, 1.5 * 0.9], [0, 0.88, 1.5 * 0.9]
        ];

    if (!verticesToUse) {
        console.error('vertices –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è –ø–∏—Ç–∞–Ω–Ω—è:', questions[currentQuestionIndex]);
    }

    // –ú–∞–ª—é—î–º–æ —Ñ—ñ–≥—É—Ä—É —Ç–∞ –≤–µ–∫—Ç–æ—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    requestAnimationFrame(() => {
        drawVectors(
            questions[currentQuestionIndex].vectors,
            questions[currentQuestionIndex].startIndices,
            questions[currentQuestionIndex].sharedOrigin,
            questions[currentQuestionIndex].offset || [0, 0],
            verticesToUse
        );
    });

    const shuffledOptions = [...questions[currentQuestionIndex].options];
    shuffleArray(shuffledOptions);
    console.log('–ü–µ—Ä–µ–º—ñ—à–∞–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏:', shuffledOptions);

    // –°—Ç–≤–æ—Ä—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –æ–ø—Ü—ñ–π
    const optionElements = shuffledOptions.map((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'option';
        optionElement.innerHTML = `\\(${option}\\)`; // –û–±–µ—Ä—Ç–∞—î–º–æ –≤ \(...\)
        optionElement.setAttribute('data-option', option);
        optionElement.setAttribute('tabindex', '0');
        optionElement.setAttribute('role', 'button');
        optionElement.setAttribute('aria-label', `–í–∞—Ä—ñ–∞–Ω—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ${index + 1}`);
        optionElement.style.opacity = '0'; // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
        return optionElement;
    });

    // –î–æ–¥–∞—î–º–æ –æ–ø—Ü—ñ—ó –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
    elements.optionsContainer.append(...optionElements);
    setTimeout(() => {
        optionElements.forEach((element, index) => {
            setTimeout(() => {
                element.style.opacity = '1'; // –ü–ª–∞–≤–Ω–∞ –ø–æ—è–≤–∞ –∫–æ–∂–Ω–æ—ó –æ–ø—Ü—ñ—ó
            }, index * 100); // –ó–∞—Ç—Ä–∏–º–∫–∞ 100–º—Å –º—ñ–∂ –æ–ø—Ü—ñ—è–º–∏
        });
        elements.optionsContainer.style.display = 'flex'; // –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—ñ—Å–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
    }, 500); // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ—è–≤–æ—é –æ–ø—Ü—ñ–π

    const renderMathJax = () => {
        if (window.MathJax && MathJax.typesetPromise) {
            console.log('–ó–∞–ø—É—Å–∫ MathJax —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó');
            MathJax.typesetPromise([elements.questionText, elements.optionsContainer])
                .then(() => {
                    console.log('MathJax —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                    attachOptionEvents();
                })
                .catch(err => {
                    console.error('–ü–æ–º–∏–ª–∫–∞ MathJax:', err);
                    attachOptionEvents();
                });
        } else {
            console.warn('MathJax –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ, –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –±–µ–∑ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó');
            attachOptionEvents();
        }
    };

    const attachOptionEvents = () => {
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        const eventTypes = isTouchDevice ? ['touchstart', 'touchend'] : ['click'];
        document.querySelectorAll('.option').forEach((optionElement, index) => {
            const option = shuffledOptions[index];
            eventTypes.forEach(eventType => {
                optionElement.addEventListener(eventType, (e) => {
                    if (eventType === 'touchstart') e.preventDefault();
                    console.log(`–í–∏–±—ñ—Ä –≤–∞—Ä—ñ–∞–Ω—Ç—É: ${option} (—ñ–Ω–¥–µ–∫—Å: ${index})`);
                    handleOptionSelection(e, optionElement, option);
                }, { passive: eventType !== 'touchstart' });
            });
        });
    };

    // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ MathJax –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
    setTimeout(renderMathJax, 600); // –î–æ–¥–∞—î–º–æ –∑–∞—Ç—Ä–∏–º–∫—É, —â–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é
}
    
    
    function handleOptionSelection(e, optionElement, option) {
        e.preventDefault();
        document.querySelectorAll('.option').forEach(opt => {
            opt.classList.remove('selected');
            opt.style.background = 'linear-gradient(135deg, #34495e, #2c3e50)';
        });

        optionElement.classList.add('selected');
        selectedOption = option;
        elements.submitAnswer.disabled = false;
    }

   function showFeedback(message, isCorrect) {
    elements.feedback.innerHTML = message;
    elements.feedback.className = `feedback ${isCorrect ? 'correct-feedback' : 'incorrect-feedback'}`;
    elements.feedback.classList.add('show');
    setTimeout(() => {
        elements.feedback.classList.remove('show');
    }, 2500);
}

elements.submitAnswer.addEventListener('click', () => {
    if (!selectedOption) {
        console.error('–ù–µ –≤–∏–±—Ä–∞–Ω–æ –∂–æ–¥–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ');
        return;
    }

    const currentQuestion = questions[currentQuestionIndex];
    const isCorrect = selectedOption === currentQuestion.correct;

    showFeedback(isCorrect ? '‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü—å!' : '‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!', isCorrect);

    document.querySelectorAll('.option').forEach(opt => {
        const optValue = opt.getAttribute('data-option');
        if (isCorrect && optValue === currentQuestion.correct) {
            opt.classList.add('correct');
            opt.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
        } else if (optValue === selectedOption && !isCorrect) {
            opt.classList.add('incorrect');
            opt.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
        }
        opt.style.pointerEvents = 'none'; // –í–∏–º–∏–∫–∞—î–º–æ –≤–∑–∞—î–º–æ–¥—ñ—é –∑ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏
    });

    setTimeout(() => {
        if (isCorrect) {
            currentQuestionIndex++;
            console.log('–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –ø–∏—Ç–∞–Ω–Ω—è:', currentQuestionIndex);

            if (currentQuestionIndex >= 5) {
                console.log('–¢—Ä–µ–Ω–∞–∂–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –±–ª–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è');
                const trainerContainer = document.getElementById('trainerContainer');
                if (trainerContainer) trainerContainer.style.display = 'none';
                elements.questionNumber.parentElement.style.display = 'none';
                elements.questionText.style.display = 'none';
                elements.optionsContainer.style.display = 'none';
                elements.submitAnswer.style.display = 'none';
                elements.feedback.classList.remove('show');
                document.querySelector('canvas').style.display = 'none';

                elements.completionBlock.classList.add('modal');
                elements.completionBlock.classList.remove('hidden');
                elements.resetTrainerBtn.focus();

                elements.resetTrainerBtn.onclick = () => {
                    console.log('–°–∫–∏–¥–∞–Ω–Ω—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞');
                    elements.completionBlock.classList.remove('modal');
                    elements.completionBlock.classList.add('hidden');
                    if (trainerContainer) trainerContainer.style.display = 'block';
                    elements.questionNumber.parentElement.style.display = 'flex';
                    elements.questionText.style.display = 'block';
                    elements.optionsContainer.style.display = 'flex';
                    elements.submitAnswer.style.display = 'block';
                    document.querySelector('canvas').style.display = 'block';

                    currentQuestionIndex = 0;
                    questions = [generate45DegreeVectors()];
                    console.log('–ù–æ–≤–∏–π –º–∞—Å–∏–≤ –ø–∏—Ç–∞–Ω—å:', questions);
                    displayQuestion();
                };

                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([elements.completionBlock]).catch(err => console.error('MathJax error:', err));
                }
            } else {
                let newQuestion, attempts = 0;
                const maxAttempts = 5;
                do {
                    console.log(`–°–ø—Ä–æ–±–∞ ${attempts + 1} –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è ${currentQuestionIndex}`);
                    newQuestion = generateNextQuestion(currentQuestionIndex);
                    attempts++;
                    console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó:`, { newQuestion, options: newQuestion?.options, correct: newQuestion?.correct });
                    if (!newQuestion || !newQuestion.options || newQuestion.options.length === 0) {
                        console.warn('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è:', newQuestion);
                    }
                } while (!newQuestion || !newQuestion.options || newQuestion.options.length === 0 && attempts < maxAttempts);

                if (newQuestion && newQuestion.options && newQuestion.options.length > 0) {
                    questions[currentQuestionIndex] = newQuestion;
                    console.log('–ù–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ:', questions[currentQuestionIndex]);
                    displayQuestion();
                } else {
                    console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –ø—ñ—Å–ª—è', maxAttempts, '—Å–ø—Ä–æ–± –¥–ª—è —Ä—ñ–≤–Ω—è', currentQuestionIndex);
                    showFeedback('–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.', false);
                }
            }
        } else {
            console.log('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤—É –ø–∞—Ä—É –∑ —Ç—ñ—î—ó –∂ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
            let newQuestion, attempts = 0;
            const maxAttempts = 5;
            const currentAngleType = currentQuestion.angleType;
            do {
                console.log(`–°–ø—Ä–æ–±–∞ ${attempts + 1} –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –Ω–æ–≤–æ—ó –ø–∞—Ä–∏ –¥–ª—è ${currentAngleType}`);
                newQuestion = generateNextQuestion(currentQuestionIndex); // –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è —Ç–æ–≥–æ –∂ —Ä—ñ–≤–Ω—è
                attempts++;
                if (!newQuestion || !newQuestion.options || newQuestion.options.length === 0) {
                    console.warn('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è:', newQuestion);
                }
            } while ((!newQuestion || !newQuestion.options || newQuestion.options.length === 0 || newQuestion.angleType !== currentAngleType) && attempts < maxAttempts);

            if (newQuestion && newQuestion.options && newQuestion.options.length > 0 && newQuestion.angleType === currentAngleType) {
                questions[currentQuestionIndex] = newQuestion;
                console.log('–ù–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è –∑ —Ç—ñ—î—ó –∂ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', questions[currentQuestionIndex]);
                // –û—á–∏—â–∞—î–º–æ —Å—Ç–∏–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª—è—î–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –≤–∏–±—ñ—Ä
                document.querySelectorAll('.option').forEach(opt => {
                    opt.style.pointerEvents = 'auto';
                    opt.classList.remove('correct', 'incorrect', 'selected');
                    opt.style.background = 'linear-gradient(135deg, #34495e, #2c3e50)';
                });
                elements.feedback.innerHTML = '';
                elements.submitAnswer.disabled = true;
                selectedOption = null;
                displayQuestion();
            } else {
                console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –∑ —Ç—ñ—î—ó –∂ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –ø—ñ—Å–ª—è', maxAttempts, '—Å–ø—Ä–æ–±');
                showFeedback('–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∏—Ç–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.', false);
            }
        }
    }, 2500);
});
    
   elements.resetTrainerBtn.addEventListener('click', () => {
    console.log("–ö–Ω–æ–ø–∫–∞ —Å–∫–∏–¥–∞–Ω–Ω—è –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞");
    questions = [];
    usedCombinations.clear();
    useDegrees = Math.random() > 0.5;
    console.log('useDegrees:', useDegrees);
    currentQuestionIndex = 0;
    questions.push(generate45DegreeVectors());
    console.log('–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è 1:', questions[0].question);
    elements.completionBlock.classList.add('hidden');
    elements.submitAnswer.style.display = 'block';
    displayQuestion();
});

    function toggleModal(modal, show) {
        if (!modal) {
            console.error('–ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        const allModals = [
            elements.theoryModal,
            elements.questionsModal,
            elements.trainerModal
        ].filter(Boolean);
        allModals.forEach(m => {
            if (m && m !== modal) m.style.display = 'none';
        });
        modal.style.display = show ? 'flex' : 'none';
        elements.modalOverlay.style.display = show ? 'block' : 'none';
        document.body.style.overflow = show ? 'hidden' : 'auto';
        if (show) {
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) closeBtn.focus();
            if (modal === elements.trainerModal) {
                currentQuestionIndex = 0;
                initializeQuestions();
            }
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise(['#trainerContent', '#questionsModal', '#theoryModal']).then(() => {
                    console.log(`MathJax —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è ${modal.id}`);
                    const modalContent = modal.querySelector('.modal-content');
                    if (modalContent) {
                        modalContent.scrollTop = 0;
                    }
                }).catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ MathJax:', err));
            }
        }
    }

    elements.openTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, true));
    elements.openQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, true));
    elements.openTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, true));

    elements.closeTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, false));
    elements.closeQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, false));
    elements.closeTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, false));

    elements.modalOverlay?.addEventListener('click', () => {
        toggleModal(elements.theoryModal, false);
        toggleModal(elements.questionsModal, false);
        toggleModal(elements.trainerModal, false);
    });

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
        }
    });
});
       
    </script>
</body>
</html>

