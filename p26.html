<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>26. Критерій сумісності системи лінійних алгебраїчних рівнянь</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: () => {
                    console.log("MathJax is loaded and ready!");
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" onerror="console.error('Failed to load MathJax')"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            background: linear-gradient(135deg, #1a2e2a, #0a3d2e);
            font-family: 'Roboto', sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100vh;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        body.loaded {
            visibility: visible;
            opacity: 1;
        }
        .title-box {
            margin-top: 60px;
            padding: 20px 40px;
            background: linear-gradient(135deg, #4a7043, #8b9a46);
            border-radius: 15px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            max-width: 90%;
            text-align: center;
        }
        .title-box h1 {
            margin: 0;
            font-size: 24px;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            font-family: 'Merriweather', serif;
        }
        .section-container {
            margin-top: 80px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .section {
            width: 260px;
            height: 200px;
            background: linear-gradient(45deg, #2e3b2e, #4a5b4a);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #ffffff;
            text-decoration: none;
        }
        .section:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
            background: linear-gradient(45deg, #2e3b2e, #6b8e23);
        }
        .section img {
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 5px rgba(139, 154, 70, 0.3));
        }
        .section h2 {
            font-size: 20px;
            margin: 0;
            font-family: 'Merriweather', serif;
            color: #ffffff;
        }
        .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: linear-gradient(135deg, #4a7043, #2e3b2e);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 1001;
            overflow: hidden;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: #2e3b2e;
            border-radius: 10px;
            margin: 10px;
            color: #ffffff;
            width: calc(100% - 20px);
            overflow-y: auto;
            display: block;
            max-height: calc(100% - 60px);
        }
        .modal-content::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #2e3b2e;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #4a7043, #8b9a46);
            border-radius: 10px;
            border: 2px solid #2e3b2e;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #6b8e23, #9ab973);
        }
        .modal-header {
            background: linear-gradient(0deg, #4a7043, #2e3b2e);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 1002;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .close-btn {
            background: #8b9a46;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-family: 'Roboto', sans-serif;
            z-index: 1003;
        }
        .close-btn:hover {
            background: #6b8e23;
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            background: #2e3b2e;
            cursor: pointer;
        }
        summary {
            font-weight: bold;
            padding: 10px;
            background: #4a7043;
            border-radius: 6px;
            color: #ffffff;
            font-family: 'Merriweather', serif;
        }
        summary:hover {
            background: #6b8e23;
        }
        details p {
            padding: 0 15px 10px;
            color: #ffffff;
            margin: 8px 0;
        }
        .math-notation {
            font-style: italic;
            color: #ffd700;
            background: #2e3b2e;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .highlight-term {
            background: #e0f7fa;
            padding: 2px 4px;
            border-radius: 3px;
            color: #0ea5e9;
        }
        .formula-line {
            display: inline-block;
            white-space: nowrap;
        }
        .theory-content h2 {
            color: #ffd700;
            text-align: center;
        }
        .theory-content h3 {
            color: #ffffff;
        }
        .theory-content p, .theory-content li {
            color: #ffffff;
            font-size: clamp(18px, 3vw, 20px);
            text-align: justify;
        }
        .example {
            color: #ff8c00;
            font-weight: bold;
        }
        .solution {
            color: #ff8c00;
            font-weight: bold;
            text-align: center;
            display: block;
        }
        .note {
            color: #ff8c00;
            font-weight: bold;
        }
        .note-text {
            font-style: italic;
            color: #ffffff;
            text-align: justify;
            width: 100%;
        }
        .matrix-type {
            font-style: italic;
            color: #ffd700;
        }
        .main-types {
            font-weight: bold;
            color: #ffffff;
        }
        ol {
            color: #ffffff;
        }
        ol li::marker {
            color: #ffd700;
        }
        mjx-container {
            color: #ffd700 !important;
           
            font-style: italic !important;
            display: inline-block;
            white-space: nowrap;
            max-width: 100%;
        }
        .theory-content mjx-container {
            color: #ffd700 !important;
            background: #2e3b2e !important;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .glow-title {
            text-align: center;
            color: #ffffff;
            font-family: 'Merriweather', serif;
            font-size: clamp(20px, 3vw, 24px);
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(139, 154, 70, 0.5);
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }
        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(45deg, #4a7043, #8b9a46);
            color: #ffffff;
            text-decoration: none;
            border-radius: 10px;
            font-family: 'Merriweather', serif;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        }
        .nav-button:hover {
            background: linear-gradient(45deg, #6b8e23, #9ab973);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        .nav-button svg {
            fill: none;
            stroke: #ffffff;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .nav-button:hover svg {
            stroke: #ffd700;
        }
        /* Стильна горизонтальна прокрутка для формул */
        .math-notation-centered {
            display: block;
            text-align: center;
            margin: 1em 0;
            color: white;
            padding: 0 10px;
            overflow-y: hidden;
        }
        .math-notation-centered mjx-container {
            max-width: 100%;
            display: inline-block;
            vertical-align: middle;
        }
        /* Клас для слова "Приклад" */
        .example-title {
            color: orange;
            font-weight: bold;
        }
        /* Білий текст для пояснень */
        .text-white {
            color: white;
        }
        /* Стилі для відео */
         .video-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        .video-card {
            width: 400px;
            height: 400px;
            background:#314765;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: #ffff00;
        }
        .video-card:hover {
            background: #556b2f;
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-player-container {
            width: 80vw;
            max-width: 960px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-player-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: block;
            border: none;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
            color: var(--text-color);
        }
        /* Стилі для флеш-карток */
        .flashcard-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
        }
        .flashcard {
            width: 350px;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
            transition: transform 0.6s ease;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .flashcard .front,
        .flashcard .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-radius: 12px;
            font-family: 'Roboto', sans-serif;
            font-size: clamp(16px, 2.5vw, 18px);
            color: #ffffff;
        }
        .flashcard .front {
            background: linear-gradient(45deg, #4a7043, #8b9a46);
        }
        .flashcard .back {
            background: linear-gradient(45deg, #2e3b2e, #4a5b4a);
            transform: rotateY(180deg);
        }
        .flashcard .front p,
        .flashcard .back p {
            margin: 0;
            text-align: center;
        }
        .flashcard .front mjx-container,
        .flashcard .back mjx-container {
            color: #ffd700 !important;
            background: transparent !important;
            font-size: clamp(16px, 2.5vw, 18px) !important;
        }
.trainer-container {
    width: 95%;
    max-width: 95%;
    padding: 25px;
    text-align: center;
    background: linear-gradient(135deg, #2e1065, #6b21a8);
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
    border: 2px solid rgba(236, 72, 153, 0.5);
    position: relative;
    min-height: 600px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow-y: visible; /* Залишаємо visible */
    box-sizing: border-box;
}

.trainer-feedback {
    display: none;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: clamp(16px, 2.5vw, 18px);
    font-weight: bold;
    text-align: center;
    max-width: 400px;
    width: 90%;
    margin: 20px auto;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    position: absolute; /* Змінено на absolute */
    top: 50%; /* Центруємо по вертикалі */
    left: 50%; /* Центруємо по горизонталі */
    transform: translate(-50%, -50%); /* Точне центрування */
    z-index: 20; /* Вище за інші елементи */
}

.trainer-feedback.show {
    display: block;
    opacity: 1;
}
.trainer-container::-webkit-scrollbar {
    width: 12px;
}

.trainer-container::-webkit-scrollbar-track {
    background: rgba(167, 139, 250, 0.2);
    border-radius: 10px;
    margin: 5px;
}

.trainer-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #d81b60, #f06292);
    border-radius: 10px;
    border: 2px solid rgba(167, 139, 250, 0.3);
}

.trainer-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #f06292, #d81b60);
}

.trainer-container {
    scrollbar-width: thin;
    scrollbar-color: #f06292 rgba(167, 139, 250, 0.2);
}

.trainer-question {
    font-size: clamp(18px, 3vw, 20px);
    color: #f0e7ff;
    margin-bottom: 25px;
}

.system-equations {
    text-align: center;
    margin-bottom: 20px;
}

.trainer-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, auto);
    gap: 15px;
    max-width: 750px;
    margin: 25px auto;
    justify-items: center;
    align-items: stretch;
}

.option-btn {
    padding: 10px 20px;
    background: #4b5320;
    color: #ffffff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.3s ease, border-color 0.3s ease;
    width: 100%;
    text-align: center;
    font-family: 'Roboto', sans-serif;
}

.option-btn:hover {
    background: #556b2f;
    transform: translateY(-2px);
}

.option-btn.selected {
    background: #560319;
    border: 2px solid #facc15;
    font-weight: bold;
}

.option-btn.wrong {
    background: linear-gradient(135deg, #7f1d1d, #991b1b);
    color: #ffffff;
    border: 2px solid rgba(167, 139, 250, 0.5);
}

.option-btn.correct {
    background: linear-gradient(135deg, #22c55e, #86efac);
    color: #1e1e5f;
    border: 2px solid #22c55e;
}

.trainer-submit {
    background: #50622c;
    color: #1e1e5f;
    border: none;
    border-radius: 10px;
    padding: 12px 25px;
    font-size: clamp(18px, 2.8vw, 20px);
    cursor: pointer;
    margin-top: 25px;
    transition: background 0.3s ease, transform 0.2s ease;
}

.trainer-submit:hover {
    background: linear-gradient(135deg, #86efac, #4ade80);
    transform: scale(1.05);
}




.trainer-feedback.correct {
    background: linear-gradient(135deg, #22c55e, #86efac);
    color: #1e1e5f;
}

.trainer-feedback.correct::before {
    content: '✓ ';
    font-size: 24px;
    vertical-align: middle;
}

.trainer-feedback.wrong {
    background: linear-gradient(135deg, #b91c1c, #dc2626);
    color: #ffffff;
}

.trainer-feedback.wrong::before {
    content: '✗ ';
    font-size: 24px;
    vertical-align: middle;
}

#resetTrainerBtn {
    padding: 12px 24px;
    background: linear-gradient(45deg, #4a7043, #8b9a46);
    color: #ffff00;
    border: none;
    border-radius: 10px;
    font-size: clamp(16px, 2.5vw, 18px);
    cursor: pointer;
    font-family: 'Roboto', sans-serif;
    transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

#resetTrainerBtn:hover {
    background: linear-gradient(45deg, #6b8e23, #9ab973);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

#resetTrainerBtn:focus {
    outline: 2px solid #facc15;
    outline-offset: 2px;
}

.question-circle {
    width: clamp(100px, 16vw, 130px);
    height: clamp(100px, 16vw, 130px);
    min-width: clamp(100px, 16vw, 130px);
    min-height: clamp(100px, 16vw, 130px);
    max-width: clamp(100px, 16vw, 130px);
    max-height: clamp(100px, 16vw, 130px);
    aspect-ratio: 1/1;
    background: linear-gradient(135deg, #d81b60, #f06292);
    border-radius: 50%;
    color: #ffffff;
    font-family: 'Lora', serif;
    font-weight: 700;
    margin: 0 auto 25px;
    border: 3px dashed #a78bfa;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    padding: 0;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.0rem, 2.5vw, 1.1rem);
    text-align: center;
    white-space: nowrap;
    line-height: 1.2;
    overflow: hidden;
}

.question-circle span {
    font-size: inherit;
    font-family: inherit;
    font-weight: inherit;
    color: inherit;
    margin: 0;
    padding: 0;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}

.question-circle mjx-container,
.question-circle .MathJax {
    display: none !important;
}
    .completion-message {
    text-align: center;
    margin: 20px auto;
    max-width: 400px;
    width: 90%;
    position: relative; /* Додаємо позиціонування */
    z-index: 10; /* Нижче, ніж trainer-feedback, але вище інших елементів */
}

#successMessage {
    background: linear-gradient(135deg, #22c55e, #86efac);
    color: #1e1e5f;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: clamp(16px, 2.5vw, 18px);
    font-weight: bold;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    margin-bottom: 20px;
}

#successMessage::before {
    content: '✓ ';
    font-size: 24px;
    vertical-align: middle;
}
.completion-emoji {
            width: clamp(100px, 18vw, 140px);
            height: clamp(100px, 18vw, 140px);
            margin: 0 auto 20px;
            border-radius: 50%;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: 3px dashed #ccff00;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .completion-emoji::after {
            content: '🎉';
            font-size: clamp(50px, 10vw, 70px);
            color: #ffff00;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

    @media (max-width: 768px) {
            .close-btn {
                font-size: 16px;
                padding: 6px 12px;
                border-radius: 8px;
            }
            .theory-content p, .theory-content li {
                font-size: clamp(18px, 3vw, 20px);
            }
            .theory-content mjx-container {
                font-size: clamp(16px, 3vw, 18px) !important;
            }
            .theory-content h2, .theory-content h3 {
                font-size: clamp(20px, 3vw, 24px);
            }
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .trainer-options {
        grid-template-columns: 1fr !important; /* Один стовпчик */
        grid-template-rows: auto; /* Автоматична кількість рядків */
        gap: 10px;
        max-width: 90%;
    }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            .modal {
                top: 2%;
                left: 2%;
                width: 96%;
                height: 96%;
            }
            .modal-header {
                padding: 5px 8px;
            }
            .modal-content {
                max-height: calc(100% - 50px);
                padding: 15px;
            }
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
                margin: 30px 0;
            }
            .nav-button {
                padding: 10px 20px;
                font-size: 16px;
            }
            .math-notation-centered {
                overflow-x: auto;
                overflow-y: hidden;
                white-space: nowrap;
                padding: 0 5px;
                -webkit-overflow-scrolling: touch;
            }
            .math-notation-centered::-webkit-scrollbar {
                height: 8px;
                display: block;
            }
            .math-notation-centered::-webkit-scrollbar-track {
                background: #2e3b2e;
                border-radius: 8px;
                box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
            }
            .math-notation-centered::-webkit-scrollbar-thumb {
                background: linear-gradient(90deg, #4a7043, #8b9a46);
                border-radius: 8px;
                border: 1px solid #2e3b2e;
                box-shadow: 0 0 4px rgba(139, 154, 70, 0.5);
                transition: background 0.3s ease;
            }
            .math-notation-centered::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(90deg, #6b8e23, #9ab973);
            }
            .video-card {
            width: 300px;
            height: 300px;
            
        }
             
        .video-player-container {
            width: 80vw;
            max-width: 800px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-player-container iframe {
            width: 90%;
            height: 90%;
            
        }
            .flashcard {
                width: 80%;
                height: 150px;
            }
            .flashcard .front,
            .flashcard .back {
                font-size: clamp(15px, 2.8vw, 17px);
            }
            .flashcard .front mjx-container,
            .flashcard .back mjx-container {
                font-size: clamp(15px, 2.8vw, 17px) !important;
            }
               .trainer-question {
        font-size: clamp(16px, 2.8vw, 18px);
    }
    .option-btn {
        font-size: 14px;
        padding: 8px 15px;
    }
    .trainer-submit {
        font-size: 14px;
        padding: 8px 15px;
    }
    .question-circle {
        width: 60px;
        height: 60px;
        font-size: 16px;
    }
            
        }
        @media (max-width: 480px) {
            .close-btn {
                font-size: 14px;
                padding: 5px 10px;
                border-radius: 6px;
            }
            .theory-content p, .theory-content li {
                font-size: clamp(17px, 3.2vw, 19px);
            }
            .theory-content mjx-container {
                font-size: clamp(16px, 3.2vw, 18px) !important;
            }
            .theory-content h2, .theory-content h3 {
                font-size: clamp(17px, 3vw, 19px);
            }
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 20px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 18px;
            }
            .modal-header {
                padding: 4px 6px;
            }
            .modal-content {
                max-height: calc(100% - 40px);
                padding: 10px;
            }
           .navigation-buttons {
        flex-direction: row; /* Горизонтальне розташування */
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
        flex-wrap: nowrap;
    }
    .nav-button {
        padding: 6px 14px; /* "Грубші" кнопки */
        font-size: 15px; /* Більший шрифт */
        font-weight: 600; /* Товстіший шрифт */
        width: auto;
        min-width: 100px;
        text-align: center;
        border: 2px solid #ffffff; /* Межа для об’єму */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Тінь */
    }
    .trainer-submit {
    padding: 8px 20px !important;
    font-size: 15px !important;
    min-width: 120px !important;
    font-weight: 700 !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
}
            .math-notation-centered {
                padding: 0 5px;
            }
            .math-notation-centered::-webkit-scrollbar {
                height: 6px;
            }
            .video-card {
            width: 200px;
            height: 200px;
            
        }
             
        .video-player-container {
            width: 80vw;
            max-width: 600px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
                    
            .flashcard {
                width: 90%;
                height: 140px;
            }
            .flashcard .front,
            .flashcard .back {
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .flashcard .front mjx-container,
            .flashcard .back mjx-container {
                font-size: clamp(14px, 2.5vw, 16px) !important;
            }
            .math-notation-centered {
                padding: 0 5px;
            }
             .trainer-question {
        font-size: clamp(14px, 2.5vw, 16px);
    }
    .option-btn {
        font-size: 13px;
        padding: 6px 12px;
    }
    .trainer-submit {
        font-size: 13px;
        padding: 6px 12px;
    }
    .question-circle {
        width: 50px;
        height: 50px;
        font-size: 14px;
    }
                   }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>26. Критерій сумісності системи лінійних алгебраїчних рівнянь</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
        <a class="nav-button" href="{{ url_for('tema6') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 6
        </a>
        <a class="nav-button" href="{{ url_for('home') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>

    <div id="theoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="theoryTitle">
        <div class="modal-header">
            <button class="close-btn" id="closeTheoryBtn" aria-label="Закрити">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="theory-content">
                <details>
                    <summary>Критерій сумісності системи лінійних алгебраїчних рівнянь</summary>
                    <p>Перед розв’язуванням системи лінійних рівнянь, особливо якщо вона містить багато рівнянь або змінних, необхідно перевірити її сумісність, тобто з’ясувати, чи має вона розв’язки. Для цього використовують критерій, який базується на рангах матриць, відомий як теорема Кронекера-Капеллі.</p>
                    <p><strong style="color: orange;">Формулювання критерію.</strong> Система лінійних рівнянь сумісна, якщо виконується умова:</p>
                    <p class="math-notation-centered">\[ r(A) = r(A|B), \]</p>
                    <p>де \( A \) – матриця коефіцієнтів системи, \( A|B \) – розширена матриця (матриця коефіцієнтів, доповнена стовпцем вільних членів).</p>
                    <p>Якщо ця рівність виконується і ранг матриці дорівнює кількості змінних, то система має єдиний розв’язок. Якщо ж ранг менший за кількість змінних, система має безліч розв’язків. Якщо ж \( r(A) \neq r(A|B) \), система несумісна, тобто немає розв’язків.</p>
                    <p><strong style="color: orange;">Аналіз сумісності системи.</strong> Перевірка сумісності системи лінійних рівнянь є важливим початковим етапом розв’язання. Для цього виконують такі кроки:</p>
                    <ol>
                        <li><em style="color: #f5e1c0;">Побудова матриць.</em> Складають головну матрицю \( A \), яка містить коефіцієнти при змінних, та формують розширену матрицю \( (A|B) \), додавши до \( A \) стовпець вільних членів \( b \).</li>
                        <li><em style="color: #f5e1c0;">Обчислення рангів.</em> Визначають \( r(A) \) і \( r(A|B) \), наприклад, методом Гауса або за допомогою мінорів.</li>
                        <li><em style="color: #f5e1c0;">Висновки за теоремою Кронекера-Капеллі.</em> Якщо \( r(A) = r(A|B) \), то система сумісна (має хоча б один розв’язок). Якщо \( r(A) \neq r(A|B) \), то система несумісна (не має розв’язків).</li>
                    </ol>
                </details>

                <details>
                    <summary>Приклади</summary>
                    <!-- Приклад 6.8 -->
                    <h3><span class="example-title">Приклад 6.8.</span> <span class="text-white">Дослідити систему на сумісність та знайти її розв’язок, якщо система сумісна:</span></h3>
                    <p style="color: orange; font-weight: bold; text-align: center; font-size: 1.2em; margin: 1em 0;">Розв’язання</p>
                    <p style="color: white; margin: 1em 0;">
                        Цю систему вже розв’язували методом Гауса у прикладі 6.4 (див. п. 25). Тепер перевіримо її на сумісність за теоремою Кронекера-Капеллі та знайдемо розв’язок.<br>
                        Застосуємо елементарні перетворення до розширеної матриці, щоб обчислити її ранг. Ці перетворення не впливають на ранг матриць.
                    </p>
                    <p class="math-notation-centered">
                        \[
                        \left(
                        \begin{array}{ccc|c}
                        3 & 2 & -5 & -1 \\
                        2 & -1 & 3 & 13 \\
                        1 & 2 & -1 & 9
                        \end{array}
                        \right)
                        \sim
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        2 & -1 & 3 & 13 \\
                        3 & 2 & -5 & -1
                        \end{array}
                        \right)
                        \sim
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        0 & -5 & 5 & -5 \\
                        0 & -4 & -2 & -28
                        \end{array}
                        \right)
                        \]
                    </p>
                    <p class="math-notation-centered">
                        \[
                        \sim
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        0 & 1 & -1 & 1 \\
                        0 & 2 & 1 & 14
                        \end{array}
                        \right)
                        \sim
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        0 & 1 & -1 & 1 \\
                        0 & 0 & 3 & 12
                        \end{array}
                        \right)
                        \sim
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        0 & 1 & -1 & 1 \\
                        0 & 0 & 1 & 4
                        \end{array}
                        \right)
                        .\]
                    </p>
                    <p style="color: white; margin: 1em 0;">
                        У результаті виконаних дій отримали <em>еквівалентні матриці </em>для заданої системи:
                        \[
                        A = \begin{pmatrix}1 & 2 & -1\\0 & 1 & -1\\0 & 0 & 1\end{pmatrix},\quad
                        (A|b) = 
                        \left(
                        \begin{array}{ccc|c}
                        1 & 2 & -1 & 9 \\
                        0 & 1 & -1 & 1 \\
                        0 & 0 & 1 & 4
                        \end{array}
                        \right)
                        \]
                        Обидві матриці мають <em>східчастий вигляд </em>, причому в кожній матриці три ненульові рядки. Отже, їхній ранг дорівнює \(3\).
                        Оскільки кількість змінних також \(3\), то за теоремою Кронекера-Капеллі система є <em>сумісною</em> та має <em>єдиний розв’язок.</em>
                    </p>
                    <p><em>Знаходження розв’язку.</em> З останнього рівняння видно, що \(z=4\), підставляємо у друге рівняння:</p>
                    <p class="math-notation-centered">\(y-z=1 \Rightarrow y-4=1 \Rightarrow y=5.\)</p>
                    <p>Підставляємо \(y=5\) та \(z=4\) у перше рівняння:</p>
                    <p class="math-notation-centered">\(x+2y-z=9 \Rightarrow x+10-4=9 \Rightarrow x=3.\)</p>
                    <p>
                        <span class="example-title">Відповідь:</span> 
                        \((x,y,z) = (3,5,4).\)
                    </p>

                    <!-- Приклад 6.9 -->
                    <h3><span class="example-title">Приклад 6.9.</span> <span class="text-white">Дослідити систему на сумісність та знайти її розв’язок, якщо система сумісна:</span></h3>
                    <p class="math-notation-centered">
                        \[
                        \begin{cases}
                        4x_1 - 3x_2 + 2x_3 - x_4 = 8\\
                        3x_1 - 2x_2 + x_3 - 3x_4 = 7\\
                        5x_1 - 3x_2 + x_3 - 8x_4 = 1
                        \end{cases}
                        \]
                    </p>
                    <p style="color: orange; font-weight: bold; text-align: center; font-size: 1.2em; margin: 1em 0;">Розв’язання</p>
                    <p class="text-white">
                        Система складається з \(3\) рівнянь і \(4\) змінних \((m=3, n=4)\). Оскільки кількість змінних перевищує кількість рівнянь, система може бути або несумісною, або мати безліч розв’язків. Визначимо її сумісність <em>за теоремою Кронекера-Капеллі.</em>
                    </p>
                    <p class="text-white">Запишемо розширену матрицю системи:</p>
                    <p class="math-notation-centered">
                        \[
                        \left(\begin{array}{cccc|c}
                        4 & -3 & 2 & -1 & 8\\
                        3 & -2 & 1 & -3 & 7\\
                        5 & -3 & 1 & -8 & 1
                        \end{array}\right)
                        \]
                    </p>
                    <p class="text-white">
                        <em>Приведемо матрицю до східчастого вигляду</em>. Утворимо нулі у першому стовпці під головним елементом: до другого рядка додаємо перший рядок, помножений на \(-3\), а сам другий рядок попередньо множимо на \(4\); до третього рядка додаємо перший рядок, помножений на \(-5\), а сам третій рядок попередньо множимо на \(4\):
                    </p>
                    <p class="math-notation-centered">
                        \[
                        \overset{
                        \substack{
                        R_2 = 4R_2 - 3R_1\\
                        R_3 = 4R_3 - 5R_1
                        }
                        }{\longrightarrow}
                        \left(
                        \begin{array}{cccc|c}
                        4 & -3 & 2 & -1 & 8\\
                        0 & 1 & -2 & -9 & 4\\
                        0 & 3 & -6 & -36 & -36
                        \end{array}
                        \right)
                        \]
                    </p>
                    <p class="text-white">Тепер потрібно зробити нуль у третьому рядку на другій позиції. Для цього до третього рядка додаємо другий рядок, помножений на \(-3\), і отримаємо:</p>
                    <p class="math-notation-centered">
                        \[
                        \overset{R_3 = R_3 - 3R_2}{\longrightarrow}
                        \left(\begin{array}{cccc|c}
                        4 & -3 & 2 & -1 & 8\\
                        0 & 1 & -2 & -9 & 4\\
                        0 & 0 & 0 & 0 & -48
                        \end{array}\right)
                        \]
                    </p>
                    <p class="text-white">
                        В результаті елементарних перетворень отримали еквівалентну матрицю системи
                    </p>
                    <p class="math-notation-centered">
                        \[
                        A = 
                        \left(
                        \begin{array}{cccc}
                        4 & -3 & 2 & -1\\
                        0 & 1 & -2 & -9\\
                        0 & 0 & 0 & 0
                        \end{array}
                        \right)
                        \sim
                        \left(
                        \begin{array}{cccc}
                        4 & -3 & 2 & -1\\
                        0 & 1 & -2 & -9
                        \end{array}
                        \right)
                        \]
                    </p>
                    <p class="text-white">та розширену матрицю системи</p>
                    <p class="math-notation-centered">
                        \[
                        (A \,|\, b) =
                        \left(
                        \begin{array}{cccc|c}
                        4 & -3 & 2 & -1 & 8 \\
                        0 & 1 & -2 & -9 & 4 \\
                        0 & 0 & 0 & 0 & -48
                        \end{array}
                        \right).
                        \]
                    </p>
                    <p class="text-white">
                        Тому \(r(A) = 2\) (два ненульові рядки), \(r(A|b) = 3\) (три ненульові рядки). Отже, оскільки \(r(A) \neq r(A|B)\), тоді за теоремою Кронекера-Капеллі система <em>несумісна (немає розв’язків).</em>
                    </p>
                    <p>
                        <span style="color: orange; font-weight: bold;">Примітка.</span>
                        <span style="font-style: italic;">
                            Якби умова не вимагала аналізу сумісності, можна було б одразу вказати, що розширена матриця приведена до східчастого вигляду 
                            <p class="math-notation-centered">
                                \[
                                \left(\begin{array}{cccc|c}
                                4 & -3 & 2 & -1 & 8 \\
                                0 & 1 & -2 & -9 & 4 \\
                                0 & 0 & 0 & 0 & -48
                                \end{array}\right).
                                \]
                            </p>
                            <p class="text-white">
                                Оскільки з’явився рядок 
                                \[\left(\begin{array}{cccc|c}0 & 0 & 0 & 0 & -48\end{array}\right)\], 
                                система несумісна (немає розв’язків).
                            </p>
                        </span>
                    </p>
                    <p>
                        <span class="example-title">Відповідь:</span> Система несумісна, розв’язків немає.
                    </p>

                    <!-- Приклад 6.10 -->
                    <h3><span class="example-title">Приклад 6.10.</span> <span class="text-white">Дослідити систему на сумісність та знайти її розв’язок, якщо система сумісна:</span></h3>
                    <p class="math-notation-centered">
                        \[
                        \begin{cases}
                        2x_1+3x_2-x_3+x_4=1\\
                        8x_1+12x_2-9x_3+8x_4=3\\
                        4x_1+6x_2+3x_3-2x_4=3\\
                        2x_1+3x_2+9x_3-7x_4=3
                        \end{cases}
                        \]
                    </p>
                    <p style="color: orange; font-weight: bold; text-align: center; font-size: 1.2em; margin: 1em 0;">Розв’язання</p>
                    <p>
                        Система має \(4\) рівняння і \(4\) змінні \((m=4, n=4)\). Вона може мати єдиний розв’язок, безліч розв’язків або бути несумісною. Метод Гауса допоможе визначити це завдяки своїй універсальності.
                    </p>
                    <p>Запишемо розширену матрицю системи:</p>
                    <p class="math-notation-centered">
                        \[
                        \left(\begin{array}{cccc|c}
                        2 & 3 & -1 & 1 & 1 \\
                        8 & 12 & -9 & 8 & 3 \\
                        4 & 6 & 3 & -2 & 3 \\
                        2 & 3 & 9 & -7 & 3
                        \end{array}\right).
                        \]
                    </p>
                    <p>Застосуємо елементарні перетворення, щоб спростити матрицю. Усунення ненульових елементів у першому стовпці під головним елементом:</p>
                    <p class="math-notation-centered">
                        \[
                        \xrightarrow{\;
                        \begin{array}{c}
                        R_2 \to R_2 - 4R_1 \\
                        R_3 \to R_3 - 2R_1 \\
                        R_4 \to R_4 - R_1
                        \end{array}
                        \;}
                        \left(
                        \begin{array}{cccc|c}
                        2 & 3 & -1 & 1 & 1 \\
                        0 & 0 & -5 & 4 & -1 \\
                        0 & 0 & 5 & -4 & 1 \\
                        0 & 0 & 10 & -8 & 2
                        \end{array}
                        \right)
                        \]
                    </p>
                    <p>Останні три рядки пропорційні (наприклад, \(R_3=-R_2, R_4=-2R_2\)), тому <em>видаляємо два з них</em>, залишаючи лише один.</p>
                    <p>Отже, після елементарних перетворень розширена матриця набуває вигляду:</p>
                    <p class="math-notation-centered">
                        \[
                        \left(\begin{array}{cccc|c}
                        2 & 3 & -1 & 1 & 1 \\
                        0 & 0 & 5 & -4 & 1
                        \end{array}\right).
                        \]
                    </p>
                    <p>Тепер отримуємо еквівалентну матрицю системи:</p>
                    <p class="math-notation-centered">
                        \[
                        A=\left(\begin{array}{cccc}
                        2 & 3 & -1 & 1 \\
                        0 & 0 & 5 & -4
                        \end{array}\right)
                        \]
                    </p>
                    <p>та розширену матрицю системи</p>
                    <p class="math-notation-centered">
                        \[
                        (A|b)=\left(\begin{array}{cccc|c}
                        2 & 3 & -1 & 1 & 1 \\
                        0 & 0 & 5 & -4 & 1
                        \end{array}\right).
                        \]
                    </p>
                    <p>
                        Тому \(r(A)=2\) (два ненульові рядки), \(r(A|b)=2\) (два ненульові рядки).
                        За теоремою Кронекера-Капеллі:
                    </p>
                    <p>
                        Оскільки \(r(A)=r(A|b)=2\), система сумісна. Кількість змінних \(n=4\), а \(r(A)=2&lt;4\), тому система має <em>безліч розв’язків</em>.
                    </p>
                    <p>Знаходимо загальний розв’язок. Отримано еквівалентну систему:</p>
                    <p class="math-notation-centered">
                        \[
                        \begin{cases}
                        2x_1+3x_2-x_3+x_4=1, \\
                        5x_3-4x_4=1.
                        \end{cases}
                        \]
                    </p>
                    <p>
                        Визначимо базисні та вільні змінні. <em>Базисні змінні</em>: \(x_1, x_3\) – ті, що стоять на «сходинках» східчастої матриці (перші ненульові коефіцієнти в кожному рівнянні). <em>Вільні змінні</em>:  
                        \(x_2, x_4\) – решта змінних, які не є базисними і можуть набувати довільних значень.
                    </p>
                    <p>Виразимо базисні змінні через вільні змінні. Зворотній хід методу Гауса:</p>
                    <p>
                        З другого рівняння системи виразимо базисну змінну \(x_3\) через \(x_4\):
                    </p>
                    <p class="math-notation-centered">
                        \[
                        x_3=\frac{4}{5}x_4+\frac{1}{5}.
                        \]
                    </p>
                    <p>Підставимо у перше рівняння:</p>
                    <p class="math-notation-centered">
                        \[
                        \begin{aligned}
                        &5x_3 - 4x_4 = 1, \\
                        &5x_3 = 4x_4 + 1 \Rightarrow x_3 = \frac{4}{5}x_4 + \frac{1}{5}
                        \end{aligned}
                        \]
                    </p>
                    <p>Підставимо \(x_3 = \frac{4}{5} x_4 + \frac{1}{5}\) у перше рівняння \(2x_1 + 3x_2 - x_3 + x_4 = 1\) системи:</p>
                    <p class="math-notation-centered">
                        \[
                        \begin{array}{l}
                        2x_1 + 3x_2 - \left(\frac{4}{5}x_4 + \frac{1}{5}\right) + x_4 = 1,\\
                        2x_1 + 3x_2 - \frac{4}{5}x_4 - \frac{1}{5} + x_4 = 1,\\
                        \hspace{1.5cm} 2x_1 = 1 - 3x_2 - \frac{1}{5}x_4 + \frac{1}{5},\\
                        \hspace{1.5cm} 2x_1 = -3x_2 - \frac{1}{5}x_4 + \frac{6}{5} \Rightarrow x_1 = -\frac{3}{2}x_2 - \frac{1}{10}x_4 + \frac{3}{5}.
                        \end{array}
                        \]
                    </p>
                    <p>В результаті отримано загальний розв’язок для базисних змінних \(x_1\) і \(x_3\), виражених через вільні змінні \(x_2\) і \(x_4\):</p>
                    <p class="math-notation-centered">
                        \[
                        \begin{cases}
                        x_1=-\frac{3}{2}x_2-\frac{1}{10}x_4+\frac{3}{5}, \\
                        x_2 \in \mathbb{R}, \\
                        x_3=\frac{4}{5}x_4+\frac{1}{5}, \\
                        x_4 \in \mathbb{R}.
                        \end{cases}
                        \]
                    </p>
                    <p>
                        <span class="example-title">Відповідь:</span>  
                        \((x_1,x_2,x_3,x_4)=\left(-\frac{3}{2}x_2-\frac{1}{10}x_4+\frac{3}{5},\; x_2,\; \frac{4}{5}x_4+\frac{1}{5},\; x_4\right), \; x_2,x_4 \in \mathbb{R}.\)
                    </p>
                </details>
            </div>
        </div>
    </div>

  <div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
                       <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Невизначені системи лінійних рівнянь. Теорема Кронекера-Капелі.</h3>
                </div>
                                            </div>
        </div>
    </div>

    <div id="videoPlayerModal1" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" title="Невизначені системи лінійних рівнянь. Теорема Кронекера-Капеллі" width="100%" height="100%" data-src="https://www.youtube.com/embed/7iqR_k8tN1E" src="https://www.youtube.com/embed/7iqR_k8tN1E" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="questionsModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeQuestionsBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="flashcard-container">
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>1. Що означає перевірка сумісності системи лінійних рівнянь?</p>
                        </div>
                        <div class="back">
                            <p>Визначення, чи має система хоча б один розв’язок.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>2. Який критерій використовується для перевірки сумісності системи?</p>
                        </div>
                        <div class="back">
                            <p>Теорема Кронекера-Капеллі, яка базується на рангах матриць.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>3. Яка умова сумісності системи за теоремою Кронекера-Капеллі?</p>
                        </div>
                        <div class="back">
                            <p>Система сумісна, якщо \( r(A) = r(A|B) \).</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>4. Що означає, якщо \( r(A) = r(A|B) \) і ранг матриці дорівнює кількості змінних?</p>
                        </div>
                        <div class="back">
                            <p>Система має єдиний розв’язок.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>5. Що означає, якщо \( r(A) = r(A|B) \), але ранг менший за кількість змінних?</p>
                        </div>
                        <div class="back">
                            <p>Система має безліч розв’язків.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>6. Що означає, якщо \( r(A) \neq r(A|B) \)?</p>
                        </div>
                        <div class="back">
                            <p>Система несумісна, тобто не має жодного розв’язку.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>7. Як побудувати розширену матрицю системи?</p>
                        </div>
                        <div class="back">
                            <p>Додають до матриці коефіцієнтів \( A \) стовпець вільних членів \( b \), утворюючи \( (A|B) \).</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0">
                    <div class="flashcard-inner">
                        <div class="front">
                            <p>8. Які основні кроки перевірки сумісності системи?</p>
                        </div>
                        <div class="back">
                            <p>
                                1. Побудова матриць \( A \) та \( (A|B) \).<br>
                                2. Обчислення рангів \( r(A) \) і \( r(A|B) \).<br>
                                3. Висновки за теоремою Кронекера-Капеллі.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div id="trainerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
    <div class="modal-header">
        <button class="close-btn" id="closeTrainerBtn" aria-label="Закрити">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container">
            <div class="question-circle">Питання 1</div>
            <div class="trainer-question">
                Задано розширену матрицю системи в східчастому вигляді:
            </div>
            <div class="system-equations" id="systemEquations"></div>
            <div class="trainer-options" id="trainerOptions"></div>
            <button class="trainer-submit" id="submitAnswer">Перевірити</button>
            <div class="trainer-feedback" id="feedbackMessage"></div>
            <div class="completion-message" id="completionMessage" style="display: none;">
    <div class="completion-emoji"></div>
    <h2>Тренування завершено!</h2>
    <p style="font-weight:bold; color:#ccff00;">Молодець!</p>
    <button id="resetTrainerBtn" aria-label="Спробувати ще раз">Спробувати ще раз</button>
</div>
        </div>
    </div>
</div>

    <div id="modalOverlay"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    document.body.classList.add('loaded');

    const elements = {
        openTheoryBtn: document.getElementById('openTheoryBtn'),
        openVideoBtn: document.getElementById('openVideoBtn'),
        openQuestionsBtn: document.getElementById('openQuestionsBtn'),
        openTrainerBtn: document.getElementById('openTrainerBtn'),
        theoryModal: document.getElementById('theoryModal'),
        videoModal: document.getElementById('videoModal'),
        questionsModal: document.getElementById('questionsModal'),
        trainerModal: document.getElementById('trainerModal'),
        videoPlayerModal1: document.getElementById('videoPlayerModal1'),
        closeTheoryBtn: document.getElementById('closeTheoryBtn'),
        closeVideoBtn: document.getElementById('closeVideoBtn'),
        closeQuestionsBtn: document.getElementById('closeQuestionsBtn'),
        closeTrainerBtn: document.getElementById('closeTrainerBtn'),
        closeVideoPlayerBtn1: document.getElementById('closeVideoPlayerBtn1'),
        modalOverlay: document.getElementById('modalOverlay'),
        youtubePlayer1: document.getElementById('youtubePlayer1'),
        systemEquations: document.getElementById('systemEquations'),
        trainerOptions: document.getElementById('trainerOptions'),
        submitAnswer: document.getElementById('submitAnswer'),
        feedbackMessage: document.getElementById('feedbackMessage'),
        completionMessage: document.getElementById('completionMessage'),
        resetTrainerBtn: document.getElementById('resetTrainerBtn'),
        questionCircle: document.querySelector('.question-circle'),
        trainerQuestion: document.querySelector('.trainer-question')
    };

    // Перевірка наявності елементів
    Object.entries(elements).forEach(([key, value]) => {
        if (!value) console.error(`Елемент ${key} не знайдено в DOM`);
    });

    
    function toggleModal(modal, show) {
        if (!modal) {
            console.error('Модальне вікно не знайдено');
            return;
        }
        modal.style.display = show ? 'flex' : 'none';
        elements.modalOverlay.style.display = show ? 'block' : 'none';
        document.body.style.overflow = show ? 'hidden' : 'auto';
        if (show) {
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) closeBtn.focus();
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([modal]).then(() => {
                    console.log(`MathJax типізація завершена для ${modal.id}`);
                    const modalContent = modal.querySelector('.modal-content');
                    if (modalContent) modalContent.scrollTop = 0;
                }).catch(err => console.error('Помилка MathJax:', err));
            }
        }
    }

    // Логіка для YouTube-відео (залишається без змін)
    let players = {};
    const playerIds = {
        'youtubePlayer1': '7iqR_k8tN1E'
    };

    const playerSrcs = {
        'youtubePlayer1': elements.youtubePlayer1?.getAttribute('data-src') || 'https://www.youtube.com/embed/7iqR_k8tN1E'
    };

    function loadYouTubeAPI() {
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
    }

    window.onYouTubeIframeAPIReady = function() {
        Object.keys(playerIds).forEach(playerId => {
            const element = elements[playerId];
            if (element) {
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => {
                            event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
                        },
                        'onError': event => {
                            console.error(`YouTube Player error for ${playerId}:`, event.data);
                        }
                    }
                });
            }
        });
    };

    loadYouTubeAPI();

    function stopAllVideos() {
        Object.keys(players).forEach(playerId => {
            const player = players[playerId];
            const element = elements[playerId];
            if (player && typeof player.stopVideo === 'function') {
                player.stopVideo();
            }
            if (element) {
                element.src = '';
                const parent = element.parentNode;
                const newIframe = document.createElement('iframe');
                newIframe.id = playerId;
                newIframe.setAttribute('data-src', playerSrcs[playerId]);
                newIframe.setAttribute('src', playerSrcs[playerId]);
                newIframe.setAttribute('title', 'Невизначені системи лінійних рівнянь. Теорема Кронекера-Капеллі');
                newIframe.setAttribute('frameborder', '0');
                newIframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
                newIframe.setAttribute('allowfullscreen', '');
                newIframe.style.width = '100%';
                newIframe.style.height = '100%';
                parent.replaceChild(newIframe, element);
                elements[playerId] = newIframe;
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 }),
                        'onError': event => console.error(`YouTube Player error for ${playerId}:`, event.data)
                    }
                });
            }
        });
    }

    function openVideoPlayerModal(videoModal, playerId) {
        stopAllVideos();
        toggleModal(elements.videoModal, false);
        toggleModal(videoModal, true);
        const element = elements[playerId];
        if (element && !element.src) {
            element.src = playerSrcs[playerId];
        }
        if (players[playerId] && typeof players[playerId].loadVideoById === 'function') {
            players[playerId].loadVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
        }
    }

    // Логіка для флеш-карток (залишається без змін)
    document.querySelectorAll('.flashcard').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('flipped');
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([card]).catch(err => console.error('MathJax error in flashcard:', err));
            }
        });
        card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === 'Space') {
                e.preventDefault();
                card.classList.toggle('flipped');
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([card]).catch(err => console.error('MathJax error in flashcard:', err));
                }
            }
        });
    });

    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoNumber = card.getAttribute('data-video');
            const videoModal = elements[`videoPlayerModal${videoNumber}`];
            const playerId = `youtubePlayer${videoNumber}`;
            if (videoModal && playerId) openVideoPlayerModal(videoModal, playerId);
            else console.error(`Video modal or player not found for video ${videoNumber}`);
        });
    });



// Логіка для тренажера
let correctRankA, correctRankAb;
let questionCount = 1;

const fixedMatricesQ3 = [
    {
        A: [[1, -1, 2], [4, -4, 8], [-3, 3, -6]],
        b: [5, 20, -15],
        correct: { rankA: 1, rankAb: 1 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[5, 4, -3], [-10, -8, 6], [-5, -4, 3]],
        b: [4, 3, -4],
        correct: { rankA: 1, rankAb: 2 },
        incorrect: [
            { rankA: 1, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 1 }
        ]
    },
    {
        A: [[3, -2, 4], [1, 5, -3], [6, -4, 8]],
        b: [1, 2, 2],
        correct: { rankA: 2, rankAb: 2 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[4, -2, 1], [5, 3, 2], [-8, 4, -2]],
        b: [4, 3, 6],
        correct: { rankA: 2, rankAb: 3 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[3, 2, -5], [2, -1, 3], [1, 2, -1]],
        b: [-1, 13, 9],
        correct: { rankA: 3, rankAb: 3 },
        incorrect: [
            { rankA: 2, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[3, 2, -5], [-6, -4, 10], [9, 6, -15]],
        b: [1, -2, 3],
        correct: { rankA: 1, rankAb: 1 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[-2, 3, 1], [2, -3, -1], [-8, 12, 4]],
        b: [-1, 5, -4],
        correct: { rankA: 1, rankAb: 2 },
        incorrect: [
            { rankA: 1, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 1 }
        ]
    },
    {
        A: [[4, 1, -2], [8, 4, 6], [-8, -2, 4]],
        b: [-3, -1, 6],
        correct: { rankA: 2, rankAb: 2 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[1, 4, 5], [3, 12, 10], [-4, -16, -20]],
        b: [2, 4, 8],
        correct: { rankA: 2, rankAb: 3 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[1, -2, 3], [2, 4, -3], [1, 3, 2]],
        b: [0, -1, 4],
        correct: { rankA: 3, rankAb: 3 },
        incorrect: [
            { rankA: 2, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[1, 0, 1], [0, 0, 0], [-2, 0, -2]],
        b: [4, 0, -8],
        correct: { rankA: 1, rankAb: 1 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[2, 1, 0], [6, 3, 0], [-4, -2, 0]],
        b: [-1, -3, -2],
        correct: { rankA: 1, rankAb: 2 },
        incorrect: [
            { rankA: 1, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 1 }
        ]
    },
    {
        A: [[0, 1, -3], [2, 0, -3], [0, -2, 6]],
        b: [1, 0, -2],
        correct: { rankA: 2, rankAb: 2 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 3 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[0, -1, 1], [1, 0, 1], [1, 1, 0]],
        b: [-1, 1, 1],
        correct: { rankA: 2, rankAb: 3 },
        incorrect: [
            { rankA: 3, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    },
    {
        A: [[0, -1, 1], [1, 0, 1], [1, -1, 0]],
        b: [-1, 1, 1],
        correct: { rankA: 3, rankAb: 3 },
        incorrect: [
            { rankA: 2, rankAb: 3 },
            { rankA: 2, rankAb: 2 },
            { rankA: 1, rankAb: 2 }
        ]
    }
];

const fixedSystemsQ4 = [
    {
        A: [[3, 2, -5], [2, -1, 3], [1, 2, -1]],
        b: [-1, 13, 9],
        equations: ['3x + 2y - 5z = -1', '2x - y + 3z = 13', 'x + 2y - z = 9'],
        correct: 'Система сумісна і має один розв’язок',
        incorrect: ['Система сумісна і має безліч розв’язків', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[2, 3, -1, 1], [8, 12, -9, 8], [4, 6, 3, -2], [2, 3, 9, -7]],
        b: [1, 3, 3, 3],
        equations: ['2x_1 + 3x_2 - x_3 + x_4 = 1', '8x_1 + 12x_2 - 9x_3 + 8x_4 = 3', '4x_1 + 6x_2 + 3x_3 - 2x_4 = 3', '2x_1 + 3x_2 + 9x_3 - 7x_4 = 3'],
        correct: 'Система сумісна і має безліч розв’язків',
        incorrect: ['Система сумісна і має один розв’язок', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[4, -3, 2, -1], [3, -2, 1, -3], [5, -3, 1, -8]],
        b: [8, 7, 1],
        equations: ['4x_1 - 3x_2 + 2x_3 - x_4 = 8', '3x_1 - 2x_2 + x_3 - 3x_4 = 7', '5x_1 - 3x_2 + x_3 - 8x_4 = 1'],
        correct: 'Система несумісна',
        incorrect: ['Система сумісна і має один розв’язок', 'Система сумісна і має безліч розв’язків', 'Неможливо визначити']
    },
    {
        A: [[3, 4, -1, -1], [2, -1, -2, 2], [1, 3, 5, -4], [4, -8, -3, 3]],
        b: [3, 9, 2, 10],
        equations: ['3x_1 + 4x_2 - x_3 - x_4 = 3', '2x_1 - x_2 - 2x_3 + 2x_4 = 9', 'x_1 + 3x_2 + 5x_3 - 4x_4 = 2', '4x_1 - 8x_2 - 3x_3 + 3x_4 = 10'],
        correct: 'Система сумісна і має один розв’язок',
        incorrect: ['Система сумісна і має безліч розв’язків', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[2, -1, 1, -5], [2, 1, 2, -1], [6, -1, 1, 11]],
        b: [4, 1, 6],
        equations: ['2x_1 - x_2 + x_3 - 5x_4 = 4', '2x_1 + x_2 + 2x_3 - x_4 = 1', '6x_1 - x_2 + x_3 + 11x_4 = 6'],
        correct: 'Система сумісна і має безліч розв’язків',
        incorrect: ['Система сумісна і має один розв’язок', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[1, 1, -3, 2], [0, 1, 1, 3], [1, -2, 0, -1], [2, -3, 2, 0]],
        b: [6, 16, -6, 6],
        equations: ['x_1 + x_2 - 3x_3 + 2x_4 = 6', 'x_2 + x_3 + 3x_4 = 16', 'x_1 - 2x_2 - x_4 = -6', '2x_1 - 3x_2 + 2x_3 = 6'],
        correct: 'Система сумісна і має один розв’язок',
        incorrect: ['Система сумісна і має безліч розв’язків', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[3, -5, 2, 4], [7, -4, 1, 3], [5, 7, -4, -6]],
        b: [2, 5, 3],
        equations: ['3x_1 - 5x_2 + 2x_3 + 4x_4 = 2', '7x_1 - 4x_2 + x_3 + 3x_4 = 5', '5x_1 + 7x_2 - 4x_3 - 6x_4 = 3'],
        correct: 'Система несумісна',
        incorrect: ['Система сумісна і має один розв’язок', 'Система сумісна і має безліч розв’язків', 'Неможливо визначити']
    },
    {
        A: [[9, -3, 5, 6], [6, -2, 3, 4], [3, -1, 3, 14]],
        b: [4, 5, -8],
        equations: ['9x_1 - 3x_2 + 5x_3 + 6x_4 = 4', '6x_1 - 2x_2 + 3x_3 + 4x_4 = 5', '3x_1 - x_2 + 3x_3 + 14x_4 = -8'],
        correct: 'Система сумісна і має безліч розв’язків',
        incorrect: ['Система сумісна і має один розв’язок', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[1, 2, -4], [2, 1, -5], [1, -1, -1]],
        b: [1, -1, -2],
        equations: ['x + 2y - 4z = 1', '2x + y - 5z = -1', 'x - y - z = -2'],
        correct: 'Система сумісна і має один розв’язок',
        incorrect: ['Система сумісна і має безліч розв’язків', 'Система несумісна', 'Неможливо визначити']
    },
    {
        A: [[2, -1, 1], [1, 2, 3], [1, -3, -2]],
        b: [-2, -1, 3],
        equations: ['2x - y + z = -2', 'x + 2y + 3z = -1', 'x - 3y - 2z = 3'],
        correct: 'Система несумісна',
        incorrect: ['Система сумісна і має один розв’язок', 'Система сумісна і має безліч розв’язків', 'Неможливо визначити']
    }
];

function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function computeRank(matrix) {
    try {
        const m = matrix.length;
        const n = matrix[0].length;
        const mat = matrix.map(row => row.slice());
        let rank = 0;
        let lead = 0;

        while (lead < m && rank < n) {
            let i = lead;
            while (i < m && Math.abs(mat[i][rank]) < 1e-8) i++;
            if (i === m) { rank++; continue; }
            if (i !== lead) [mat[lead], mat[i]] = [mat[i], mat[lead]];
            const pivot = mat[lead][rank];
            if (Math.abs(pivot) < 1e-8) { rank++; continue; }
            for (let j = 0; j < n; j++) mat[lead][j] /= pivot;
            for (let k = 0; k < m; k++) {
                if (k !== lead && Math.abs(mat[k][rank]) > 1e-8) {
                    const factor = mat[k][rank];
                    for (let j = 0; j < n; j++) mat[k][j] -= factor * mat[lead][j];
                }
            }
            lead++;
            rank++;
        }
        for (let i = lead; i < m; i++) {
            if (mat[i].some(val => Math.abs(val) > 1e-8)) {
                lead++;
            }
        }
        return lead;
    } catch (err) {
        console.error('Помилка в computeRank:', err);
        throw err;
    }
}

function generateQuestion() {
    try {
        console.log('Генерація питання для questionCount:', questionCount);
        elements.trainerQuestion.innerHTML = '';
        elements.trainerOptions.innerHTML = '';
        elements.systemEquations.innerHTML = '';

        let A, b, options;
        const allowedRanksQ1 = [
            { rankA: 1, rankAb: 1 },
            { rankA: 1, rankAb: 2 },
            { rankA: 2, rankAb: 2 },
            { rankA: 2, rankAb: 3 },
            { rankA: 3, rankAb: 3 }
        ];
        const allowedRanksQ2 = [
            { rankA: 1, rankAb: 1 },
            { rankA: 1, rankAb: 2 },
            { rankA: 2, rankAb: 2 },
            { rankA: 2, rankAb: 3 },
            { rankA: 3, rankAb: 3 },
            { rankA: 3, rankAb: 4 },
            { rankA: 4, rankAb: 4 }
        ];

        let maxRankAttempts = 50;
        let rankAttempts = 0;

        if (questionCount === 3) {
            console.log('Генерація питання 3');
            const system = fixedMatricesQ3[Math.floor(Math.random() * fixedMatricesQ3.length)];
            A = system.A.map(row => row.slice());
            b = system.b.slice();
            const rankA = system.correct.rankA;
            const rankAb = system.correct.rankAb;

            options = [
                { text: `r(A)=${rankA}, r(A|b)=${rankAb}`, correct: true },
                ...system.incorrect.map(opt => ({
                    text: `r(A)=${opt.rankA}, r(A|b)=${opt.rankAb}`,
                    correct: false
                }))
            ];

            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            console.log('Система для питання 3:', { A, b, rankA, rankAb, options });

            const Ab = A.map((row, i) => [...row, b[i]]);
            const computedRankA = computeRank(A);
            const computedRankAb = computeRank(Ab);
            console.log('Обчислені ранги: r(A)=', computedRankA, 'r(A|b)=', computedRankAb);
            if (computedRankA !== rankA || computedRankAb !== rankAb) {
                console.error('Невідповідність рангів:', { computedRankA, computedRankAb, expectedRankA: rankA, expectedRankAb: rankAb });
                elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка: Невідповідність рангів для питання 3</span>';
                elements.trainerOptions.innerHTML = '';
                elements.submitAnswer.style.display = 'none';
                return;
            }

            const matrixLatex = `\\left( \\begin{array}{ccc|c} ${A.map((row, i) => row.join(' & ') + ' & ' + b[i]).join(' \\\\ ')} \\end{array} \\right)`;
            elements.trainerQuestion.innerHTML = `
                Задано розширену матрицю системи:<br>
                \\[(A \\mid b) = ${matrixLatex}\\]<br>
                Обчисліть \\( r(A) \\) та \\( r(A|b) \\).
            `;
            console.log('LaTeX для матриці:', matrixLatex);

            elements.trainerOptions.innerHTML = options.map((opt, index) => `
                <button class="option-btn" data-option="${index}" data-correct="${opt.correct}" aria-label="Варіант ${index + 1}: ${opt.text}">
                    \\(${opt.text}\\)
                </button>
            `).join('');
            console.log('Варіанти відповідей:', options);
        } else if (questionCount === 4) {
            console.log('Генерація питання 4');
            const system = fixedSystemsQ4[Math.floor(Math.random() * fixedSystemsQ4.length)];
            A = system.A.map(row => row.slice());
            b = system.b.slice();
            const equations = system.equations;

            options = [
                { text: system.correct, correct: true },
                ...system.incorrect.map(opt => ({
                    text: opt,
                    correct: false
                }))
            ];

            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            console.log('Система для питання 4:', { A, b, equations, correct: system.correct, options });

            const Ab = A.map((row, i) => [...row, b[i]]);
            const computedRankA = computeRank(A);
            const computedRankAb = computeRank(Ab);
            console.log('Обчислені ранги: r(A)=', computedRankA, 'r(A|b)=', computedRankAb);

            // Перевірка сумісності системи
            const n = A[0].length; // Кількість змінних
            let expectedAnswer;
            if (computedRankA !== computedRankAb) {
                expectedAnswer = 'Система несумісна';
            } else if (computedRankA === computedRankAb && computedRankA === n) {
                expectedAnswer = 'Система сумісна і має один розв’язок';
            } else if (computedRankA === computedRankAb && computedRankA < n) {
                expectedAnswer = 'Система сумісна і має безліч розв’язків';
            } else {
                expectedAnswer = 'Неможливо визначити';
            }

            if (expectedAnswer !== system.correct) {
                console.error('Невідповідність відповіді:', { computedAnswer: expectedAnswer, expectedCorrect: system.correct, rankA: computedRankA, rankAb: computedRankAb });
                elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка: Невідповідність відповіді для питання 4</span>';
                elements.trainerOptions.innerHTML = '';
                elements.submitAnswer.style.display = 'none';
                return;
            }

            const equationsLatex = equations.join('\\\\');
            elements.trainerQuestion.innerHTML = `
                Дослідіть систему на сумісність. Якщо сумісна — вкажіть, скільки в неї розв’язків:<br>
                \\[\\begin{cases} ${equationsLatex} \\end{cases}\\]<br>
            `;
            console.log('LaTeX для рівнянь:', equationsLatex);

            elements.trainerOptions.innerHTML = options.map((opt, index) => `
                <button class="option-btn" data-option="${index}" data-correct="${opt.correct}" aria-label="Варіант ${index + 1}: ${opt.text}">
                    ${opt.text}
                </button>
            `).join('');
            console.log('Варіанти відповідей:', options);
        } else {
            const allowedRanks = questionCount === 1 ? allowedRanksQ1 : allowedRanksQ2;
            let computedRankA, computedRankAb, Ab;

            do {
                rankAttempts++;
                if (rankAttempts > maxRankAttempts) {
                    console.error('Не вдалося згенерувати матрицю з потрібними рангами після', maxRankAttempts, 'спроб');
                    elements.trainerQuestion.innerHTML = `<span style="color: red;">Помилка: Не вдалося згенерувати питання ${questionCount}</span>`;
                    elements.trainerOptions.innerHTML = '';
                    elements.submitAnswer.style.display = 'none';
                    return;
                }

                const selectedRank = allowedRanks[Math.floor(Math.random() * allowedRanks.length)];
                correctRankA = selectedRank.rankA;
                correctRankAb = selectedRank.rankAb;

                console.log('Вибрані ранги для питання', questionCount, ': r(A)=', correctRankA, ', r(A|b)=', correctRankAb);

                if (questionCount === 1) {
                    A = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
                    b = [0, 0, 0];
                    if (correctRankA === 1) {
                        const pivot = randomInt(-5, 5) || 1;
                        A[0] = [pivot, randomInt(-5, 5), randomInt(-5, 5)];
                        if (correctRankAb === 1) {
                            const scalar = randomInt(-10, 10) || 1;
                            b[0] = scalar * pivot;
                            if (b[0] > 30 || b[0] < -30) b[0] = Math.sign(b[0]) * 30;
                            b[1] = 0;
                            b[2] = 0;
                        } else {
                            b[0] = randomInt(-30, 30);
                            b[1] = randomInt(-30, 30);
                            b[2] = 0;
                        }
                    } else if (correctRankA === 2) {
                        const pivot1 = randomInt(-5, 5) || 1;
                        A[0] = [pivot1, randomInt(-5, 5), randomInt(-5, 5)];
                        const pivot2 = randomInt(-5, 5) || 1;
                        A[1] = [0, pivot2, randomInt(-5, 5)];
                        if (correctRankAb === 2) {
                            const scalar1 = randomInt(-10, 10) || 1;
                            const scalar2 = randomInt(-10, 10) || 1;
                            b[0] = scalar1 * pivot1;
                            b[1] = scalar2 * pivot2;
                            if (b[0] > 30 || b[0] < -30) b[0] = Math.sign(b[0]) * 30;
                            if (b[1] > 30 || b[1] < -30) b[1] = Math.sign(b[1]) * 30;
                            b[2] = 0;
                        } else {
                            b[0] = randomInt(-30, 30);
                            b[1] = randomInt(-30, 30);
                            b[2] = randomInt(-30, 30);
                        }
                    } else {
                        const pivot1 = randomInt(-5, 5) || 1;
                        const pivot2 = randomInt(-5, 5) || 1;
                        const pivot3 = randomInt(-5, 5) || 1;
                        A[0] = [pivot1, randomInt(-5, 5), randomInt(-5, 5)];
                        A[1] = [0, pivot2, randomInt(-5, 5)];
                        A[2] = [0, 0, pivot3];
                        b = [randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30)];
                    }
                } else {
                    A = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]];
                    b = [0, 0, 0, 0];
                    if (correctRankA === 1 && correctRankAb === 1) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        A[0] = row1;
                        const b1 = randomInt(-30, 30) || 1;
                        b = [b1, 0, 0, 0];
                        for (let i = 1; i < 4; i++) {
                            if (i === 1) {
                                const scalar = randomInt(-5, 5) || 1;
                                A[i] = row1.map(x => x * scalar);
                                b[i] = b1 * scalar;
                            } else {
                                A[i] = [0, 0, 0, 0];
                                b[i] = 0;
                            }
                        }
                    } else if (correctRankA === 1 && correctRankAb === 2) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        A[0] = row1;
                        const scalar = randomInt(-5, 5) || 1;
                        A[1] = row1.map(x => x * scalar);
                        A[2] = [0, 0, 0, 0];
                        A[3] = [0, 0, 0, 0];
                        const b0 = randomInt(-30, 30) || 1;
                        b = [b0, b0 * scalar, randomInt(-30, 30) || 1, 0];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank([row1, b]) !== 2 && attempts < maxAttempts) {
                            b[2] = randomInt(-30, 30) || 1;
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                    } else if (correctRankA === 2 && correctRankAb === 2) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        const row2 = [0, 0, randomInt(-5, 5) || 1, randomInt(-5, 5)];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank([row1, row2]) !== 2 && attempts < maxAttempts) {
                            row2[2] = randomInt(-5, 5) || 1;
                            row2[3] = randomInt(-5, 5);
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                        A[0] = row1;
                        const scalar0 = randomInt(-5, 5) || 1;
                        A[1] = row2;
                        const scalar1 = randomInt(-5, 5) || 1;
                        A[2] = row2.map(x => x * scalar1);
                        const scalar2 = randomInt(-5, 5) || 1;
                        A[3] = row2.map(x => x * scalar2);
                        const b1 = randomInt(-10, 10) || 1;
                        b = [b1 * scalar0, b1, b1 * scalar1, b1 * scalar2];
                        b = b.map(x => Math.max(-30, Math.min(30, x)));
                    } else if (correctRankA === 2 && correctRankAb === 3) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        const row2 = [0, randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5)];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank([row1, row2]) !== 2 && attempts < maxAttempts) {
                            row2[1] = randomInt(-5, 5) || 1;
                            row2[2] = randomInt(-5, 5);
                            row2[3] = randomInt(-5, 5);
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                        const k = randomInt(-5, 5) || 1;
                        const row3 = row2.map(x => x * k);
                        const row4 = [0, 0, 0, 0];
                        b = [randomInt(-30, 30) || 1, randomInt(-30, 30) || 1, row3[3], randomInt(-30, 30) || 1];
                        A[0] = row1;
                        A[1] = row2;
                        A[2] = row3;
                        A[3] = row4;
                        attempts = 0;
                        while (computeRank([row1, row2, row3, row4, b]) !== 3 && attempts < maxAttempts) {
                            b[0] = randomInt(-30, 30) || 1;
                            b[1] = randomInt(-30, 30) || 1;
                            b[3] = randomInt(-30, 30) || 1;
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                    } else if (correctRankA === 3 && correctRankAb === 3) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        const row2 = [0, randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5)];
                        const row3 = [0, 0, randomInt(-5, 5) || 1, randomInt(-5, 5)];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank([row1, row2, row3]) !== 3 && attempts < maxAttempts) {
                            row2[1] = randomInt(-5, 5) || 1;
                            row3[2] = randomInt(-5, 5) || 1;
                            row2[2] = row2[3] = row3[3] = randomInt(-5, 5);
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                        A[0] = row1;
                        A[1] = row2;
                        A[2] = row3;
                        A[3] = [0, 0, 0, randomInt(-5, 5) || 1];
                        const scalar1 = randomInt(-10, 10) || 1;
                        const scalar2 = randomInt(-10, 10) || 1;
                        const scalar3 = randomInt(-10, 10) || 1;
                        b = row1.map((x, i) => x * scalar1 + row2[i] * scalar2 + row3[i] * scalar3);
                        b = b.map(x => Math.max(-30, Math.min(30, x)));
                    } else if (correctRankA === 3 && correctRankAb === 4) {
                        const row1 = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        const row2 = [0, 0, randomInt(-5, 5) || 1, randomInt(-5, 5)];
                        const row3 = [0, 0, 0, randomInt(-5, 5) || 1];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank([row1, row2, row3]) !== 3 && attempts < maxAttempts) {
                            row2[2] = randomInt(-5, 5) || 1;
                            row3[3] = randomInt(-5, 5) || 1;
                            row2[3] = randomInt(-5, 5);
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                        A[0] = row1;
                        A[1] = row2;
                        A[2] = row3;
                        A[3] = [0, 0, 0, 0];
                        b = [randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30)];
                        attempts = 0;
                        while (computeRank([row1, row2, row3, b]) !== 4 && attempts < maxAttempts) {
                            b = [randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30)];
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                    } else if (correctRankA === 4 && correctRankAb === 4) {
                        A[0] = [randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5), randomInt(-5, 5)];
                        A[1] = [0, randomInt(-5, 5) || 1, randomInt(-5, 5), randomInt(-5, 5)];
                        A[2] = [0, 0, randomInt(-5, 5) || 1, randomInt(-5, 5)];
                        A[3] = [0, 0, 0, randomInt(-5, 5) || 1];
                        let attempts = 0;
                        const maxAttempts = 100;
                        while (computeRank(A) !== 4 && attempts < maxAttempts) {
                            A[1][1] = randomInt(-5, 5) || 1;
                            A[2][2] = randomInt(-5, 5) || 1;
                            A[3][3] = randomInt(-5, 5) || 1;
                            A[1][2] = A[1][3] = A[2][3] = randomInt(-5, 5);
                            attempts++;
                        }
                        if (attempts >= maxAttempts) continue;
                        b = [randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30), randomInt(-30, 30)];
                    }
                }

                Ab = A.map((row, i) => [...row, b[i]]);
                computedRankA = computeRank(A);
                computedRankAb = computeRank(Ab);
            } while (computedRankA !== correctRankA || computedRankAb !== correctRankAb);

            console.log('Згенеровано A:', A, 'b:', b);
            console.log('Обчислені ранги: r(A)=', computedRankA, 'r(A|b)=', computedRankAb, 'Очікувані: r(A)=', correctRankA, 'r(A|b)=', correctRankAb);

            const matrixLatex = `\\left( \\begin{array}{${questionCount === 1 ? 'ccc|c' : 'cccc|c'}} ${A.map((row, i) => row.join(' & ') + ' & ' + b[i]).join(' \\\\ ')} \\end{array} \\right)`;
            elements.trainerQuestion.innerHTML = `
                Задано розширену матрицю системи${questionCount === 1 ? ' в східчастому вигляді' : ''}:<br>
                \\[(A \\mid b) = ${matrixLatex}\\]<br>
                Обчисліть \\( r(A) \\) та \\( r(A|b) \\).
            `;
            elements.systemEquations.innerHTML = '';

            const allPossibleRanks = questionCount === 1 ? allowedRanksQ1 : allowedRanksQ2;
            options = [
                { text: `r(A)=${correctRankA}, r(A|b)=${correctRankAb}`, correct: true },
                ...allPossibleRanks
                    .filter(r => r.rankA !== correctRankA || r.rankAb !== correctRankAb)
                    .slice(0, 3)
                    .map(opt => ({ text: `r(A)=${opt.rankA}, r(A|b)=${opt.rankAb}`, correct: false }))
            ];
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }

            elements.trainerOptions.innerHTML = options.map((opt, index) => `
                <button class="option-btn" data-option="${index}" data-correct="${opt.correct}" aria-label="Варіант ${index + 1}: ${opt.text}">
                    \\(${opt.text}\\)
                </button>
            `).join('');
        }

        if (!elements.trainerQuestion.innerHTML || !elements.trainerOptions.innerHTML) {
            console.error('DOM-елементи не заповнені для питання', questionCount);
            elements.trainerQuestion.innerHTML = `<span style="color: red;">Помилка: Не вдалося відобразити питання ${questionCount}</span>`;
            elements.trainerOptions.innerHTML = '';
            elements.submitAnswer.style.display = 'none';
            return;
        }

        elements.questionCircle.textContent = `Питання ${questionCount}`;
        elements.questionCircle.style.display = 'flex';
        elements.trainerQuestion.style.display = 'block';
        elements.systemEquations.style.display = 'none';
        elements.trainerOptions.style.display = 'grid';
        elements.feedbackMessage.style.display = 'none';
        elements.completionMessage.style.display = 'none';
        elements.submitAnswer.style.display = 'block';
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('wrong', 'selected', 'correct');
        });

        if (window.MathJax && MathJax.typesetPromise) {
            console.log('Запуск MathJax для питання', questionCount);
            MathJax.typesetPromise([elements.trainerQuestion, elements.trainerOptions])
                .then(() => {
                    console.log('MathJax успішно обробив питання', questionCount);
                    elements.trainerOptions.removeEventListener('click', handleOptionClick);
                    elements.trainerOptions.addEventListener('click', handleOptionClick);
                })
                .catch(err => {
                    console.error('Помилка MathJax:', err);
                    elements.trainerQuestion.innerHTML = `
                        <span style="color: red;">Помилка MathJax. Матриця: ${A.map((row, i) => row.join(', ') + ' | ' + b[i]).join('; ')}</span>
                    `;
                });
        } else {
            console.error('MathJax не завантажено');
            elements.trainerQuestion.innerHTML = `
                <span style="color: red;">Помилка: MathJax не завантажено. Матриця: ${A.map((row, i) => row.join(', ') + ' | ' + b[i]).join('; ')}</span>
            `;
        }
    } catch (err) {
        console.error('Помилка в generateQuestion:', err);
        elements.trainerQuestion.innerHTML = `<span style="color: red;">Помилка генерації питання ${questionCount}: ${err.message}</span>`;
        elements.trainerOptions.innerHTML = '';
        elements.submitAnswer.style.display = 'none';
    }
}

function handleOptionClick(event) {
    const btn = event.target.closest('.option-btn');
    if (!btn) return;
    console.log('Клік по кнопці:', btn.getAttribute('aria-label'));
    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected', 'wrong', 'correct'));
    btn.classList.add('selected');
}

function resetTrainer() {
    questionCount = 1; // Скидаємо до 1
    elements.systemEquations.innerHTML = '';
    elements.trainerOptions.innerHTML = '';
    elements.feedbackMessage.style.display = 'none';
    elements.completionMessage.style.display = 'none';
    elements.submitAnswer.style.display = 'block';
    elements.questionCircle.style.display = 'flex';
    elements.trainerQuestion.style.display = 'block';
    elements.questionCircle.textContent = 'Питання 1'; // Явно встановлюємо "Питання 1"
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('wrong', 'selected', 'correct');
    });
    console.log('resetTrainer: questionCount =', questionCount, ', questionCircle.textContent =', elements.questionCircle.textContent);
    generateQuestion(); // Викликаємо після скидання
}
    
    // Додавання слухачів подій
    if (elements.openTheoryBtn) elements.openTheoryBtn.addEventListener('click', () => toggleModal(elements.theoryModal, true));
    if (elements.openVideoBtn) elements.openVideoBtn.addEventListener('click', () => toggleModal(elements.videoModal, true));
    if (elements.openQuestionsBtn) elements.openQuestionsBtn.addEventListener('click', () => toggleModal(elements.questionsModal, true));
    if (elements.openTrainerBtn) elements.openTrainerBtn.addEventListener('click', () => {
        toggleModal(elements.trainerModal, true);
        generateQuestion();
    });
    if (elements.closeTheoryBtn) elements.closeTheoryBtn.addEventListener('click', () => toggleModal(elements.theoryModal, false));
    if (elements.closeVideoBtn) elements.closeVideoBtn.addEventListener('click', () => toggleModal(elements.videoModal, false));
    if (elements.closeQuestionsBtn) elements.closeQuestionsBtn.addEventListener('click', () => toggleModal(elements.questionsModal, false));
    if (elements.closeTrainerBtn) elements.closeTrainerBtn.addEventListener('click', () => {
        toggleModal(elements.trainerModal, false);
        resetTrainer();
    });
    if (elements.closeVideoPlayerBtn1) elements.closeVideoPlayerBtn1.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoModal, true);
    });
    if (elements.modalOverlay) {
        elements.modalOverlay.addEventListener('click', () => {
            stopAllVideos();
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.videoModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
            toggleModal(elements.videoPlayerModal1, false);
            resetTrainer();
        });
    }
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            stopAllVideos();
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.videoModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
            toggleModal(elements.videoPlayerModal1, false);
            resetTrainer();
        }
    });

if (elements.submitAnswer) {
    elements.submitAnswer.addEventListener('click', () => {
        const selectedBtn = elements.trainerOptions.querySelector('.option-btn.selected');
        const fb = elements.feedbackMessage;

        if (!fb) {
            console.error('Елемент feedbackMessage не знайдено');
            elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка: Елемент feedbackMessage не знайдено</span>';
            return;
        }

        fb.style.display = 'none';
        fb.className = 'trainer-feedback';

        if (!selectedBtn) {
            fb.style.display = 'block';
            fb.textContent = 'Виберіть варіант відповіді!';
            fb.className = 'trainer-feedback wrong show';
            setTimeout(() => {
                fb.className = 'trainer-feedback';
                fb.style.display = 'none';
                fb.textContent = '';
            }, 2000);
            return;
        }

        const isCorrect = selectedBtn.dataset.correct === 'true';
        console.log('Обрано відповідь:', selectedBtn.getAttribute('aria-label'), 'Правильна:', isCorrect, 'questionCount:', questionCount, 'dataset.correct:', selectedBtn.dataset.correct);

        if (isCorrect) {
            fb.style.display = 'block';
            fb.textContent = 'Правильно! Молодець!';
            fb.className = 'trainer-feedback correct show';
            selectedBtn.classList.add('correct');
            setTimeout(() => {
                fb.className = 'trainer-feedback';
                fb.style.display = 'none';
                fb.textContent = '';
                elements.trainerQuestion.innerHTML = '';
                elements.trainerOptions.innerHTML = '';
                elements.systemEquations.innerHTML = '';
                console.log('Перехід до наступного питання, поточний questionCount:', questionCount);
                if (questionCount === 1) {
                    questionCount = 2;
                    console.log('Встановлено questionCount = 2');
                    elements.questionCircle.textContent = 'Питання 2';
                    generateQuestion();
                } else if (questionCount === 2) {
                    questionCount = 3;
                    console.log('Встановлено questionCount = 3');
                    elements.questionCircle.textContent = 'Питання 3';
                    generateQuestion();
                } else if (questionCount === 3) {
                    questionCount = 4;
                    console.log('Встановлено questionCount = 4');
                    elements.questionCircle.textContent = 'Питання 4';
                    generateQuestion();
                } else if (questionCount === 4) {
                    console.log('Завершення тренажера');
                     elements.questionCircle.style.display = 'none';
                            elements.trainerQuestion.style.display = 'none';
                            elements.systemEquations.style.display = 'none';
                            elements.trainerOptions.style.display = 'none';
                            elements.submitAnswer.style.display = 'none';
                            elements.completionMessage.style.display = 'block';
                            elements.resetTrainerBtn?.focus();
                } else {
                    console.error('Некоректне значення questionCount:', questionCount);
                    elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка: Некоректний стан тренажера</span>';
                }
                if (window.MathJax && MathJax.typesetPromise && questionCount <= 4) {
                    console.log('Запуск MathJax після переходу до питання', questionCount);
                    MathJax.typesetPromise([elements.trainerQuestion, elements.trainerOptions])
                        .then(() => console.log('MathJax оновлено для питання', questionCount))
                        .catch(err => {
                            console.error('Помилка MathJax:', err);
                            elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка MathJax</span>';
                        });
                }
            }, 2000);
        } else {
            fb.style.display = 'block';
            fb.textContent = 'Неправильно, спробуй ще раз!';
            fb.className = 'trainer-feedback wrong show';
            selectedBtn.classList.add('wrong');
            setTimeout(() => {
                fb.className = 'trainer-feedback';
                fb.style.display = 'none';
                fb.textContent = '';
                document.querySelectorAll('.option-btn').forEach(btn => {
                    btn.classList.remove('wrong', 'selected', 'correct');
                });
                console.log('Генерація нового питання після неправильної відповіді для questionCount:', questionCount);
                generateQuestion();
                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([elements.trainerQuestion, elements.trainerOptions])
                        .then(() => console.log('MathJax оновлено після неправильної відповіді'))
                        .catch(err => {
                            console.error('Помилка MathJax:', err);
                            elements.trainerQuestion.innerHTML = '<span style="color: red;">Помилка MathJax</span>';
                        });
                }
            }, 2000);
        }
    });
}

if (elements.resetTrainerBtn) {
    elements.resetTrainerBtn.addEventListener('click', () => {
        console.log('Скидання тренажера');
        resetTrainer();
    });
}

console.log('MathJax:', window.MathJax);
generateQuestion();
    });
    </script>
</body>
</html>


