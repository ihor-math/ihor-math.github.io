<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. Алгебраїчна форма комплексних чисел</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #2F4F4F, #4B5320);
            font-family: 'Roboto', sans-serif;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100dvh;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background-color: #800000;
            border-radius: 25px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            text-align: center;
        }
        .title-box h1 {
            margin: 0;
            font-size: 28px;
            color: #FFFF00;
            text-shadow: 1px 1px 2px rgba(0, 96, 100, 0.2);
            font-family: 'Lora', serif;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: linear-gradient(135deg, #3C4033, #4A4F3A, #5A5F4A);
            border-radius: 20px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }
        .section:hover {
            transform: translateY(-5px);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
        }
        .section h2 {
            font-size: 20px;
            color: #FFFFFF;
            margin: 0;
            font-family: 'Lora', serif;
        }
        #theoryModal, #questionsModal, #trainerModal, #videoModal, #videoPlayerModal1, #videoPlayerModal2, #videoPlayerModal3 {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow: hidden;
            flex-direction: column;
        }
         #theoryModal .modal-content, #questionsModal .modal-content, #trainerModal .modal-content, #videoModal .modal-content, #videoPlayerModal1 .modal-content, #videoPlayerModal2 .modal-content, #videoPlayerModal3 .modal-content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin: 10px;
        }
        #trainerModal .modal-content {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        #theoryModal .modal-content p {
            text-align: justify;
        }
        #theoryModal .modal-header, #questionsModal .modal-header, #trainerModal .modal-header, #videoModal .modal-header, #videoPlayerModal1 .modal-header, #videoPlayerModal2 .modal-header, #videoPlayerModal3 .modal-header {
            display: flex;
            justify-content: flex-end;
            background: #006064;
            padding: 8px 10px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        #theoryModal .close-btn, #questionsModal .close-btn, #trainerModal .close-btn, #videoModal .close-btn, #videoPlayerModal1 .close-btn, #videoPlayerModal2 .close-btn, #videoPlayerModal3 .close-btn {
            background: #004d4d;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 5px 15px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #theoryModal .close-btn:hover, #questionsModal .close-btn:hover, #trainerModal .close-btn:hover, #videoModal .close-btn:hover, #videoPlayerModal1 .close-btn:hover, #videoPlayerModal2 .close-btn:hover, #videoPlayerModal3 .close-btn:hover {
            background: #003333;
        }
       #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.4);
            z-index: 999;
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ffe66d);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .video-card {
            width: 300px;
            height: 180px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 20px;
            border: 2px solid #ffffff;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            padding: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: #082949;
            position: relative;
            overflow: hidden;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #74ebd5, #acb6e5);
        }
        .video-card img {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            display: block;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #ffffff;
            transition: transform 0.3s ease;
        }
        .video-card:hover img {
            transform: rotate(5deg);
        }
           .video-card img:not([src]) {
            background-image: url('https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000');
            background-size: cover;
            background-position: center;
            content: '';
        }
        .video-card img[alt] {
            text-indent: -9999px;
        }
        .video-card h3 {
            font-size: 18px;
            margin: 0;
            font-family: 'Lora', serif;
            line-height: 1.3;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        .video-card::after {
            content: '▶';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            color: #ffffff;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        .video-card:hover::after {
            opacity: 1;
        }
 .video-player-container {
            max-width: 800px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        .video-player-container iframe, .video-player-container div {
            width: 100%;
            max-height: 400px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #08457e;
            cursor: pointer;
            overflow: hidden;
        }
        details[open] {
            max-height: none;
        }
        summary {
            font-weight: bold;
            padding: 10px;
            background: #3f5f5f;
            border-radius: 5px;
            transition: background 0.2s ease;
            font-family: 'Lora', serif;
            color: #FFFF00;
        }
          summary:hover {
            background: #3d6c1a;
        }
        details p {
            padding: 0 20px 10px;
            color: #FFFFFF;
            margin: 10px 0;
        }
        .highlight-term {
            padding: 2px 5px;
            border-radius: 3px;
            transition: background 0.2s ease;
            font-family: 'Lora', serif;
        }
        details .highlight-term {
            background: none;
            color: #FFFFFF;
        }
        .card-front .highlight-term {
            color: #08457e;
        }
        .math-notation {
            font-style: italic;
            color: #006064;
            font-family: 'Roboto', sans-serif;
        }
        details .math-notation {
            color: #FFFF00;
        }
        #comparisons, #comparisons p, #comparisons li, #comparisons .highlight-term, #comparisons .math-notation, #comparisons .subsection-title {
            color: #FFFFFF !important;
        }
        #comparisons .MathJax {
            color: #FFFF00 !important;
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 90%;
            width: 100%;
            height: 150px;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        #questionsModal[style*="display: flex"] .question-card {
            opacity: 1;
            transform: translateY(0);
        }
        .question-card:nth-child(1) { transition-delay: 0s; }
        .question-card:nth-child(2) { transition-delay: 0.1s; }
        .question-card:nth-child(3) { transition-delay: 0.2s; }
        .question-card:nth-child(4) { transition-delay: 0.3s; }
        .question-card:nth-child(5) { transition-delay: 0.4s; }
        .question-card:nth-child(6) { transition-delay: 0.5s; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .card-inner:hover {
            transform: scale(1.02);
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 10px;
            border-radius: 15px;
            font-size: clamp(14px, 2.5vw, 16px);
            font-family: 'Lora', serif;
            line-height: 1.4;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: justify;
            overflow: hidden;
        }
        .card-front {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            color: #006064;
            font-weight: 700;
            border: 2px solid #80deea;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: 10px;
        }
        .card-back {
            background: #006064;
            color: #FFFFFF;
            transform: rotateY(180deg);
            border: 2px solid #80deea;
            overflow-y: auto;
            hyphens: auto;
            word-break: break-word;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: 10px;
        }
        .card-back span, .card-back .MathJax {
            margin: 0;
            font-size: 1em;
            line-height: 1.4;
            color: #FFFFFF;
            display: inline;
        }
        .card-back .MathJax {
            vertical-align: middle;
            font-size: 0.95em; 
        }
        .card-front:nth-child(2n), .card-back:nth-child(2n) {
            background: #ad1457;
            border: none;
        }
        .card-front:nth-child(2n) {
            background: linear-gradient(135deg, #f8bbd0, #f48fb1);
        }
        .card-front:nth-child(2n) span {
            color: #5e0032;
        }
        .card-front:nth-child(3n), .card-back:nth-child(3n) {
            background: #2e7d32;
            border: 2px solid #66bb6a;
        }
        .card-front:nth-child(3n) {
            background: linear-gradient(135deg, #c8e6c9, #81c784);
        }
        .card-front:nth-child(3n) span {
            color: #1b5e20;
        }
        .trainer-container {
            width: 90%;
            max-width: 800px;
            padding: 3vw 4vw;
            text-align: center;
            background-color: #ffffffc7;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        .question-circle {
            width: 15vw;
            height: 15vw;
            min-width: 80px;
            min-height: 80px;
            max-width: 120px;
            max-height: 120px;
            margin: 0 auto 3vw;
            background: linear-gradient(135deg, #800000, #a00000);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }
        .question-circle h3 {
            color: white;
            font-family: 'Lora', serif;
            font-size: clamp(16px, 2.5vw, 20px);
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        /* === МЕДАЛЬ З ТРИЗУБОМ === */
        .completion-emoji {
            position: relative;
            display: inline-block;
            width: clamp(56px, 12vw, 96px);
            height: clamp(56px, 12vw, 96px);
            vertical-align: middle;
            margin: 0 auto 3vw;
            border-radius: 50%;
            background: linear-gradient(135deg, #2a2a2a, #3a4a45);
            border: 3px dashed #ffd700;
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
            overflow: hidden;
            animation: medalAppear 0.8s ease-out;
        }
        .completion-emoji::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'><defs><filter id='s' x='-50%' y='-50%' width='200%' height='200%'><feDropShadow dx='0' dy='2' stdDeviation='2' flood-color='%23000000' flood-opacity='0.25'/></filter></defs><rect x='30' y='0' width='60' height='40' rx='4' fill='%23007ACC'/><rect x='30' y='20' width='60' height='20' rx='4' fill='%23FFD700'/><g transform='translate(60,70)'><polygon points='0,-26 6,-6 26,-6 9,6 15,26 0,14 -15,26 -9,6 -26,-6 -6,-6' fill='%23FFD700' filter='url(%23s)'/></g></svg>");
            background-size: 75%;
            background-repeat: no-repeat;
            background-position: center 60%;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.25));
            animation: medalBounce 1.2s ease-out 0.3s both;
        }
        @keyframes medalAppear {
            0% { transform: scale(0.3) rotate(-180deg); opacity: 0; }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes medalBounce {
            0% { transform: translateY(-120px) rotate(-30deg) scale(0.4); opacity: 0; }
            60% { transform: translateY(15px) rotate(10deg) scale(1.15); opacity: 1; }
            80% { transform: translateY(-8px) rotate(-5deg) scale(1.05); }
            100% { transform: translateY(0) rotate(0) scale(1); }
        }

        .completion-message {
            background: linear-gradient(145deg, #2a2a2a, #3a4a45);
            border: 2.5px solid #ffffff;
            border-radius: 15px;
            padding: clamp(12px, 3vw, 18px);
            box-shadow: 0 6px 12px rgba(240,216,92,0.4);
            margin: 2vw auto;
            max-width: 90%;
            text-align: center;
        }
        .completion-message h2 {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .completion-message p { 
            color: #ffffff; 
            margin: 10px 0;
        }

            
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2vw;
            justify-content: center;
            margin-bottom: 3vw;
        }
        .option {
            padding: 1.8vw 2.8vw;
            border: 1.5px solid #800000;
            border-radius: 10px;
            background: #fbeaea;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            font-size: clamp(13px, 2.1vw, 15px);
            line-height: 1.4;
            flex: 1 1 auto;
            min-width: 90px;
            max-width: 45%;
        }
        .option:hover {
            background: #f3dada;
            transform: scale(1.03);
        }
        .option.selected {
            background: #e6bcbc;
            border-color: #800000;
        }
        button {
            padding: 2vw 4vw;
            margin-top: 3vw;
            background-color: #800000;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #5f0000;
        }
        .result {
            margin-top: 3vw;
            font-size: clamp(16px, 2.5vw, 18px);
        }
        .result-text {
            margin-top: 2vw;
            font-size: clamp(14px, 2vw, 16px);
        }
       .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(26px, 6.5vw, 38px);
            font-family: 'Lora', serif;
            font-weight: 700;
            padding: clamp(12px, 3.5vw, 18px) clamp(18px, 5.5vw, 28px);
            border-radius: 15px;
            border: 2.5px solid;
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            text-align: center;
            line-height: 1.2;
        }
        .correct-feedback {
            color: #2e7d32;
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
            border-color: #1b5e20;
            animation: popInOut 1.5s ease-in-out;
        }
        .incorrect-feedback {
            color: #d32f2f;
            background: linear-gradient(135deg, #ffcdd2, #ef9a9a);
            border-color: #b71c1c;
            animation: popInOut 1.5s ease-in-out;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background-color: #2F4F4F;
            color: #FFD700;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
        }
        .nav-button:hover {
            background-color: #556B2F;
            color: #fff;
            transform: scale(1.05);
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
        }
        @keyframes popInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
        @media (max-width: 768px) {
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            #theoryModal, #questionsModal, #trainerModal, #videoModal, #videoPlayerModal1, #videoPlayerModal2, #videoPlayerModal3 {
                top: 2%;
                left: 2%;
                width: 96%;
                height: 96%;
            }
            #theoryModal .modal-content, #questionsModal .modal-content, #trainerModal .modal-content, #videoModal .modal-content, #videoPlayerModal1 .modal-content, #videoPlayerModal2 .modal-content, #videoPlayerModal3 .modal-content {
                padding: 15px;
            }
            .video-card {
                width: 280px;
                height: 150px;
            }
            .video-card img {
                width: 50px;
                height: 50px;
            }
            .video-card h3 {
                font-size: 14px;
            }
            .video-card-container {
                max-width: 90%;
                padding: 15px;
            }
            .question-card {
                height: 150px;
            }
            .card-front, .card-back {
                font-size: 12px;
                padding: 8px;
                line-height: 1.2;
            }
            .card-front span {
                font-size: 12px;
                line-height: 1.2;
            }
            .trainer-container {
                width: 95%;
                padding: 4vw;
            }
            .question-circle, .completion-emoji {
                width: 20vw;
                height: 20vw;
                min-width: 70px;
                min-height: 70px;
            }
            .question-circle h3 {
                font-size: clamp(14px, 3vw, 16px);
            }
            .completion-emoji::after {
                font-size: clamp(30px, 7vw, 40px);
            }
            .option {
                padding: 2.2vw 3.2vw;
                font-size: clamp(11px, 2.6vw, 13px);
                min-width: 75px;
                max-width: 90%;
            }
            .options-container {
                gap: 1.5vw;
                flex-direction: column;
                align-items: center;
            }
            .button {
                padding: 3vw 5vw;
                font-size: clamp(12px, 3vw, 14px);
            }
            .feedback {
                font-size: clamp(22px, 5.5vw, 30px);
                padding: clamp(10px, 3vw, 15px) clamp(15px, 4.5vw, 22px);
                max-width: 90vw;
                word-wrap: break-word;
            }
            .completion-message {
                padding: clamp(10px, 3vw, 15px);
            }
            .completion-message h2 {
                font-size: clamp(20px, 4vw, 26px);
            }
            .completion-message p {
                font-size: clamp(16px, 3vw, 20px);
            }
            .navigation-buttons {
                margin: 20px auto;
                gap: 15px;
            }
            .nav-button {
                font-size: 16px;
                padding: 10px 20px;
            }
            .video-player-container {
                padding: 15px;
            }
            .video-player-container iframe {
                max-height: 300px;
            }
            /* Fix for Корені квадратних рівнянь section on mobile */
            #theoryModal details:nth-child(3) .modal-content {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100%;
                box-sizing: border-box;
            }
            #theoryModal details:nth-child(3) p {
                white-space: normal !important; /* Allow text to wrap */
                overflow-x: visible !important;
                display: block !important;
                min-width: 0 !important;
                max-width: 100% !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            #theoryModal details:nth-child(3) p mjx-container {
                display: inline-block !important;
                white-space: nowrap !important;
                vertical-align: middle !important;
                min-width: auto !important;
            }
            /* Ensure the parent container supports scrolling */
            #theoryModal details:nth-child(3) {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
                width: 100% !important;
            }
        }
            
        @media (max-width: 480px) {
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 20px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 18px;
            }
            #theoryModal .modal-content, #questionsModal .modal-content, #trainerModal .modal-content, #videoModal .modal-content, #videoPlayerModal1 .modal-content, #videoPlayerModal2 .modal-content, #videoPlayerModal3 .modal-content {
                padding: 10px;
            }
            #theoryModal .modal-header, #questionsModal .modal-header, #trainerModal .modal-header, #videoModal .modal-header, #videoPlayerModal1 .modal-header, #videoPlayerModal2 .modal-header, #videoPlayerModal3 .modal-header {
                padding: 5px 8px;
            }
            #theoryModal .close-btn, #questionsModal .close-btn, #trainerModal .close-btn, #videoModal .close-btn, #videoPlayerModal1 .close-btn, #videoPlayerModal2 .close-btn, #videoPlayerModal3 .close-btn {
                font-size: 14px;
                padding: 4px 10px;
            }
            .video-card {
                width: 180px;
                height: 140px;
            }
            .video-card img {
                width: 36px;
                height: 36px;
            }
            .video-card h3 {
                font-size: 13px;
            }
            .question-card {
                height: 180px;
            }
            .card-front, .card-back {
                font-size: 11px;
                padding: 6px;
                line-height: 1.1;
            }
            .card-front span {
                font-size: 11px;
                line-height: 1.1;
            }
            .card-back .MathJax {
                font-size: 0.9em;
            }
            .question-circle, .completion-emoji {
                width: 30vw;
                height: 30vw;
                min-width: 70px;
                min-height: 70px;
            }
            .question-circle h3 {
        font-size: clamp(16px, 3.5vw, 18px);
    }
            .option {
                font-size: clamp(12px, 2.5vw, 14px);
                padding: 3.5vw 4.5vw;
            }
            .completion-emoji::after {
                font-size: clamp(25px, 6vw, 35px);
            }
            
            .feedback {
                font-size: clamp(20px, 5vw, 26px);
                padding: clamp(8px, 2.5vw, 12px) clamp(12px, 4vw, 18px);
            }
            .completion-message h2 {
                font-size: clamp(18px, 3.5vw, 22px);
            }
            .completion-message p {
                font-size: clamp(14px, 3vw, 18px);
            }
            .navigation-buttons {
                margin: 15px auto;
                gap: 10px;
            }
            .nav-button {
                font-size: 14px;
                padding: 8px 16px;
            }
            .video-player-container {
                padding: 10px;
            }
            .video-player-container iframe {
                max-height: 200px;
            }
        }

.input-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 3vw;
    align-items: center;
}
.input-group {
    display: flex;
    align-items: center;
    gap: 10px;
}
.input-group label {
    font-size: clamp(14px, 2vw, 16px);
    color: #333;
    font-family: 'Lora', serif;
    font-style: italic;
}
.input-group input {
    padding: 8px;
    width: 100px;
    border: 1.5px solid #800000;
    border-radius: 8px;
    font-size: clamp(13px, 2vw, 15px);
    font-family: 'Roboto', sans-serif;
    transition: border-color 0.3s ease;
}
.input-group input:focus {
    border-color: #5f0000;
    outline: none;
}
button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}
.correct-feedback::before {
    display: inline-block;
    margin-right: 10px;
    font-size: clamp(20px, 4vw, 24px);
    color: #2e7d32;
    animation: bounce 0.5s ease;
}
.incorrect-feedback::before {
    display: inline-block;
    margin-right: 10px;
    font-size: clamp(20px, 4vw, 24px);
    color: #d32f2f;
    animation: shake 0.5s ease;
}
@keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.5); }
    100% { transform: scale(1); }
}
@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}
            .inline-input {
    display: inline-block;
    padding: 5px;
    width: 60px;
    border: 1.5px solid #800000;
    border-radius: 8px;
    font-size: clamp(13px, 2vw, 15px);
    font-family: 'Roboto', sans-serif;
    vertical-align: middle;
    margin-left: 5px;
    transition: border-color 0.3s ease;
}
.inline-input:focus {
    border-color: #5f0000;
    outline: none;
}

            
        @media (max-width: 768px) {
            .card-front {
                text-align: justify;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            .card-back {
                text-align: justify;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
        }
        mjx-container {
            display: inline !important;
            vertical-align: baseline !important;
            white-space: normal !important;
            line-height: normal !important;
        }
        mjx-container > * {
            display: inline !important;
            vertical-align: baseline !important;
        }
        .math-i {
            color: #f0f0f0;
            font-style: italic;
            font-family: 'STIX', 'Latin Modern Math', 'Times New Roman', serif;
            font-size: 1em;
            vertical-align: baseline;
            display: inline;
        }
        .card-inner.flipped .card-back {
            opacity: 1;
        }
        .card-front {
            opacity: 1;
            transition: opacity 0s;
        }
        .card-inner.flipped .card-front {
            opacity: 0;
        }
        .card-front span {
            display: block;
            text-align: justify;
            color: #006064;
            font-weight: 700;
            font-family: 'Lora', serif;
            font-size: clamp(14px, 2.5vw, 16px);
            line-height: 1.4;
            width: 100%;
        }
        .math-notation-centered {
    display: block;
    text-align: center;
    width: 100%;
    font-size: inherit;
    margin: 5px 0;
    line-height: 1.2;
    color: #560319 !important;
    font-style: italic;
    font-family: 'Roboto', sans-serif;
}

mjx-container.math-notation-centered {
    display: block !important;
    text-align: center !important;
    vertical-align: middle !important;
    white-space: normal !important;
    line-height: 1.2 !important;
    font-size: inherit !important;
    color: #560319 !important;
    margin: 5px auto !important;
    width: auto !important;
    padding: 0 !important;
}

mjx-container.math-notation-centered * {
    color: #560319 !important;
}

@media (max-width: 480px) {
    .card-front {
        text-align: justify;
        word-wrap: break-word;
        overflow-wrap: break-word;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        line-height: 1.1;
        font-size: 14px;
    }
    .card-front span {
        display: block;
        text-align: justify;
        width: 100%;
        line-height: 1.1;
        font-size: 14px;
    }
    .card-back {
        text-align: justify;
        word-wrap: break-word;
        overflow-wrap: break-word;
        font-size: 15px;
        padding: 6px;
        line-height: 1.1;
    }
    .card-back span, .card-back .MathJax {
        font-size: 15px;
        line-height: 1.1;
    }
    .math-notation-centered {
        display: block;
        text-align: center;
        width: 100%;
        font-size: 12px;
        margin: 2px 0;
        line-height: 1.1;
        color: #560319 !important;
    }
    mjx-container.math-notation-centered {
        display: block !important;
        text-align: center !important;
        vertical-align: middle !important;
        white-space: normal !important;
        line-height: 1.1 !important;
        font-size: 12px !important;
        color: #560319 !important;
        margin: 2px auto !important;
        width: auto !important;
        padding: 0 !important;
    }
    mjx-container.math-notation-centered * {
        color: #560319 !important;
    }
    mjx-container {
        font-size: 17px !important;
    }
   /* Виправлення для відповіді на 12-й флешкартці на мобільних */
    #questionsModal .question-card:nth-child(12) .card-back {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
        white-space: nowrap !important;
        width: 100% !important;
        box-sizing: border-box !important;
        text-align: left !important;
        padding-left: 160px !important; /* Збільшено зсув вправо */
    }

    #questionsModal .question-card:nth-child(12) .card-back span {
        display: inline-block !important;
        white-space: nowrap !important;
        min-width: max-content !important;
        margin-left: -20px !important; /* Компенсація зсуву для видимості тексту зліва */
    }

    #questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar {
        height: 8px !important;
    }

    #questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar-thumb {
        background-color: #800000 !important;
        border-radius: 4px !important;
    }

    #questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar-track {
        background-color: #f0f0f0 !important;
    }

    /* Забезпечуємо, щоб MathJax рівняння в 12-й флешкартці не заважали прокрутці */
    #questionsModal .question-card:nth-child(12) .card-back mjx-container {
        display: inline-block !important;
        white-space: nowrap !important;
        vertical-align: middle !important;
    }
}
            #comparisons li p {
            text-align: justify !important;
        }

        details:nth-child(3) .modal-content p {
            overflow-x: auto;
            white-space: nowrap;
        }

        details:nth-child(3) .modal-content p::-webkit-scrollbar {
            height: 8px;
        }

        details:nth-child(3) .modal-content p::-webkit-scrollbar-thumb {
            background-color: #800000;
            border-radius: 4px;
        }

        details:nth-child(3) .modal-content p::-webkit-scrollbar-track {
            background-color: #f0f0f0;
        }
           /* Стилі для назв підпунктів у #comparisons */
#theoryModal #comparisons .subsection-title {
    text-align: center;
    color: #f7ff00 !important;
    margin: 10px 0;
    font-family: 'Lora', serif;
    font-size: 18px;
    font-weight: bold;
}

/* Приховування номерів списку */
#theoryModal #comparisons ol {
    list-style-type: none;
    padding-left: 0;
}
.reset-btn {
    background: linear-gradient(135deg, #6b5f2f, #f0d85c);
    color: #fff;
    padding: 15px 35px;
    border: none;
    border-radius: 25px;
    font-family: 'Roboto', sans-serif;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    margin-top: 20px;
    transition: all 0.3s ease;
}
.reset-btn:hover { 
    background: linear-gradient(135deg, #8b7d3f, #6b5f2f); 
    transform: scale(1.05); 
    box-shadow: 0 4px 15px rgba(107,95,47,0.4); 
}
/* Додайте ці стилі в розділ CSS */

/* СТИЛІ ДЛЯ ПРОКРУТКИ МОДАЛЬНИХ ВІКОН */
#theoryModal .modal-content,
#questionsModal .modal-content,
#trainerModal .modal-content,
#videoModal .modal-content {
    scrollbar-width: thin;
    scrollbar-color: #800000 #f0f0f0;
}

/* Для вебкіт браузерів (Chrome, Safari, Edge) */
#theoryModal .modal-content::-webkit-scrollbar,
#questionsModal .modal-content::-webkit-scrollbar,
#trainerModal .modal-content::-webkit-scrollbar,
#videoModal .modal-content::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

#theoryModal .modal-content::-webkit-scrollbar-track,
#questionsModal .modal-content::-webkit-scrollbar-track,
#trainerModal .modal-content::-webkit-scrollbar-track,
#videoModal .modal-content::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-radius: 4px;
}

#theoryModal .modal-content::-webkit-scrollbar-thumb,
#questionsModal .modal-content::-webkit-scrollbar-thumb,
#trainerModal .modal-content::-webkit-scrollbar-thumb,
#videoModal .modal-content::-webkit-scrollbar-thumb {
    background: #800000;
    border-radius: 4px;
    border: 2px solid #f0f0f0;
}

#theoryModal .modal-content::-webkit-scrollbar-thumb:hover,
#questionsModal .modal-content::-webkit-scrollbar-thumb:hover,
#trainerModal .modal-content::-webkit-scrollbar-thumb:hover,
#videoModal .modal-content::-webkit-scrollbar-thumb:hover {
    background: #5f0000;
}

/* Спеціальні стилі для довгих математичних формул у details */
#theoryModal details .modal-content p {
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 10px; /* Додаємо місце для прокрутки */
    margin-bottom: 10px;
}

#theoryModal details .modal-content p::-webkit-scrollbar {
    height: 6px;
}

#theoryModal details .modal-content p::-webkit-scrollbar-track {
    background: #f8f9fa;
    border-radius: 3px;
}

#theoryModal details .modal-content p::-webkit-scrollbar-thumb {
    background: #006064;
    border-radius: 3px;
}

#theoryModal details .modal-content p::-webkit-scrollbar-thumb:hover {
    background: #004d4d;
}

/* Для Firefox */
#theoryModal details .modal-content p {
    scrollbar-width: thin;
    scrollbar-color: #006064 #f8f9fa;
}

/* Стилі для карток питань з горизонтальною прокруткою */
#questionsModal .question-card:nth-child(12) .card-back {
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: #800000 #f0f0f0;
    white-space: nowrap;
    width: 100%;
    box-sizing: border-box;
    text-align: left;
    padding: 10px 15px;
}

#questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar {
    height: 6px;
}

#questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-radius: 3px;
}

#questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar-thumb {
    background: #800000;
    border-radius: 3px;
    border: 1px solid #f0f0f0;
}

#questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar-thumb:hover {
    background: #5f0000;
}

/* Плавна прокрутка для всіх модальних вікон */
#theoryModal .modal-content,
#questionsModal .modal-content,
#trainerModal .modal-content,
#videoModal .modal-content {
    scroll-behavior: smooth;
}

/* Для мобільних пристроїв - трошки ширша прокрутка для зручності */
@media (max-width: 768px) {
    #theoryModal .modal-content::-webkit-scrollbar,
    #questionsModal .modal-content::-webkit-scrollbar,
    #trainerModal .modal-content::-webkit-scrollbar,
    #videoModal .modal-content::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }
    
    #theoryModal details .modal-content p::-webkit-scrollbar {
        height: 8px;
    }
    
    #questionsModal .question-card:nth-child(12) .card-back::-webkit-scrollbar {
        height: 8px;
    }
}

/* Анімація при появі прокрутки */
@keyframes scrollbarAppear {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

#theoryModal .modal-content::-webkit-scrollbar-thumb,
#questionsModal .modal-content::-webkit-scrollbar-thumb,
#trainerModal .modal-content::-webkit-scrollbar-thumb,
#videoModal .modal-content::-webkit-scrollbar-thumb {
    animation: scrollbarAppear 0.3s ease-out;
}
    </style>
</head>
<body>
    <div class="title-box">
        <h1>2. Алгебраїчна форма комплексних чисел</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn" tabindex="0" role="button" aria-pressed="false">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга" />
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn" tabindex="0" role="button" aria-pressed="false">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео" />
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn" tabindex="0" role="button" aria-pressed="false">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки" />
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn" tabindex="0" role="button" aria-pressed="false">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер" />
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
        <a class="nav-button" href='tema1.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 1
        </a>
        <a class="nav-button" href='index.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>

    <div id="modalOverlay"></div>

    <div id="theoryModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити документ" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
           <details>
                <summary>Основне означення</summary>
                <p><strong class="highlight-term">Комплексні числа</strong> найчастіше записуються в так званій <strong class="highlight-term">алгебраїчній формі</strong>, що є дуже зручною для визначення їх дійсної та уявної частин. Цей спосіб представлення простий і чіткий, і саме він допомагає легше розуміти структуру комплексних чисел. У попередньому пункті ми дізналися, що комплексні числа записуються у вигляді</p>
                <p style="text-align: center;"><em class="math-notation">\( z = a + bi, \)</em> (1.1)</p>
                <p>де <em class="math-notation">\( a \)</em> і <em class="math-notation">\( b \)</em> – довільні дійсні числа, а <em class="math-notation">\( i \)</em> – уявна одиниця (<em class="math-notation">\( i^2 = -1 \)</em>). Цей запис називається <strong class="highlight-term">алгебраїчною формою</strong> комплексного числа.</p>
                <p>Дійсну частину <em class="math-notation">\( a \)</em> позначають як <em class="math-notation">\( \text{Re } z \)</em> (від латинського <em>realis</em> – «дійсний»), а уявну частину <em class="math-notation">\( b \)</em> – як <em class="math-notation">\( \text{Im } z \)</em> (від латинського <em>imaginarius</em> – «уявний»), тобто</p>
                <p><em class="math-notation">\( \text{Re } z = a, \quad \text{Im } z = b. \)</em></p>
                <p>Наприклад, для комплексного числа <em class="math-notation">\( z = 2.1 - 5i \)</em>:</p>
                <p><em class="math-notation">\( \text{Re } z = 2.1, \quad \text{Im } z = -5. \)</em></p>
                <p>Дійсні числа можна вважати комплексними, записуючи їх у вигляді <em class="math-notation">\( a + 0i \)</em>, а уявні числа – у вигляді <em class="math-notation">\( 0 + bi \)</em>.</p>
            </details>
            <details id="comparisons">
    <summary>Порівняння комплексних чисел</summary>
    <p><strong class="highlight-term">Комплексні числа</strong> <em class="math-notation">\( z_1 = a_1 + b_1 i \)</em> та <em class="math-notation">\( z_2 = a_2 + b_2 i \)</em> порівнюють за кількома основними критеріями. Розглянемо такі випадки:</p>
    <ol>
        <li>
            <h3 class="subsection-title">Рівність комплексних чисел</h3>
            <p>Комплексні числа <em class="math-notation">\( z_1 \)</em> і <em class="math-notation">\( z_2 \)</em> рівні, якщо їх дійсні та уявні частини є рівними, тобто:</p>
            <p><em class="math-notation">\( a_1 = a_2, \quad b_1 = b_2. \)</em></p>
            <p>Наприклад, <em class="math-notation">\( z_1 = 2 + 3i \)</em> і <em class="math-notation">\( z_2 = 2 + 3i \)</em> – рівні комплексні числа, оскільки <em class="math-notation">\( \text{Re } z_1 = \text{Re } z_2 = 2 \)</em> і <em class="math-notation">\( \text{Im } z_1 = \text{Im } z_2 = 3 \)</em>.</p>
        </li>
        <li>
            <h3 class="subsection-title">Комплексно-спряжені числа</h3>
            <p>Два комплексні числа <em class="math-notation">\( z_1 \)</em> і <em class="math-notation">\( z_2 \)</em> є комплексно-спряженими, якщо їх дійсні частини рівні, а уявні частини мають протилежні знаки, тобто:</p>
            <p><em class="math-notation">\( a_1 = a_2, \quad b_1 = -b_2. \)</em></p>
            <p>Спряжене комплексне число до <em class="math-notation">\( z = a + bi \)</em> позначається як <em class="math-notation">\( \overline{z} \)</em> і записується у вигляді:</p>
            <p><em class="math-notation">\( \overline{z} = a - bi. \)</em></p>
            <p>Наприклад, <em class="math-notation">\( z = -2 + 3i \)</em> і <em class="math-notation">\( \overline{z} = -2 - 3i \)</em> є комплексно-спряженими числами.</p>
        </li>
        <li>
            <h3 class="subsection-title">Протилежні комплексні числа</h3>
            <p>Комплексні числа <em class="math-notation">\( z_1 \)</em> і <em class="math-notation">\( z_2 \)</em> протилежні, якщо їхні частини мають протилежні знаки, тобто:</p>
            <p><em class="math-notation">\( a_1 = -a_2, \quad b_1 = -b_2. \)</em></p>
            <p>Протилежне комплексне число до <em class="math-notation">\( z = a + bi \)</em> позначається як <em class="math-notation">\( -z \)</em> і записується у вигляді:</p>
            <p><em class="math-notation">\( -z = -a - bi. \)</em></p>
            <p>Наприклад, <em class="math-notation">\( z = 2 - 3i \)</em> і <em class="math-notation">\( -z = -2 + 3i \)</em> – протилежні комплексні числа.</p>
        </li>
    </ol>
</details>
            <details>
                <summary>Корені квадратних рівнянь з комплексними числами</summary>
                <p>Оскільки для уявної одиниці <em class="math-notation">\( i \)</em> справджується рівність <em class="math-notation">\( i = \sqrt{-1} \)</em>, то для будь-якого додатного числа <em class="math-notation">\( a \)</em> ми маємо, що <em class="math-notation">\( \sqrt{-a} = \sqrt{a} \, i \)</em>, де під <em class="math-notation">\( \sqrt{a} \)</em> мається на увазі додатній (арифметичний) корінь з <em class="math-notation">\( a \)</em>. Наприклад, <em class="math-notation">\( \sqrt{-16} = \sqrt{16} \cdot \sqrt{-1} = 4i \)</em>, <em class="math-notation">\( \sqrt{-25} = \sqrt{25} \cdot \sqrt{-1} = 5i \)</em>, тощо.</p>
                <p>Це означає, що на множині <strong class="highlight-term">комплексних чисел</strong> можна розв'язувати квадратні рівняння, які не мають розв'язків серед дійсних чисел.</p>
                <p><strong>Приклад 1.1.</strong> Розв’язати рівняння <em class="math-notation">\( x^2 + 49 = 0 \).</em></p>
                <p>\( \triangleright \) Щоб знайти його розв'язки, спочатку перенесемо 49 у праву частину рівняння, змінивши знак на протилежний:</p>
                <p><em class="math-notation">\( x^2 = -49. \)</em></p>
                <p>Оскільки рівняння <em class="math-notation">\( x^2 = -49 \)</em> не має розв’язків серед дійсних чисел, розв'язуємо його в множині комплексних чисел. Візьмемо квадратний корінь з обох частин рівняння, і отримаємо два корені:</p>
                <p><em class="math-notation">\( x_1 = -\sqrt{-49}, \quad x_2 = \sqrt{-49}. \)</em></p>
                <p>З використанням рівності <em class="math-notation">\( \sqrt{-1} = i \)</em> маємо:</p>
                <p><em class="math-notation">\( x_1 = -\sqrt{-49} = -\sqrt{49} \cdot \sqrt{-1} = -7 \cdot i = -7i, \)</em></p>
                <p><em class="math-notation">\( x_2 = \sqrt{-49} = \sqrt{49} \cdot \sqrt{-1} = 7 \cdot i = 7i. \)</em></p>
                <p>Отже, рівняння <em class="math-notation">\( x^2 + 49 = 0 \)</em> має два корені: <em class="math-notation">\( x_1 = -7i \)</em> і <em class="math-notation">\( x_2 = 7i \)</em>.</p>
                <p>Ці корені є комплексними числами та взаємно спряженими. У множині дійсних чисел для заданого рівняння розв'язків не існує.</p>
                <p><strong>Примітка.</strong> Скорочений запис двох коренів <em class="math-notation">\( x_1 = -7i \)</em> та <em class="math-notation">\( x_2 = 7i \)</em>:</p>
                <p><em class="math-notation">\( x_{1,2} = \pm 7i. \)</em> \( \triangleleft \)</p>
                <p><strong>Приклад 1.2.</strong> Розв’язати рівняння <em class="math-notation">\( x^2 - 4x + 29 = 0 \).</em></p>
                <p>\( \triangleright \) Знайдемо дискримінант заданого рівняння:</p>
                <p><em class="math-notation">\( D = b^2 - 4ac = (-4)^2 - 4 \cdot 1 \cdot 29 = 16 - 116 = -100. \)</em></p>
                <p>Оскільки дискримінант рівняння від’ємний (<em class="math-notation">\( D = -100 \)</em>), рівняння не має розв'язків серед дійсних чисел. Отже, шукаємо корені в множині комплексних чисел.</p>
                <p>Запишемо корені за формулою:</p>
                <p><em class="math-notation">\( x_{1,2} = \frac{-b \pm \sqrt{D}}{2a} = \frac{4 \pm \sqrt{-100}}{2}. \)</em></p>
                <p>Оскільки <em class="math-notation">\( \sqrt{-100} = 10i \)</em>, тоді:</p>
                <p><em class="math-notation">\( x_{1,2} = \frac{4 \pm 10i}{2} = 2 \pm 5i. \)</em></p>
                <p>Таким чином, рівняння має два комплексних корені:</p>
                <p><em class="math-notation">\( x_1 = 2 - 5i \)</em> і <em class="math-notation">\( x_2 = 2 + 5i. \)</em></p>
                <p><strong>Примітка.</strong> Ці взаємно спряжені корені мають суму 4 і добуток 29, що підтверджує теорему Вієта! Перевірка вимагає знання додавання та множення комплексних чисел, які розглянуті в пункті 3: Арифметичні дії в алгебраїчній формі. \( \triangleleft \)</p>
            </details>
        </div>
    </div>

    <div id="videoModal" role="dialog" aria-modal="true" aria-labelledby="videoTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити відео" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 style="text-align: center; color: #003153;">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера" />
                    <h3>Що таке комплексні числа. Просто про складне.</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера" />
                    <h3>Як поєднуються дійсні та уявні числа.</h3>
                </div>
                <div class="video-card" data-video="3">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера" />
                    <h3>Розв’язування квадратних рівнянь з комплексними коренями.</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal1" role="dialog" aria-modal="true" aria-labelledby="videoPlayerTitle1">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити відео" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" width="100%" height="400" src="https://www.youtube.com/embed/HK99lj3c9RI?rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal2" role="dialog" aria-modal="true" aria-labelledby="videoPlayerTitle2">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити відео" id="closeVideoPlayerBtn2">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer2" width="100%" height="400" src="https://www.youtube.com/embed/ecCUSwJVv0A?rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal3" role="dialog" aria-modal="true" aria-labelledby="videoPlayerTitle3">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити відео" id="closeVideoPlayerBtn3">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer3" width="100%" height="400" src="https://www.youtube.com/embed/gHLUewnFFqg?rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="questionsModal" role="dialog" aria-modal="true" aria-labelledby="questionsTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити питання" id="closeQuestionsBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">1. Як записується алгебраїчна форма комплексного числа?</div>
                    <div class="card-back"><span>У вигляді \( z = a + bi \), де \( a \) і \( b \) – довільні дійсні числа, а \( i \) – уявна одиниця, для якої \( i^2 = -1 \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">2. Як позначають дійсну та уявну частини комплексного числа?</div>
                    <div class="card-back"><span>Дійсна частина позначається \( \text{Re } z = a \), уявна — \( \text{Im } z = b \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">3. Як представити дійсне число як комплексне?</div>
                    <div class="card-back"><span>У вигляді \( a + 0i \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">4. Як виглядає уявне число у вигляді комплексного?</div>
                    <div class="card-back"><span>У вигляді \( 0 + bi \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">5. У якому випадку два комплексних числа рівні?</div>
                    <div class="card-back"><span>Коли їхні дійсні частини рівні і уявні частини також рівні: \( a_1 = a_2 \), \( b_1 = b_2. \) </div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">6. Що таке спряжене комплексне число?</div>
                    <div class="card-back"><span>Це число вигляду \( \overline{z} = a - bi \), якщо \( z = a + bi \). У ньому уявна частина має протилежний знак. </div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">7. У якому випадку два комплексних числа є спряженими?</div>
                    <div class="card-back"><span>Коли дійсні частини рівні, а уявні мають протилежні знаки: \( a_1 = a_2 \), \( b_1 = -b_2 \).</div>
                </div>
            </div>
<div class="question-card">
                <div class="card-inner">
                    <div class="card-front">8. Що таке протилежне комплексне число?</div>
                    <div class="card-back"><span> Це число вигляду \( -z = -a - bi \), якщо \( z = a + bi \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">9. У якому випадку два комплексних числа є протилежними?</div>
                    <div class="card-back"><span> Коли їхні дійсні та уявні частини мають протилежні знаки: \( a_1 = -a_2 \), \( b_1 = -b_2 \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">10. Як обчислити корінь з від’ємного числа у множині комплексних чисел?</div>
                    <div class="card-back"><span> Використовують рівність \( \sqrt{-a} = \sqrt{a} \, i \), де \( a > 0 \).</div>
                </div>
            </div>
            <div class="question-card">
                <div class="card-inner">
                    <div class="card-front">11. Які корені має рівняння <div style="text-align: center">\( x^2 + 49 = 0 \)</div> у множині комплексних чисел?</div>
                    <div class="card-back"><span> \( x_1 = -7i \) і \( x_2 = 7i \), або скорочено: \( x_{1,2} = \pm 7i \).</div>
                </div>
            </div>
<div class="question-card">
                <div class="card-inner">
                    <div class="card-front">12. Навести приклад розв’язання квадратного рівняння з від’ємним дискримінантом.</div>
                    <div class="card-back"><span> \( x^2 - 4x + 29 = 0 \):<br>
        \( D = b^2 - 4ac = (-4)^2 - 4 \cdot 1 \cdot 29 = 16 - 116 = -100, \)<br>
        \( x_{1,2} = \frac{-b \pm \sqrt{D}}{2a} = \frac{4 \pm \sqrt{-100}}{2} = \frac{4 \pm 10i}{2} = 2 \pm 5i. \)</div>
                </div>
            </div>
            </div>
        </div>
    </div>

     <div id="trainerModal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити тренажер" id="closeTrainerBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="trainer-container" id="trainerContent"></div>
        </div>
    </div>

    <script>
    // ---------- ГЛОБАЛЬНІ ЗМІННІ МОДАЛЬНИХ ВІКОН ----------
    const openTheoryBtn = document.getElementById('openTheoryBtn');
    const openVideoBtn = document.getElementById('openVideoBtn');
    const openQuestionsBtn = document.getElementById('openQuestionsBtn');
    const openTrainerBtn = document.getElementById('openTrainerBtn');
    const theoryModal = document.getElementById('theoryModal');
    const videoModal = document.getElementById('videoModal');
    const questionsModal = document.getElementById('questionsModal');
    const trainerModal = document.getElementById('trainerModal');
    const videoPlayerModal1 = document.getElementById('videoPlayerModal1');
    const videoPlayerModal2 = document.getElementById('videoPlayerModal2');
    const videoPlayerModal3 = document.getElementById('videoPlayerModal3');
    const youtubePlayer1 = document.getElementById('youtubePlayer1');
    const youtubePlayer2 = document.getElementById('youtubePlayer2');
    const youtubePlayer3 = document.getElementById('youtubePlayer3');
    const closeVideoPlayerBtn1 = document.getElementById('closeVideoPlayerBtn1');
    const closeVideoPlayerBtn2 = document.getElementById('closeVideoPlayerBtn2');
    const closeVideoPlayerBtn3 = document.getElementById('closeVideoPlayerBtn3');
    const overlay = document.getElementById('modalOverlay');
    const closeTheoryBtn = document.getElementById('closeTheoryBtn');
    const closeVideoBtn = document.getElementById('closeVideoBtn');
    const closeQuestionsBtn = document.getElementById('closeQuestionsBtn');
    const closeTrainerBtn = document.getElementById('closeTrainerBtn');

        // Додайте цей код в секцію JavaScript після всіх обробників подій

// Покращення прокрутки для модальних вікон
function enhanceModalScrolling() {
    const modals = [theoryModal, questionsModal, trainerModal, videoModal];
    
    modals.forEach(modal => {
        if (!modal) return;
        
        const content = modal.querySelector('.modal-content');
        if (!content) return;
        
        // Додаємо клас при наведенні для кращої видимості прокрутки
        content.addEventListener('mouseenter', () => {
            content.style.scrollbarWidth = 'thin';
        });
        
        // Плавна прокрутка до початку при відкритті
        modal.addEventListener('click', (e) => {
            if (e.target === modal || e.target.classList.contains('close-btn')) {
                setTimeout(() => {
                    content.scrollTo({ top: 0, left: 0, behavior: 'smooth' });
                }, 100);
            }
        });
    });
}

// Ініціалізація покращеної прокрутки при завантаженні
window.addEventListener('load', enhanceModalScrolling);

// Також додаємо для карток питань
document.querySelectorAll('.question-card').forEach(card => {
    const cardBack = card.querySelector('.card-back');
    if (cardBack && cardBack.scrollWidth > cardBack.clientWidth) {
        // Якщо контент ширший за контейнер, додаємо індикатор прокрутки
        cardBack.style.position = 'relative';
        
        // Додаємо градієнт на краях для індикації прокрутки
        cardBack.style.background = `
            linear-gradient(to right, #006064 0%, #006064 95%, transparent 100%),
            linear-gradient(to left, #006064 0%, #006064 95%, transparent 100%)
        `;
        cardBack.style.backgroundSize = '50px 100%, 50px 100%';
        cardBack.style.backgroundRepeat = 'no-repeat';
        cardBack.style.backgroundPosition = 'left center, right center';
    }
});

    // ---------- ДОПОМІЖНІ ФУНКЦІЇ ----------
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getRandomIntExcluding(min, max, excludeList) {
        let num;
        do {
            num = getRandomInt(min, max);
        } while (excludeList.includes(num));
        return num;
    }

    function formatComplexNumber(a, b) {
        let str = '';
        if (a !== 0) {
            str += a;
            if (b > 0) str += '+';
        }
        if (b !== 0) {
            if (b === 1) str += 'i';
            else if (b === -1) str += '-i';
            else str += b + 'i';
        }
        if (str === '') str = '0';
        if (a === 0 && b !== 0) {
            if (b === 1) str = 'i';
            else if (b === -1) str = '-i';
            else str = b + 'i';
        }
        return str;
    }
        function formatComplexNumberBIplusA(a, b) {
    let str = '';
    
    if (b !== 0) {
        if (b === 1) str += 'i';
        else if (b === -1) str += '-i';
        else str += b + 'i';
        
        if (a > 0) str += '+';
    }
    
    if (a !== 0) {
        str += a;
    }
    
    if (str === '') str = '0';
    if (a === 0 && b !== 0) {
        if (b === 1) str = 'i';
        else if (b === -1) str = '-i';
        else str = b + 'i';
    }
    
    return str;
}

    // ---------- ГЕНЕРАЦІЯ ПИТАНЬ ----------
    const questionGenerators = {
        // Питання 1: Дійсна або уявна частина комплексного числа
        q1: function() {
            const types = ['дійсна', 'уявна'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let a, b;
            do {
                a = getRandomIntExcluding(-5, 5, [0]);
                b = getRandomIntExcluding(-5, 5, [0]);
            } while (a === 0 && b === 0);
            
            const number = formatComplexNumber(a, b);
            const questionText = (type === 'дійсна') 
                ? `Дійсна частина \\( \\text{Re } z \\) комплексного числа \\( z = ${number} \\) дорівнює:`
                : `Уявна частина \\( \\text{Im } z \\) комплексного числа \\( z = ${number} \\) дорівнює:`;
            
            const correctAnswer = (type === 'дійсна') ? a.toString() : b.toString();
            
            // Генеруємо варіанти
            let options = [];
            if (type === 'дійсна') {
                options = [
                    a.toString(),
                    b.toString(),
                    (a + b).toString(),
                    (a - b).toString()
                ];
            } else {
                options = [
                    b.toString(),
                    a.toString(),
                    (a + b).toString(),
                    (a * b).toString()
                ];
            }
            
            // Перемішуємо і обрізаємо до 4 унікальних варіантів
            options = [...new Set(options)];
            while (options.length < 4) {
                const randomNum = getRandomIntExcluding(-8, 8, options.map(Number));
                options.push(randomNum.toString());
            }
            
            shuffleArray(options);
            
            return {
                text: questionText,
                options: options,
                correct: correctAnswer,
                type: 'single'
            };
        },
        
        // Питання 2: Визначення дійсної та уявної частин (два вводи)
        q2: function() {
            let a, b;
            do {
                a = getRandomIntExcluding(-8, 8, [0]);
                b = getRandomIntExcluding(-8, 8, [0]);
            } while (Math.abs(a) < 2 || Math.abs(b) < 2);
            
            const number = formatComplexNumber(a, b);
            
            return {
                text: `У комплексному числі \\( z = ${number} \\) вкажіть:`,
                inputs: [
                    { label: 'Дійсна частина \\( \\text{Re } z = \\)', correct: a.toString() },
                    { label: 'Уявна частина \\( \\text{Im } z = \\)', correct: b.toString() }
                ],
                type: 'double-input'
            };
        },
        
       // Питання 3: Визначення частин для чисел виду a+bi або bi
q3: function() {
    const types = ['only-imaginary', 'mixed'];
    const type = types[Math.floor(Math.random() * types.length)];
    
    let a, b;
    if (type === 'only-imaginary') {
        a = 0;
        b = getRandomIntExcluding(-5, 5, [0, 1, -1]);
    } else {
        do {
            a = getRandomIntExcluding(-5, 5, [0]);
            b = getRandomIntExcluding(-5, 5, [0]);
        } while (a === 0 || b === 0);
    }
    
    // ЗМІНИ ТУТ: використовуємо спеціальну функцію для форматування bi+a
    const number = formatComplexNumberBIplusA(a, b);
    
    return {
        text: `У комплексному числі \\( z = ${number} \\) вкажіть:`,
        inputs: [
            { label: '\\( \\text{Re } z = \\)', correct: a.toString() },
            { label: '\\( \\text{Im } z = \\)', correct: b.toString() }
        ],
        type: 'double-input'
    };
},
        
        // Питання 4: Протилежне число
        q4: function() {
            let a, b;
            do {
                a = getRandomIntExcluding(-6, 6, [0]);
                b = getRandomIntExcluding(-6, 6, [0]);
            } while (Math.abs(a) < 2 || Math.abs(b) < 2);
            
            const z = formatComplexNumber(a, b);
            const opposite = formatComplexNumber(-a, -b);
            
            const question = `Вказати число, протилежне до комплексного числа \\( z = ${z} \\)`;
            
            // Генеруємо варіанти
            const wrong1 = formatComplexNumber(a, -b); // спряжене
            const wrong2 = formatComplexNumber(-a, b);
            const wrong3 = formatComplexNumber(b, a); // переставлені
            
            let options = [
                `\\(-z = ${opposite}\\)`,
                `\\(-z = ${wrong1}\\)`,
                `\\(-z = ${wrong2}\\)`,
                `\\(-z = ${wrong3}\\)`
            ];
            
            shuffleArray(options);
            
            return {
                text: question,
                options: options,
                correct: `\\(-z = ${opposite}\\)`,
                type: 'single'
            };
        },
        
        // Питання 5: Спряжене число
        q5: function() {
            let a, b;
            do {
                a = getRandomIntExcluding(-6, 6, [0]);
                b = getRandomIntExcluding(-6, 6, [0]);
            } while (Math.abs(a) < 2 || Math.abs(b) < 2);
            
            const z = formatComplexNumber(a, b);
            const conjugate = formatComplexNumber(a, -b);
            
            const question = `Вказати число, спряжене до комплексного числа \\( z = ${z} \\)`;
            
            // Генеруємо варіанти
            const wrong1 = formatComplexNumber(-a, b); // протилежне спряжене
            const wrong2 = formatComplexNumber(-a, -b); // протилежне
            const wrong3 = formatComplexNumber(b, a); // переставлені
            
            let options = [
                `\\(\\overline{z} = ${conjugate}\\)`,
                `\\(\\overline{z} = ${wrong1}\\)`,
                `\\(\\overline{z} = ${wrong2}\\)`,
                `\\(\\overline{z} = ${wrong3}\\)`
            ];
            
            shuffleArray(options);
            
            return {
                text: question,
                options: options,
                correct: `\\(\\overline{z} = ${conjugate}\\)`,
                type: 'single'
            };
        },
        
        // Питання 6: Корінь з від'ємного числа
        q6: function() {
            const squares = [4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144];
            const n = squares[Math.floor(Math.random() * squares.length)];
            const sqrtN = Math.sqrt(n);
            
            const question = `Перетворити корінь з від'ємного числа у вигляд із використанням уявної одиниці \\( i \\):<br>
                \\( \\pm \\sqrt{-${n}} = \\pm \\)`;
            
            const correct = `${sqrtN}i`;
            
            // Генеруємо варіанти для множинного вибору
            const wrong1 = `${sqrtN}`;
            const wrong2 = `${n}i`;
            const wrong3 = `-${sqrtN}i`;
            
            let options = [correct, wrong1, wrong2, wrong3];
            shuffleArray(options);
            
            return {
                text: question,
                options: options,
                correct: correct,
                type: 'single'
            };
        },
        
// Питання 7: Розв'язання квадратного рівняння - ПОВНІСТЮ ВИПРАВЛЕНА ВЕРСІЯ
q7: function() {
    // Генеруємо рівняння з комплексними коренями
    // Оберемо лише позитивні значення для a, щоб уникнути подвійних мінусів
    let a = getRandomInt(1, 4); // a буде від 1 до 4 (додатнє)
    let b = getRandomInt(1, 5); // b буде від 1 до 5 (додатнє)
    
    // Обчислюємо коефіцієнти рівняння: x² - 2ax + (a²+b²) = 0
    const p = -2 * a; // це буде від'ємне число
    const q = a*a + b*b;
    
    const question = `Знайти корені рівняння \\( x^2 ${p >= 0 ? '+' : ''}${p}x + ${q} = 0 \\)`;
    
    // Правильна відповідь завжди має вигляд: a ± bi, де a > 0
    const correct = `\\( ${a} \\pm ${b}i \\)`;
    
    // Генеруємо неправильні варіанти
    const wrongOptions = [];
    
    // Варіант 1: помилковий знак перед a (мінус замість плюса)
    wrongOptions.push(`\\( -${a} \\pm ${b}i \\)`);
    
    // Варіант 2: помилкова уявна частина
    wrongOptions.push(`\\( ${a} \\pm ${b+1}i \\)`);
    
    // Варіант 3: помилкова дійсна частина
    wrongOptions.push(`\\( ${a+1} \\pm ${b}i \\)`);
    
    // Варіант 4: неправильний формат (без ±)
    wrongOptions.push(`\\( ${a} + ${b}i \\)`);
    
    // Варіант 5: подвійний ± (як у вашій оригінальній помилці)
    wrongOptions.push(`\\( \\pm ${a} \\pm ${b}i \\)`);
    
    // Беремо 3 випадкові неправильні варіанти
    shuffleArray(wrongOptions);
    const selectedWrongOptions = wrongOptions.slice(0, 3);
    
    let options = [correct, ...selectedWrongOptions];
    shuffleArray(options);
    
    return {
        text: question,
        options: options,
        correct: correct,
        type: 'single'
    };
}
    };

    // ---------- СИСТЕМА ТРЕНАЖЕРА ----------
    let currentQuestion = 'q1';
    let generatedQuestions = {};
    let attemptCounts = {
        q1: 0, q2: 0, q3: 0, q4: 0, 
        q5: 0, q6: 0, q7: 0
    };
    
    function generateNewQuestion(questionType) {
        generatedQuestions[questionType] = questionGenerators[questionType]();
        return generatedQuestions[questionType];
    }
    
    function getCurrentQuestion() {
        if (!generatedQuestions[currentQuestion]) {
            generateNewQuestion(currentQuestion);
        }
        return generatedQuestions[currentQuestion];
    }
    
    function moveToNextQuestion() {
        const questionOrder = ['q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7'];
        const currentIndex = questionOrder.indexOf(currentQuestion);
        
        if (currentIndex < questionOrder.length - 1) {
            currentQuestion = questionOrder[currentIndex + 1];
            generateNewQuestion(currentQuestion);
            return true;
        } else {
            currentQuestion = 'end';
            return false;
        }
    }
    
    function moveToSameQuestion() {
        generateNewQuestion(currentQuestion);
    }

    // ---------- РЕНДЕРИНГ ПИТАНЬ ----------
    function renderQuestion() {
        const trainerContent = document.getElementById('trainerContent');
        if (!trainerContent) return;
        
        if (currentQuestion === 'end') {
            trainerContent.innerHTML = `
                <div class="completion-message">
                    <div class="completion-emoji"></div>
                    <h2>МІСІЯ ВИКОНАНА!</h2>
                    <p>Ти впевнено працюєш із алгебраїчною формою комплексних чисел!</p>
                    <p><strong>СЛАВА УКРАЇНІ!</strong></p>
                    <button id="resetTrainerBtn" class="reset-btn">Повернутися на полігон!</button>
                </div>
            `;
            return;
        }
        
        const q = getCurrentQuestion();
        const questionNumber = currentQuestion.charAt(1);
        
        let contentHTML = '';
        
        // Шапка з номером питання
        contentHTML += `
            <div class="question-circle">
                <h3>Питання ${questionNumber}</h3>
            </div>
            <p>${q.text}</p>
        `;
        
        if (q.type === 'single') {
            // Одиночний вибір
            contentHTML += `
                <div class="options-container">
                    ${q.options.map(opt => `<div class="option" data-answer="${opt}">${opt}</div>`).join('')}
                </div>
            `;
        } else if (q.type === 'double-input') {
            // Два поля вводу
            contentHTML += `
                <div class="input-container">
                    ${q.inputs.map((input, idx) => `
                        <div class="input-group">
                            <label>${input.label}</label>
                            <input type="text" id="input${idx}" class="inline-input" />
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        contentHTML += `
            <button onclick="checkAnswer()" id="submitBtn">Відповісти</button>
            <div class="result" id="result"></div>
        `;
        
        trainerContent.innerHTML = contentHTML;
        
        // Рендеримо MathJax
        if (typeof MathJax !== 'undefined') {
            MathJax.typesetPromise().catch(err => console.error('MathJax Error:', err));
        }
        
        // Додаємо обробники подій
        if (q.type === 'single') {
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.addEventListener('click', () => {
                    options.forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                });
            });
        } else if (q.type === 'double-input') {
            const inputs = document.querySelectorAll('.inline-input');
            const submitBtn = document.getElementById('submitBtn');
            
            // Перевірка заповнення всіх полів
            function checkInputs() {
                const allFilled = Array.from(inputs).every(input => input.value.trim() !== '');
                if (submitBtn) submitBtn.disabled = !allFilled;
            }
            
            inputs.forEach(input => {
                input.addEventListener('input', checkInputs);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && submitBtn && !submitBtn.disabled) {
                        checkAnswer();
                    }
                });
            });
            
            checkInputs(); // Початкова перевірка
        }
    }

    // ---------- ПЕРЕВІРКА ВІДПОВІДЕЙ ----------
    function normalizeInput(input) {
        return input.trim().toLowerCase().replace(/\s+/g, '');
    }
    
    function showFeedback(isCorrect) {
        const feedbackDiv = document.createElement('div');
        feedbackDiv.className = isCorrect ? 'feedback correct-feedback' : 'feedback incorrect-feedback';
        feedbackDiv.innerHTML = isCorrect ? '✅ ВІРНО! Ціль уражена!' : '❌ Промах! Спробуй ще!';
        document.body.appendChild(feedbackDiv);
        
        setTimeout(() => {
            feedbackDiv.remove();
            
            if (isCorrect) {
                const hasNext = moveToNextQuestion();
                if (hasNext) {
                    renderQuestion();
                } else {
                    renderQuestion(); // показуємо завершення
                }
            } else {
                moveToSameQuestion();
                renderQuestion();
            }
        }, 1500);
    }
    
    function checkAnswer() {
        const q = getCurrentQuestion();
        const resultDiv = document.getElementById('result');
        if (resultDiv) resultDiv.innerHTML = '';
        
        let isCorrect = false;
        
        if (q.type === 'single') {
            const selected = document.querySelector('.option.selected');
            if (!selected) {
                if (resultDiv) resultDiv.innerHTML = '<div class="result-text">Оберіть варіант відповіді.</div>';
                return;
            }
            isCorrect = selected.dataset.answer === q.correct;
        } else if (q.type === 'double-input') {
            const inputs = document.querySelectorAll('.inline-input');
            const answers = Array.from(inputs).map(input => normalizeInput(input.value));
            
            isCorrect = q.inputs.every((input, idx) => {
                const userAnswer = answers[idx];
                const correctAnswer = normalizeInput(input.correct);
                return userAnswer === correctAnswer;
            });
        }
        
        attemptCounts[currentQuestion]++;
        
        showFeedback(isCorrect);
    }

    // ---------- МОДАЛЬНІ ВІКНА ----------
    document.querySelectorAll('.video-card img').forEach(img => {
        img.onerror = () => {
            img.src = 'https://img.icons8.com/color/48/video-camera.png';
        };
    });

    function isModalVisible(modal) {
        return modal && modal.style.display === 'flex';
    }

    function openModal(modal, btn) {
        if (!modal || !btn) return;
        modal.style.display = 'flex';
        overlay.style.display = 'block';
        btn.setAttribute('aria-pressed', 'true');
        setTimeout(() => {
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise().catch(err => console.error('MathJax error:', err));
            }
        }, 100);
    }

    function closeModal(modal, btn) {
        if (!modal || !btn) return;
        modal.style.display = 'none';
        overlay.style.display = 'none';
        btn.setAttribute('aria-pressed', 'false');
        btn.focus();
    }

    function closeVideoPlayerModal(videoModal, player, mainModal, btn) {
        if (player) {
            player.src = player.src;
        }
        if (videoModal) videoModal.style.display = 'none';
        overlay.style.display = 'none';
        if (mainModal && btn) openModal(mainModal, btn);
    }

    // ---------- ОБРОБНИКИ ПОДІЙ ----------
    openTheoryBtn.addEventListener('click', () => openModal(theoryModal, openTheoryBtn));
    openVideoBtn.addEventListener('click', () => openModal(videoModal, openVideoBtn));
    openQuestionsBtn.addEventListener('click', () => openModal(questionsModal, openQuestionsBtn));
    openTrainerBtn.addEventListener('click', () => {
        // Скидаємо стан тренажера
        currentQuestion = 'q1';
        generatedQuestions = {};
        attemptCounts = {
            q1: 0, q2: 0, q3: 0, q4: 0, 
            q5: 0, q6: 0, q7: 0
        };
        generateNewQuestion('q1');
        
        openModal(trainerModal, openTrainerBtn);
        renderQuestion();
    });
    
    closeTheoryBtn.addEventListener('click', () => closeModal(theoryModal, openTheoryBtn));
    closeVideoBtn.addEventListener('click', () => closeModal(videoModal, openVideoBtn));
    closeQuestionsBtn.addEventListener('click', () => closeModal(questionsModal, openQuestionsBtn));
    closeTrainerBtn.addEventListener('click', () => closeModal(trainerModal, openTrainerBtn));
    
    closeVideoPlayerBtn1.addEventListener('click', () => closeVideoPlayerModal(videoPlayerModal1, youtubePlayer1, videoModal, openVideoBtn));
    closeVideoPlayerBtn2.addEventListener('click', () => closeVideoPlayerModal(videoPlayerModal2, youtubePlayer2, videoModal, openVideoBtn));
    closeVideoPlayerBtn3.addEventListener('click', () => closeVideoPlayerModal(videoPlayerModal3, youtubePlayer3, videoModal, openVideoBtn));

    overlay.addEventListener('click', () => {
        closeModal(theoryModal, openTheoryBtn);
        closeModal(videoModal, openVideoBtn);
        closeModal(questionsModal, openQuestionsBtn);
        closeModal(trainerModal, openTrainerBtn);
        closeVideoPlayerModal(videoPlayerModal1, youtubePlayer1, videoModal, openVideoBtn);
        closeVideoPlayerModal(videoPlayerModal2, youtubePlayer2, videoModal, openVideoBtn);
        closeVideoPlayerModal(videoPlayerModal3, youtubePlayer3, videoModal, openVideoBtn);
    });

    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoId = card.dataset.video;
            if (videoId === '1') {
                openModal(videoPlayerModal1, openVideoBtn);
            } else if (videoId === '2') {
                openModal(videoPlayerModal2, openVideoBtn);
            } else if (videoId === '3') {
                openModal(videoPlayerModal3, openVideoBtn);
            }
        });
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            const modals = [
                { modal: videoPlayerModal1, player: youtubePlayer1 },
                { modal: videoPlayerModal2, player: youtubePlayer2 },
                { modal: videoPlayerModal3, player: youtubePlayer3 },
                { modal: theoryModal },
                { modal: videoModal },
                { modal: questionsModal },
                { modal: trainerModal }
            ];
            const activeModal = modals.find(m => isModalVisible(m.modal));
            if (activeModal) {
                if (activeModal.player) {
                    closeVideoPlayerModal(activeModal.modal, activeModal.player, videoModal, openVideoBtn);
                } else {
                    const btn = 
                        activeModal.modal === theoryModal ? openTheoryBtn :
                        activeModal.modal === videoModal ? openVideoBtn :
                        activeModal.modal === questionsModal ? openQuestionsBtn :
                        activeModal.modal === trainerModal ? openTrainerBtn : null;
                    closeModal(activeModal.modal, btn);
                }
            }
        }
    });

    // Кнопка скидання тренажера
    document.addEventListener('click', function(e) {
        if (e.target && e.target.id === 'resetTrainerBtn') {
            currentQuestion = 'q1';
            generatedQuestions = {};
            attemptCounts = {
                q1: 0, q2: 0, q3: 0, q4: 0, 
                q5: 0, q6: 0, q7: 0
            };
            generateNewQuestion('q1');
            renderQuestion();
        }
    });

    // Обробка кліків для карток питань
    document.querySelectorAll('.question-card').forEach(card => {
        card.addEventListener('click', () => {
            const inner = card.querySelector('.card-inner');
            if (inner) inner.classList.toggle('flipped');
        });
    });

    // Запускаємо MathJax при завантаженні
    window.addEventListener('load', () => {
        if (typeof MathJax !== 'undefined') {
            MathJax.typesetPromise().catch(err => console.error('MathJax error:', err));
        }
    });
</script>
</body>
</html>



