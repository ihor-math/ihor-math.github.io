   <!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>23. Розв’язування систем лінійних алгебраїчних рівнянь за допомогою методу Крамера</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --base-font-size: 16px;
            --text-color: #FFFFFF;
            --math-color: #ffff00;
            --bg-gradient: linear-gradient(135deg, #2C3E50, #3498DB);
            --bg-hover: linear-gradient(135deg, #3498DB, #9B59B6);
        }
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100dvh;
            font-size: 1rem;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: var(--bg-gradient);
            border-radius: 25px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            margin: 0;
            font-size: 1.75rem;
            color: var(--text-color);
            font-family: 'Lora', serif;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: var(--bg-gradient);
            border-radius: 20px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .section:hover {
            background: var(--bg-hover);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: brightness(1.2);
        }
        .section h2 {
            font-size: 1.25rem;
            color: var(--text-color);
            margin: 0;
            font-family: 'Lora', serif;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: var(--bg-gradient);
            color: var(--text-color);
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: bold;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--text-color);
            line-height: 1.2;
        }
        .nav-button:hover {
            background: var(--bg-hover);
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
            width: 20px;
            height: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: var(--bg-gradient);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
            flex-direction: column;
        }
        .modal-content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            background: var(--bg-gradient);
            border-radius: 10px;
            margin: 10px;
            width: 100%;
            color: var(--text-color);
        }
        #trainerModal .modal-content {
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            padding: 20px;
        }
        .modal-header {
            display: flex;
            justify-content: flex-end;
            background: var(--bg-gradient);
            padding: 8px 10px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .close-btn {
            background: var(--text-color);
            color: #2C3E50;
            border: none;
            border-radius: 6px;
            padding: 5px 15px;
            font-size: 1rem;
            cursor: pointer;
        }
        .close-btn:hover {
            background: #9B59B6;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .tab-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            background: var(--bg-gradient);
            color: #ffff00;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Lora', serif;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            text-align: left;
            position: relative;
        }
        .tab-button::after {
            content: '▶';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            color: #ffcc00;
        }
        .tab-button.active::after {
            content: '▼';
        }
        .tab-button.active {
            background: var(--bg-hover);
            color: #fff0f5;
            font-weight: 700;
        }
        .tab-button:hover {
            background: var(--bg-hover);
            color: #ffd1dc;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border-radius: 10px;
            background: #003153;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .tab-content.active {
            display: block;
        }
        #theoryModal .modal-content p {
            text-align: justify;
            color: var(--text-color);
            font-size: 1.125rem;
            line-height: 1.6;
            white-space: normal;
        }
        #theoryModal .modal-content h3 {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: #9B59B6;
            margin-bottom: 15px;
            text-align: center;
        }
        #theoryModal .modal-content .example-title {
            color: #ff8c00;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 10px;
        }
        #theoryModal .modal-content .example-solution {
            color: #ff8c00;
            font-weight: bold;
            font-size: 1.125rem;
            text-align: left;
            margin: 15px 0;
        }
        #theoryModal .modal-content li {
            color: var(--text-color);
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
        .MathJax, mjx-container, mjx-math, mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
        }
        mjx-msub {
            font-size: 1.1em !important;
        }
        mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap;
            max-width: 100%;
            margin: 0 auto !important;
            padding: 5px;
            -webkit-overflow-scrolling: touch;
        }
        .flashcard-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .flashcard {
            perspective: 1000px;
            width: 100%;
            height: 230px;
            cursor: pointer;
            outline: none;
        }
        .flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    will-change: transform; /* Оптимізуємо рендеринг анімації */
}
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 15px;
            box-sizing: border-box;
            background: #34495E;
            color: var(--text-color);
        }
        .flashcard-back {
            transform: rotateY(180deg);
            background: #8E44AD;
            color: var(--math-color);
            text-align: justify;
        }
        .flashcard-front p, .flashcard-back p {
            font-size: 1.4rem;
            margin: 0;
            font-family: 'Lora', serif;
            line-height: 1.5;
            text-align: center;
        }
        .flashcard-back p {
            font-family: 'Roboto', sans-serif;
            font-size: 1.4rem;
            line-height: 1.6;
            text-align: left;
            white-space: normal;
        }
        .flashcard-back li {
            color: var(--math-color);
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
        .trainer-container {
            width: 95%;
            max-width: 95%;
            padding: 25px;
            text-align: center;
            background: linear-gradient(135deg, #2e1065, #6b21a8);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(236, 72, 153, 0.5);
            position: relative;
            min-height: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-y: auto;
                                        box-sizing: border-box;
        }
        .solution {
            color: #ff8c00;
            font-weight: bold;
            text-align: center;
            display: block;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #f0e7ff;
            margin-bottom: 25px;
        }
        .trainer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 15px;
            max-width: 750px;
            margin: 25px auto;
            justify-items: center;
            align-items: stretch;
        }
        .trainer-option {
    background: linear-gradient(135deg, #1e40af, #3b82f6);
    color: #f0e7ff;
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    font-size: clamp(18px, 3vw, 20px);
    text-align: center;
    border: 2px solid rgba(167, 139, 250, 0.5);
    transition: background 0.3s ease, transform 0.2s ease;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80px;
}
.trainer-option mjx-container {
    font-size: 0.9em !important;
    text-align: center !important;
}
        .trainer-option:hover {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            transform: scale(1.03);
        }
        .trainer-option.selected {
            background: linear-gradient(135deg, #a78bfa, #c026d3);
            border-color: #facc15;
        }
            .trainer-option mjx-container[display="true"] {
    display: block !important;
    text-align: center !important;
    margin: 0 auto !important;
}
        .trainer-submit {
            background: linear-gradient(135deg, #22c55e, #86efac);
            color: #1e1e5f;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: clamp(18px, 2.8vw, 20px);
            cursor: pointer;
            margin-top: 25px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .trainer-submit:hover {
            background: linear-gradient(135deg, #86efac, #4ade80);
            transform: scale(1.05);
        }
        .trainer-feedback.correct {
            color: #3498DB !important;
            background: rgba(232, 245, 233, 0.95) !important;
            opacity: 1 !important;
            display: block !important;
        }
        .trainer-feedback.wrong {
            color: #E74C3C !important;
            background: rgba(255, 235, 238, 0.95) !important;
            opacity: 1 !important;
            display: block !important;
        }
          /* Стилізація смуги прокрутки для .trainer-container */
.trainer-container::-webkit-scrollbar {
    width: 12px; /* Ширина смуги прокрутки */
}

.trainer-container::-webkit-scrollbar-track {
    background: rgba(167, 139, 250, 0.2); /* Прозорий фон треку з легким фіолетовим відтінком */
    border-radius: 10px; /* Закруглення країв треку */
    margin: 5px; /* Відступи для естетичного вигляду */
}

.trainer-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #d81b60, #f06292); /* Градієнт від темно-рожевого до світло-рожевого */
    border-radius: 10px; /* Закруглення бігунка */
    border: 2px solid rgba(167, 139, 250, 0.3); /* Обведення для контрасту */
}

.trainer-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #f06292, #d81b60); /* Зміна градієнта при наведенні */
}

/* Стилі для Firefox */
.trainer-container {
    scrollbar-width: thin; /* Тонка смуга прокрутки */
    scrollbar-color: #f06292 rgba(167, 139, 250, 0.2); /* Колір бігунка і треку */
}  
       .question-circle {
    width: clamp(100px, 16vw, 130px);
    height: clamp(100px, 16vw, 130px);
    min-width: clamp(100px, 16vw, 130px); /* Додано */
    min-height: clamp(100px, 16vw, 130px); /* Додано */
    max-width: clamp(100px, 16vw, 130px); /* Додано */
    max-height: clamp(100px, 16vw, 130px); /* Додано */
    aspect-ratio: 1/1;
    background: linear-gradient(135deg, #d81b60, #f06292);
    border-radius: 50%;
    color: var(--math-color);
    font-family: 'Lora', serif;
    font-weight: 700;
    margin: 0 auto 25px;
    border: 3px dashed #a78bfa;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    padding: 0;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.0rem, 2.5vw, 1.1rem);
    text-align: center;
    white-space: nowrap;
    line-height: 1.2;
    overflow: hidden;
}
        .question-circle span {
    font-size: inherit;
    font-family: inherit;
    font-weight: inherit;
    color: inherit;
    margin: 0;
    padding: 0;
    text-align: center;
    display: flex; /* Змінено з inline-flex на flex */
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}
       .question-circle mjx-container,
.question-circle .MathJax {
    display: none !important; /* Уже є, але залишаємо для надійності */
}
    .trainer-input {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px 0;
    width: 100%;
    max-width: 300px;
}
.trainer-input label {
    font-family: 'Lora', serif;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
    margin-bottom: 10px;
    text-align: center;
}
.answer-input {
    background: #34495E;
    color: var(--text-color);
    border: 2px solid rgba(167, 139, 250, 0.5);
    border-radius: 8px;
    padding: 10px;
    font-size: clamp(1rem, 2.2vw, 1.1rem);
    font-family: 'Roboto', sans-serif;
    width: 100%;
    max-width: 200px;
    text-align: center;
    box-sizing: border-box;
}
.answer-input:focus {
    outline: none;
    border-color: #facc15;
    background: #4a5568;
}
.answer-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}
    @media (max-width: 768px) {
    .trainer-options.question-2 {
        display: flex;
        flex-direction: column;
        gap: 15px;
        max-width: 100%;
    }
    .trainer-options.question-2 .trainer-option {
        width: 100%;
        max-width: 500px; /* Обмежуємо максимальну ширину для зручності */
        min-height: 80px;
        font-size: clamp(16px, 2.8vw, 18px);
    }
}
    @media (max-width: 480px) {
    .trainer-options.question-2 {
        gap: 10px;
    }
    .trainer-options.question-2 .trainer-option {
        font-size: clamp(14px, 2.5vw, 16px);
        min-height: 70px;
        padding: 10px;
    }
}
@media (max-width: 768px) {
    .trainer-input {
        max-width: 250px;
    }
    .answer-input {
        font-size: clamp(0.9rem, 2vw, 1rem);
        max-width: 150px;
    }
}
@media (max-width: 480px) {
    .trainer-input {
        max-width: 200px;
    }
    .answer-input {
        font-size: clamp(0.8rem, 1.8vw, 0.9rem);
        max-width: 120px;
    }
}
@media (max-width: 768px) {
    .question-circle {
        width: clamp(80px, 15vw, 100px);
        height: clamp(80px, 15vw, 100px);
        font-size: clamp(1rem, 2.5vw, 1.25rem);
    }
}
@media (max-width: 480px) {
    .question-circle {
        width: clamp(100px, 14vw, 120px);
        height: clamp(100px, 14vw, 120px);
        font-size: clamp(0.9rem, 2.2vw, 1rem);
    }
}
        #questionText {
            font-family: 'Lora', serif;
            font-size: clamp(1.2rem, 3vw, 1.3rem);
            color: #fffff0;
            font-weight: 700;
            line-height: 1.4;
            margin: 15px 0;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        #questionsModal mjx-container {
            font-size: clamp(24px, 3.2vw, 26px) !important;
            color: #ffff00 !important;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        #questionsModal .card-front mjx-container,
        #questionsModal .card-back mjx-container {
            display: inline !important;
            margin: 0 0.3em !important;
            padding: 0 !important;
            vertical-align: -0.1em !important;
        }
        #questionsModal .card-back mjx-container[display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 4px auto;
            padding: 4px;
        }
        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 20px 0;
            justify-items: center;
        }
        .answer-button {
            background: #34495E;
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: 'Roboto', sans-serif;
            font-size: 1.25rem;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            text-align: center;
        }
        .answer-button:hover:not(:disabled) {
            background: #9B59B6;
        }
        .answer-button.selected {
            background: #3498DB;
        }
        .answer-button.correct {
            background: #3498DB;
        }
        .answer-button.wrong {
            background: #E74C3C;
        }
        .answer-button:disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .answer-button .MathJax, .answer-button mjx-container, .answer-button mjx-math, .answer-button mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
        }
        /* Оновлені стилі для .result-message */
.result-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-family: 'Lora', serif;
    font-weight: bold;
    text-align: center;
    padding: 20px 40px;
    border-radius: 12px;
    min-width: 300px;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.1s ease; /* Зменшено до 0.1с для швидкої анімації */
    z-index: 1001;
    display: none;
}
.result-message.correct {
    color: #3498DB;
    background: rgba(232, 245, 233, 0.95);
    opacity: 1;
}
.result-message.wrong {
    color: #E74C3C;
    background: rgba(255, 235, 238, 0.95);
    opacity: 1;
}
            .system-equation {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 10px 0;
    font-size: clamp(1.1rem, 2.5vw, 1.2rem);
    color: var(--math-color);
}

.system-equation mjx-container {
    font-size: 1.2rem !important;
}

.system-equation .answer-input {
    margin-left: 10px;
    width: 80px;
    max-width: 80px;
    font-size: clamp(1rem, 2vw, 1.1rem);
}

@media (max-width: 768px) {
    .system-equation {
        font-size: clamp(1rem, 2.2vw, 1.1rem);
    }
    .system-equation .answer-input {
        width: 60px;
        font-size: clamp(0.9rem, 1.8vw, 1rem);
    }
}

@media (max-width: 480px) {
    .system-equation {
        font-size: clamp(0.9rem, 2vw, 1rem);
    }
    .system-equation .answer-input {
        width: 50px;
        font-size: clamp(0.8rem, 1.6vw, 0.9rem);
    }
}

/* Оновлені стилі для .completion-message */
.completion-message {
    display: none;
    text-align: center;
    padding: 20px;
    background: var(--bg-gradient);
    border-radius: 15px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    margin: 20px auto;
    max-width: 600px;
    color: var(--text-color);
    position: relative;
    width: 90%;
    z-index: 1002; /* Вищий z-index, щоб бути поверх .result-message */
}
.completion-message h2 {
    font-family: 'Lora', serif;
    font-size: 1.75rem;
    color: var(--math-color);
    text-align: center;
    margin: 10px 0;
}
.completion-message p {
    font-family: 'Roboto', sans-serif;
    font-size: 1.5rem;
    color: var(--math-color);
    text-align: center;
    margin: 10px 0;
    font-weight: bold;
}
            
        .completion-emoji {
            width: clamp(100px, 18vw, 140px);
            height: clamp(100px, 18vw, 140px);
            margin: 0 auto 20px;
            border-radius: 50%;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: 3px dashed #facc15;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .completion-emoji::after {
            content: '🎉';
            font-size: clamp(50px, 10vw, 70px);
            color: #facc15;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        /* Оновлені стилі для .completion-message */

        #resetTrainerBtn {
            display: block;
            margin: 20px auto;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            color: var(--text-color);
            background: #E74C3C;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #resetTrainerBtn:hover {
            background: #9B59B6;
        }
        .video-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: var(--bg-gradient);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: var(--text-color);
        }
        .video-card:hover {
            background: var(--bg-hover);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-player-container {
            width: 80vw;
            max-width: 960px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-player-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: block;
            border: none;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
            color: var(--text-color);
        }
        .glow-title {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: var(--math-color);
            text-align: center;
            margin-bottom: 20px;
        }
        .math-loading {
            visibility: hidden;
            opacity: 0;
        }
        .math-loaded {
            visibility: visible;
            opacity: 1;
        }
        .answer-select {
            background: #34495E;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px;
            font-family: 'Roboto', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            width: 150px;
            margin-left: 5px;
        }
        .answer-select:hover:not(:disabled) {
            background: #9B59B6;
        }
        .answer-select:disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .answer-options label {
            font-family: 'Lora', serif;
            font-size: 1.2rem;
            color: var(--math-color);
            margin-right: 5px;
        }
        #systemText {
            margin: 20px 0;
            font-size: 1.3rem;
            color: var(--math-color);
            text-align: center;
        }
        #systemText mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 0 auto !important;
        }
        .trainer-option.disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .trainer-option.correct {
            background: linear-gradient(135deg, #22c55e, #86efac);
            border-color: #facc15;
        }
        .trainer-option.wrong {
            background: linear-gradient(135deg, #E74C3C, #ff6b6b);
            border-color: #facc15;
        }
            @media (max-width: 768px) {
    .flashcard.flashcard-2 {
        height: auto;
        min-height: 200px;
    }
    .flashcard.flashcard-2 .flashcard-inner {
        height: 100%; /* Гарантуємо, що flashcard-inner займає всю висоту flashcard */
        min-height: 200px;
    }
    .flashcard.flashcard-2 .flashcard-back {
        padding: 15px;
        overflow-y: auto;
        max-height: 200px;
        height: 100%; /* Гарантуємо, що flashcard-back займає всю висоту flashcard-inner */
        background: #8E44AD; /* Явно вказуємо фон */
    }
    .flashcard.flashcard-2 .flashcard-back p {
        font-size: 0.9rem;
        line-height: 1.4;
        margin: 0;
        text-align: justify;
    }
}

@media (max-width: 480px) {
    .flashcard.flashcard-2 {
        height: auto;
        min-height: 180px;
    }
    .flashcard.flashcard-2 .flashcard-inner {
        height: 100%;
        min-height: 180px;
    }
    .flashcard.flashcard-2 .flashcard-back {
        padding: 10px;
        overflow-y: auto;
        max-height: 180px;
        height: 100%;
        background: #8E44AD;
    }
    .flashcard.flashcard-2 .flashcard-back p {
        font-size: 0.8rem;
        line-height: 1.3;
        margin: 0;
    }
}
        @media (max-width: 768px) {
            .title-box { margin-top: 40px; padding: 15px 20px; }
            .title-box h1 { font-size: 1.5rem; }
            .section-container { flex-direction: column; align-items: center; gap: 20px; }
            .section { width: 80%; height: 180px; }
            .section h2 { font-size: 1.125rem; }
            .nav-button { font-size: 0.9rem; padding: 8px 16px; }
            .tab-button { font-size: 1rem; padding: 8px 16px; }
            .tab-content { padding: 15px; }
            .modal { top: 2%; left: 2%; width: 96%; height: 96%; }
            .trainer-container { width: 95%; padding: 4vw; }
            .video-card-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            .video-card {
                width: 260px;
                height: 160px;
                margin: 5px;
            }
            .video-card img {
                width: 40px;
                height: 40px;
                margin-bottom: 6px;
            }
            .video-player-container {
                width: 80vw;
                max-width: 600px;
                aspect-ratio: 16 / 9;
            }
            .video-card h3 {
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .flashcard-front p { font-size: 1.125rem; }
            .flashcard-back p { font-size: 1rem; }
            .flashcard { height: 180px; }
            .flashcard-front, .flashcard-back { padding: 15px; }
            .answer-select { font-size: 1rem; width: 120px; }
            .answer-options label { font-size: 1rem; }
            .question-circle {
                width: clamp(80px, 15vw, 100px);
                height: clamp(80px, 15vw, 100px);
                font-size: clamp(1rem, 2.5vw, 1.25rem);
            }
            #questionText {
                font-size: clamp(1.25rem, 3vw, 1.5rem);
            }
            #questionText .MathJax,
            #questionText mjx-container,
            #questionText mjx-math,
            #questionText mjx-mrow {
                font-size: clamp(1.1rem, 2.5vw, 1.3rem) !important;
            }
            mjx-container[jax="CHTML"][display="true"] {
        display: block !important;
        text-align: center !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        white-space: nowrap;
        max-width: 100%;
        margin: 0 auto !important;
        padding: 8px; /* Збільшено для кращої видимості */
        -webkit-overflow-scrolling: touch; /* Плавна прокрутка на iOS */
        scrollbar-width: thin; /* Для Firefox */
        scrollbar-color: #f06292 rgba(167, 139, 250, 0.2); /* Колір смуги прокрутки */
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar {
        height: 10px; /* Збільшено висоту смуги прокрутки для кращої видимості */
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-track {
        background: rgba(167, 139, 250, 0.2); /* Прозорий фон треку */
        border-radius: 10px;
        margin: 5px;
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #d81b60, #f06292); /* Градієнт для бігунка */
        border-radius: 10px;
        border: 2px solid rgba(167, 139, 250, 0.3);
    }

    mjx-container[jax="CHTML"][display="true"]::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #f06292, #d81b60); /* Зміна при наведенні */
    }
        }
        @media (max-width: 480px) {
            .title-box { margin-top: 20px; padding: 10px 15px; }
            .title-box h1 { font-size: 1.25rem; }
            .section { width: 90%; height: 150px; }
            .section img { width: 50px; height: 50px; }
            .section h2 { font-size: 1rem; }
            .video-card-container {
                gap: 10px;
                padding: 10px;
            }
            .video-card {
                width: 90%;
                max-width: 260px;
                height: 140px;
                margin: 5px;
            }
            .video-card img {
                width: 30px;
                height: 30px;
                margin-bottom: 5px;
            }
            .video-card h3 {
                font-size: clamp(12px, 2.5vw, 14px);
            }
            .video-player-container {
                width: 80vw;
                max-width: 400px;
                aspect-ratio: 16 / 9;
            }
            #theoryModal .modal-content h3 { font-size: 1.25rem; }
            .example-title { font-size: 1.0rem; }
            .example-solution { font-size: 1.0rem; }
            .MathJax, mjx-container, mjx-math, mjx-mrow { font-size: 1.0rem !important; }
            .question-circle { width: clamp(80px, 15vw, 100px); height: clamp(80px, 15vw, 100px); }
            .question-circle h3 { font-size: clamp(0.9rem, 2.5vw, 1.0rem); }
            #questionText { font-size: 1.0rem; }
            #questionText .MathJax, #questionText mjx-container, #questionText mjx-math, #questionText mjx-mrow { font-size: 1.1rem !important; }
            .answer-button { font-size: 1.0rem; }
            .answer-select { font-size: 0.9rem; width: 100px; }
            .answer-options label { font-size: 0.9rem; }
            #systemText { font-size: 0.9rem; }
            .question-circle {
                width: clamp(70px, 14vw, 90px);
                height: clamp(70px, 14vw, 90px);
                font-size: clamp(0.9rem, 2.2vw, 1rem);
            }
            #questionText {
                font-size: clamp(1rem, 2.5vw, 1.25rem);
            }
            #questionText .MathJax,
            #questionText mjx-container,
            #questionText mjx-math,
            #questionText mjx-mrow {
                font-size: clamp(0.9rem, 2.2vw, 1.1rem) !important;
            }
        .trainer-options.question-2 {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 100%;
    }
    .trainer-options.question-2 .trainer-option {
        width: 100%;
        max-width: 400px;
        min-height: 70px;
        font-size: clamp(14px, 2.5vw, 16px);
        padding: 10px;
    }
        }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>23. Розв’язування систем лінійних алгебраїчних рівнянь за допомогою методу Крамера</h1>
    </div>
    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>
    <div class="navigation-buttons">
        <a class="nav-button" href="{{ url_for('tema6') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 6
        </a>
        <a class="nav-button" href="{{ url_for('home') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>
    <div id="modalOverlay"></div>
    
    <div id="theoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити документ" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="tab-container">
                <button class="tab-button" data-tab="cramer-two" aria-expanded="false">Метод Крамера для системи двох рівнянь із двома змінними</button>
                <div id="cramer-two" class="tab-content">
                    <p>Метод Крамера є одним із класичних підходів до розв’язування систем лінійних алгебраїчних рівнянь. Він базується на обчисленні визначників матриць і є особливо зручним для систем із малою кількістю змінних, таких як дві чи три. Для успішного використання цього методу необхідно добре володіти навичками обчислення визначників, а також пам’ятати, що метод застосовується лише тоді, коли головний визначник системи не дорівнює нулю.</p>
                    <p>Розглянемо детально, як працює метод Крамера, на прикладі системи з двома рівняннями та двома змінними. Це найпростіший випадок, який допоможе зрозуміти принципи методу та його застосування до складніших систем, наприклад, із трьома змінними.</p>
                    <p>Розглянемо систему рівнянь:</p>
                    <p class="math-equation center">\[ \begin{cases} a_{11}x + a_{12}y = b_1 \\ a_{21}x + a_{22}y = b_2 \end{cases} \]</p>
                    <p>На першому кроці потрібно обчислити головний визначник:</p>
                    <p class="math-equation center">\[ \Delta = \begin{vmatrix} a_{11} & a_{12} \\ a_{21} & a_{22} \end{vmatrix} \]</p>
                    <p>де елементами цього визначника є коефіцієнти при змінних у системі рівнянь. Якщо \(\Delta \neq 0\), то система має єдиний розв’язок. Для знаходження коренів потрібно ще обчислити два допоміжних визначники \(\Delta_x\) і \(\Delta_y\):</p>
                    <p>Замінивши перший стовпець визначника \(\Delta\) на стовпець вільних членів \(\begin{pmatrix} b_1 \\ b_2 \end{pmatrix}\), отримуємо визначник \(\Delta_x\):</p>
                    <p class="math-equation center">\[ \Delta_x = \begin{vmatrix} b_1 & a_{12} \\ b_2 & a_{22} \end{vmatrix} \]</p>
                    <p>Замінивши другий стовпець визначника \(\Delta\) на стовпець вільних членів \(\begin{pmatrix} b_1 \\ b_2 \end{pmatrix}\), отримуємо визначник \(\Delta_y\):</p>
                    <p class="math-equation center">\[ \Delta_y = \begin{vmatrix} a_{11} & b_1 \\ a_{21} & b_2 \end{vmatrix} \]</p>
                    <p>Корені рівняння визначаються за формулами:</p>
                    <p class="math-equation center">\[ x = \frac{\Delta_x}{\Delta}, \quad y = \frac{\Delta_y}{\Delta} \]</p>
                    <p>Якщо \(\Delta = \Delta_x = \Delta_y = 0\), то система має безліч розв’язків (невизначена). Якщо \(\Delta = 0\), а \(\Delta_x \neq 0\) або \(\Delta_y \neq 0\), то система не має розв’язків (несумісна).</p>
                    <p><strong><span class="example-title">Приклад 6.1. </span></strong> Розв’язати систему лінійних рівнянь:</p>
                    <p class="math-equation center">\[ \begin{cases} 5x - 3y = 16 \\ 2x + 4y = 22 \end{cases} \]</p>
                    <p><span class="solution">Розв’язання:</span></p>
                    <p>Обчислимо головний визначник системи:</p>
                    <p class="math-equation center">\[ \Delta = \begin{vmatrix} 5 & -3 \\ 2 & 4 \end{vmatrix} = 5 \cdot 4 - (-3) \cdot 2 = 20 + 6 = 26 \]</p>
                    <p>Оскільки \(\Delta \neq 0\), система має єдиний розв’язок. Обчислимо допоміжні визначники:</p>
                    <p class="math-equation center">\[ \Delta_x = \begin{vmatrix} 16 & -3 \\ 22 & 4 \end{vmatrix} = 16 \cdot 4 - (-3) \cdot 22 = 64 + 66 = 130 \]</p>
                    <p class="math-equation center">\[ \Delta_y = \begin{vmatrix} 5 & 16 \\ 2 & 22 \end{vmatrix} = 5 \cdot 22 - 16 \cdot 2 = 110 - 32 = 78 \]</p>
                    <p>Обчислимо корені:</p>
                    <p class="math-equation center">\[ x = \frac{\Delta_x}{\Delta} = \frac{130}{26} = 5 \]</p>
                    <p class="math-equation center">\[ y = \frac{\Delta_y}{\Delta} = \frac{78}{26} = 3 \]</p>
                    <p>Перевірка розв’язку:</p>
                    <p>Перше рівняння: \(5 \cdot 5 - 3 \cdot 3 = 25 - 9 = 16\),</p>
                    <p>Друге рівняння: \(2 \cdot 5 + 4 \cdot 3 = 10 + 12 = 22\).</p>
                    <p class="example-solution">Відповідь: \((5; 3)\).</p>
                </div>
                <button class="tab-button" data-tab="cramer-three" aria-expanded="false">Метод Крамера для системи трьох рівнянь із трьома змінними</button>
                <div id="cramer-three" class="tab-content">
                    <p>Розглянемо систему рівнянь:</p>
                    <p class="math-equation center">\[ \begin{cases} a_{11}x + a_{12}y + a_{13}z = b_1 \\ a_{21}x + a_{22}y + a_{23}z = b_2 \\ a_{31}x + a_{32}y + a_{33}z = b_3 \end{cases} \]</p>
                    <p>Головний визначник системи:</p>
                    <p class="math-equation center"> \[
                                \Delta = \begin{vmatrix} a_{11} & a_{12} & a_{13} \\ a_{21} & a_{22} & a_{23} \\ a_{31} & a_{32} & a_{33} \end{vmatrix}. \tag{6.4}
                                \]</p>
                    <p>Якщо \(\Delta = 0\), то система має безліч розв’язків або не має розв’язків. У цьому випадку метод Крамера не застосовний, і необхідно використовувати інший метод, зокрема метод Гауса.</p>
                    <p>Якщо \(\Delta \neq 0\), то система має єдиний розв’язок, і для знаходження коренів потрібно обчислити ще три допоміжні визначники \(\Delta_x\), \(\Delta_y\) і \(\Delta_z\). Для цього послідовно заміщаємо стовпці головного визначника на стовпець із вільними членами:</p>
                    <p class="math-equation center long-formula">\[
    \begin{array}{l}
        \Delta_x = \begin{vmatrix} b_1 & a_{12} & a_{13} \\ b_2 & a_{22} & a_{23} \\ b_3 & a_{32} & a_{33} \end{vmatrix}, \\[10pt]
        \Delta_y = \begin{vmatrix} a_{11} & b_1 & a_{13} \\ a_{21} & b_2 & a_{23} \\ a_{31} & b_3 & a_{33} \end{vmatrix}, \\[10pt]
        \Delta_z = \begin{vmatrix} a_{11} & a_{12} & b_1 \\ a_{21} & a_{22} & b_2 \\ a_{31} & a_{32} & b_3 \end{vmatrix}.
    \end{array} \tag{6.5}
\]</p>
                    <p>Розв’язки знаходять за допомогою наступних формул:</p>
                   <p class="math-equation center long-formula">\[
    \begin{array}{l}
        x = \frac{\Delta_x}{\Delta}, \\[10pt]
        y = \frac{\Delta_y}{\Delta}, \\[10pt]
        z = \frac{\Delta_z}{\Delta}.
    \end{array} \tag{6.6}
\]</p>
                    <p>Ці формули аналогічні до випадку двох змінних, але працюють із визначниками третього порядку.</p>
                    <p>Формули \((6.5)\) і \((6.6)\), які дозволяють розв’язувати системи лінійних рівнянь за допомогою визначників, називаються формулами Крамера.</p>
                    <p><strong><span class="example-title">Приклад 6.2. </span></strong> Розв’язати систему методом Крамера:</p>
                    <p class="math-equation center">\[ \begin{cases} 3x - 2y + 4z = 21 \\ 3x + 4y - 2z = 9 \\ 2x - y - z = 10 \end{cases} \]</p>
                    <p><span class="solution">Розв’язання:</span></p>
                    <p>Обчислимо головний визначник системи, розклавши за елементами третього рядка:</p>
                    <p class="math-equation center">\[ \Delta = \begin{vmatrix} 3 & -2 & 4 \\ 3 & 4 & -2 \\ 2 & -1 & -1 \end{vmatrix} = -12+8-12-32-6-6=-60 \neq 0 \]</p>
                    <p>Отже, система має єдиний розв’язок. Обчислимо допоміжні визначники, також розклавши за елементами третього рядка:</p>
                    <p class="math-equation center">\[ \Delta_x = \begin{vmatrix} 21 & -2 & 4 \\ 9 & 4 & -2 \\ 10 & -1 & -1 \end{vmatrix} = -84+40-36-160-42-18=-300,\]</p>
                    <p class="math-equation center">\[ \Delta_y = \begin{vmatrix} 3 & 21 & 4 \\ 3 & 9 & -2 \\ 2 & 10 & -1 \end{vmatrix} = -27-84+120-72+60+63=60, \]</p>
                    <p class="math-equation center">\[ \Delta_z = \begin{vmatrix} 3 & -2 & 21 \\ 3 & 4 & 9 \\ 2 & -1 & 10 \end{vmatrix} = 120-36-63-168+27+60=-60. \]</p>
                    <p>Знаходимо корені:</p>
                    <p class="math-equation center">\[ x = \frac{\Delta_x}{\Delta} = \frac{-300}{-60} = 5, \]</p>
                    <p class="math-equation center">\[ y = \frac{\Delta_y}{\Delta} = \frac{60}{-60} = -1, \]</p>
                    <p class="math-equation center">\[ z = \frac{\Delta_z}{\Delta} = \frac{-60}{-60} = 1. \]</p>
                    <p>Перевірка розв’язку:</p>
                    <p>Перше рівняння: \(3 \cdot 5 - 2 \cdot (-1) + 4 \cdot 1 = 15 + 2 + 4 = 21\),</p>
                    <p>Друге рівняння: \(3 \cdot 5 + 4 \cdot (-1) - 2 \cdot 1 = 15 - 4 - 2 = 9\),</p>
                    <p>Третє рівняння: \(2 \cdot 5 - (-1) - 1 = 10 + 1 - 1 = 10\).</p>
                    <p class="example-solution">Відповідь: \((5; -1; 1)\).</p>
                    <p><strong><span class="example-title">Зауваження:</span></strong> <em> Якщо в рівняннях системи відсутні певні змінні, наприклад:</em></p>
                    <p class="math-equation center">\[ \begin{cases} 3y + 4z = 21 \\ 3x + 4y = 9 \\ 2x - y - z = 10 \end{cases} \]</p>
                    <p><em> то у відповідних місцях головного визначника потрібно ставити нулі. Наприклад:</em></p>
                    <p class="math-equation center">\[ \Delta = \begin{vmatrix} 0 & 3 & 4 \\ 3 & 4 & 0 \\ 2 & -1 & -1 \end{vmatrix} \]</p>
                    <p>Для систем із чотирма рівняннями метод Крамера застосовується за тим самим принципом, але з визначниками 4-го порядку, що може бути трудомістким для обчислень.</p>
                </div>
            </div>
        </div>
    </div>
    <div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 class="glow-title">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>How to Solve a System of Equations Using Cramer's Rule: Step-by-Step Method</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Метод Крамера</h3>
                </div>
                <div class="video-card" data-video="3">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Метод Крамера розв'язування СЛАР 3×3</h3>
                </div>
            </div>
        </div>
    </div>
    <div id="videoPlayerModal1" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" width="100%" data-src="https://www.youtube.com/embed/UVHweVUrgUM" src="https://www.youtube.com/embed/UVHweVUrgUM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    <div id="videoPlayerModal2" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer2" width="100%" data-src="https://www.youtube.com/embed/zm55sT12X2w" src="https://www.youtube.com/embed/zm55sT12X2w" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    <div id="videoPlayerModal3" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn3">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer3" width="100%" data-src="https://www.youtube.com/embed/4-FW3dXefc8" src="https://www.youtube.com/embed/4-FW3dXefc8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    <div id="questionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="questionsTitle">
        <div class="modal-header">
            <button class="close-btn" aria-label="Закрити питання" id="closeQuestionsBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="flashcard-container">
                <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p>1. Що є головним визначником у методі Крамера?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Головний визначник – це визначник матриці, складеної з коефіцієнтів при невідомих у системі рівнянь.</p>
                        </div>
                    </div>
                </div>
               <div class="flashcard flashcard-2" tabindex="0" role="button" aria-expanded="false">
    <div class="flashcard-inner">
        <div class="flashcard-front">
            <p>2. У чому полягає сутність методу Крамера?</p>
        </div>
        <div class="flashcard-back">
            <p>Метод Крамера полягає у знаходженні розв’язку системи лінійних рівнянь за допомогою визначників: спочатку обчислюється головний визначник системи, а потім – допоміжні визначники, які отримують заміною відповідних стовпців на стовпець вільних членів. Значення змінних визначаються як відношення допоміжних визначників до головного.</p>
        </div>
    </div>
</div>
                <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p>3. В яких випадках застосовуються формули Крамера для розв'язання системи лінійних рівнянь?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Формули Крамера застосовуються тільки тоді, коли головний визначник системи відмінний від нуля (\(\Delta \neq 0\)). У цьому випадку система є сумісною та має єдиний розв’язок.</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p>4. Що відбувається, якщо головний визначник дорівнює нулю?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Якщо \(\Delta = 0\), то система або має безліч розв’язків (є невизначеною), або взагалі не має розв’язків (є несумісною).</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p>5. Як обчислюються значення змінних у методі Крамера?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Кожна змінна обчислюється як відношення відповідного допоміжного визначника до головного: \( x = \frac{\Delta_x}{\Delta}, y = \frac{\Delta_y}{\Delta}, z = \frac{\Delta_z}{\Delta} \).</p>
                        </div>
                    </div>
                </div>
                <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p>6. Чому метод Крамера зручний тільки для невеликих систем рівнянь?</p>
                        </div>
                        <div class="flashcard-back">
                            <p>Тому що для великих систем потрібно обчислювати визначники високих порядків, що є трудомістким і незручним для ручних обчислень.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
   <div id="trainerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити тренажер" id="closeTrainerBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="trainer-container" id="trainerContent">
            <div class="question-circle" id="questionCircle"><span>Питання 1</span></div>
            <div class="trainer-question" id="questionText">Вкажіть вільні члени заданої системи лінійних рівнянь:</div>
            <div id="systemText"></div>
            <div class="trainer-options" id="optionsContainer"></div>
             <div class="system-equations" id="systemEquations" style="display: none;"></div>
           <div class="trainer-input" id="inputContainer" style="display: none;">
    <label for="determinantInput" class="trainer-question">Введіть значення визначника:</label>
    <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="determinantInput" class="answer-input" placeholder="Введіть число" aria-label="Введіть значення визначника">
    <label for="xInput" class="trainer-question" style="display: none;">Введіть значення \(x\):</label>
    <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="xInput" class="answer-input" placeholder="Введіть \(x\)" style="display: none;" aria-label="Введіть значення x">
    <label for="yInput" class="trainer-question" style="display: none;">Введіть значення \(y\):</label>
    <input type="text" inputmode="numeric" pattern="-?[0-9]*" id="yInput" class="answer-input" placeholder="Введіть \(y\)" style="display: none;" aria-label="Введіть значення y">
</div>
            <button class="trainer-submit" id="submitAnswer" aria-label="Перевірити обрану відповідь">Перевірити</button>
            <div class="trainer-feedback result-message" id="feedback"></div>
            <div class="completion-message" id="completionMessage" style="display: none;">
                <div class="completion-emoji"></div>
                <h2>Тренування завершено!</h2>
                <p>Молодець!</p>
                <button id="resetTrainerBtn" aria-label="Спробувати ще раз">Спробувати ще раз</button>
            </div>
        </div>
    </div>
</div>
    <div id="modalOverlay"></div>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    const elements = {
        openTheoryBtn: document.getElementById('openTheoryBtn'),
        openVideoBtn: document.getElementById('openVideoBtn'),
        openQuestionsBtn: document.getElementById('openQuestionsBtn'),
        openTrainerBtn: document.getElementById('openTrainerBtn'),
        theoryModal: document.getElementById('theoryModal'),
        videoModal: document.getElementById('videoModal'),
        questionsModal: document.getElementById('questionsModal'),
        trainerModal: document.getElementById('trainerModal'),
        closeTheoryBtn: document.getElementById('closeTheoryBtn'),
        closeVideoBtn: document.getElementById('closeVideoBtn'),
        closeQuestionsBtn: document.getElementById('closeQuestionsBtn'),
        closeTrainerBtn: document.getElementById('closeTrainerBtn'),
        closeVideoPlayerBtn1: document.getElementById('closeVideoPlayerBtn1'),
        closeVideoPlayerBtn2: document.getElementById('closeVideoPlayerBtn2'),
        closeVideoPlayerBtn3: document.getElementById('closeVideoPlayerBtn3'),
        videoPlayerModal1: document.getElementById('videoPlayerModal1'),
        videoPlayerModal2: document.getElementById('videoPlayerModal2'),
        videoPlayerModal3: document.getElementById('videoPlayerModal3'),
        modalOverlay: document.getElementById('modalOverlay'),
        questionCircle: document.getElementById('questionCircle'),
        questionText: document.getElementById('questionText'),
        systemText: document.getElementById('systemText'),
        optionsContainer: document.getElementById('optionsContainer'),
        inputContainer: document.getElementById('inputContainer'),
        determinantInput: document.getElementById('determinantInput'),
        systemEquations: document.getElementById('systemEquations'),
    xInput: document.getElementById('xInput'),
    yInput: document.getElementById('yInput'),
        submitAnswer: document.getElementById('submitAnswer'),
        feedback: document.getElementById('feedback'),
        completionMessage: document.getElementById('completionMessage'),
        resetTrainerBtn: document.getElementById('resetTrainerBtn'),
        youtubePlayer1: document.getElementById('youtubePlayer1'),
        youtubePlayer2: document.getElementById('youtubePlayer2'),
        youtubePlayer3: document.getElementById('youtubePlayer3'),
        trainerContainer: document.getElementById('trainerContent')
    };

    // Логіка для вкладок теорії
    const tabButtons = elements.theoryModal?.querySelectorAll('.tab-button');
    const tabContents = elements.theoryModal?.querySelectorAll('.tab-content');

    function closeAllTabs() {
        tabButtons?.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-expanded', 'false');
        });
        tabContents?.forEach(content => {
            content.classList.remove('active');
        });
    }

    function toggleTab(tabId, button) {
        const targetContent = elements.theoryModal?.querySelector(`#${tabId}`);
        if (!targetContent) return;

        const isActive = button.classList.contains('active');
        closeAllTabs();

        if (!isActive) {
            button.classList.add('active');
            button.setAttribute('aria-expanded', 'true');
            targetContent.classList.add('active');
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([targetContent]).then(() => {
                    elements.theoryModal.querySelector('.modal-content').scrollTop = 0;
                });
            }
        }
    }

    tabButtons?.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            toggleTab(tabId, button);
        });
    });

    closeAllTabs();

    // Логіка для YouTube-відео
    let players = {};
    const playerIds = {
        'youtubePlayer1': 'UVHweVUrgUM',
        'youtubePlayer2': 'zm55sT12X2w',
        'youtubePlayer3': '4-FW3dXefc8'
    };

    const playerSrcs = {
        'youtubePlayer1': elements.youtubePlayer1?.getAttribute('data-src') || '',
        'youtubePlayer2': elements.youtubePlayer2?.getAttribute('data-src') || '',
        'youtubePlayer3': elements.youtubePlayer3?.getAttribute('data-src') || ''
    };

    function loadYouTubeAPI() {
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
    }

    window.onYouTubeIframeAPIReady = function() {
        Object.keys(playerIds).forEach(playerId => {
            const element = elements[playerId];
            if (element) {
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => {
                            event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
                        }
                    }
                });
            }
        });
    };

    loadYouTubeAPI();

    function stopAllVideos() {
        Object.keys(players).forEach(playerId => {
            const player = players[playerId];
            const element = elements[playerId];
            if (player && typeof player.stopVideo === 'function') {
                player.stopVideo();
            }
            if (element) {
                element.src = '';
                const parent = element.parentNode;
                const newIframe = document.createElement('iframe');
                newIframe.id = playerId;
                newIframe.setAttribute('data-src', playerSrcs[playerId]);
                newIframe.setAttribute('frameborder', '0');
                newIframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
                newIframe.setAttribute('allowfullscreen', '');
                parent.replaceChild(newIframe, element);
                elements[playerId] = newIframe;
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 })
                    }
                });
            }
        });
    }

    function openVideoPlayerModal(videoModal, playerId) {
        stopAllVideos();
        toggleModal(elements.videoModal, false);
        toggleModal(videoModal, true);
        const element = elements[playerId];
        if (element && !element.src) {
            element.src = playerSrcs[playerId];
        }
        if (players[playerId] && typeof players[playerId].loadVideoById === 'function') {
            players[playerId].loadVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
        }
    }

    function toggleModal(modal, show) {
        if (!modal) return;
        const allModals = [
            elements.theoryModal,
            elements.videoModal,
            elements.questionsModal,
            elements.trainerModal,
            elements.videoPlayerModal1,
            elements.videoPlayerModal2,
            elements.videoPlayerModal3
        ].filter(Boolean);
        allModals.forEach(m => {
            if (m && m !== modal) m.style.display = 'none';
        });
        modal.style.display = show ? 'flex' : 'none';
        elements.modalOverlay.style.display = show ? 'block' : 'none';
        document.body.style.overflow = show ? 'hidden' : 'auto';
        if (show) {
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) closeBtn.focus();
            if (modal === elements.trainerModal) resetTrainer();
        }
    }

    elements.openTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, true));
    elements.openVideoBtn?.addEventListener('click', () => toggleModal(elements.videoModal, true));
    elements.openQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, true));
    elements.openTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, true));
    elements.closeTheoryBtn?.addEventListener('click', () => toggleModal(elements.theoryModal, false));
    elements.closeVideoBtn?.addEventListener('click', () => toggleModal(elements.videoModal, false));
    elements.closeQuestionsBtn?.addEventListener('click', () => toggleModal(elements.questionsModal, false));
    elements.closeTrainerBtn?.addEventListener('click', () => toggleModal(elements.trainerModal, false));
    elements.closeVideoPlayerBtn1?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoModal, true);
    });
    elements.closeVideoPlayerBtn2?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal2, false);
        toggleModal(elements.videoModal, true);
    });
    elements.closeVideoPlayerBtn3?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.videoPlayerModal3, false);
        toggleModal(elements.videoModal, true);
    });
    elements.modalOverlay?.addEventListener('click', () => {
        stopAllVideos();
        toggleModal(elements.theoryModal, false);
        toggleModal(elements.videoModal, false);
        toggleModal(elements.questionsModal, false);
        toggleModal(elements.trainerModal, false);
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoPlayerModal2, false);
        toggleModal(elements.videoPlayerModal3, false);
    });
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            stopAllVideos();
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.videoModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
            toggleModal(elements.videoPlayerModal1, false);
            toggleModal(elements.videoPlayerModal2, false);
            toggleModal(elements.videoPlayerModal3, false);
        }
    });

    document.querySelectorAll('.flashcard').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('flipped');
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([card]);
            }
        });
        card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.classList.toggle('flipped');
                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([card]);
                }
            }
        });
    });

    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoNumber = card.getAttribute('data-video');
            const videoModal = elements[`videoPlayerModal${videoNumber}`];
            const playerId = `youtubePlayer${videoNumber}`;
            if (videoModal && playerId) openVideoPlayerModal(videoModal, playerId);
        });
    });

    // Логіка тренажера
    let currentQuestion = 1;
    let selectedOption = null;
    let currentSystem = null;
    let correctAnswer = null;

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Генерація системи 3x3 (виправлено Δ_z)
function generateSystem3x3() {
    let coefficients, constants, det, x, y, z, isCoprime;
    do {
        x = getRandomInt(-3, 3);
        y = getRandomInt(-3, 3);
        z = getRandomInt(-3, 3);
        coefficients = Array(3).fill().map(() => Array(3).fill(0));
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                coefficients[i][j] = getRandomInt(-5, 5);
                while (coefficients[i][j] === 0) {
                    coefficients[i][j] = getRandomInt(-5, 5);
                }
            }
        }
        constants = [
            coefficients[0][0] * x + coefficients[0][1] * y + coefficients[0][2] * z,
            coefficients[1][0] * x + coefficients[1][1] * y + coefficients[1][2] * z,
            coefficients[2][0] * x + coefficients[2][1] * y + coefficients[2][2] * z
        ];
        const equation1 = [coefficients[0][0], coefficients[0][1], coefficients[0][2], constants[0]];
        const equation2 = [coefficients[1][0], coefficients[1][1], coefficients[1][2], constants[1]];
        const equation3 = [coefficients[2][0], coefficients[2][1], coefficients[2][2], constants[2]];
        isCoprime = gcdArray(equation1) === 1 && gcdArray(equation2) === 1 && gcdArray(equation3) === 1;
        const [a1, a2, a3] = coefficients;
        det = a1[0] * (a2[1] * a3[2] - a2[2] * a3[1]) -
              a1[1] * (a2[0] * a3[2] - a2[2] * a3[0]) +
              a1[2] * (a2[0] * a3[1] - a2[1] * a3[0]);
    } while (det === 0 || !isCoprime || constants[0] === 0 || constants[1] === 0 || constants[2] === 0);

    const [b1, b2, b3] = constants;
    // Δ_x: заміна першого стовпця на [b1, b2, b3]
    const delta_x = b1 * (coefficients[1][1] * coefficients[2][2] - coefficients[1][2] * coefficients[2][1]) -
                    coefficients[0][1] * (b2 * coefficients[2][2] - b3 * coefficients[1][2]) +
                    coefficients[0][2] * (b2 * coefficients[2][1] - b3 * coefficients[1][1]);
    // Δ_y: заміна другого стовпця на [b1, b2, b3]
    const delta_y = coefficients[0][0] * (b2 * coefficients[2][2] - b3 * coefficients[1][2]) -
                    b1 * (coefficients[1][0] * coefficients[2][2] - coefficients[1][2] * coefficients[2][0]) +
                    coefficients[0][2] * (coefficients[1][0] * b3 - b2 * coefficients[2][0]);
    // Δ_z: заміна третього стовпця на [b1, b2, b3]
    const delta_z =
    coefficients[0][0] * (coefficients[1][1] * b3 - b2 * coefficients[2][1]) -
    coefficients[0][1] * (coefficients[1][0] * b3 - b2 * coefficients[2][0]) +
    b1 * (coefficients[1][0] * coefficients[2][1] - coefficients[1][1] * coefficients[2][0]);

    // Перевірка коренів
    const computed_x = delta_x / det;
    const computed_y = delta_y / det;
    const computed_z = delta_z / det;

    if (Math.abs(computed_x - x) > 0.01 || Math.abs(computed_y - y) > 0.01 || Math.abs(computed_z - z) > 0.01) {
        console.error('Помилка: обчислені корені не відповідають згенерованим', { x, y, z, computed_x, computed_y, computed_z });
    }

    return {
        coefficients,
        constants,
        determinants: { delta: det, delta_x, delta_y, delta_z },
        roots: { x: computed_x, y: computed_y, z: computed_z }
    };
}


// Допоміжна функція для НДЧ
function gcd(a, b) {
    return b === 0 ? Math.abs(a) : gcd(b, a % b);
}

function gcdArray(arr) {
    return arr.reduce((a, b) => gcd(a, Math.abs(b)), Math.abs(arr[0]));
}

function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Генерація системи 2x2 з цілими коренями від -3 до 3
function generateSystem2x2() {
    let coefficients, constants, det, x, y, isCoprime;
    do {
        x = getRandomInt(-3, 3);
        y = getRandomInt(-3, 3);
        coefficients = Array(2).fill().map(() => Array(2).fill(0));
        for (let i = 0; i < 2; i++) {
            for (let j = 0; j < 2; j++) {
                coefficients[i][j] = getRandomInt(-5, 5);
                while (coefficients[i][j] === 0) {
                    coefficients[i][j] = getRandomInt(-5, 5);
                }
            }
        }
        constants = [
            coefficients[0][0] * x + coefficients[0][1] * y,
            coefficients[1][0] * x + coefficients[1][1] * y
        ];
        const equation1 = [coefficients[0][0], coefficients[0][1], constants[0]];
        const equation2 = [coefficients[1][0], coefficients[1][1], constants[1]];
        isCoprime = gcdArray(equation1) === 1 && gcdArray(equation2) === 1;
        det = coefficients[0][0] * coefficients[1][1] - coefficients[0][1] * coefficients[1][0];
    } while (det === 0 || !isCoprime || constants[0] === 0 || constants[1] === 0);

    const delta_x = constants[0] * coefficients[1][1] - constants[1] * coefficients[0][1];
    const delta_y = coefficients[0][0] * constants[1] - coefficients[1][0] * constants[0];

    return {
        coefficients,
        constants,
        determinants: { delta: det, delta_x, delta_y },
        roots: { x, y }
    };
}

// Виправлена функція форматування рівнянь
function formatEquation(a, b, c, d = null) {
    let parts = [];
    if (a !== 0) {
        parts.push(a === 1 ? 'x' : a === -1 ? '-x' : `${a}x`);
    }
    if (b !== 0) {
        let yPart = b === 1 ? 'y' : b === -1 ? '-y' : `${b}y`;
        if (parts.length > 0) {
            yPart = b > 0 ? ` + ${yPart}` : ` - ${Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y'}`;
        }
        parts.push(yPart);
    }
    if (d !== null && c !== 0) {
        let zPart = c === 1 ? 'z' : c === -1 ? '-z' : `${c}z`;
        if (parts.length > 0) {
            zPart = c > 0 ? ` + ${zPart}` : ` - ${Math.abs(c) === 1 ? 'z' : Math.abs(c) + 'z'}`;
        }
        parts.push(zPart);
    }
    if (parts.length === 0) parts.push('0');
    return `${parts.join('')} = ${d !== null ? d : c}`;
}

        
     function systemToLatex(system, withInputs = false) {
        const size = system.coefficients.length;
        let latex = '\\begin{cases} ';
        let plainText = '';
        for (let i = 0; i < size; i++) {
            let equation = '';
            let plainEquation = '';
            let isFirstTerm = true;
            for (let j = 0; j < size; j++) {
                let coef = system.coefficients[i][j];
                let varName = ['x', 'y', 'z'][j];
                if (coef !== 0) {
                    let sign = isFirstTerm ? (coef < 0 ? '-' : '') : (coef > 0 ? '+' : '-');
                    if (Math.abs(coef) === 1) {
                        equation += `${sign}${varName}`;
                        plainEquation += `${sign}${varName}`;
                    } else {
                        equation += `${sign}${Math.abs(coef)}${varName}`;
                        plainEquation += `${sign}${Math.abs(coef)}${varName}`;
                    }
                    isFirstTerm = false;
                }
            }
            if (withInputs) {
                equation += ` = \\text{ } \\input{input_b${i}}`;
                plainEquation += ` = `;
            } else {
                equation += ` = ${system.constants[i]}`;
                plainEquation += ` = ${system.constants[i]}`;
            }
            latex += equation.replace(/^\+/, '');
            plainText += plainEquation.replace(/^\+/, '') + '\n';
            if (i < size - 1) latex += ' \\\\ ';
        }
        latex += ' \\end{cases}';
        elements.systemText.dataset.plainText = plainText;
        return latex;
    }

    function matrixToLatex(matrix) {
        if (matrix.length === 2) {
            return `\\begin{vmatrix} ${matrix[0][0]} & ${matrix[0][1]} \\\\ ${matrix[1][0]} & ${matrix[1][1]} \\end{vmatrix}`;
        } else {
            return `\\begin{vmatrix} ${matrix[0][0]} & ${matrix[0][1]} & ${matrix[0][2]} \\\\ ${matrix[1][0]} & ${matrix[1][1]} & ${matrix[1][2]} \\\\ ${matrix[2][0]} & ${matrix[2][1]} & ${matrix[2][2]} \\end{vmatrix}`;
        }
    }

    function generateQuestion1() {
        currentSystem = generateSystem3x3();
        const correctAnswer = `(${currentSystem.constants.join(', ')})`;
        const wrongAnswers = [
            `(${currentSystem.coefficients.map(row => row[0]).join(', ')})`,
            `(${currentSystem.coefficients.map(row => row[1]).join(', ')})`,
            `(${currentSystem.coefficients.map(row => row[2]).join(', ')})`
        ];
        const options = [
            { text: correctAnswer, isCorrect: true, comment: '✓ Правильно! Молодець!' },
            { text: wrongAnswers[0], isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' },
            { text: wrongAnswers[1], isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' },
            { text: wrongAnswers[2], isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' }
        ];
        return shuffleArray(options);
    }

   function generateQuestion2() {
    currentSystem = generateSystem2x2();
    const [a1, a2] = currentSystem.coefficients;
    const [b1, b2] = currentSystem.constants;

    // Правильні визначники
    const delta = `\\Delta = ${matrixToLatex([[a1[0], a1[1]], [a2[0], a2[1]]])}`;
    const deltaX = `\\Delta_x = ${matrixToLatex([[b1, a1[1]], [b2, a2[1]]])}`;
    const deltaY = `\\Delta_y = ${matrixToLatex([[a1[0], b1], [a2[0], b2]])}`;
    const correctAnswer = `\\begin{aligned} &${delta}, \\\\ &${deltaX}, \\quad ${deltaY} \\end{aligned}`;
    // Неправильні відповіді з позначеннями Δ, Δ_x, Δ_y
    const wrongAnswer1 = `\\begin{aligned} &\\Delta = ${matrixToLatex([[a1[0], a1[1]], [a2[0], a2[1]]])}, \\\\ &\\Delta_x = ${matrixToLatex([[b1, a1[0]],[b2, a2[0]]])},
       \\quad \\Delta_y = ${matrixToLatex([[a1[1], b1], [a2[1], b2]])} \\end{aligned}`; // Помилка: Δ_x, Δ_y з неправильними стовпцями
    const wrongAnswer2 = `\\begin{aligned} &\\Delta = ${matrixToLatex([[a1[1], a1[0]], [a2[1], a2[0]]])}, \\\\ &\\Delta_x = ${matrixToLatex([[b1, a1[1]], [b2, a2[1]]])},
        \\quad \\Delta_y = ${matrixToLatex([[a1[0], b1], [a2[0], b2]])} \\end{aligned}`; // Помилка: Δ з переставленими стовпцями
    const wrongAnswer3 = `\\begin{aligned} &\\Delta = ${matrixToLatex([[a1[0], a1[1]], [a2[0], a2[1]]])}, \\\\ &\\Delta_x = ${matrixToLatex([[-b1, a1[1]], [-b2, a2[1]]])},
        \\quad \\Delta_y = ${matrixToLatex([[a1[0], -b1], [a2[0], -b2]])} \\end{aligned}`; // Помилка: Δ_x, Δ_y з протилежними знаками

    const options = [
        { text: correctAnswer, isCorrect: true, comment: '✓ Правильно! Молодець!' },
        { text: wrongAnswer1, isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' },
        { text: wrongAnswer2, isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' },
        { text: wrongAnswer3, isCorrect: false, comment: '✗ Неправильно, спробуй ще раз!' }
    ];
    return shuffleArray(options);
}

   function generateQuestion3() {
    currentSystem = generateSystem3x3();
    const [a1, a2, a3] = currentSystem.coefficients;
    const [b1, b2, b3] = currentSystem.constants;

    const determinantTypes = ['\\Delta', '\\Delta_x', '\\Delta_y', '\\Delta_z'];
    const selectedType = determinantTypes[Math.floor(Math.random() * determinantTypes.length)];

    let correctValue;
    let matrix;
    if (selectedType === '\\Delta') {
        matrix = [a1, a2, a3];
        correctValue = a1[0] * (a2[1] * a3[2] - a2[2] * a3[1]) -
                       a1[1] * (a2[0] * a3[2] - a2[2] * a3[0]) +
                       a1[2] * (a2[0] * a3[1] - a2[1] * a3[0]);
    } else if (selectedType === '\\Delta_x') {
        matrix = [[b1, a1[1], a1[2]], [b2, a2[1], a2[2]], [b3, a3[1], a3[2]]];
        correctValue = b1 * (a2[1] * a3[2] - a2[2] * a3[1]) -
                       a1[1] * (b2 * a3[2] - a2[2] * b3) +
                       a1[2] * (b2 * a3[1] - a2[1] * b3);
    } else if (selectedType === '\\Delta_y') {
        matrix = [[a1[0], b1, a1[2]], [a2[0], b2, a2[2]], [a3[0], b3, a3[2]]];
        correctValue = a1[0] * (b2 * a3[2] - a2[2] * b3) -
                       b1 * (a2[0] * a3[2] - a2[2] * a3[0]) +
                       a1[2] * (a2[0] * b3 - b2 * a3[0]);
     } else {
            matrix = [[a1[0], a1[1], b1], [a2[0], a2[1], b2], [a3[0], a3[1], b3]];
            correctValue = a1[0] * (a2[1] * b3 - b2 * a3[1]) -
                           a1[1] * (a2[0] * b3 - b2 * a3[0]) +
                           b1 * (a2[0] * a3[1] - a2[1] * a3[0]);
        }

    console.log('generateQuestion3: selectedType:', selectedType, 'correctValue:', correctValue, 'matrix:', matrix);
    return {
        question: `Знайдіть ${selectedType === '\\Delta' ? 'головний визначник' : 'допоміжний визначник'} системи \\(${selectedType}\\)`,
        correctAnswer: correctValue,
        matrix: matrix
    };
}
                
    // Генерація питання 4
function generateQuestion4() {
    currentSystem = generateSystem2x2();
    if (!currentSystem || !currentSystem.coefficients || !currentSystem.constants || !currentSystem.determinants || !currentSystem.roots) {
        console.error('Помилка: generateSystem2x2 повернув некоректну систему', currentSystem);
        return null;
    }
    const { coefficients, constants, determinants, roots } = currentSystem;
    const [a1, a2] = coefficients;

    const useDeltaX = Math.random() < 0.5;
    const auxDeterminant = useDeltaX ? 'delta_x' : 'delta_y';
    const auxValue = useDeltaX ? determinants.delta_x : determinants.delta_y;
    const solutionVar = useDeltaX ? 'x' : 'y';
    const solutionValue = useDeltaX ? roots.x : roots.y;

    const systemLatex = `\\begin{cases} ${formatEquation(a1[0], a1[1], constants[0])} \\\\ ${formatEquation(a2[0], a2[1], constants[1])} \\end{cases}`;

    return {
        question: 'Розв’яжіть систему рівнянь методом Крамера:',
        systemLatex,
        correctAnswers: {
            delta: determinants.delta,
            [auxDeterminant]: auxValue,
            [solutionVar]: solutionValue
        },
        auxDeterminant,
        solutionVar
    };
}

// Генерація питання 5
function generateQuestion5() {
    currentSystem = generateSystem3x3();
    if (!currentSystem || !currentSystem.coefficients || !currentSystem.constants || !currentSystem.determinants || !currentSystem.roots) {
        console.error('Помилка: generateSystem3x3 повернув некоректну систему', currentSystem);
        return null;
    }
    const { coefficients, constants, determinants, roots } = currentSystem;
    const [a1, a2, a3] = coefficients;

    const determinantOptions = ['delta_x', 'delta_y', 'delta_z'];
    const selectedDet = determinantOptions[Math.floor(Math.random() * 3)];
    const solutionVar = selectedDet === 'delta_x' ? 'x' : selectedDet === 'delta_y' ? 'y' : 'z';
    const auxValue = determinants[selectedDet];
    const solutionValue = roots[solutionVar];

    const systemLatex = `\\begin{cases} ${formatEquation(a1[0], a1[1], a1[2], constants[0])} \\\\ ${formatEquation(a2[0], a2[1], a2[2], constants[1])} \\\\ ${formatEquation(a3[0], a3[1], a3[2], constants[2])} \\end{cases}`;

    return {
        question: 'Знайдіть один із коренів системи рівнянь методом Крамера:',
        systemLatex,
        correctAnswers: {
            delta: determinants.delta,
            [selectedDet]: auxValue,
            [solutionVar]: solutionValue
        },
        auxDeterminant: selectedDet,
        solutionVar
    };
}
   
function parseFraction(input) {
    if (!input || typeof input !== 'string') return NaN;
    input = input.trim();
    if (/^-?\d*\.?\d*$/.test(input)) {
        return parseFloat(input);
    }
    const fractionMatch = input.match(/^(-?\d+)\/(\d+)$/);
    if (fractionMatch) {
        const numerator = parseInt(fractionMatch[1], 10);
        const denominator = parseInt(fractionMatch[2], 10);
        if (denominator === 0) return NaN;
        return numerator / denominator;
    }
    return NaN;
}

// Оновлення resetTrainer для п’яти питань
function resetTrainer() {
    console.log('resetTrainer викликано');
    currentQuestion = 1;
    currentSystem = null;
    selectedOption = null;
    correctAnswer = null;
    elements.questionCircle.style.display = 'block';
    elements.questionText.style.display = 'block';
    elements.systemText.style.display = 'block';
    elements.optionsContainer.style.display = 'grid';
    elements.inputContainer.style.display = 'none';
    elements.systemEquations.style.display = 'none';
    elements.submitAnswer.style.display = 'block';
    elements.completionMessage.style.display = 'none';
    elements.trainerContainer.scrollTop = 0;
    displayQuestion();
}

// Оновлена функція displayQuestion
function displayQuestion() {
    console.log('displayQuestion викликано, currentQuestion:', currentQuestion);

    if (!elements.questionCircle || !elements.questionText || !elements.systemText ||
        !elements.optionsContainer || !elements.inputContainer || !elements.systemEquations ||
        !elements.determinantInput || !elements.submitAnswer || !elements.feedback ||
        !elements.completionMessage || !elements.trainerContainer || !elements.resetTrainerBtn) {
        console.error('Один або кілька елементів тренажера відсутні в DOM');
        elements.questionText.textContent = 'Помилка: елементи інтерфейсу не знайдено';
        return;
    }

    selectedOption = null;
    correctAnswer = null;
    elements.optionsContainer.innerHTML = '';
    elements.inputContainer.style.display = 'none';
    elements.systemEquations.innerHTML = '';
    elements.systemEquations.style.display = 'none';
    elements.systemText.innerHTML = '';
    elements.determinantInput.value = '';
    elements.submitAnswer.disabled = true;
    elements.feedback.style.opacity = '0';
    elements.feedback.style.display = 'none';
    elements.completionMessage.style.display = 'none';
    elements.optionsContainer.classList.remove('question-1', 'question-2', 'question-3', 'question-4', 'question-5');
    elements.questionCircle.innerHTML = `<span>Питання ${currentQuestion}</span>`;
    elements.questionCircle.style.width = 'clamp(100px, 16vw, 130px)';
    elements.questionCircle.style.height = 'clamp(100px, 16vw, 130px)';

    let options;
    if (currentQuestion === 1) {
        elements.questionText.textContent = 'Вкажіть вільні члени заданої системи лінійних рівнянь:';
        options = generateQuestion1();
        if (!options) {
            console.error('Помилка: generateQuestion1 не повернув даних');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 1');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${systemToLatex(currentSystem)}\\]`;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-1');
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
    } else if (currentQuestion === 2) {
        elements.questionText.innerHTML = 'Вкажіть правильні визначники \\(\\Delta\\), \\(\\Delta_x\\), \\(\\Delta_y\\) для розв’язання системи за методом Крамера:';
        options = generateQuestion2();
        if (!options) {
            console.error('Помилка: generateQuestion2 не повернув даних');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 2');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${systemToLatex(currentSystem)}\\]`;
        elements.optionsContainer.style.display = 'grid';
        elements.inputContainer.style.display = 'none';
        elements.systemEquations.style.display = 'none';
        elements.optionsContainer.classList.add('question-2');
        options.forEach((opt, index) => {
            const option = document.createElement('div');
            option.className = 'trainer-option';
            option.innerHTML = `\\[${opt.text}\\]`;
            option.setAttribute('data-index', index);
            option.addEventListener('click', () => {
                document.querySelectorAll('.trainer-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedOption = opt;
                elements.submitAnswer.disabled = false;
            });
            elements.optionsContainer.appendChild(option);
        });
    } else if (currentQuestion === 3) {
        const q3 = generateQuestion3();
        if (!q3 || !q3.correctAnswer) {
            console.error('Помилка: generateQuestion3 не повернув даних або correctAnswer');
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q3.question;
        if (!currentSystem) {
            console.error('Помилка: currentSystem не визначено для питання 3');
            elements.systemText.textContent = 'Помилка генерації системи';
            return;
        }
        elements.systemText.innerHTML = `\\[${systemToLatex(currentSystem)}\\]`;
        correctAnswer = q3.correctAnswer;
        elements.optionsContainer.style.display = 'none';
        elements.inputContainer.style.display = 'flex';
        elements.systemEquations.style.display = 'none';
        elements.determinantInput.style.display = 'block';
        elements.determinantInput.value = '';
        document.querySelector('label[for="determinantInput"]').style.display = 'block';
        elements.determinantInput.focus();
        elements.optionsContainer.classList.add('question-3');
        elements.determinantInput.addEventListener('input', () => {
            elements.submitAnswer.disabled = elements.determinantInput.value.trim() === '';
        });
     } else if (currentQuestion === 4) {
        const q4 = generateQuestion4();
        if (!q4 || !q4.correctAnswers || !q4.systemLatex) {
            console.error('Помилка: generateQuestion4 не повернув даних або неправильна структура', q4);
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q4.question;
        elements.systemText.innerHTML = '';
        elements.systemText.style.display = 'none';
        elements.systemEquations.style.display = 'block';
        elements.optionsContainer.style.display = 'none';
        elements.inputContainer.style.display = 'none';
        elements.optionsContainer.classList.add('question-4');

        const systemHtml = `
            <div class="system-equation">
                \\[${q4.systemLatex}\\]
            </div>
            <div class="trainer-inputs">
                <div class="trainer-input">
                    <label for="deltaInput">1) Головний визначник системи:</label>
                    <input type="text" inputmode="text" id="deltaInput" class="answer-input" placeholder="Введіть Δ" aria-label="Введіть значення Δ">
                </div>
                <div class="trainer-input">
                    <label for="${q4.auxDeterminant}Input">2) Допоміжний визначник:</label>
                    <input type="text" inputmode="text" id="${q4.auxDeterminant}Input" class="answer-input" placeholder="Введіть ${q4.auxDeterminant === 'delta_x' ? 'Δ_x' : 'Δ_y'}" aria-label="Введіть значення ${q4.auxDeterminant === 'delta_x' ? 'Δ_x' : 'Δ_y'}">
                </div>
                <div class="trainer-input">
                    <label for="${q4.solutionVar}Input">3) Один із розв’язків системи:</label>
                    <input type="text" inputmode="text" id="${q4.solutionVar}Input" class="answer-input" placeholder="Введіть ${q4.solutionVar}" aria-label="Введіть значення ${q4.solutionVar}">
                </div>
            </div>
        `;
        elements.systemEquations.innerHTML = systemHtml;
        correctAnswer = q4.correctAnswers;

        const inputs = [
            document.getElementById('deltaInput'),
            document.getElementById(`${q4.auxDeterminant}Input`),
            document.getElementById(`${q4.solutionVar}Input`)
        ];
        if (inputs.some(input => !input)) {
            console.error('Одне або кілька полів вводу для питання 4 відсутні в DOM', inputs);
            elements.systemEquations.innerHTML = '<p style="color: red;">Помилка: не вдалося знайти поля вводу</p>';
            return;
        }

        inputs.forEach(input => {
            input.value = '';
            input.addEventListener('input', () => {
                const allFilled = inputs.every(inp => inp && inp.value.trim() !== '');
                elements.submitAnswer.disabled = !allFilled;
            });
        });

        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([elements.questionText, elements.systemEquations]).then(() => {
                console.log('MathJax завершив рендеринг для питання 4');
                document.getElementById('deltaInput')?.focus();
            }).catch(err => {
                console.error('Помилка MathJax:', err);
                elements.systemEquations.innerHTML = '<p style="color: red;">Помилка відображення системи рівнянь</p>';
            });
        } else {
            console.warn('MathJax не доступний');
            elements.systemEquations.innerHTML = '<p style="color: red;">Помилка: MathJax не завантажено</p>';
        }
    } else if (currentQuestion === 5) {
        const q5 = generateQuestion5();
        if (!q5 || !q5.correctAnswers || !q5.systemLatex) {
            console.error('Помилка: generateQuestion5 не повернув даних або неправильна структура', q5);
            elements.questionText.textContent = 'Помилка генерації питання';
            return;
        }
        elements.questionText.innerHTML = q5.question;
        elements.systemText.innerHTML = '';
        elements.systemText.style.display = 'none';
        elements.systemEquations.style.display = 'block';
        elements.optionsContainer.style.display = 'none';
        elements.inputContainer.style.display = 'none';
        elements.optionsContainer.classList.add('question-5');

        const systemHtml = `
            <div class="system-equation">
                \\[${q5.systemLatex}\\]
            </div>
            <div class="trainer-inputs">
                <div class="trainer-input">
                    <label for="deltaInput">1) Головний визначник системи:</label>
                    <input type="text" inputmode="text" id="deltaInput" class="answer-input" placeholder="Введіть Δ" aria-label="Введіть значення Δ">
                </div>
                <div class="trainer-input">
                    <label for="${q5.auxDeterminant}Input">2) Допоміжний визначник:</label>
                    <input type="text" inputmode="text" id="${q5.auxDeterminant}Input" class="answer-input" placeholder="Введіть ${q5.auxDeterminant === 'delta_x' ? 'Δ_x' : q5.auxDeterminant === 'delta_y' ? 'Δ_y' : 'Δ_z'}" aria-label="Введіть значення ${q5.auxDeterminant === 'delta_x' ? 'Δ_x' : q5.auxDeterminant === 'delta_y' ? 'Δ_y' : 'Δ_z'}">
                </div>
                <div class="trainer-input">
                    <label for="${q5.solutionVar}Input">3) Один із розв’язків системи:</label>
                    <input type="text" inputmode="text" id="${q5.solutionVar}Input" class="answer-input" placeholder="Введіть ${q5.solutionVar}" aria-label="Введіть значення ${q5.solutionVar}">
                </div>
            </div>
        `;
        elements.systemEquations.innerHTML = systemHtml;
        correctAnswer = q5.correctAnswers;

        const inputs = [
            document.getElementById('deltaInput'),
            document.getElementById(`${q5.auxDeterminant}Input`),
            document.getElementById(`${q5.solutionVar}Input`)
        ];
        if (inputs.some(input => !input)) {
            console.error('Одне або кілька полів вводу для питання 5 відсутні в DOM', inputs);
            elements.systemEquations.innerHTML = '<p style="color: red;">Помилка: не вдалося знайти поля вводу</p>';
            return;
        }

        inputs.forEach(input => {
            input.value = '';
            input.addEventListener('input', () => {
                const allFilled = inputs.every(inp => inp && inp.value.trim() !== '');
                elements.submitAnswer.disabled = !allFilled;
            });
        });

        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([elements.questionText, elements.systemEquations]).then(() => {
                console.log('MathJax завершив рендеринг для питання 5');
                document.getElementById('deltaInput')?.focus();
            }).catch(err => {
                console.error('Помилка MathJax:', err);
                elements.systemEquations.innerHTML = '<p style="color: red;">Помилка відображення системи рівнянь</p>';
            });
        } else {
            console.warn('MathJax не доступний');
            elements.systemEquations.innerHTML = '<p style="color: red;">Помилка: MathJax не завантажено</p>';
        }
    }

    if (currentQuestion < 4 && window.MathJax && MathJax.typesetPromise) {
        console.log('MathJax обробляє systemText, optionsContainer, questionText');
        MathJax.typesetPromise([elements.systemText, elements.optionsContainer, elements.questionText]).then(() => {
            console.log('MathJax успішно обробив елементи');
            if (currentQuestion < 3) {
                elements.optionsContainer.querySelector('.trainer-option')?.focus();
            } else if (currentQuestion === 3) {
                elements.determinantInput?.focus();
            }
        }).catch(err => {
            console.error('Помилка MathJax у displayQuestion:', err);
            elements.systemText.textContent = 'Помилка відображення системи';
        });
    } else if (currentQuestion < 4 && (!window.MathJax || !MathJax.typesetPromise)) {
        console.warn('MathJax не доступний');
        elements.systemText.textContent = 'Помилка: MathJax не завантажено';
    }

    elements.submitAnswer.style.display = 'block';
}

// Обробник для кнопки "Відповісти"
elements.submitAnswer?.addEventListener('click', () => {
    console.log('submitAnswer клікнуто, currentQuestion:', currentQuestion, 'selectedOption:', selectedOption, 'correctAnswer:', correctAnswer);

    if (currentQuestion === 4 || currentQuestion === 5) {
        const isQuestion4 = currentQuestion === 4;
        const useDeltaX = document.getElementById('delta_xInput') !== null;
        const useDeltaY = document.getElementById('delta_yInput') !== null;
        const solutionVar = useDeltaX ? 'x' : useDeltaY ? 'y' : 'z';
        const auxDeterminant = useDeltaX ? 'delta_x' : useDeltaY ? 'delta_y' : 'delta_z';
        const inputIds = ['deltaInput', `${auxDeterminant}Input`, `${solutionVar}Input`];

        const inputs = inputIds.map(id => document.getElementById(id));
        if (inputs.some(input => !input || input.value.trim() === '')) {
            console.log(`Повернення: питання ${currentQuestion}, не всі поля заповнені`);
            elements.feedback.textContent = '✗ Будь ласка, заповніть усі поля!';
            elements.feedback.className = 'trainer-feedback result-message wrong';
            elements.feedback.style.display = 'block';
            elements.feedback.style.opacity = '1';
            setTimeout(() => {
                elements.feedback.style.opacity = '0';
                setTimeout(() => {
                    elements.feedback.style.display = 'none';
                    elements.feedback.className = 'trainer-feedback result-message';
                }, 300);
            }, 2000);
            return;
        }

 // Отримуємо відповіді користувача
       const userAnswers = {
            delta: parseFloat(document.getElementById('deltaInput')?.value),
            [auxDeterminant]: parseFloat(document.getElementById(`${auxDeterminant}Input`)?.value),
            [solutionVar]: parseFraction(document.getElementById(`${solutionVar}Input`)?.value)
        };
        console.log('submitAnswer: userAnswers:', userAnswers, 'correctAnswer:', correctAnswer);

        if (Object.values(userAnswers).some(val => isNaN(val))) {
            elements.feedback.textContent = '✗ Будь ласка, введіть числові значення або дроби (наприклад, 2/7)!';
            elements.feedback.className = 'trainer-feedback result-message wrong';
            elements.feedback.style.display = 'block';
            elements.feedback.style.opacity = '1';
            setTimeout(() => {
                elements.feedback.style.opacity = '0';
                setTimeout(() => {
                    elements.feedback.style.display = 'none';
                    elements.feedback.className = 'trainer-feedback result-message';
                }, 300);
            }, 2000);
            return;
        }

        const isCorrect = (
            Math.abs(userAnswers.delta - correctAnswer.delta) < 0.01 &&
            Math.abs(userAnswers[auxDeterminant] - correctAnswer[auxDeterminant]) < 0.01 &&
            Math.abs(userAnswers[solutionVar] - correctAnswer[solutionVar]) < 0.01
        );
        const feedbackText = isCorrect ? '✓ Правильно! Молодець!' : '✗ Неправильно, спробуй ще раз!';
        elements.feedback.textContent = feedbackText;
        elements.feedback.className = `trainer-feedback result-message ${isCorrect ? 'correct' : 'wrong'}`;
        elements.feedback.style.display = 'block';
        elements.feedback.style.opacity = '1';
        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([elements.feedback]).catch(err => console.error('Помилка MathJax у feedback:', err));
        }

        const feedbackDuration = isCorrect ? 1000 : 2000;
        setTimeout(() => {
            elements.feedback.style.opacity = '0';
            setTimeout(() => {
                elements.feedback.style.display = 'none';
                elements.feedback.className = 'trainer-feedback result-message';
                inputIds.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) input.value = '';
                });
                elements.submitAnswer.disabled = true;
                if (isCorrect) {
                    if (currentQuestion === 4) {
                        currentQuestion += 1;
                        currentSystem = null;
                        displayQuestion();
                    } else {
                        console.log('Завершення тренажера');
                        elements.questionCircle.style.display = 'none';
                        elements.questionText.style.display = 'none';
                        elements.systemText.style.display = 'none';
                        elements.optionsContainer.style.display = 'none';
                        elements.inputContainer.style.display = 'none';
                        elements.systemEquations.style.display = 'none';
                        elements.submitAnswer.style.display = 'none';
                        elements.completionMessage.style.display = 'block';
                        elements.trainerContainer.scrollTop = 0;
                        elements.resetTrainerBtn.focus();
                    }
                } else {
                    console.log('Неправильна відповідь, генерація нової системи');
                    currentSystem = null;
                    displayQuestion();
                }
            }, 300);
        }, feedbackDuration);
        return;
    }
    
    let isCorrect;
    let feedbackText;
    if (currentQuestion < 3) {
        if (!selectedOption) {
            console.error('Помилка: selectedOption не визначено для питання', currentQuestion);
            return;
        }
        isCorrect = selectedOption.isCorrect;
        feedbackText = selectedOption.comment;
        elements.feedback.textContent = feedbackText;
        elements.feedback.className = `trainer-feedback result-message ${isCorrect ? 'correct' : 'wrong'}`;
        elements.feedback.style.display = 'block';
        elements.feedback.style.opacity = '1';
        document.querySelectorAll('.trainer-option').forEach(opt => {
            opt.classList.add('disabled');
            const optionText = opt.textContent.replace(/\\\[|\\]/g, '');
            if (optionText === selectedOption.text.replace(/\\\[|\\]/g, '')) {
                opt.classList.add(isCorrect ? 'correct' : 'wrong');
            }
        });
    } else if (currentQuestion === 3) {
        const userAnswer = parseFloat(elements.determinantInput.value);
        if (isNaN(userAnswer)) {
            elements.feedback.textContent = '✗ Будь ласка, введіть числове значення!';
            elements.feedback.className = 'trainer-feedback result-message wrong';
            elements.feedback.style.display = 'block';
            elements.feedback.style.opacity = '1';
            setTimeout(() => {
                elements.feedback.style.opacity = '0';
                setTimeout(() => {
                    elements.feedback.style.display = 'none';
                    elements.feedback.className = 'trainer-feedback result-message';
                }, 300);
            }, 2000);
            return;
        }
        isCorrect = Math.abs(userAnswer - correctAnswer) < 0.01;
        feedbackText = isCorrect ? '✓ Правильно! Молодець!' : '✗ Неправильно, спробуй ще раз!';
        elements.feedback.textContent = feedbackText;
        elements.feedback.className = `trainer-feedback result-message ${isCorrect ? 'correct' : 'wrong'}`;
        elements.feedback.style.display = 'block';
        elements.feedback.style.opacity = '1';
    }

    const feedbackDuration = isCorrect ? 1000 : 2000;
    setTimeout(() => {
        elements.feedback.style.opacity = '0';
        setTimeout(() => {
            elements.feedback.style.display = 'none';
            elements.feedback.className = 'trainer-feedback result-message';
            document.querySelectorAll('.trainer-option').forEach(opt => {
                opt.classList.remove('disabled', 'correct', 'wrong', 'selected');
            });
            if (currentQuestion === 3) {
                elements.determinantInput.value = '';
                elements.submitAnswer.disabled = true;
            }
            if (isCorrect) {
                if (currentQuestion < 4) {
                    currentQuestion += 1;
                    currentSystem = null;
                    displayQuestion();
                } else {
                    console.log('Завершення тренажера');
                    elements.questionCircle.style.display = 'none';
                    elements.questionText.style.display = 'none';
                    elements.systemText.style.display = 'none';
                    elements.optionsContainer.style.display = 'none';
                    elements.inputContainer.style.display = 'none';
                    elements.systemEquations.style.display = 'none';
                    elements.submitAnswer.style.display = 'none';
                    elements.completionMessage.style.display = 'block';
                    elements.trainerContainer.scrollTop = 0;
                    elements.resetTrainerBtn.focus();
                }
            } else {
                currentSystem = null;
                displayQuestion();
            }
        }, 300);
    }, feedbackDuration);
});

elements.resetTrainerBtn?.addEventListener('click', resetTrainer);
});
    </script>
</body>
</html>

