<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>37. Скалярний добуток векторів та його властивості</title>
    <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['\\(', '\\)']],
            displayMath: [['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            ignoreHtmlClass: 'tex2jax_ignore',
            processHtmlClass: 'tex2jax_process'
        }
    };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        *, *:before, *:after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            font-family: 'Poppins', sans-serif;
            color: #e8e8e8;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100dvh;
        }
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: linear-gradient(135deg, #16213e, #0f3460);
            border-radius: 25px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            font-size: 28px;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            font-weight: 800;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            overflow: hidden; /* Блокує тимчасовий скрол при reflow */
        }
        .section {
            width: 250px;
            height: 220px;
            background: linear-gradient(135deg, #1e3a5f, #0f3460);
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3), inset 0 0 8px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: inherit;
            border: 1px solid rgba(0, 212, 255, 0.3);
                                        position: relative; /* Фіксує absolute ::before */
    will-change: transform; /* Оптимізує hover для GPU */
    overflow: hidden; /* Запобігає витіканню контенту при scale */
            
        }
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transition: left 0.5s;
            transition: left 0.3s ease; /* Прискорили, щоб менше flicker */
        }
        .section:hover::before {
            left: 100%;
        }
        .section:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), inset 0 0 12px rgba(0, 212, 255, 0.2);
            will-change: transform, box-shadow; /* Додаткова оптимізація */
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: drop-shadow(0 0 5px rgba(0, 212, 255, 0.3));
        }
        .section h2 {
            font-size: 20px;
            color: #e8e8e8;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 95%;
            max-width: 95vw;
            height: 95vh;
            max-height: 95vh;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            z-index: 1001;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            transition: opacity 0.25s ease, transform 0.25s ease;
            opacity: 0;
            border-radius: 15px;
            overflow: hidden;
            transform: translateZ(0);
                   }
        .modal.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        .modal-header {
            background: linear-gradient(90deg, #16213e, #0f3460);
            padding: 8px 12px;
            display: flex;
            justify-content: flex-end;
            width: 100%;
            flex-shrink: 0;
        }
        .close-btn {
            background: #00d4ff;
            color: #0a0a0a;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .close-btn:hover {
            background: #00b3d9;
            transform: scale(1.05);
        }
        .modal-content {
            padding: 20px;
            flex-grow: 1;
            background: linear-gradient(135deg, #0f3460, #16213e);
            border-radius: 10px;
            margin: 10px;
            color: #e8e8e8;
            width: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 212, 255, 0.5) transparent;
        }
        .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 3px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.8);
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: linear-gradient(135deg, #1e3a5f, #0f3460);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: #e8e8e8;
            position: relative;
            overflow: hidden;
        }
        .video-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        .video-card:hover::before {
            left: 100%;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
        }
        .video-player-container {
            max-width: 95%;
            margin: 0 auto;
        }
        .video-player-container iframe {
            width: 100%;
            aspect-ratio: 16 / 9;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .glow-title {
            text-align: center;
            font-size: 2em;
            color: #e8e8e8;
            font-family: 'Verdana', sans-serif;
            text-shadow: 0 0 10px #e8e8e8, 0 0 20px #00d4ff, 0 0 30px #00d4ff;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #e8e8e8, 0 0 10px #00d4ff;
            }
            to {
                text-shadow: 0 0 20px #e8e8e8, 0 0 30px #00d4ff;
            }
        }
        #theoryModal .modal-content p {
            font-size: 18px !important;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: justify;
            max-width: 100%;
        }
        #theoryModal .modal-content ul {
            list-style: none;
            padding-left: 20px;
        }
        #theoryModal .modal-content li {
            color: #e8e8e8;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
        }
        #theoryModal .modal-content li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #00d4ff;
            font-size: 16px;
        }
        #theoryModal .modal-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
       #theoryModal .math-notation-centered {
            display: block !important;
            color: #FFFF00 !important;
            text-align: center !important;
            max-width: 100%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
        }
        #theoryModal mjx-container {
            color: #FFFF00 !important;
            font-size: clamp(16px, 2.8vw, 18px);
        }
        #theoryModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 100% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        #trainerModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 10px auto;
            padding: 5px;
            box-sizing: border-box;
            text-align: center;
        }
        #trainerModal mjx-container[jax="CHTML"][display="true"] {
            font-size: clamp(18px, 3vw, 20px) !important;
            display: block !important;
            text-align: center !important;
            margin: 10px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        .mathjax-loading::before {
            content: 'Завантаження формул...';
            display: block;
            text-align: center;
            color: #e0e6ed;
            margin: 10px 0;
        }
        #questionsModal mjx-container {
            font-size: clamp(16px, 2.8vw, 18px);
            color: #FFFF00;
            max-width: 90%;
            width: fit-content;
            margin: 5px auto;
            padding: 3px;
            box-sizing: border-box;
            text-align: center;
            overflow: visible !important;
        }
        #questionsModal mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 5px auto !important;
            max-width: 90% !important;
            width: fit-content !important;
            padding: 3px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }

        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            transition: opacity 0.25s ease;
            transform: translateZ(0);
        }
        .question-card {
            perspective: 1000px;
            margin: 20px auto;
            max-width: 95%;
            height: 200px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 12px;
            border-radius: 15px;
            font-size: clamp(16px, 3vw, 18px);
            line-height: 1.5;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
        }
        .card-front {
            background: linear-gradient(135deg, #1e3a5f, #0f3460);
            color: #e8e8e8;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-wrap: wrap;
            overflow-wrap: break-word;
            word-break: break-word;
            padding: 12px 15px;
            max-width: 100%;
        }
        .card-back {
            background: linear-gradient(135deg, #0f3460, #1e3a5f);
            color: #e8e8e8;
            transform: rotateY(180deg);
            overflow-y: auto;
            text-align: justify;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
            padding: 12px 15px;
            max-width: 100%;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 212, 255, 0.5) transparent;
        }
            .question-text { display: inline-block; max-width: 100%; }
            
        .card-back::-webkit-scrollbar {
            width: 6px;
        }
        .card-back::-webkit-scrollbar-track {
            background: transparent;
        }
        .card-back::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 3px;
        }
        .card-back::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.8);
        }
        .question-card .card-front {
            white-space: normal;
            overflow-wrap: break-word;
            word-break: break-word;
            flex-wrap: wrap;
        }
        .card-back p {
            margin: 5px 0;
            font-size: clamp(16px, 3vw, 18px);
            color: #e8e8e8;
            box-sizing: border-box;
            width: 100%;
            text-align: center;
        }
        .card-front span.yellow {
            color: #FFFF00;
            font-weight: 600;
            display: inline;
            margin-right: 0.1em;
        }
        .trainer-container {
            width: 95%;
            max-width: 900px;
            padding: 4vw 5vw;
            text-align: center;
            background: linear-gradient(135deg, #1e3a5f, #0f3460);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-sizing: border-box;
            margin: auto;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 212, 255, 0.5) transparent;
                                        will-change: scroll-position; /* Оптимізує скрол, зменшує flicker */
        }
        .trainer-container::-webkit-scrollbar {
            width: 6px;
        }
        .trainer-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .trainer-container::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 3px;
        }
        .trainer-container::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.8);
        }
        .trainer-container p {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin: 10px 0;
        }
        .trainer-container .math-notation-centered {
            text-align: center !important;
            margin: 10px 0;
            max-width: 90%;
        }
        .trainer-question {
            font-size: clamp(18px, 3vw, 20px);
            color: #e8e8e8;
            margin-bottom: 15px;
            text-align: center;
        }
        .question-number {
            width: 100px;
            height: 100px;
            line-height: 100px;
            background: linear-gradient(135deg, #00d4ff, #00b3d9);
            color: #0a0a0a;
            border-radius: 50%;
            font-size: clamp(16px, 2.8vw, 18px);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
            white-space: nowrap;
        }
      /* Забезпечуємо, що .answer-buttons адаптується до маленьких екранів */
.answer-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 12px; /* Збільшено gap для кращого розподілу */
    justify-content: center;
    margin: 15px 0;
    position: relative; /* Додаємо для явного контексту z-index */
    z-index: 10; /* Нижче #feedback, але вище інших елементів */
}

/* Оновлені стилі для .answer-btn */
.answer-btn {
    background: #16213e;
    border: 1.5px solid #00d4ff;
    color: #e8e8e8;
    border-radius: 8px;
    padding: 12px 24px; /* Збільшено padding для більшої зони натискання */
    font-size: clamp(14px, 2.5vw, 16px); /* Зменшено розмір шрифту для мобільних */
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
    min-width: 80px; /* Зменшено min-width для кращої адаптивності */
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    touch-action: manipulation; /* Залишаємо для запобігання масштабування */
    user-select: none; /* Запобігаємо виділенню тексту */
    -webkit-user-select: none; /* Для iOS Safari */
    -moz-user-select: none;
    -ms-user-select: none;
    z-index: 11; /* Вище .answer-buttons, але нижче #feedback.show */
}

/* Стилі для .answer-btn:hover */
.answer-btn:hover {
    background: linear-gradient(135deg, #0f3460, #1e3a5f);
    transform: scale(1.05);
}

/* Стилі для .answer-btn:disabled */
.answer-btn:disabled {
    background: #1e3a5f;
    cursor: not-allowed;
    opacity: 0.6;
}

/* Стилі для .answer-btn.selected */
.answer-btn.selected {
    background: #00d4ff !important;
    color: #0a0a0a !important;
    border: 2px solid #FFFF00 !important;
}

        .submit-btn {
            background: #0f3460;
            color: #00d4ff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(18px, 2.9vw, 20px);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            margin: 15px auto;
            display: block;
        }
        .submit-btn:hover {
            background: linear-gradient(135deg, #1e3a5f, #16213e);
            transform: scale(1.05);
        }
        .submit-btn:disabled {
            background: #1e3a5f;
            cursor: not-allowed;
            opacity: 0.6;
            color: #e8e8e8;
        }
        /* Оновлені стилі для #feedback */
#feedback {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin: 0;
    padding: 15px 25px;
    max-width: 400px;
    width: 90%;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    font-size: clamp(16px, 2.8vw, 18px);
    font-weight: 600;
    text-align: center;
    opacity: 0;
    transition: opacity 0.4s ease, transform 0.4s ease;
    z-index: 1000; /* Вище всіх кнопок, коли видно */
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none; /* Вимикаємо взаємодію, коли не видно */
}

#feedback.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.05);
    pointer-events: auto; /* Увімкнути взаємодію, коли видно */
}

#feedback.correct {
    color: #ffffff;
    background: linear-gradient(135deg, #00ff00, #00cc00);
    border: 2px solid #00b3d9;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

#feedback.incorrect {
    color: #ffffff;
    background: linear-gradient(135deg, #ff4757, #cc3333);
    border: 2px solid #ff6b6b;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

        #resetTrainerBtn {
            background: #00d4ff;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #resetTrainerBtn:hover {
            background: #00b3d9;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #16213e, #0f3460);
            color: #00d4ff;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.3);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .nav-button:hover {
            background: linear-gradient(135deg, #0f3460, #1e3a5f);
            color: #e8e8e8;
            text-decoration: none;
            transform: translateY(-2px);
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
        }
        details {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(135deg, #1e3a5f, #0f3460);
            cursor: pointer;
            border: 1px solid rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
        }
        details:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        summary {
            font-weight: 600;
            padding: 10px;
            background: linear-gradient(90deg, #0f3460, #1e3a5f);
            border-radius: 10px;
            color: #00d4ff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            transition: background 0.3s ease;
        }
        summary:hover {
            background: linear-gradient(90deg, #1e3a5f, #16213e);
        }
        details p {
            padding: 0 20px 10px;
            color: #e8e8e8;
        }
        .solution {
            color: #F4A261 !important;
            font-weight: bold;
        }
        .example-title {
            color: #F4A261 !important;
            font-weight: bold;
        }
        .example-condition {
            color: #e8e8e8 !important;
        }
        .completion-emoji {
            width: clamp(80px, 15vw, 120px);
            height: clamp(80px, 15vw, 120px);
            margin: 0 auto 3vw;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            border: 2px dashed #00d4ff;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .completion-emoji::after {
            content: '🎉';
            font-size: clamp(40px, 8vw, 60px);
            color: #ffff00;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        #completionScreen {
            z-index: 10;
            width: 100%;
            max-width: 90%;
            margin: 20px auto;
            text-align: center;
            position: relative;
        }
        .completion-message {
            text-align: center;
            padding: 20px;
            background: #16213e;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            max-width: 90%;
            margin: 20px auto;
        }
        .completion-message h2 {
            font-size: clamp(20px, 3.5vw, 24px);
            color: #e6e6e6;
            margin-bottom: 10px;
        }
        .completion-message p {
            font-size: clamp(18px, 3vw, 20px);
            color: #FFFF00;
        }
        .completion-message button {
            margin-top: 20px;
            background: #00d4ff;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .completion-message button:hover {
            background: #00b3d9;
        }
        .hidden {
            display: none !important;
        }
            .modal {
   overflow: hidden; /* Блокує скрол під час transition */
    will-change: opacity, transform;
}
.modal.hide {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
    visibility: hidden; /* Додали: плавніше, ніж display:none */
}
            .modal.show {
    visibility: visible; /* Забезпечує плавність */
}
       .trainer-container {
    width: 95%;
    max-width: 900px;
    padding: 4vw 5vw;
    text-align: center;
    background: linear-gradient(135deg, #1e3a5f, #0f3460);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(0, 212, 255, 0.3);
    box-sizing: border-box;
    margin: auto;
    position: relative; /* Додаємо для позиціонування #feedback */
    min-height: 400px; /* Забезпечуємо достатню висоту */
    overflow-y: auto; /* Залишаємо скрол, але перевіримо, що він не обрізає */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 212, 255, 0.5) transparent;
}
           
        @media (max-width: 768px) {
            .title-box {
                margin-top: 40px;
                padding: 15px 20px;
            }
            .title-box h1 {
                font-size: 24px;
            }
            .section-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .section {
                width: 80%;
                height: 180px;
            }
            .modal-content {
                padding: 15px;
                max-height: calc(100dvh - 60px);
                overflow-x: auto;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 18px !important;
                line-height: 1.7;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(18px, 3vw, 20px) !important;
            }
            .question-card {
                height: 220px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(16px, 2.9vw, 18px);
                padding: 10px 12px;
                overflow-wrap: break-word;
                word-break: break-word;
            }
            .card-back {
                padding: 10px 12px;
                font-size: clamp(16px, 2.9vw, 18px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(16px, 3.2vw, 18px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(16px, 2.9vw, 18px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 4vw 5vw;
                width: 95%;
                max-width: 800px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .question-number {
                width: 80px;
                height: 80px;
                line-height: 80px;
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .answer-btn, .submit-btn, #resetTrainerBtn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 8px 15px;
                min-width: 100px;
            }
            .completion-emoji {
                width: clamp(60px, 12vw, 100px);
                height: clamp(60px, 12vw, 100px);
            }
            .completion-emoji::after {
                font-size: clamp(30px, 6vw, 50px);
            }
            .completion-message h2 {
                font-size: clamp(18px, 3vw, 20px);
            }
            .completion-message p {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .completion-message button {
                font-size: clamp(12px, 2.3vw, 14px);
                padding: 8px 16px;
            }
            .navigation-buttons {
                margin: 22px auto;
                gap: 16px;
            }
            .nav-button {
                font-size: 18px;
                padding: 8px 18px;
            }
            .trainer-question {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .submit-btn {
                font-size: clamp(16px, 3vw, 18px);
                padding: 12px 24px;
                min-width: 120px;
                border-radius: 10px;
            }

             .answer-buttons {
        gap: 10px; /* Менший gap для компактності */
    }
    .answer-btn {
        padding: 10px 20px; /* Зменшено padding */
        font-size: clamp(13px, 2.4vw, 15px); /* Ще менший шрифт */
        min-width: 70px; /* Ще менший min-width */
    }
    #feedback {
        font-size: clamp(14px, 2.6vw, 16px);
        padding: 10px 15px;
        max-width: 300px;
    }
            .section-container {
        overflow: hidden; /* Посилює фікс скролу */
    }
    .section:hover {
        transform: translateY(-4px) scale(1.01); /* Менший scale, менше reflow */
    }
        }
        @media (max-width: 480px) {
            .title-box {
                margin-top: 20px;
                padding: 10px 15px;
            }
            .title-box h1 {
                font-size: 22px;
            }
            .section {
                width: 90%;
                height: 150px;
            }
            .section img {
                width: 50px;
                height: 50px;
            }
            .section h2 {
                font-size: 20px;
            }
            .modal-content {
                padding: 10px;
            }
            .video-card {
                width: 260px;
                height: 160px;
            }
            #theoryModal .modal-content p, #theoryModal .modal-content li {
                font-size: 16px !important;
            }
            #theoryModal mjx-container, #theoryModal .math-notation-centered {
                font-size: clamp(16px, 2.8vw, 18px) !important;
            }
            #trainerModal mjx-container, #questionsModal mjx-container {
                font-size: clamp(15px, 2.7vw, 17px) !important;
            }
            .question-card {
                height: 240px;
                max-width: 90%;
            }
            .card-front {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 8px 10px;
            }
            .card-back {
                padding: 8px 10px;
                font-size: clamp(15px, 2.8vw, 17px);
                justify-content: center;
                align-items: center;
                overflow-y: auto;
            }
            #questionsModal mjx-container {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
            }
            #questionsModal mjx-container[jax="CHTML"][display="true"] {
                font-size: clamp(15px, 2.8vw, 17px) !important;
                max-width: 100%;
                margin: 5px auto;
                padding: 5px;
                overflow: visible !important;
                text-align: center;
            }
            .card-back p {
                font-size: clamp(15px, 2.8vw, 17px);
                margin: 5px 0;
                text-align: center;
            }
            .trainer-container {
                padding: 5vw 6vw;
                width: 95%;
                max-width: 700px;
            }
            .trainer-container p, .trainer-question {
                font-size: clamp(15px, 2.7vw, 17px);
            }
            .question-number {
                width: 70px;
                height: 70px;
                line-height: 70px;
                font-size: clamp(12px, 2.3vw, 14px);
            }
            .answer-buttons {
        gap: 8px; /* Ще менший gap */
        flex-direction: column; /* Вертикальне розташування для дуже маленьких екранів */
        align-items: center;
    }
    .answer-btn {
        padding: 8px 16px;
        font-size: clamp(14px, 2.5vw, 16px);
        min-width: 60px; /* Ще менший min-width */
        width: 90%; /* Кнопки займають більше ширини */
        max-width: 200px; /* Обмежуємо максимальну ширину */
    }
    #feedback {
        font-size: clamp(14px, 2.4vw, 16px);
        padding: 8px 12px;
        max-width: 250px;
        min-height: 50px;
    }
           
            .completion-emoji {
                width: clamp(50px, 10vw, 80px);
                height: clamp(50px, 10vw, 80px);
            }
            .completion-emoji::after {
                font-size: clamp(25px, 5vw, 40px);
            }
            .completion-message h2 {
                font-size: clamp(16px, 2.8vw, 18px);
            }
            .completion-message p {
                font-size: clamp(14px, 2.6vw, 16px);
            }
            .completion-message button {
                font-size: clamp(12px, 2.3vw, 14px);
                padding: 6px 12px;
            }
            .nav-button {
                font-size: 16px;
                padding: 8px 16px;
            }
            .submit-btn {
                font-size: clamp(15px, 2.8vw, 17px);
                padding: 10px 20px;
                min-width: 100px;
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="title-box">
        <h1>37. Скалярний добуток векторів та його властивості</h1>
    </div>

    <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>

    <div class="navigation-buttons">
        <a class="nav-button" href='tema8.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6l6-6"/>
            </svg>
            До теми 8
        </a>
        <a class="nav-button" href='index.html'>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>

    <div id="modalOverlay"></div>

    <div id="theoryModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTheoryBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <details>
                <summary>Алгебраїчне означення скалярного добутку</summary>
                <p>Скалярним добутком векторів \(\vec{a}(a_x; a_y; a_z)\) і \(\vec{b}(b_x; b_y; b_z)\) називають число, яке обчислюється за формулою:</p>
                <p class="math-notation-centered">\[
                    \vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z. \quad (8.1)
                \]</p>
                <p>Позначають скалярний добуток \( «\cdot» \), наприклад, \(\vec{a} \cdot \vec{b}\) або просто \(\vec{a} \vec{b}\).</p>
                <p>Отже, <span style="font-style: italic; color: #fb607f;">
скалярний добуток двох векторів дорівнює сумі добутків їхніх однойменних координат.
</span></p>

                <p><span class="example-title">Приклад 8.1.</span> <span class="example-condition">Знайти скалярний добуток векторів \(\vec{a}(-4;1;3)\) та \(\vec{b}(2;6;5)\).</span></p>
                <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
                <p>За формулою (8.1):</p>
                <p>\[
                    \vec{a} \cdot \vec{b} = -4 \cdot 2 + 1 \cdot 6 + 3 \cdot 5 = -8 + 6 + 15 = 13.
                \]</p>
                <p><strong>Відповідь.</strong> \( 13 \). </p>
                <p><span style="color: #00ffff; font-weight: bold;">Скалярний квадрат вектора.</span> 
Розглянемо скалярний добуток вектора на самого себе. Нехай дано вектор \(\vec{a}(a_x; a_y; a_z)\). Тоді:</p>
                <p>\[
                    \vec{a} \cdot \vec{a} = a_x \cdot a_x + a_y \cdot a_y + a_z \cdot a_z = a_x^2 + a_y^2 + a_z^2.
                \]</p>
                <p>Оскільки \(\sqrt{a_x^2 + a_y^2 + a_z^2} = |\vec{a}|\) є довжиною (модулем) вектора \(\vec{a}\), то:</p>
                <p>\[
                    \vec{a} \cdot \vec{a} = |\vec{a}|^2.
                \]</p>
                <p>Добуток \(\vec{a} \cdot \vec{a}\) позначають як \(\vec{a}^2\) і називають скалярним квадратом вектора. Таким чином, <span style="font-style: italic; color: #fb607f;">скалярний квадрат вектора дорівнює квадрату його модуля:</span></p>
                <p class="math-notation-centered">\[
                    \vec{a}^2 = |\vec{a}|^2. \quad (8.2)
                \]</p>
            </details>


          <details>
    <summary>Геометричне означення скалярного добутку</summary>
    <p>Скалярним добутком двох ненульових векторів \(\vec{a}\) і \(\vec{b}\) називається число, яке дорівнює добутку їхніх довжин (модулів) на косинус кута між ними (рис. 8.1):</p>

    <p class="math-notation-centered">\[
        \vec{a} \cdot \vec{b} = |\vec{a}| \cdot |\vec{b}| \cos \varphi, \quad (8.3)
    \]</p>

    <p>де \(\varphi\) – кут між векторами \(\vec{a}\) і \(\vec{b}\) (\(\varphi = \angle \vec{a}, \vec{b}\)).</p>

    <p style="text-align: center;">
        <img src="static/figure8.1.jpg" alt="Рис. 8.1" class="figure figure-8-1">
    </p>

    <p>Якщо хоча б один із векторів <span style="font-style: italic; color: #fb607f;">нульовий </span>  (\(\vec{a} = 0\) або \(\vec{b} = 0\)), то скалярний добуток дорівнює нулю.</p>

    <p><span class="example-title">Приклад 8.2.</span>
        <span class="example-condition">Знайти скалярний добуток векторів \(\vec{a}\) і \(\vec{b}\), якщо \(|\vec{a}| = 2\), \(|\vec{b}| = 5\), \(\angle(\vec{a}; \vec{b}) = \pi/6\).</span>
    </p>

    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p>Використаємо формулу (8.3):</p>

    <p>\[
        \vec{a} \cdot \vec{b} = |\vec{a}| \cdot |\vec{b}| \cos \varphi = 2 \cdot 5 \cdot \cos \frac{\pi}{6} = 10 \cdot \frac{\sqrt{3}}{2} = 5\sqrt{3}.
    \]</p>

    <p><em><span style="font-style: italic; color: #ff9900;">Примітка.</em></span> Значення \(\cos \pi/6 = \sqrt{3}/2\) можна знайти в тригонометричній таблиці. З математичної точки зору, скалярний добуток є безрозмірним числом (наприклад, \(5\sqrt{3}\)). Однак у фізичних задачах він набуває змісту й одиниць вимірювання. Наприклад, у задачі про роботу сили (\(A = \vec{F} \cdot \vec{s}\)) результат записують у джоулях, наприклад, \(5\sqrt{3}\) Дж. Детальніше про це – у підручниках із фізики.</p>

    <p><strong>Відповідь.</strong> \(5\sqrt{3}\).</p>
</details>


           <details>
    <summary>Властивості скалярного добутку</summary>

    <p>Скалярний добуток векторів має <strong>алгебраїчні</strong> та <strong>геометричні</strong> властивості, які роблять його потужним інструментом для розв’язання задач.</p>

    <p style="text-align:center;">
    <span style="color:#00ffff; font-weight:bold;">Алгебраїчні властивості:</span>
</p>

    <ol>
        <li><strong>Комутативність.</strong> Зміна порядку векторів не впливає на результат:<br>
        \[
        \vec{a} \cdot \vec{b} = \vec{b} \cdot \vec{a}.
        \]</li>

        <li><strong>Лінійність (за множником).</strong> Якщо один із векторів помножити на число \(\lambda\), то скалярний добуток пропорційно змінюється:<br>
        \[
        (\lambda \vec{a}) \cdot \vec{b} = \lambda (\vec{a} \cdot \vec{b}),
        \]
        де \(\lambda\) – довільне дійсне число.
        </li>

        <li><strong>Дистрибутивність (розподільний закон).</strong> Скалярний добуток розподіляється за додаванням векторів:<br>
        \[
        \vec{a} \cdot (\vec{b} + \vec{c}) = \vec{a} \cdot \vec{b} + \vec{a} \cdot \vec{c}.
        \]
        </li>
    </ol>

   <p style="text-align:center;">
    <span style="color:#00ffff; font-weight:bold;">Геометричні властивості:</span>
</p>

    <ol>
        <li><strong>Залежність від кута.</strong> Скалярний добуток векторів залежить від кута \(\varphi\) між ними (згідно з формулою):<br>
        \[
        \vec{a} \cdot \vec{b} = |\vec{a}| \cdot |\vec{b}| \cos \varphi.
        \]
        Якщо \(\varphi\) гострий (\(0 < \varphi < 90^\circ\)), то \(\vec{a} \cdot \vec{b} > 0\);  
        якщо \(\varphi\) тупий (\(90^\circ < \varphi < 180^\circ\)), то \(\vec{a} \cdot \vec{b} < 0\).
        </li>

        <li><strong>Перпендикулярність.</strong> Для будь-яких двох ненульових векторів їхній скалярний добуток дорівнює нулю тоді й тільки тоді, коли вони перпендикулярні:<br>
        \[
        \vec{a} \cdot \vec{b} = 0 \iff \vec{a} \perp \vec{b}.
        \]
        </li>

        <li><strong>Скалярний квадрат.</strong> Скалярний добуток вектора самого на себе дорівнює квадрату його довжини (модуля):<br>
        \[
        \vec{a} \cdot \vec{a} = |\vec{a}|^2.
        \]
        Звідси можна знайти довжину вектора:<br>
        \[
        |\vec{a}| = \sqrt{\vec{a} \cdot \vec{a}} = \sqrt{\vec{a}^2}.
        \]
        </li>
    </ol>
</details>

            <details>
    <summary>Обчислення кута між двома векторами</summary>
    <p>За означенням скалярного добутку \(\vec{a} \cdot \vec{b} = |\vec{a}| \cdot |\vec{b}| \cos \varphi\), де \(\varphi\) – кут між векторами \(\vec{a}\) і \(\vec{b}\). Якщо \(\vec{a} \neq 0\) і \(\vec{b} \neq 0\), то косинус кута можна виразити як:</p>
    <p class="math-notation-centered">\[
        \cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|}. \quad (8.4)
    \]</p>
    <p>Отже, <span style="font-style: italic; color: #fb607f;">косинус кута між ненульовими векторами \(\vec{a}\) і \(\vec{b}\) дорівнює їхньому скалярному добутку, поділеному на добуток їхніх довжин.</span></p>
  <p><span style="color: #00ffff; font-weight: bold;">Формула для обчислення косинуса кута у декартовій системі координат.</span> <em>У тривимірному просторі.</em> Нехай у тривимірній прямокутній декартовій системі координат задано вектори:</p>

<p>\[
\vec{a} = (a_x; a_y; a_z), \quad \vec{b} = (b_x; b_y; b_z).
\]</p>

<p>Тоді скалярний добуток між цими векторами</p>
<p>\[
\vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z,
\]</p>

<p>довжини векторів обчислюються як</p>
<p>\[
|\vec{a}| = \sqrt{a_x^2 + a_y^2 + a_z^2}, \quad |\vec{b}| = \sqrt{b_x^2 + b_y^2 + b_z^2}.
\]</p>

<p>Згідно з формулою (8.4), косинус кута \(\varphi = \angle (\vec{a}; \vec{b})\) між векторами можна обчислити так:</p>

<p class="math-notation-centered">\[
\cos \varphi = \frac{a_x b_x + a_y b_y + a_z b_z}{\sqrt{a_x^2 + a_y^2 + a_z^2} \cdot \sqrt{b_x^2 + b_y^2 + b_z^2}}. \quad (8.5)
\]</p>

<p>Ця формула дозволяє зручно обчислювати косинус кута між векторами у тривимірному просторі за їхніми координатами.</p>

<p><em>На площині.</em> Якщо вектори \(\vec{a} = (a_x; a_y)\) і \(\vec{b} = (b_x; b_y)\) задано в двовимірній прямокутній декартовій системі координат, то косинус кута \(\varphi = \angle (\vec{a}; \vec{b})\) обчислюється так:</p>

<p class="math-notation-centered">\[
\cos \varphi = \frac{a_x b_x + a_y b_y}{\sqrt{a_x^2 + a_y^2} \cdot \sqrt{b_x^2 + b_y^2}}. \quad (8.6)
\]</p>

<p><em><span style="font-style: italic; color: #ff9900;">Примітка.</span></em> Щоб знайти міру кута \(\varphi\), можна скористатися функцією арккосинуса (\(\varphi = \arccos(\cos \varphi)\)) або таблицями значень косинусів.</p>

    <p><span class="example-title">Приклад 8.3.</span> <span class="example-condition">Дано два вектори \(\vec{a} = (1;1;0)\) і \(\vec{b} = (1;0;1)\). Знайти кут між ними.</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p> Використаємо формулу для косинуса кута між векторами (8.4) або можна скористатися безпосередньо формулою (8.5):</p>
    <p>\[
        \cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|}.
    \]</p>
    <p>Знайдемо скалярний добуток векторів:</p>
    <p>\[
        \vec{a} \cdot \vec{b} = 1 \cdot 1 + 1 \cdot 0 + 0 \cdot 1 = 1.
    \]</p>
    <p>Обчислимо довжини векторів:</p>
    <p>\[
        |\vec{a}| = \sqrt{1^2 + 1^2 + 0^2} = \sqrt{2}, \quad |\vec{b}| = \sqrt{1^2 + 0^2 + 1^2} = \sqrt{2}.
    \]</p>
    <p>Підставимо у формулу:</p>
    <p>\[
        \cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|} = \frac{1}{\sqrt{2} \cdot \sqrt{2}} = \frac{1}{2}.
    \]</p>
    <p>Знаходимо кут за допомогою арккосинуса:</p>
    <p>\[
        \varphi = \arccos \frac{1}{2} = \frac{\pi}{3}.
    \]</p>
    <p>Оскільки \(\frac{\pi}{3}\) радіан відповідає \(60^\circ\), можна записати відповідь і в градусах:</p>
    <p>\[
        \varphi = 60^\circ.
    \]</p>
    <p><strong>Відповідь.</strong> \(60^\circ\). </p>

    <p><span class="example-title">Приклад 8.4.</span> <span class="example-condition">Знайти кут між векторами \(\vec{a} = 2\vec{i} - \vec{j} + \vec{k}\), \(\vec{b} = -\vec{i} + \vec{j}\).</span></p>
    <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
    <p> Запишемо координати векторів у вигляді:</p>
    <p>\[
        \vec{a} = (2; -1; 1), \quad \vec{b} = (-1; 1; 0).
    \]</p>
    <p>Використаємо формулу для косинуса кута між векторами (8.4):</p>
    <p>\[
        \cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|}.
    \]</p>
    <p>Знайдемо скалярний добуток векторів:</p>
    <p>\[
        \vec{a} \cdot \vec{b} = 2 \cdot (-1) + (-1) \cdot 1 + 1 \cdot 0 = -3.
    \]</p>
    <p>Обчислимо довжини векторів:</p>
    <p>\[
        |\vec{a}| = \sqrt{2^2 + (-1)^2 + 1^2} = \sqrt{6}, \quad |\vec{b}| = \sqrt{(-1)^2 + 1^2 + 0^2} = \sqrt{2}.
    \]</p>
    <p>Підставимо у формулу:</p>
    <p>\[
        \cos \varphi = \frac{-3}{\sqrt{6} \cdot \sqrt{2}} = \frac{-3}{2\sqrt{3}} = -\frac{\sqrt{3}}{2}.
    \]</p>
    <p>Знаходимо кут за допомогою оберненого косинуса:</p>
    <p>\[
        \varphi = \arccos \left( -\frac{\sqrt{3}}{2} \right) = \pi - \arccos \frac{\sqrt{3}}{2} = \pi - \frac{\pi}{6} = \frac{5\pi}{6}.
    \]</p>
    <p>У градусах \(\varphi = 180^\circ - 30^\circ = 150^\circ\).</p>
    <p><strong>Відповідь.</strong> \(150^\circ\). </p>
</details>

          <details>
    <summary>Проекція вектора на вектор</summary>

    <p>Проекція вектора <span style="color:#00ffff;">\(\vec{a}\)</span> на вісь \(l\), напрямок якої збігається з напрямом вектора <span style="color:#00ffff;">\(\vec{a}\)</span>, виражається формулою:</p>

    <p class="math-notation-centered" style="text-align:center; color:#ffd54f; font-size:17px;">
        \[
        \text{пр}_l \vec{a} = |\vec{a}| \cos \varphi,
        \]
    </p>

    <p>де <span style="color:#ffcc80;">\(\varphi\)</span> – кут між вектором <span style="color:#00ffff;">\(\vec{a}\)</span> і віссю \(l\).</p>

    <p>Оскільки виконуються рівності:</p>

    <p class="math-notation-centered" style="text-align:center;">
        \[
        |\vec{a}| \cos \varphi = \text{пр}_{\vec{b}} \vec{a}, \quad 
        |\vec{b}| \cos \varphi = \text{пр}_{\vec{a}} \vec{b},
        \]
    </p>

    <p>то, підставляючи ці вирази у формулу скалярного добутку 
        \(\vec{a} \cdot \vec{b} = |\vec{a}| \cdot |\vec{b}| \cos \varphi\), 
        отримуємо:
    </p>

    <p class="math-notation-centered" style="text-align:center; color:#ffd54f;">
        \[
        \vec{a} \cdot \vec{b} = |\vec{b}| \text{пр}_{\vec{b}} \vec{a} = |\vec{a}| \text{пр}_{\vec{a}} \vec{b}. \quad (8.7)
        \]
    </p>

    <p style="text-align:center;"><span style="color:#00ffff; font-weight:bold;">Формули для обчислення проекцій:</span></p>

    <p>Проекція вектора \(\vec{a}\) на вектор \(\vec{b}\):</p>
    <p class="math-notation-centered" style="text-align:center;">
        \[
        \text{пр}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|}. \quad (8.8)
        \]
    </p>

    <p>Проекція вектора \(\vec{b}\) на вектор \(\vec{a}\):</p>
    <p class="math-notation-centered" style="text-align:center;">
        \[
        \text{пр}_{\vec{a}} \vec{b} = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}|}. \quad (8.9)
        \]
    </p>

    <p><span class="example-title" style="color:#ffb74d;">Приклад 8.5.</span>
    <span class="example-condition">Знайти проекцію вектора \(\vec{a} = (0;4;1)\) на вектор \(\vec{b} = (-1;2;7)\).</span></p>

    <p class="solution" style="text-align: center; color:#81d4fa;"><strong>Розв’язання</strong></p>

   <p>Використовуючи формулу для проекції вектора \(\vec{a}\) на вектор \(\vec{b}\) (8.8), отримаємо:</p>

    <p class="math-notation-centered" style="text-align:center;">
        \[
        \text{пр}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|} = 
        \frac{0 \cdot (-1) + 4 \cdot 2 + 1 \cdot 7}{\sqrt{(-1)^2 + 2^2 + 7^2}} = 
        \frac{15}{3\sqrt{6}} = \frac{5}{\sqrt{6}}.
        \]
    </p>
    <p><strong style="color:#ffd54f;">Відповідь:</strong> \(\text{пр}_{\vec{b}} \vec{a} = \frac{5}{\sqrt{6}}\).</p>

    <p><span class="example-title">Приклад 8.6.</span> <span class="example-condition">Трикутник задано своїми вершинами \(A(3;-2;4)\), \(B(1;0;5)\) і \(C(6;4;2)\). Знайти: 1) величину кута \(A\); 2) проекцію сторони \(AB\) на сторону \(AC\); 3) проекцію сторони \(AC\) на сторону \(BC\).</span></p>
                <p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
                <p>1) Розглянемо схематичний рисунок трикутника \(ABC\) (рис. 8.2) і побудуємо на сторонах \(AB\) і \(AC\) відповідно вектори \(\overrightarrow{AB}\) і \(\overrightarrow{AC}\) (рис. 8.3).</p>
 <img src="static/figure8.2.jpg" alt="Рис. 8.2" class="figure figure-8-2">
                <p>Згідно з формулою (8.4):</p>
                <p>\[
                    \cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|},
                \]</p>
                <p>для кута \(\angle A\) використовуємо вектори \(\overrightarrow{AB}\) і \(\overrightarrow{AC}\):</p>
                <p>\[
                    \cos \angle A = \frac{\overrightarrow{AB} \cdot \overrightarrow{AC}}{|\overrightarrow{AB}| \cdot |\overrightarrow{AC}|}.
                \]</p>
                <p>Спочатку знайдемо координати векторів \(\overrightarrow{AB}\) і \(\overrightarrow{AC}\):</p>
                <p>\[
                    \overrightarrow{AB} = (1-3; 0-(-2); 5-4) = (-2; 2; 1),
                \]</p>
                <p>\[
                    \overrightarrow{AC} = (6-3; 4-(-2); 2-4) = (3; 6; -2).
                \]</p>
                <p>Далі обчислюємо скалярний добуток:</p>
                <p>\[
                    \overrightarrow{AB} \cdot \overrightarrow{AC} = (-2) \cdot 3 + 2 \cdot 6 + 1 \cdot (-2) = -6 + 12 - 2 = 4.
                \]</p>
                <p>І довжини векторів:</p>
                <p>\[
                    |\overrightarrow{AB}| = \sqrt{(-2)^2 + 2^2 + 1^2} = \sqrt{4 + 4 + 1} = \sqrt{9} = 3,
                \]</p>
                <p>\[
                    \overrightarrow{AC} = \sqrt{3^2 + 6^2 + (-2)^2} = \sqrt{9 + 36 + 4} = \sqrt{49} = 7.
                \]</p>
                <p>Тепер можемо знайти косинус кута:</p>
                <p>\[
                    \cos \angle A = \frac{4}{3 \cdot 7} = \frac{4}{21}.
                \]</p>
                <p>Кут \(\angle A\):</p>
                <p>\[
                    \angle A = \arccos \frac{4}{21} \approx 79^\circ.
                \]</p>
                <p>2) Для знаходження проекції сторони \(AB\) на сторону \(AC\) (рис. 8.4) скористаємося формулою (8.8):</p>
                <p>\[
                    \text{пр}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|} = \text{пр}_{\overrightarrow{AC}} \overrightarrow{AB} = \frac{\overrightarrow{AB} \cdot \overrightarrow{AC}}{|\overrightarrow{AC}|}.
                \]</p>
                 <img src="static/figure8.4.jpg" alt="Рис. 8.4" class="figure figure-8-4">
                <p>Підставляємо знайдені значення:</p>
                <p>\[
                    \text{пр}_{\overrightarrow{AC}} \overrightarrow{AB} = \frac{4}{7}.
                \]</p>
                <p>3) Для знаходження проекції сторони \(AC\) на сторону \(BC\) (рис. 8.5) скористаємося формулою (8.8):</p>
                <p>\[
                    \text{пр}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|} = \text{пр}_{\overrightarrow{BC}} \overrightarrow{AC} = \frac{\overrightarrow{AC} \cdot \overrightarrow{BC}}{|\overrightarrow{BC}|}.
                \]</p>
                 <img src="static/figure8.5.jpg" alt="Рис. 8.5" class="figure figure-8-5">
                <p>Необхідно знайти ще координати вектора \(\overrightarrow{BC}\), а також скалярний добуток векторів \(\overrightarrow{AC}\) і \(\overrightarrow{BC}\) та довжину вектора \(\overrightarrow{BC}\):</p>
                <p>\[
                    \overrightarrow{BC} = (6-1; 4-0; 2-5) = (5; 4; -3),
                \]</p>
                <p>\[
                    \overrightarrow{AC} \cdot \overrightarrow{BC} = 3 \cdot 5 + 6 \cdot 4 + (-2) \cdot (-3) = 15 + 24 + 6 = 45,
                \]</p>
                <p>\[
                    |\overrightarrow{BC}| = \sqrt{5^2 + 4^2 + (-3)^2} = \sqrt{25 + 16 + 9} = \sqrt{50} = 5\sqrt{2}.
                \]</p>
                <p>Підставляємо знайдені значення:</p>
                <p>\[
                    \text{пр}_{\overrightarrow{BC}} \overrightarrow{AC} = \frac{45}{5\sqrt{2}} = \frac{9}{\sqrt{2}}.
                \]</p>
                <p><strong>Відповідь.</strong> 1) \(\angle A \approx 79^\circ\); 2) \(\text{пр}_{\overrightarrow{AC}} \overrightarrow{AB} = \frac{4}{7}\); 3) \(\text{пр}_{\overrightarrow{BC}} \overrightarrow{AC} = \frac{9}{\sqrt{2}}\).</p>



    <p style="text-align:center; color:#ffb300; font-weight:bold;">Робота сили</p>

   <p>Формула для обчислення роботи \(A\), виконаної сталою силою \(\vec{F}\) при переміщенні матеріальної точки на шляху \(|\vec{s}|\), виглядає так:</p>
<p class="math-notation-centered">\[
    A = \vec{F} \cdot \vec{s} = |\vec{F}| \cdot |\vec{s}| \cdot \cos \angle (\vec{F}; \vec{s}), \quad (8.10)
\]</p>
<p>де \(\vec{F} \cdot \vec{s}\) – скалярний добуток вектора сили і вектора переміщення, \(|\vec{F}|\) – величина сили, \(|\vec{s}|\) – довжина шляху (вектора переміщення), \(\angle (\vec{F}; \vec{s})\) – кут між вектором сили і вектором переміщення.</p>
<p><em><span style="font-style: italic; color: #ff9900;">Примітка.</em></span> З урахуванням того, що \(\angle (\vec{F}; \vec{s})\) є єдиним кутом, який враховується в обчисленні роботи сили, і він визначається лише між двома векторами: силою та переміщенням. Якщо ж є кілька сил, то кут визначається між рівнодійною силою та шляхом.</p>

<p><span class="example-title">Приклад 8.7.</span> <span class="example-condition">Обчислити роботу рівнодійної сили \(\vec{F}\), яка є сумою трьох сил \(\vec{F_1} = (3;-4;5)\), \(\vec{F_2} = (2;1;-4)\), \(\vec{F_3} = (-1;6;2)\), прикладених до матеріальної точки, що переміщається прямолінійно від точки \(M_1(4;2;-3)\) до точки \(M_2(7;4;1)\).</span></p>
<p class="solution" style="text-align: center;"><strong>Розв’язання</strong></p>
<p> Знайдемо рівнодійну силу \(\vec{F}\). Рівнодійна сила \(\vec{F}\) – це векторна сума всіх сил:</p>
<p>\[
    \vec{F} = \vec{F_1} + \vec{F_2} + \vec{F_3} = (3;-4;5) + (2;1;-4) + (-1;6;2) = (4;3;3).
\]</p>
<p>Знайдемо вектор переміщення \(\vec{s}\). Вектор переміщення \(\vec{s}\) – це різниця координат точок \(M_1\) і \(M_2\):</p>
<p>\[
    \vec{s} = \overrightarrow{M_1 M_2} = (7;4;1) - (4;2;-3) = (3;2;4).
\]</p>
<p>Обчислимо роботу. Робота \(A\) визначається як скалярний добуток рівнодійної сили \(\vec{F}\) і вектора переміщення \(\vec{s}\) прямолінійного руху:</p>
<p>\[
    A = \vec{F} \cdot \vec{s}.
\]</p>
<p>Виконуємо обчислення скалярного добутку:</p>
<p>\[
    A = (4;3;3) \cdot (3;2;4) = 4 \cdot 3 + 3 \cdot 2 + 3 \cdot 4 = 12 + 6 + 12 = 30.
\]</p>
<p>Отже, робота, виконана рівнодійною силою:</p>
<p><strong>Відповідь.</strong> \(A = 30\) одиниць роботи. </p>


</details>



        </div>
    </div>

    <div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 class="glow-title">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Скалярний добуток векторів(геометричних, координатами)</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Скалярний добуток векторів у просторі(приклади)</h3>
                </div>
                            </div>
        </div>
    </div>

    <div id="videoPlayerModal1" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn1">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer1" width="100%" src="https://www.youtube.com/embed/_mWtjasS3QE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="videoPlayerModal2" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoPlayerBtn2">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="video-player-container">
                <iframe id="youtubePlayer2" width="100%" src="https://www.youtube.com/embed/8Ev1wHymWuY" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

       <div id="questionsModal" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeQuestionsBtn">× Закрити</button>
    </div>
    <div class="modal-content">

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    1. Що називають скалярним добутком двох векторів?
                </div>
                <div class="card-back">
                    <p>Число, яке дорівнює сумі добутків їхніх однойменних координат:<br>
                    \(\vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    2. Яке позначення має скалярний добуток?
                </div>
                <div class="card-back">
                   <p>Позначають через крапку «\(\cdot\)»: \(\vec{a} \cdot \vec{b}\) або просто \(ab\).</p>

                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    3. Що таке скалярний квадрат вектора?
                </div>
                <div class="card-back">
                    <p>Це скалярний добуток вектора самого на себе:<br>
                    \(\vec{a} \cdot \vec{a} = |\vec{a}|^2.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    4. Як обчислити модуль вектора через скалярний добуток?
                </div>
                <div class="card-back">
                    <p>\(|\vec{a}| = \sqrt{\vec{a} \cdot \vec{a}} = \sqrt{a^2}.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    5. Як формулюється геометричне означення скалярного добутку?
                </div>
                <div class="card-back">
                    <p>Скалярний добуток двох векторів дорівнює добутку їхніх довжин на косинус кута між ними:<br>
                    \(\vec{a} \cdot \vec{b} = |\vec{a}| |\vec{b}| \cos \varphi.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    6. Коли скалярний добуток дорівнює нулю?
                </div>
                <div class="card-back">
                    <p>Коли хоча б один із векторів нульовий або коли вектори перпендикулярні.</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    7. Назвіть три алгебраїчні властивості скалярного добутку.
                </div>
                <div class="card-back">
                    <p>
                        1. Комутативність: \(\vec{a} \cdot \vec{b} = \vec{b} \cdot \vec{a}\)<br>
                        2. Лінійність: \((\lambda \vec{a}) \cdot \vec{b} = \lambda (\vec{a} \cdot \vec{b})\)<br>
                        3. Дистрибутивність: \(\vec{a} \cdot (\vec{b} + \vec{c}) = \vec{a} \cdot \vec{b} + \vec{a} \cdot \vec{c}\)
                    </p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    8. Як залежить знак скалярного добутку від кута між векторами?
                </div>
                <div class="card-back">
                    <p>
                        Якщо \(\varphi\) гострий (0° &lt; \(\varphi\) &lt; 90°), то \(\vec{a} \cdot \vec{b} &gt; 0\).<br>
                        Якщо \(\varphi\) тупий (90° &lt; \(\varphi\) &lt; 180°), то \(\vec{a} \cdot \vec{b} &lt; 0\).
                    </p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    9. Яка умова перпендикулярності векторів через скалярний добуток?
                </div>
                <div class="card-back">
                    <p>\(\vec{a} \cdot \vec{b} = 0 \iff \vec{a} \perp \vec{b}.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    10. Як знайти косинус кута між двома векторами?
                </div>
                <div class="card-back">
                    <p>\(\cos \varphi = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| |\vec{b}|}.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    11. Формула для косинуса кута між векторами, що задані координатами у просторі.
                </div>
                <div class="card-back">
                    <p>\(\cos \varphi = \frac{a_x b_x + a_y b_y + a_z b_z}{\sqrt{a_x^2 + a_y^2 + a_z^2} \cdot \sqrt{b_x^2 + b_y^2 + b_z^2}}.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                <div class="card-front">
                    12. Формула для косинуса кута між векторами, що задані координатами на площині.
                </div>
                <div class="card-back">
                    <p>\(\cos \varphi = \frac{a_x b_x + a_y b_y}{\sqrt{a_x^2 + a_y^2} \cdot \sqrt{b_x^2 + b_y^2}}.\)</p>
                </div>
            </div>
        </div>

        <div class="question-card">
            <div class="card-inner">
                 <div class="card-front">
<p class="question-text">13. Як обчислити проекцію вектора \(\vec{a}\) на вектор \(\vec{b}\)?</p>
 </div>
                <div class="card-back">
                    <p>\(\text{пр}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|}.\)</p>
                </div>
            </div>
        </div>

    </div>
</div>


    <div id="trainerModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeTrainerBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <div class="trainer-container" id="trainerContent">
                <div class="question-number" id="questionNumber">Питання 1</div>
                <p class="trainer-question" id="trainerQuestion"></p>
                <div id="vectorDisplay" class="math-notation-centered"></div>
                <div class="answer-buttons" id="answerButtons"></div>
                <button class="submit-btn" id="submitAnswerBtn" disabled>Перевірити</button>
                <p id="feedback"></p>
            </div>
            <div id="completionScreen" class="completion-message hidden">
                <div class="completion-emoji"></div>
                <h2>Тестування завершено!</h2>
                <p>Молодець!</p>
                <button id="resetTrainerBtn">Спробувати ще раз</button>
            </div>
        </div>
    </div>

    <script>
              const modals = {
    theory: document.getElementById('theoryModal'),
    video: document.getElementById('videoModal'),
    questions: document.getElementById('questionsModal'),
    trainer: document.getElementById('trainerModal'),
    videoPlayer1: document.getElementById('videoPlayerModal1'),
    videoPlayer2: document.getElementById('videoPlayerModal2')
};

const buttons = {
    openTheory: document.getElementById('openTheoryBtn'),
    openVideo: document.getElementById('openVideoBtn'),
    openQuestions: document.getElementById('openQuestionsBtn'),
    openTrainer: document.getElementById('openTrainerBtn'),
    closeTheory: document.getElementById('closeTheoryBtn'),
    closeVideo: document.getElementById('closeVideoBtn'),
    closeQuestions: document.getElementById('closeQuestionsBtn'),
    closeTrainer: document.getElementById('closeTrainerBtn'),
    closeVideoPlayer1: document.getElementById('closeVideoPlayerBtn1'),
    closeVideoPlayer2: document.getElementById('closeVideoPlayerBtn2'),
    submitAnswer: document.getElementById('submitAnswerBtn')
};

const overlay = document.getElementById('modalOverlay');
const trainerContent = document.getElementById('trainerContent');
const questionNumber = document.getElementById('questionNumber');
const trainerQuestion = document.getElementById('trainerQuestion');
const vectorDisplay = document.getElementById('vectorDisplay');
const answerButtons = document.getElementById('answerButtons');
const feedback = document.getElementById('feedback');
const completionScreen = document.getElementById('completionScreen');
const resetTrainerBtn = document.getElementById('resetTrainerBtn');


function stopVideo(modal) {
    const iframe = modal.querySelector('iframe');
    if (iframe) {
        const src = iframe.src;
        iframe.src = ''; // Скидаємо src, щоб зупинити відтворення
        iframe.src = src; // Повертаємо src, щоб відео можна було відтворити знову
    }
}

        let currentQuestion = 1;
        let selectedAnswer = null;
        let incorrectAttempts = 0;
        const maxIncorrectAttempts = 3;
        let scrollPosition = 0;
        let correctAnswerValue = ''; // Store correct numerical or LaTeX

        function getRandomInt(min = -5, max = 5) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Обчислення НСД
function gcd(a, b) {
    a = Math.abs(a);
    b = Math.abs(b);
    while (b) {
        let temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}

      // Вибір відповіді
function selectAnswer(btn) {
    if (selectedAnswer) {
        selectedAnswer.classList.remove('selected');
    }
    selectedAnswer = btn;
    btn.classList.add('selected');
    buttons.submitAnswer.disabled = false;
    console.log('Answer selected:', btn.textContent);
}

       // Форматування відповіді
function formatAnswer(value, isRoot3) {
    if (Number.isInteger(value)) {
        return `${value}`;
    }
    const absValue = Math.abs(value);
    let numerator = Math.round(absValue * 2);
    let denominator = 2;
    const gcdValue = gcd(numerator, denominator);
    numerator /= gcdValue;
    denominator /= gcdValue;
    const sign = value < 0 ? '-' : '';
    const root = isRoot3 ? '\\sqrt{3}' : '\\sqrt{2}';
    if (denominator === 1) {
        return `${sign}${numerator}${root}`;
    }
    return `${sign}\\frac{${numerator}${root}}{${denominator}}`;
}

        // Рендеринг MathJax
function typesetMath(id, elements) {
    if (typeof MathJax === 'undefined') {
        console.error('Error: MathJax not loaded');
        return;
    }
    elements.forEach(element => {
        MathJax.typesetPromise([element]).catch(err => console.error('MathJax error:', err));
    });
}

        function waitForMathJax(callback, context = 'general', maxAttempts = 100, interval = 200) {
            let attempts = 0;
            const checkMathJax = setInterval(() => {
                if (typeof MathJax !== 'undefined' && typeof MathJax.typesetPromise === 'function') {
                    clearInterval(checkMathJax);
                    callback();
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkMathJax);
                    callback();
                }
                attempts++;
            }, interval);
        }

        function generateVector() {
    let vector;
    do {
        vector = [getRandomInt(-5, 5), getRandomInt(-5, 5), getRandomInt(-5, 5)];
    } while (vector[0] === 0 && vector[1] === 0 && vector[2] === 0); // Забезпечуємо ненульовий вектор
    return vector;
}

function generateQuestion1() {
    const a = generateVector();
    const b = generateVector();
    const dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
    correctAnswerValue = dot.toString();

    // Генерація чотирьох унікальних варіантів відповідей
    const options = new Set([dot]); // Починаємо з правильної відповіді
    while (options.size < 4) {
        const offset = getRandomInt(-5, 5);
        if (offset !== 0) { // Виключаємо додавання 0, щоб не дублювати правильну відповідь
            options.add(dot + offset);
        }
    }
    const shuffled = shuffleArray([...options]); // Перемішуємо унікальні відповіді

    // Оновлення елементів UI
    questionNumber.textContent = 'Питання 1';
    trainerQuestion.textContent = 'Обчислити скалярний добуток:';
    vectorDisplay.innerHTML = `\\(\\vec{a} = (${a[0]}, ${a[1]}, ${a[2]}), \\vec{b} = (${b[0]}, ${b[1]}, ${b[2]})\\)`;

    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = opt;
        btn.dataset.correct = (opt == dot).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        answerButtons.appendChild(btn);
    });

    submitAnswerBtn.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';

    typesetMath('q1', [vectorDisplay]);
}
        // Question 2: Cos theta
 function generateQuestion2() {
    const p = generateVector(); // Вектор p (px, py, pz)
    const q = generateVector(); // Вектор q (qx, qy, qz)
    const dot = p[0] * q[0] + p[1] * q[1] + p[2] * q[2]; // Скалярний добуток
    correctAnswerValue = dot.toString();
    const options = new Set([dot]);
    while (options.size < 4) {
        const offset = getRandomInt(-5, 5);
        if (offset !== 0) {
            options.add(dot + offset);
        }
    }
    const shuffled = shuffleArray([...options]);

    function formatVector(v) {
        let terms = [];
        let first = true;
        for (let i = 0; i < 3; i++) {
            const coeff = v[i];
            if (coeff === 0) continue;
            let term = '';
            const absCoeff = Math.abs(coeff);
            const isPositive = coeff > 0;
            if (first) {
                if (!isPositive) {
                    term += '-';
                }
            } else {
                term += isPositive ? ' + ' : ' - ';
            }
            if (absCoeff !== 1) {
                term += absCoeff;
            }
            term += ['\\vec{i}', '\\vec{j}', '\\vec{k}'][i];
            terms.push(term);
            first = false;
        }
        if (terms.length === 0) return '0';
        return terms.join('');
    }

    const pFormatted = formatVector(p);
    const qFormatted = formatVector(q);

    questionNumber.textContent = 'Питання 2';
    trainerQuestion.textContent = 'Обчислити скалярний добуток:';
    vectorDisplay.innerHTML = `\\(\\vec{p} = ${pFormatted}, \\vec{q} = ${qFormatted}\\)`;
    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = opt;
        btn.dataset.correct = (opt == dot).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        answerButtons.appendChild(btn);
    });
    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    typesetMath('q2', [vectorDisplay]);
}

        // Question 3: Orthogonal? (yes/no)
function generateQuestion3() {
    let a, b, dot, unknownValue, unknownVar, unknownIndex, zVector;
    do {
        a = generateVector();
        b = generateVector();
        // Випадково обираємо змінну: x (0), y (1), z (2)
        unknownIndex = Math.floor(Math.random() * 3); // 0 (x), 1 (y), 2 (z)
        unknownVar = ['x', 'y', 'z'][unknownIndex];
        // Випадково обираємо, в якому векторі буде змінна
        zVector = Math.random() < 0.5 ? 'a' : 'b';
        // Цільовий скалярний добуток від -10 до 10, окрім 0
        dot = getRandomInt(-10, 10);
        while (dot === 0) {
            dot = getRandomInt(-10, 10);
        }
        // Обчислюємо значення невідомої змінної
        if (zVector === 'a') {
            if (unknownIndex === 0) unknownValue = (dot - a[1] * b[1] - a[2] * b[2]) / b[0]; // x = a_x
            else if (unknownIndex === 1) unknownValue = (dot - a[0] * b[0] - a[2] * b[2]) / b[1]; // y = a_y
            else unknownValue = (dot - a[0] * b[0] - a[1] * b[1]) / b[2]; // z = a_z
        } else {
            if (unknownIndex === 0) unknownValue = (dot - a[1] * b[1] - a[2] * b[2]) / a[0]; // x = b_x
            else if (unknownIndex === 1) unknownValue = (dot - a[0] * b[0] - a[2] * b[2]) / a[1]; // y = b_y
            else unknownValue = (dot - a[0] * b[0] - a[1] * b[1]) / a[2]; // z = b_z
        }
    } while (!Number.isInteger(unknownValue) || unknownValue < -5 || unknownValue > 5 || 
             (zVector === 'a' && b[unknownIndex] === 0) || (zVector === 'b' && a[unknownIndex] === 0));

    correctAnswerValue = unknownValue.toString();

    const options = new Set([unknownValue]);
    while (options.size < 4) {
        const offset = getRandomInt(-5, 5);
        if (offset !== 0 && offset !== unknownValue) {
            options.add(unknownValue + offset);
        }
    }
    const shuffled = shuffleArray([...options]);

    questionNumber.textContent = 'Питання 3';
    // Умова: текст + формули через MathJax
    trainerQuestion.innerHTML = `Знайти значення \\(\\small ${unknownVar}\\), при якому \\(\\small \\vec{a} \\cdot \\vec{b} = ${dot}\\):`;
    // Форматуємо вектори з урахуванням невідомої змінної
    const aDisplay = zVector === 'a' ? 
        (unknownIndex === 0 ? `${unknownVar}, ${a[1]}, ${a[2]}` : 
         unknownIndex === 1 ? `${a[0]}, ${unknownVar}, ${a[2]}` : `${a[0]}, ${a[1]}, ${unknownVar}`) :
        `${a[0]}, ${a[1]}, ${a[2]}`;
    const bDisplay = zVector === 'b' ? 
        (unknownIndex === 0 ? `${unknownVar}, ${b[1]}, ${b[2]}` : 
         unknownIndex === 1 ? `${b[0]}, ${unknownVar}, ${b[2]}` : `${b[0]}, ${b[1]}, ${unknownVar}`) :
        `${b[0]}, ${b[1]}, ${b[2]}`;
    vectorDisplay.innerHTML = `\\(\\vec{a} = (${aDisplay}), \\vec{b} = (${bDisplay})\\)`;

    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = opt;
        btn.dataset.correct = (opt == unknownValue).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        answerButtons.appendChild(btn);
    });

    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';

    typesetMath('q3', [trainerQuestion, vectorDisplay]);
}

function generateQuestion4() {
    console.log('generateQuestion4 started');
    let aDisplay, bDisplay, exact_dot, answerDisplay;
    const angles = [
        { deg: 30, rad: "\\frac{\\pi}{6}", cos: { num: 1, den: 2, root: 3 }, displayCos: "\\frac{\\sqrt{3}}{2}" },
        { deg: 45, rad: "\\frac{\\pi}{4}", cos: { num: 1, den: 2, root: 2 }, displayCos: "\\frac{\\sqrt{2}}{2}" },
        { deg: 60, rad: "\\frac{\\pi}{3}", cos: { num: 1, den: 2, root: 0 }, displayCos: "\\frac{1}{2}" },
        { deg: 120, rad: "\\frac{2\\pi}{3}", cos: { num: -1, den: 2, root: 0 }, displayCos: "-\\frac{1}{2}" },
        { deg: 135, rad: "\\frac{3\\pi}{4}", cos: { num: -1, den: 2, root: 2 }, displayCos: "-\\frac{\\sqrt{2}}{2}" },
        { deg: 150, rad: "\\frac{5\\pi}{6}", cos: { num: -1, den: 2, root: 3 }, displayCos: "-\\frac{\\sqrt{3}}{2}" }
    ];
    const rootFactors = [1, 2, 3, 4, 5];
    // Вибір кута
    const angleRad = angles[Math.floor(Math.random() * angles.length)];
    const useRadians = Math.random() < 0.5;
    const angleDisplay = useRadians ? angleRad.rad : `${angleRad.deg}^\\circ`;
    const cosValue = angleRad.cos;
    const sign = cosValue.num;
    const cos_root = cosValue.root;
    const cos_den = cosValue.den;
    // Генерація довжин векторів
    if (angleRad.deg === 60 || angleRad.deg === 120) {
        const even = getRandomInt(1, 5) * 2;
        const other = getRandomInt(1, 10);
        if (Math.random() < 0.5) {
            aDisplay = even;
            bDisplay = other;
        } else {
            aDisplay = other;
            bDisplay = even;
        }
        exact_dot = sign * (even * other) / cos_den;
    } else if (angleRad.deg === 45 || angleRad.deg === 135) {
        const factor = rootFactors[Math.floor(Math.random() * rootFactors.length)];
        const coeff = factor * 2;
        const sqrtDisplay = coeff === 1 ? '\\sqrt{2}' : `${coeff}\\sqrt{2}`;
        const other = getRandomInt(1, 5);
        if (Math.random() < 0.5) {
            aDisplay = sqrtDisplay;
            bDisplay = other;
        } else {
            aDisplay = other;
            bDisplay = sqrtDisplay;
        }
        exact_dot = sign * coeff * other * (cos_root / cos_den);
    } else {
        const factor = rootFactors[Math.floor(Math.random() * rootFactors.length)];
        const multiple = getRandomInt(1, 5) * 2;
        const sqrtDisplay = factor === 1 ? '\\sqrt{3}' : `${factor}\\sqrt{3}`;
        if (Math.random() < 0.5) {
            aDisplay = sqrtDisplay;
            bDisplay = multiple;
        } else {
            aDisplay = multiple;
            bDisplay = sqrtDisplay;
        }
        exact_dot = sign * multiple * factor * (cos_root / cos_den);
    }
    const abs_dot = Math.abs(exact_dot);
    const int_dot = Math.round(abs_dot);
    answerDisplay = exact_dot < 0 ? `-${int_dot}` : `${int_dot}`;
    correctAnswerValue = answerDisplay;
    // Генерація неправильних варіантів
    const options = new Set([answerDisplay]);
    const currentVal = parseInt(answerDisplay.replace('-', ''));
    const isNegative = answerDisplay.startsWith('-');
    while (options.size < 4) {
        const offset = getRandomInt(-5, 5);
        if (offset === 0) continue;
        let newVal = currentVal + offset;
        if (newVal < 0) newVal = -newVal;
        const newAbs = Math.abs(newVal);
        const newOption = (isNegative ? (Math.random() < 0.5 ? `-${newAbs}` : `${newAbs}`) : `${newAbs}`);
        if (!options.has(newOption) && newOption !== '0') {
            options.add(newOption);
        }
    }
    const shuffled = shuffleArray([...options]);
    // Оновлення UI
    questionNumber.textContent = 'Питання 4';
    trainerQuestion.innerHTML = `Обчислити скалярний добуток векторів \\(\\small \\vec{a}\\) і \\(\\small \\vec{b}\\), якщо \\(\\small |\\vec{a}| = ${aDisplay}\\), \\(\\small |\\vec{b}| = ${bDisplay}\\), \\(\\small \\varphi = ${angleDisplay}\\):`;
    vectorDisplay.innerHTML = '';
    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.innerHTML = `\\(\\small ${opt}\\)`;
        btn.dataset.correct = (opt === answerDisplay).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            selectAnswer(btn);
        });
        answerButtons.appendChild(btn);
    });
    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    feedback.style.display = 'none';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
    console.log('Question 4 generated:', { aDisplay, bDisplay, angleDisplay, exact_dot, answerDisplay });
    waitForMathJax(() => {
        typesetMath('q4', [trainerQuestion, ...answerButtons.querySelectorAll('.answer-btn')]);
        console.log('MathJax typesetting completed for q4');
    }, 'q4');
}

function generateQuestion5() {
    console.log('Generating Q5');
    let a_orig, b_orig, nValue, i, j, constTerm, denom;
    do {
        // Випадково обираємо різні позиції для n в a та -n в b
        i = Math.floor(Math.random() * 3); // Позиція n в a
        j = Math.floor(Math.random() * 3); // Позиція -n в b
        while (i === j) {
            j = Math.floor(Math.random() * 3); // Забезпечуємо різні позиції
        }
        // Генеруємо оригінальні координати (числа)
        a_orig = [getRandomInt(-5, 5), getRandomInt(-5, 5), getRandomInt(-5, 5)];
        b_orig = [getRandomInt(-5, 5), getRandomInt(-5, 5), getRandomInt(-5, 5)];
        // Обчислюємо constTerm: сума a[k]*b[k] для k != i та k != j
        constTerm = 0;
        for (let k = 0; k < 3; k++) {
            if (k !== i && k !== j) {
                constTerm += a_orig[k] * b_orig[k];
            }
        }
        // denom = b_orig[i] - a_orig[j]
        denom = b_orig[i] - a_orig[j];
        if (denom === 0) continue;
        if (constTerm % denom !== 0) continue;
        nValue = - (constTerm / denom);
        if (!Number.isInteger(nValue) || Math.abs(nValue) > 20 || nValue === 0) continue;
        // Перевіряємо dot з n та -n
        const a_check = [...a_orig];
        const b_check = [...b_orig];
        a_check[i] = nValue;
        b_check[j] = -nValue;
        const dotCheck = a_check[0]*b_check[0] + a_check[1]*b_check[1] + a_check[2]*b_check[2];
        if (dotCheck !== 0) continue;
        break;
    } while (true);

    correctAnswerValue = nValue.toString();

    // Display: placeholders 'n' та '-n', оригінальні числа зі знаками
    const aDisplay = a_orig.map((val, idx) => idx === i ? 'n' : val).join(', ');
    const bDisplay = b_orig.map((val, idx) => idx === j ? '-n' : val).join(', ');

    // 4 опції: правильна + distractors (20, 4, -20), додати random якщо дубль
    const distractors = ['20', '4', '-20'];
    const options = new Set([nValue.toString(), ...distractors]);
    while (options.size < 4) {
        const offset = getRandomInt(-10, 10);
        const newOpt = (nValue + offset).toString();
        if (newOpt !== nValue.toString() && !options.has(newOpt)) {
            options.add(newOpt);
        }
    }
    const shuffled = shuffleArray([...options]);
    console.log('Q5 options:', options, 'shuffled:', shuffled, 'correct:', nValue);

    questionNumber.textContent = 'Питання 5';
    trainerQuestion.innerHTML = `Знайти значення \\(\\small n\\), при якому вектори \\(\\small \\vec{a}\\) і \\(\\small \\vec{b}\\) будуть взаємно перпендикулярними:`;
    vectorDisplay.innerHTML = `\\(\\vec{a} = (${aDisplay}), \\vec{b} = (${bDisplay})\\)`;

    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        const optStr = opt;
        btn.innerHTML = `\\(\\small ${optStr}\\)`;
        btn.dataset.correct = (opt == nValue.toString()).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); selectAnswer(btn); });
        answerButtons.appendChild(btn);
    });

    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    feedback.style.display = 'none';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';

    waitForMathJax(() => {
        typesetMath('q5', [trainerQuestion, vectorDisplay, ...answerButtons.querySelectorAll('.answer-btn')]);
        console.log('MathJax Q5 done');
    }, 'q5');
}

function generateQuestion6() {
    console.log('Generating Q6');
    let a, b, dot, aLength, bLength, cosPhi, angleDeg, answerDisplay;
    const tabularAngles = [
        { deg: 0, cos: 1 },
        { deg: 30, cos: Math.sqrt(3) / 2 },
        { deg: 45, cos: Math.sqrt(2) / 2 },
        { deg: 60, cos: 0.5 },
        { deg: 90, cos: 0 },
        { deg: 120, cos: -0.5 },
        { deg: 135, cos: -Math.sqrt(2) / 2 },
        { deg: 150, cos: -Math.sqrt(3) / 2 },
        { deg: 180, cos: -1 }
    ];

    do {
        // Генеруємо вектори
        a = generateVector(); // [ax, ay, az]
        b = generateVector(); // [bx, by, bz]

        // Обчислюємо скалярний добуток
        dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
        // Обчислюємо довжини
        aLength = Math.sqrt(a[0] ** 2 + a[1] ** 2 + a[2] ** 2);
        bLength = Math.sqrt(b[0] ** 2 + b[1] ** 2 + b[2] ** 2);

        // Перевіряємо, що вектори не нульові
        if (aLength === 0 || bLength === 0) continue;

        // Обчислюємо косинус кута
        cosPhi = dot / (aLength * bLength);
        cosPhi = Math.max(-1, Math.min(1, cosPhi)); // Обмежуємо через похибки

        // Перевіряємо, чи косинус є табличним
        let isTabular = false;
        for (const angle of tabularAngles) {
            if (Math.abs(cosPhi - angle.cos) < 1e-6) {
                isTabular = true;
                angleDeg = angle.deg;
                answerDisplay = `${angle.deg}^\\circ`;
                break;
            }
        }

        // Якщо нетабличний, форматуємо як arccos з числовим чисельником і знаменником як добуток коренів
        if (!isTabular) {
            const aSquaredSum = a[0] ** 2 + a[1] ** 2 + a[2] ** 2;
            const bSquaredSum = b[0] ** 2 + b[1] ** 2 + b[2] ** 2;
            answerDisplay = `\\arccos \\frac{${dot}}{\\sqrt{${aSquaredSum}} \\cdot \\sqrt{${bSquaredSum}}}`;
        }
    } while (!answerDisplay || isNaN(cosPhi));

    correctAnswerValue = answerDisplay;

    // Генерація неправильних варіантів
    const options = new Set([answerDisplay]);
    const tabularAnswer = answerDisplay.includes('^\\circ');

    if (tabularAnswer) {
        const correctDeg = parseInt(answerDisplay);
        const otherAngles = tabularAngles
            .filter(angle => angle.deg !== correctDeg)
            .map(angle => `${angle.deg}^\\circ`);

        while (options.size < 4 && otherAngles.length > 0) {
            const randomAngle = otherAngles.splice(Math.floor(Math.random() * otherAngles.length), 1)[0];
            if (!options.has(randomAngle)) {
                options.add(randomAngle);
            }
        }

        if (options.size < 4) {
            const cosOption = `\\cos ${correctDeg}^\\circ`;
            if (!options.has(cosOption)) {
                options.add(cosOption);
            }
        }

        while (options.size < 4) {
            const offset = getRandomInt(-10, 10, [0]);
            const newAngle = `${correctDeg + offset}^\\circ`;
            if (!options.has(newAngle)) {
                options.add(newAngle);
            }
        }
    } else {
        // Для нетабличних кутів: чисельник — число, знаменник — добуток коренів
        const aSquaredSum = a[0] ** 2 + a[1] ** 2 + a[2] ** 2;
        const bSquaredSum = b[0] ** 2 + b[1] ** 2 + b[2] ** 2;
        const baseFormula = (num) => `\\arccos \\frac{${num}}{\\sqrt{${aSquaredSum}} \\cdot \\sqrt{${bSquaredSum}}}`;
        const cosOption = `\\cos \\frac{${dot}}{\\sqrt{${aSquaredSum}} \\cdot \\sqrt{${bSquaredSum}}}`;

        // Генеруємо distractors з перевіркою на унікальність та відмінність від правильної
        let addedCount = 0;
        // Спочатку додаємо cosOption, якщо унікальний
        if (!options.has(cosOption)) {
            options.add(cosOption);
            addedCount++;
        }

        // Генеруємо arccos з offsets
        let attempts = 0;
        while (addedCount < 3 && attempts < 20) { // обмежуємо спроби, щоб уникнути нескінченного циклу
            const offset = getRandomInt(-5, 5, [0]);
            const wrongNum = dot + offset;
            const wrongOption = baseFormula(wrongNum);
            if (wrongOption !== answerDisplay && !options.has(wrongOption)) {
                options.add(wrongOption);
                addedCount++;
            }
            attempts++;
        }

        // Якщо все ще менше 4, додаємо більше з більшим offset
        while (options.size < 4) {
            let offset = getRandomInt(-10, 10, [0]);
            let wrongNum = dot + offset;
            let newOption = baseFormula(wrongNum);
            if (newOption !== answerDisplay && !options.has(newOption)) {
                options.add(newOption);
            } else {
                // Якщо співпадає, змінюємо число в чисельнику вручну
                wrongNum = dot + offset + 1; // додаємо +1, щоб зробити неправильним
                newOption = baseFormula(wrongNum);
                if (!options.has(newOption)) {
                    options.add(newOption);
                }
            }
        }
    }

    const shuffled = shuffleArray([...options]);
    console.log('Q6 options:', options, 'shuffled:', shuffled, 'correct:', answerDisplay);

    // Форматування векторів (0, 1, -1 відображаємо явно)
    const formatComponent = (value) => value.toString();
    const aDisplay = a.map(formatComponent).join(', ');
    const bDisplay = b.map(formatComponent).join(', ');

    questionNumber.textContent = 'Питання 6';
    trainerQuestion.innerHTML = `Визначити кут між векторами \\(\\small \\vec{a}\\) і \\(\\small \\vec{b}\\):`;
    vectorDisplay.innerHTML = `\\(\\vec{a} = (${aDisplay}), \\; \\vec{b} = (${bDisplay})\\)`;

    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.innerHTML = `\\(\\small ${opt}\\)`;
        btn.dataset.correct = (opt === answerDisplay).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            selectAnswer(btn);
        });
        answerButtons.appendChild(btn);
    });

    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    feedback.style.display = 'none';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';

    console.log('Question 6 generated:', { a, b, dot, aLength, bLength, cosPhi, answerDisplay });
    waitForMathJax(() => {
        typesetMath('q6', [trainerQuestion, vectorDisplay, ...answerButtons.querySelectorAll('.answer-btn')]);
        console.log('MathJax Q6 done');
    }, 'q6');
}

function generateQuestion7() {
    console.log('Generating Q7');
    let A, B, C, AB, AC, dot, ACLength, projection, answerDisplay;

    do {
        // Генеруємо координати точок A, B, C
        A = generateVector(); // [x1, y1, z1]
        B = generateVector(); // [x2, y2, z2]
        C = generateVector(); // [x3, y3, z3]

        // Обчислюємо вектори AB і AC
        AB = [B[0] - A[0], B[1] - A[1], B[2] - A[2]];
        AC = [C[0] - A[0], C[1] - A[1], C[2] - A[2]];

        // Обчислюємо скалярний добуток
        dot = AB[0] * AC[0] + AB[1] * AC[1] + AB[2] * AC[2];

        // Обчислюємо довжину AC
        ACLength = Math.sqrt(AC[0] ** 2 + AC[1] ** 2 + AC[2] ** 2);

        // Перевіряємо, що AC не нульовий
        if (ACLength === 0) continue;

        // Обчислюємо проекцію
        projection = dot / ACLength;

        // Форматуємо відповідь
        const denomSquared = AC[0] ** 2 + AC[1] ** 2 + AC[2] ** 2;
        const isPerfectSquare = Number.isInteger(Math.sqrt(denomSquared));
        const gcd = (a, b) => (b === 0 ? Math.abs(a) : gcd(b, a % b));
        const num = Math.round(dot * 1000); // Для уникнення похибок
        const denom = Math.round(ACLength * 1000);
        const divisor = gcd(num, denom);
        const simplifiedNum = num / divisor;
        const simplifiedDenom = denom / divisor;

        if (isPerfectSquare) {
            answerDisplay = `\\frac{${Math.round(simplifiedNum / 1000)}}{\\sqrt{${denomSquared}}}`;
            // Спрощуємо, якщо знаменник — ціле число
            if (simplifiedDenom === 1000) {
                answerDisplay = `\\frac{${Math.round(simplifiedNum / 1000)}}{${Math.sqrt(denomSquared)}}`;
            }
        } else {
            answerDisplay = `\\frac{${Math.round(simplifiedNum / 1000)}}{\\sqrt{${denomSquared}}}`;
        }
    } while (!answerDisplay);

    correctAnswerValue = answerDisplay;

    // Генерація неправильних варіантів
    const options = new Set([answerDisplay]);
    const denomSquared = AC[0] ** 2 + AC[1] ** 2 + AC[2] ** 2;
    const isPerfectSquare = Number.isInteger(Math.sqrt(denomSquared));
    const distractors = [
        `\\frac{${Math.round(dot + getRandomInt(-3, 3, [0]))}}{\\sqrt{${denomSquared}}}`,
        `\\frac{${Math.round(dot + getRandomInt(-5, 5, [0, -3, 3]))}}{\\sqrt{${denomSquared}}}`,
        `\\frac{${dot}}{\\sqrt{${denomSquared + getRandomInt(-5, 5, [0])}}}`
    ];

    // Якщо знаменник — ціле число, спрощуємо неправильні відповіді
    if (isPerfectSquare) {
        distractors[0] = `\\frac{${Math.round(dot + getRandomInt(-3, 3, [0]))}}{${Math.sqrt(denomSquared)}}`;
        distractors[1] = `\\frac{${Math.round(dot + getRandomInt(-5, 5, [0, -3, 3]))}}{${Math.sqrt(denomSquared)}}`;
        distractors[2] = `\\frac{${dot}}{${Math.sqrt(denomSquared + getRandomInt(-5, 5, [0]))}}}`;
    }

    distractors.forEach(d => {
        if (options.size < 4 && !options.has(d)) {
            options.add(d);
        }
    });

    while (options.size < 4) {
        const offset = getRandomInt(-5, 5, [0, -3, 3]);
        const newOption = isPerfectSquare
            ? `\\frac{${dot + offset}}{${Math.sqrt(denomSquared)}}`
            : `\\frac{${dot + offset}}{\\sqrt{${denomSquared}}}`;
        if (!options.has(newOption)) {
            options.add(newOption);
        }
    }

    const shuffled = shuffleArray([...options]);
    console.log('Q7 options:', options, 'shuffled:', shuffled, 'correct:', answerDisplay);

    // Форматування координат
    const formatComponent = (value) => value.toString();
    const ADisplay = A.map(formatComponent).join(', ');
    const BDisplay = B.map(formatComponent).join(', ');
    const CDisplay = C.map(formatComponent).join(', ');

    questionNumber.textContent = 'Питання 7';
    trainerQuestion.innerHTML = `Задано координати точок \\(\\small A(${ADisplay})\\), \\(\\small B(${BDisplay})\\) і \\(\\small C(${CDisplay})\\). Знайти проекцію вектора \\(\\small \\vec{AB}\\) на вектор \\(\\small \\vec{AC}\\).`;
    vectorDisplay.innerHTML = '';

    answerButtons.innerHTML = '';
    shuffled.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.innerHTML = `\\(\\small ${opt}\\)`;
        btn.dataset.correct = (opt === answerDisplay).toString();
        btn.addEventListener('click', () => selectAnswer(btn));
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            selectAnswer(btn);
        });
        answerButtons.appendChild(btn);
    });

    buttons.submitAnswer.disabled = true;
    selectedAnswer = null;
    feedback.textContent = '';
    feedback.className = 'feedback';
    feedback.style.display = 'none';
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';

    console.log('Question 7 generated:', { A, B, C, AB, AC, dot, ACLength, projection, answerDisplay });
    waitForMathJax(() => {
        typesetMath('q7', [trainerQuestion, vectorDisplay, ...answerButtons.querySelectorAll('.answer-btn')]);
        console.log('MathJax Q7 done');
    }, 'q7');
}

function generateQuestion() {
    console.log('generateQuestion called, currentQuestion:', currentQuestion, 'incorrectAttempts:', incorrectAttempts);
    if (currentQuestion === 1) {
        console.log('Calling generateQuestion1');
        generateQuestion1();
    } else if (currentQuestion === 2) {
        console.log('Calling generateQuestion2');
        generateQuestion2();
    } else if (currentQuestion === 3) {
        console.log('Calling generateQuestion3');
        generateQuestion3();
    } else if (currentQuestion === 4) {
        console.log('Calling generateQuestion4');
        generateQuestion4();
    } else if (currentQuestion === 5) {
        console.log('Calling generateQuestion5');
        generateQuestion5();
    } else if (currentQuestion === 6) {
        console.log('Calling generateQuestion6');
        generateQuestion6();
    } else if (currentQuestion === 7) {
        console.log('Calling generateQuestion7');
        generateQuestion7();
    } else {
        console.log('Showing completion screen');
        trainerContent.style.display = 'none';
        completionScreen.classList.remove('hidden');
        typesetMath('completion', [completionScreen]);
    }
}

if (buttons.submitAnswer) {
    buttons.submitAnswer.addEventListener('click', () => {
        console.log('Submit button clicked, selectedAnswer:', selectedAnswer);
        if (selectedAnswer) {
            const isCorrect = selectedAnswer.dataset.correct === 'true';
            feedback.textContent = isCorrect ? '✓ Правильно! Молодець!' : '✗ Неправильно. Спробуй ще раз!';
            feedback.className = 'feedback show' + (isCorrect ? ' correct' : ' incorrect');
            feedback.style.display = 'flex';
            console.log('Feedback set:', feedback.textContent);
            buttons.submitAnswer.disabled = true;
            setTimeout(() => {
                feedback.className = 'feedback';
                feedback.style.display = 'none';
                if (isCorrect) {
                    console.log('Correct answer, currentQuestion before increment:', currentQuestion);
                    incorrectAttempts = 0;
                    currentQuestion++;
                    console.log('Correct answer, currentQuestion after increment:', currentQuestion);
                    generateQuestion();
                } else {
                    incorrectAttempts++;
                    console.log('Incorrect answer, attempts:', incorrectAttempts, 'currentQuestion:', currentQuestion);
                    console.log('Regenerating question');
                    if (currentQuestion === 1) {
                        generateQuestion1();
                    } else if (currentQuestion === 2) {
                        generateQuestion2();
                    } else if (currentQuestion === 3) {
                        generateQuestion3();
                    } else if (currentQuestion === 4) {
                        generateQuestion4();
                    } else if (currentQuestion === 5) {
                        generateQuestion5();
                    } else if (currentQuestion === 6) {
                        generateQuestion6();
                    } else if (currentQuestion === 7) {
                        generateQuestion7();
                    }
                }
            }, 2000);
        } else {
            console.error('Error: No answer selected');
        }
    });
}

buttons.openTrainer.addEventListener('click', () => {
    openModal(modals.trainer);
    currentQuestion = 1;
    generateQuestion1();
});
// Open/close functions
function openModal(modal) {
    overlay.style.display = 'block';
    modal.style.display = 'flex';
    modal.classList.add('show');
    scrollPosition = window.pageYOffset;
    document.body.classList.add('modal-open');
    document.body.style.top = `-${scrollPosition}px`;
}
function closeModal(modal) {
    modal.classList.remove('show');
    modal.classList.add('hide');
    if (modal.id.includes('videoPlayer')) {
        stopVideo(modal);
    }
    modal.addEventListener('transitionend', function handler() {
        modal.style.display = 'none';
        modal.classList.remove('hide');
        modal.style.visibility = 'visible'; // Скидаємо для наступного відкриття
        if (modal.id.includes('videoPlayer')) {
            openModal(modals.video);
        } else {
            overlay.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo(0, scrollPosition);
        }
        modal.removeEventListener('transitionend', handler);
    }, { once: true });
    // Додали: Блокуємо body скрол одразу
    if (!modal.id.includes('videoPlayer')) {
        document.body.style.overflow = 'auto';
    }
}
// Event listeners similar to sample
buttons.openTheory.addEventListener('click', () => openModal(modals.theory));
buttons.openVideo.addEventListener('click', () => openModal(modals.video));
buttons.openQuestions.addEventListener('click', () => openModal(modals.questions));
buttons.openTrainer.addEventListener('click', () => {
    openModal(modals.trainer);
    currentQuestion = 1;
    generateQuestion1();
});
// Close buttons
Object.keys(buttons).forEach(key => {
    if (key.includes('close')) {
        buttons[key].addEventListener('click', () => {
            const modalId = key.replace('close', '').toLowerCase().replace('btn', '');
            const modalKey = modalId.includes('videoplayer') ? `videoPlayer${modalId.slice(-1)}` : modalId;
            closeModal(modals[modalKey]);
        });
    }
});
overlay.addEventListener('click', () => {
    Object.values(modals).forEach(modal => {
        if (modal.classList.contains('show')) closeModal(modal);
    });
});
document.querySelectorAll('.video-card').forEach(card => {
    card.addEventListener('click', () => {
        const videoId = card.dataset.video;
        closeModal(modals.video);
        openModal(modals[`videoPlayer${videoId}`]);
    });
});
document.querySelectorAll('.question-card .card-inner').forEach(card => {
    card.addEventListener('click', () => card.classList.toggle('flipped'));
});
resetTrainerBtn.addEventListener('click', () => {
    currentQuestion = 1;
    generateQuestion1();
    completionScreen.classList.add('hidden');
    trainerContent.style.display = 'block';
});
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
        Object.values(modals).forEach(modal => {
            if (modal.classList.contains('show')) closeModal(modal);
        });
    }
});
    </script>
</body>
</html>

