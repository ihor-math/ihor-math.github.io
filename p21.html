<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>21. Ранг матриці</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --base-font-size: 16px;
            --text-color: #FFFFFF;
            --math-color: #FFD700;
            --bg-gradient: linear-gradient(135deg, #1B263B, #2A9D8F);
            --bg-hover: linear-gradient(135deg, #2A9D8F, #E9C46A);
        }
        *, *:before, *:after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            min-height: 100dvh;
            font-size: 1rem;
        }
        .title-box {
            margin-top: 60px;
            padding: 25px 40px;
            background: var(--bg-gradient);
            border-radius: 25px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .title-box h1 {
            margin: 0;
            font-size: 1.75rem;
            color: var(--text-color);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            font-family: 'Lora', serif;
        }
        .section-container {
            margin-top: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .section {
            width: 250px;
            height: 220px;
            background: var(--bg-gradient);
            border-radius: 20px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: transform 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .section:hover {
            transform: translateY(-5px);
            background: var(--bg-hover);
        }
        .section img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            object-fit: cover;
            border-radius: 8px;
            filter: brightness(1.2);
        }
        .section h2 {
            font-size: 1.25rem;
            color: var(--text-color);
            margin: 0;
            font-family: 'Lora', serif;
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 40px auto;
            max-width: 1000px;
            padding: 0 20px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            background: var(--bg-gradient);
            color: var(--text-color);
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--text-color);
            line-height: 1.2;
        }
        .nav-button:hover {
            background: var(--bg-hover);
            color: var(--text-color);
            transform: scale(1.05);
        }
        .nav-button svg {
            margin-right: 8px;
            fill: currentColor;
            width: 20px;
            height: 20px;
        }

 .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: var(--bg-gradient);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
            flex-direction: column;
        }

      
        .modal-content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            background: var(--bg-gradient);
            border-radius: 10px;
            margin: 10px;
            width: 100%;
            color: var(--text-color);
        }
        #trainerModal .modal-content {
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            padding: 20px;
        }
        .modal-header {
            display: flex;
            justify-content: flex-end;
            background: var(--bg-gradient);
            padding: 8px 10px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
.close-btn {
            background: var(--text-color);
            color: #1A3C34;
            border: none;
            border-radius: 6px;
            padding: 5px 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }


        .close-btn:hover {
            background: #E9C46A;
        }
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .tab-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

.tab-button {
            background: var(--bg-gradient);
            color: var(--text-color);
             border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Lora', serif;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
}


.tab-button::after {
    content: '▶';
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1rem;
    color: var(--text-color);
    transition: transform 0.3s ease;
}

.tab-button.active::after {
    content: '▼';
    transform: translateY(-50%);
}

.tab-button.active {
    background: var(--bg-hover);
    color: #FFD700;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.tab-button:hover {
    background: var(--bg-hover);
    transform: translateY(-2px);
}
.tab-content {
            display: none;
            padding: 20px;
            border-radius: 10px;
            background: var(--bg-gradient);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.4);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            width: 100%;
            box-sizing: border-box;
        
        }

.tab-content.active {
    display: block;
    max-height: none; /* Видаляємо обмеження висоти */
    overflow-y: auto; /* Додаємо прокрутку, якщо потрібно */
}
        #theoryModal .modal-content p {
            text-align: justify;
            color: var(--text-color);
            font-size: 1.125rem;
            line-height: 1.6;
            white-space: normal;
        }
        #theoryModal .modal-content h3 {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: #FFA500; /* Помаранчевий для заголовків */
            margin-bottom: 15px;
            text-align: center;
        }
        #theoryModal .modal-content .example-title {
    color: #FFA500; /* Помаранчевий для "Приклад" */
    font-weight: bold;
    font-size: 1.25rem;
    margin-bottom: 10px;
}
#theoryModal .modal-content .example-solution {
    color: #FFA500; /* Помаранчевий для "Відповідь" */
    font-weight: bold;
    font-size: 1.125rem;
    text-align: left;
    margin: 15px 0;
}
#theoryModal .modal-content li {
            color: #ffd1dc;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
       
        .MathJax, mjx-container, mjx-math, mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        mjx-msub {
            font-size: 1.1em !important;
        }
        mjx-container[jax="CHTML"][display="true"] {
            display: block !important;
            text-align: center !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap;
            max-width: 100%;
            margin: 0 auto !important;
            padding: 5px;
            -webkit-overflow-scrolling: touch;
        }
        .flashcard-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .flashcard {
            perspective: 1000px;
            width: 100%;
            height: 200px;
            cursor: pointer;
            outline: none;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 15px;
            box-sizing: border-box;
            background: #4b5320;
            color: var(--text-color);
        }
       .flashcard-back {
    transform: rotateY(180deg);
    background: #4f7942;
    color: #ffd700;
    text-align: justify;   /* вирівнює текст по ширині */
}
   
        .flashcard-front p, .flashcard-back p {
    font-size: 1.4rem;
    margin: 0;
    font-family: 'Lora', serif;
    line-height: 1.5;
    text-align: center;
}

.flashcard-back p {
    font-family: 'Roboto', sans-serif;
    font-size: 1.4rem;
    line-height: 1.6;
    text-align: left;
    white-space: normal;
}
.flashcard-back li {
            color: #ffd700;
            padding-left: 20px;
            margin-left: 10px;
            max-width: calc(100% - 30px);
            white-space: normal;
            text-align: justify;
            position: relative;
            font-size: 1.125rem;
        }
        .trainer-container {
            width: 90%;
            max-width: 800px;
            padding: 3vw 4vw;
            text-align: left;
            background: var(--bg-gradient);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .question-circle {
            width: clamp(80px, 15vw, 120px);
            height: clamp(80px, 15vw, 120px);
            margin: 0 auto 3vw;
            border-radius: 50%;
            background: var(--bg-gradient);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .question-circle h3 {
            font-family: 'Lora', serif;
            font-size: clamp(1.0rem, 2.8vw, 1.2rem);
            color: var(--math-color);
            margin: 0;
            padding: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            text-align: center;
            line-height: 1;
        }
        #questionText {
            font-family: 'Lora', serif;
            font-size: 1.125rem;
            color: var(--text-color);
            line-height: 1.6;
            margin: 10px 0;
        }
        #questionText .MathJax, #questionText mjx-container, #questionText mjx-math, #questionText mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 20px 0;
            justify-items: center;
        }
        .answer-button {
            background: #264653;
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: 'Roboto', sans-serif;
            font-size: 1.25rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            width: 100%;
            max-width: 300px;
            text-align: center;
        }
        .answer-button:hover:not(:disabled) {
            background: #E9C46A;
            transform: scale(1.02);
        }
        .answer-button.selected {
            background: #2A9D8F;
        }
        .answer-button.correct {
            background: #2A9D8F;
        }
        .answer-button.wrong {
            background: #E76F51;
        }
        .answer-button:disabled {
            background: #7F8C8D;
            cursor: not-allowed;
        }
        .answer-button .MathJax, .answer-button mjx-container, .answer-button mjx-math, .answer-button mjx-mrow {
            color: var(--math-color) !important;
            font-size: 1.3rem !important;
        }
        #submitAnswerBtn {
            background: #7F8C8D;
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-family: 'Roboto', sans-serif;
            font-size: 1rem;
            cursor: not-allowed;
            transition: background 0.3s ease;
            margin: 10px auto;
            display: block;
        }
        #submitAnswerBtn.active {
            background: #2A9D8F;
            cursor: pointer;
        }
        #submitAnswerBtn.active:hover {
            background: #E9C46A;
        }
        .result-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-family: 'Lora', serif;
            font-weight: bold;
            text-align: center;
            padding: 20px 40px;
            border-radius: 12px;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 1001;
            display: none;
        }
        .result-message.correct {
            color: #2A9D8F;
            background: rgba(232, 245, 233, 0.95);
            opacity: 1;
        }
        .result-message.wrong {
            color: #E76F51;
            background: rgba(255, 235, 238, 0.95);
            opacity: 1;
        }
        .completion-emoji {
            width: clamp(80px, 15vw, 120px);
            height: clamp(80px, 15vw, 120px);
            margin: 0 auto 3vw;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            border: 2px dashed #E9C46A;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .completion-emoji::after {
            content: '🎉';
            font-size: clamp(40px, 8vw, 60px);
            color: var(--math-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .completion-message {
            display: none;
            text-align: center;
            padding: 20px;
            background: var(--bg-gradient);
            border-radius: 15px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
            max-width: 600px;
            color: var(--text-color);
        }
        .completion-message h2 {
            font-family: 'Lora', serif;
            font-size: 1.75rem;
            color: var(--math-color);
            text-align: center;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .completion-message p {
            font-family: 'Roboto', sans-serif;
            font-size: 1.5rem;
            color: var(--math-color);
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
        #resetTrainerBtn {
            display: block;
            margin: 20px auto;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            color: var(--text-color);
            background: #E76F51;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #resetTrainerBtn:hover {
            background: #F4A261;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        #resetTrainerBtn:active {
            transform: scale(0.95);
        }
        .video-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .video-card {
            width: 350px;
            height: 250px;
            background: var(--bg-gradient);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            color: var(--text-color);
        }
         .video-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        .video-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        .video-card img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            object-fit: cover;
            border-radius: 6px;
        }
        .video-player-container {
            width: 80vw;
            max-width: 960px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .video-player-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: block;
            border: none;
        }
        .video-card h3 {
            font-size: clamp(16px, 2.5vw, 18px);
            font-weight: 600;
            color: var(--text-color);
        }
        .glow-title {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            color: var(--math-color);
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        .math-loading {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .math-loaded {
            visibility: visible;
            opacity: 1;
        }
       .answer-select {
    background: #264653;
    color: var(--text-color);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    padding: 8px;
    font-family: 'Roboto', sans-serif;
    font-size: 1.2rem;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease;
    width: 100px; /* Зменшено ширину для компактності */
    margin-left: 5px; /* Зменшено відступ для наближення до r(A) */
}

.answer-select:hover:not(:disabled) {
    background: #E9C46A;
    transform: scale(1.02);
}

.answer-select:disabled {
    background: #7F8C8D;
    cursor: not-allowed;
}

.answer-options label {
    font-family: 'Lora', serif;
    font-size: 1.2rem;
    color: var(--math-color);
    margin-right: 5px; /* Зменшено відступ для компактності */
}

#matrixText {
    margin: 20px 0;
    font-size: 1.3rem;
    color: var(--math-color);
    text-align: center;
}

#matrixText mjx-container[jax="CHTML"][display="true"] {
    display: block !important;
    text-align: center !important;
    margin: 0 auto !important;
}

#submitAnswerBtn {
 background: #264653;
 color: var(--text-color);
 border: 1.5px solid #a855f7;
 border-radius: 8px;
 padding: 10px 20px;
 font-family: 'Roboto', sans-serif;
 font-size: 1.25rem;
 cursor: pointer;
 transition: background 0.3s ease, transform 0.2s ease, border-color 0.3s ease;
 margin: 10px auto;
 display: block;
}

#submitAnswerBtn:hover:not(:disabled) {
 background: #E9C46A;
 transform: scale(1.02);
}

#submitAnswerBtn:disabled {
 background: #7F8C8D;
 cursor: not-allowed;
}

#submitAnswerBtn:not(:disabled) {
 background: #4ade80;
 border-color: #FFD700;
}

        @media (max-width: 768px) {
            .title-box { margin-top: 40px; padding: 15px 20px; }
            .title-box h1 { font-size: 1.5rem; }
            .section-container { flex-direction: column; align-items: center; gap: 20px; }
            .section { width: 80%; height: 180px; }
            .section h2 { font-size: 1.125rem; }
            .nav-button { font-size: 0.9rem; padding: 8px 16px; }
            .tab-button { font-size: 1rem; padding: 8px 16px; }
            .tab-content { padding: 15px; }
            .modal { top: 2%; left: 2%; width: 96%; height: 96%; }
            .trainer-container { width: 95%; padding: 4vw; }
            .answer-options { grid-template-columns: 1fr; gap: 0.75rem; }
            .video-card-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            .video-card {
                width: 260px;
                height: 160px;
                margin: 5px;
            }
            .video-card img {
                width: 40px;
                height: 40px;
                margin-bottom: 6px;
            }
            .video-player-container {
                width: 80vw;
                max-width: 600px;
                aspect-ratio: 16 / 9;
            }
            .video-card h3 {
                font-size: clamp(14px, 2.5vw, 16px);
            }
            .flashcard-front p {
        font-size: 1.125rem; /* Зменшуємо до 18px */
    }

    .flashcard-back p {
        font-size: 1rem; /* Зменшуємо до 16px */
    }

    /* Опціонально: зменшуємо висоту картки для кращого вигляду на мобільних */
    .flashcard {
        height: 180px;
    }

    /* Опціонально: зменшуємо відступи для економії простору */
    .flashcard-front, .flashcard-back {
        padding: 15px;
    }
        }
        @media (max-width: 480px) {
            .title-box { margin-top: 20px; padding: 10px 15px; }
            .title-box h1 { font-size: 1.25rem; }
            .section { width: 90%; height: 150px; }
            .section img { width: 50px; height: 50px; }
            .section h2 { font-size: 1rem; }
            .video-card-container {
                gap: 10px;
                padding: 10px;
            }
            .video-card {
                width: 90%;
                max-width: 260px;
                height: 140px;
                margin: 5px;
            }
            .video-card img {
                width: 30px;
                height: 30px;
                margin-bottom: 5px;
            }
            .video-card h3 {
                font-size: clamp(12px, 2.5vw, 14px);
            }
            .video-player-container {
                width: 80vw;
                max-width: 400px;
                aspect-ratio: 16 / 9;
            }
            #theoryModal .modal-content h3 { font-size: 1.25rem; }
            .example-title { font-size: 1.0rem; }
            .example-solution { font-size: 1.0rem; }
            .MathJax, mjx-container, mjx-math, mjx-mrow { font-size: 1.0rem !important; }
            .question-circle { width: clamp(80px, 15vw, 100px); height: clamp(80px, 15vw, 100px); }
            .question-circle h3 { font-size: clamp(0.9rem, 2.5vw, 1.0rem); }
            #questionText { font-size: 1.0rem; }
            #questionText .MathJax, #questionText mjx-container, #questionText mjx-math, #questionText mjx-mrow { font-size: 1.1rem !important; }
            .answer-button { font-size: 1.0rem; }
        }
           .answer-select {
 font-size: 1rem;
 width: 80px;
 }
 .answer-options label {
 font-size: 1rem;
 }
 #matrixText {
 font-size: 1rem;
 }
 #submitAnswerBtn {
 font-size: 1rem;
 padding: 8px 16px;
 }
}
    </style>
</head>
<body>
    <div class="title-box">
        <h1>21. Ранг матриці</h1>
    </div>
     <div class="section-container">
        <div class="section" id="openTheoryBtn">
            <img src="https://img.icons8.com/fluency/96/book-shelf.png" alt="Книга">
            <h2>Теоретичні відомості</h2>
        </div>
        <div class="section" id="openVideoBtn">
            <img src="https://img.icons8.com/fluency/96/video.png" alt="Відео">
            <h2>Відеоматеріали</h2>
        </div>
        <div class="section" id="openQuestionsBtn">
            <img src="https://img.icons8.com/fluency/96/flipboard.png" alt="Картки">
            <h2>Питання і відповіді</h2>
        </div>
        <div class="section" id="openTrainerBtn">
            <img src="https://img.icons8.com/fluency/96/flash-on.png" alt="Тренажер">
            <h2>Тренажер</h2>
        </div>
    </div>
    
    <div class="navigation-buttons">
        <a class="nav-button" href="{{ url_for('tema5') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            До теми 5
        </a>
        <a class="nav-button" href="{{ url_for('home') }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            На головну
        </a>
    </div>
    
    <div id="modalOverlay"></div>
    
  <div id="theoryModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити документ" id="closeTheoryBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="tab-container">
            <button class="tab-button" data-tab="minors-cofactors" aria-expanded="false">Поняття рангу матриці та особливі випадки рангів матриць</button>
            <div id="minors-cofactors" class="tab-content">
                <p>Ранг матриці \( A \), який позначається як \( r(A) \) або \( \text{rang}(A) \), – це найбільший порядок її ненульових мінорів. Це означає, що серед усіх квадратних підматриць, отриманих із початкової матриці шляхом видалення певних рядків та/або стовпців, є хоча б одна підматриця найбільшого можливого порядку, визначник якої не дорівнює нулю. Числове значення цього порядку і є рангом матриці.</p>
            <h3>Особливі випадки рангів матриць.</h3>
                        <p>Ранг нульової матриці. Якщо всі елементи матриці дорівнюють нулю, то її ранг дорівнює нулю. Наприклад:</p>
            <p class="math-equation center">\[ \begin{pmatrix} 0 & 0 \\ 0 & 0 \end{pmatrix}, \quad \begin{pmatrix} 0 \\ 0 \\ 0 \end{pmatrix}, \quad \begin{pmatrix} 0 & 0 \end{pmatrix}, \quad \begin{pmatrix} 0 & 0 & 0 \\ 0 & 0 & 0 \end{pmatrix}, \quad \begin{pmatrix} 0 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 0 \end{pmatrix}, \quad \begin{pmatrix} 0 & 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 0 & 0 \end{pmatrix} .\]</p>
           <p>Така матриця називається нульовою, і її ранг завжди дорівнює нулю, незалежно від розміру. Це означає, що всі її мінори будь-якого порядку дорівнюють нулю.</p>
            <h3>Ранг ненульових матриць-рядків і матриць-стовпців.</h3>
            <p>Якщо в матриці є хоча б один ненульовий елемент, її ранг не може бути меншим за одиницю. Наприклад:</p>
           <p class="math-equation center">\[ \begin{pmatrix} 0 & 0 & 2 \end{pmatrix}, \quad \begin{pmatrix} 4 \\ 3 \\ 0 \\ 0 \end{pmatrix}, \quad \begin{pmatrix} -2 & 0 & 0 & 4 & -1 \end{pmatrix}, \quad \begin{pmatrix} 6 \\ 7 \end{pmatrix}, \quad \begin{pmatrix} 1 & 0 & 0 & 0 & 0 & 0 & 0 \end{pmatrix} \]</p>
             <p>У кожному з цих прикладів є хоча б один ненульовий елемент. Ранг будь-якої ненульової матриці-рядка або матриці-стовпця завжди дорівнює одиниці, оскільки така матриця містить лише один рядок або стовпець, і її найбільший ненульовий мінор – це один елемент, який не дорівнює нулю, тобто має порядок \( 1 \).</p>
            </div>
            <button class="tab-button" data-tab="determinant-expansion" aria-expanded="false">Методи обчислення рангу матриці</button>
            <div id="determinant-expansion" class="tab-content">
 <h3>За мінорами</h3>
            <p>Ранг матриці визначається як найбільший порядок її ненульових мінорів. Мінор – це визначник квадратної підматриці, утвореної з початкової матриці шляхом видалення певних рядків і/або стовпців. Щоб знайти ранг:</p>
            <ul>
                <li>Перевіряємо мінори максимального можливого порядку, який дорівнює меншій кількості рядків або стовпців матриці. Наприклад, для матриці розмірності \( m \times n \), максимальний порядок мінора – це число, що дорівнює меншому з \( m \) і \( n \).</li>
                <li>Якщо всі мінори цього порядку дорівнюють нулю, ранг матриці менший за цей порядок.</li>
                <li>Перевіряємо мінори на один порядок менші. Якщо хоча б один із них не дорівнює нулю, його порядок і є рангом матриці.</li>
                <li>Якщо всі мінори цього порядку також дорівнюють нулю, перевіряємо ще менші порядки, доки не знайдемо ненульовий мінор або поки не буде досягнуто порядку \( 1 .\)</li>
            </ul>
            <p>Для квадратної матриці найбільший можливий мінор – це визначник самої матриці. Якщо цей визначник не дорівнює нулю, ранг матриці дорівнює її порядку. Якщо ж він дорівнює нулю, процедура повторюється, як описано вище.</p>
            <h3>За допомогою елементарних перетворень</h3>
            <p>Для обчислення рангу матриці будь-якого розміру використовують елементарні перетворення, які спрощують матрицю до східчастого вигляду (тобто трикутного або трапецієподібного), де легко визначити кількість ненульових рядків. Ранг матриці дорівнює кількості таких рядків.</p>
            <p style="text-align: center; font-weight: bold;">
  Елементарні перетворення матриць включають:
</p>
            <ul>
                <li>Транспонування матриці – зміна місцями рядків і стовпців (хоч це і не завжди необхідне для обчислення рангу, але може бути корисним).</li>
                <li>Перестановка двох рядків (або стовпців) – змінюємо місцями будь-які два рядки або стовпці в матриці.</li>
                <li>Множення або ділення всіх елементів рядка (або стовпця) на довільне ненульове число \( \lambda \) – множимо або ділимо всі елементи певного рядка або стовпця на ненульове число.</li>
                <li>Додавання до всіх елементів рядка (або стовпця) відповідних елементів іншого рядка (або стовпця), помножених на одне й те ж число – до кожного елемента рядка або стовпця додаємо відповідний елемент іншого рядка або стовпця, помножений на певне число.</li>
            </ul>
<p style="text-align: center; font-weight: bold;">
 Позначення для елементарних перетворень
</p>
<p>Щоб скоротити записи та зробити їх більш компактними, будемо використовувати позначення \( R_1, R_2, R_3, \ldots \) для першого, другого, третього рядків матриці відповідно (від англійського слова Row – «рядок»). Наприклад, запис \( R_2 = R_2 - 4 \cdot R_1 \) означає, що елементи другого рядка оновлюються шляхом додавання до поточного другого рядка першого рядка, помноженого на \(-4\). Це позначення допоможе чітко описувати операції над рядками в прикладах і поясненнях.</p>
            <p>
  <span class="example-title">Приклад 15.14.</span> 
  Знайти ранг матриці \( A = \begin{pmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{pmatrix} \).
</p>
 <h3>Розв’язання</h3>
            <p>Задана матриця має три рядки, отже її найбільший можливий ранг не перевищує 3. Використаємо елементарні перетворення, щоб визначити кількість ненульових рядків.</p>
            <p><strong>Елементарні перетворення.</strong> До другого рядка додамо перший рядок, помножений на \(-4\):</p>
            <p class="math-equation center">\[ \begin{pmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{pmatrix} \xrightarrow{R_2 = R_2 - 4 \cdot R_1} \begin{pmatrix} 1 & 2 & 3 \\ 0 & -3 & -6 \\ 7 & 8 & 9 \end{pmatrix}. \]</p>
            <p>До третього рядка додамо перший рядок, помножений на \(-7\):</p>
            <p class="math-equation center">\[ \begin{pmatrix} 1 & 2 & 3 \\ 0 & -3 & -6 \\ 7 & 8 & 9 \end{pmatrix} \xrightarrow{R_3 = R_3 - 7 \cdot R_1} \begin{pmatrix} 1 & 2 & 3 \\ 0 & -3 & -6 \\ 0 & -6 & -12 \end{pmatrix}. \]</p>
            <p>Тепер до третього рядка додаємо другий рядок, помножений на \(-2\):</p>
            <p class="math-equation center">\[ \begin{pmatrix} 1 & 2 & 3 \\ 0 & -3 & -6 \\ 0 & -6 & -12 \end{pmatrix} \xrightarrow{R_3 = R_3 - 2 \cdot R_2} \begin{pmatrix} 1 & 2 & 3 \\ 0 & -3 & -6 \\ 0 & 0 & 0 \end{pmatrix}. \]</p>
            <p>У результаті залишилися два ненульові рядки. Отже, ранг матриці \( r(A) = 2 \).</p>
 <p style="text-align: center; font-weight: bold;">
 Альтернативний підхід
</p>
   
           <p> Ранг матриці визначається як найбільший порядок її ненульових мінорів. Обчислимо визначник матриці \( A \), тобто мінор третього порядку:</p>
            <p class="math-equation center">\[ |A| = \begin{vmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{vmatrix} = 0. \]</p>
            <p>Оскільки визначник дорівнює нулю, ранг матриці менший за 3. Перевіримо мінори другого порядку, обчисливши визначники підматриць розміру \( 2 \times 2 \). Один із таких мінорів:</p>
            <p class="math-equation center">\[ \begin{vmatrix} 1 & 2 \\ 4 & 5 \end{vmatrix} = 1 \cdot 5 - 2 \cdot 4 = 5 - 8 = -3 \neq 0. \]</p>
            <p>Оскільки знайдено ненульовий мінор другого порядку, можна зробити висновок, що \( r(A) = 2 \).</p>
           <p><strong>Зауваження.</strong> <em>Такий спосіб знаходження рангу є досить громіздким для матриць вищих порядків, оскільки обчислення всіх мінорів може бути дуже затратним за часом.</em></p>
 <p class="example-solution">Відповідь: \( r(A) = 2 \).</p>
            <p><span class="example-title">Приклад 5.15.</span> Знайти ранг матриці за допомогою елементарних перетворень:</p>

<p class="math-equation center">\[ A = \begin{pmatrix} 3 & 1 & -1 & -2 & 8 \\ -1 & 1 & -2 & -1 & 2 \\ -3 & 2 & 3 & 0 & 6 \\ 2 & -3 & 13 & 5 & -4 \end{pmatrix}. \]</p>
 <h3>Розв’язання</h3>
            <p>Матриця має розмір \( 4 \times 5 \), тому максимальний ранг \( r(A) \leq 4 \). Використаємо елементарні перетворення, щоб привести матрицю до східчастого вигляду та визначити кількість ненульових рядків.</p>
            <p>Оскільки у нас є елемент \(-1\) у другому рядку, поміняємо місцями перший і другий рядки, оскільки з \(-1\) зручніше працювати:</p>
            <p class="math-equation center">\[ \begin{pmatrix} 3 & 1 & -1 & -2 & 8 \\ -1 & 1 & -2 & -1 & 2 \\ -3 & 2 & 3 & 0 & 6 \\ 2 & -3 & 13 & 5 & -4 \end{pmatrix} \xrightarrow{R_1 \leftrightarrow R_2} \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 3 & 1 & -1 & -2 & 8 \\ -3 & 2 & 3 & 0 & 6 \\ 2 & -3 & 13 & 5 & -4 \end{pmatrix}. \]</p>
            <p>Тепер виконаємо наступні елементарні перетворення:</p>
            <p class="math-equation center">\[ \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 3 & 1 & -1 & -2 & 8 \\ -3 & 2 & 3 & 0 & 6 \\ 2 & -3 & 13 & 5 & -4 \end{pmatrix} \xrightarrow{\begin{array}{c} R_2 = R_2 + 3 \cdot R_1 \\ R_3 = R_3 - 3 \cdot R_1 \\ R_4 = R_4 + 2 \cdot R_1 \end{array}} \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 0 & 4 & -7 & -5 & 14 \\ 0 & -1 & 9 & 3 & 0 \\ 0 & -1 & 9 & 3 & 0 \end{pmatrix}. \]</p>
            <p>Спостерігаємо, що третій і четвертий рядки пропорційні, тому можна видалити четвертий рядок та поміняємо місцями другий і третій рядки:</p>
            <p class="math-equation center">\[ \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 0 & 4 & -7 & -5 & 14 \\ 0 & -1 & 9 & 3 & 0 \\ 0 & -1 & 9 & 3 & 0 \end{pmatrix} \xrightarrow{R_2 \leftrightarrow R_3} \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 0 & -1 & 9 & 3 & 0 \\ 0 & 4 & -7 & -5 & 14 \\ 0 & -1 & 9 & 3 & 0 \end{pmatrix}. \]</p>
            <p>Виконаємо перетворення:</p>
            <p class="math-equation center">\[ \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 0 & -1 & 9 & 3 & 0 \\ 0 & 4 & -7 & -5 & 14 \\ 0 & -1 & 9 & 3 & 0 \end{pmatrix} \xrightarrow{R_3 = R_3 + 4 \cdot R_2} \begin{pmatrix} -1 & 1 & -2 & -1 & 2 \\ 0 & -1 & 9 & 3 & 0 \\ 0 & 0 & 29 & 7 & 14 \\ 0 & -1 & 9 & 3 & 0 \end{pmatrix}. \]</p>
            <p>Отже, ми отримали матрицю в східчастому вигляді, де три рядки є ненульовими. Таким чином, ранг матриці \( A \) дорівнює 3.</p>
            <p class="example-solution">Відповідь: \( r(A) = 3 \).</p>
             </div>
        </div>
    </div>
</div>

<div id="videoModal" class="modal">
        <div class="modal-header">
            <button class="close-btn" id="closeVideoBtn">× Закрити</button>
        </div>
        <div class="modal-content">
            <h2 class="glow-title">Оберіть відео</h2>
            <div class="video-card-container">
                <div class="video-card" data-video="1">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Ранг матриці і його обчислення за мінорами</h3>
                </div>
                <div class="video-card" data-video="2">
                    <img src="https://img.icons8.com/?size=100&id=o1CR3NjO7Pv8&format=png&color=000000" alt="Відеокамера">
                    <h3>Ранг матриці і його обчислення методом елементарних перетворень</h3>
                </div>
                            </div>
        </div>
    </div>



<!-- Video Player Modals -->
<div id="videoPlayerModal1" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn1" aria-label="Закрити">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer1" width="100%" data-src="https://www.youtube.com/embed/rA1gZ02UrqI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<div id="videoPlayerModal2" class="modal">
    <div class="modal-header">
        <button class="close-btn" id="closeVideoPlayerBtn2" aria-label="Закрити">× Закрити</button>
    </div>
    <div class="modal-content">
        <div class="video-player-container">
            <iframe id="youtubePlayer2" width="100%" data-src="https://www.youtube.com/embed/UdjuNWkGExk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>


<div id="questionsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="questionsTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити питання" id="closeQuestionsBtn">× Закрити</button>
    </div>
    <div class="modal-content">
                <div class="flashcard-container">
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>1. Що таке ранг матриці?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Ранг матриці — це найбільший порядок її ненульового мінора, тобто найбільший розмір квадратної підматриці з ненульовим визначником.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>2. Який ранг нульової матриці?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Ранг нульової матриці завжди дорівнює 0, незалежно від її розміру.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>3. Який ранг матриці-рядка або матриці-стовпця, якщо в ній є ненульовий елемент?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Така матриця завжди має ранг 1, бо її найбільший ненульовий мінор — це окремий елемент.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>4. Як обчислюють ранг матриці за допомогою мінорів?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Перевіряють мінори від найбільшого можливого порядку до найменшого і знаходять найбільший ненульовий.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>5. Як обчислюють ранг матриці за допомогою елементарних перетворень?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Матрицю зводять до східчастого вигляду, після чого ранг дорівнює кількості ненульових рядків.</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>6. Які елементарні перетворення застосовують для знаходження рангу?</p>
                    </div>
                    <div class="flashcard-back">
                        
                            <ul>
                                <li>Перестановка рядків (або стовпців).</li>
                                <li>Множення рядка на ненульове число.</li>
                                <li>Додавання до одного рядка іншого, помноженого на число.</li>
                            </ul>
                        
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>7. Як пов’язані визначник і ранг квадратної матриці?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Якщо визначник квадратної матриці розміру \( n \) відмінний від нуля, то ранг дорівнює \( n \). Якщо визначник дорівнює нулю — ранг менший за \( n \).</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>8. Який максимальний можливий ранг матриці розміру \( m \times n \)?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Максимальний ранг дорівнює \( \min(m, n) \).</p>
                    </div>
                </div>
            </div>
            <div class="flashcard" tabindex="0" role="button" aria-expanded="false">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p>9. Чому метод мінорів на практиці майже не використовують для великих матриць?</p>
                    </div>
                    <div class="flashcard-back">
                        <p>Тому що потрібно обчислювати дуже багато визначників, що є громіздким і затратним за часом.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  <div id="trainerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="trainerTitle">
    <div class="modal-header">
        <button class="close-btn" aria-label="Закрити тренажер" id="closeTrainerBtn">× Закрити</button>
    </div>
    <div class="modal-content">
        
        <div class="trainer-container">
            <div id="questionText">Визначте ранг матриці \( A \):</div>
            <div id="matrixText"></div>
            <div class="answer-options">
                <label for="rankSelect">\( r(A) = \)</label>
                <select id="rankSelect" class="answer-select">
                    <option value="" disabled selected>Оберіть ранг</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>
            <button id="submitAnswerBtn" disabled>Відповісти</button>
            <div class="result-message" id="resultMessage"></div>
            <div class="completion-message" id="completionMessage">
                <div class="completion-emoji"></div>
                    <h2>Тренування завершено!</h2>
                    <p>Молодець!</p>
                    <button id="resetTrainerBtn">Спробувати ще раз</button>
            </div>
        </div>
    </div>
</div>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    console.log('Сторінка завантажена');
    document.body.classList.add('loaded');

    // Ініціалізація всіх елементів
    const elements = {
        openTheoryBtn: document.getElementById('openTheoryBtn'),
        openVideoBtn: document.getElementById('openVideoBtn'),
        openQuestionsBtn: document.getElementById('openQuestionsBtn'),
        openTrainerBtn: document.getElementById('openTrainerBtn'),
        theoryModal: document.getElementById('theoryModal'),
        videoModal: document.getElementById('videoModal'),
        questionsModal: document.getElementById('questionsModal'),
        trainerModal: document.getElementById('trainerModal'),
        closeTheoryBtn: document.getElementById('closeTheoryBtn'),
        closeVideoBtn: document.getElementById('closeVideoBtn'),
        closeQuestionsBtn: document.getElementById('closeQuestionsBtn'),
        closeTrainerBtn: document.getElementById('closeTrainerBtn'),
        closeVideoPlayerBtn1: document.getElementById('closeVideoPlayerBtn1'),
        closeVideoPlayerBtn2: document.getElementById('closeVideoPlayerBtn2'),
        videoPlayerModal1: document.getElementById('videoPlayerModal1'),
        videoPlayerModal2: document.getElementById('videoPlayerModal2'),
        modalOverlay: document.getElementById('modalOverlay'),
        questionText: document.getElementById('questionText'),
        matrixText: document.getElementById('matrixText'),
        rankSelect: document.getElementById('rankSelect'),
        submitAnswerBtn: document.getElementById('submitAnswerBtn'),
        resultMessage: document.getElementById('resultMessage'),
        completionMessage: document.getElementById('completionMessage'),
        resetTrainerBtn: document.getElementById('resetTrainerBtn'),
        youtubePlayer1: document.getElementById('youtubePlayer1'),
        youtubePlayer2: document.getElementById('youtubePlayer2')
    };

    // Перевірка наявності всіх елементів
    console.log("Перевірка DOM-елементів:");
    for (const [key, value] of Object.entries(elements)) {
        if (!value) console.error(`Елемент з ID ${key} не знайдено`);
        else console.log(`Елемент ${key} знайдено`);
    }

    // Управління вкладками в #theoryModal
    const tabButtons = elements.theoryModal?.querySelectorAll('.tab-button');
    const tabContents = elements.theoryModal?.querySelectorAll('.tab-content');

    function closeAllTabs() {
        tabButtons?.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-expanded', 'false');
            console.log(`Кнопка ${btn.getAttribute('data-tab')} деактивована`);
        });
        tabContents?.forEach(content => {
            content.classList.remove('active');
            console.log(`Вкладка ${content.id} закрита`);
        });
    }

    function toggleTab(tabId, button) {
        const targetContent = elements.theoryModal?.querySelector(`#${tabId}`);
        if (!targetContent) {
            console.error(`Вкладка з ID ${tabId} не знайдена`);
            return;
        }

        const isActive = button.classList.contains('active');
        closeAllTabs();

        if (!isActive) {
            button.classList.add('active');
            button.setAttribute('aria-expanded', 'true');
            targetContent.classList.add('active');
            console.log(`Вкладка ${tabId} відкрита`);
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([targetContent]).then(() => {
                    console.log(`MathJax оновлено для вкладки ${tabId}`);
                    const modalContent = elements.theoryModal?.querySelector('.modal-content');
                    if (modalContent) modalContent.scrollTop = 0;
                }).catch(err => console.error('Помилка MathJax:', err));
            }
        }
    }

    tabButtons?.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.getAttribute('data-tab');
            console.log(`Клік на вкладку: ${tabId}`);
            toggleTab(tabId, button);
        });
    });

    closeAllTabs();

    // YouTube API для відео
    let players = {};
    const playerIds = {
        'youtubePlayer1': 'rA1gZ02UrqI',
        'youtubePlayer2': 'UdjuNWkGExk'
    };

    const playerSrcs = {
        'youtubePlayer1': elements.youtubePlayer1?.getAttribute('data-src') || '',
        'youtubePlayer2': elements.youtubePlayer2?.getAttribute('data-src') || ''
    };

    function loadYouTubeAPI() {
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            console.log('Завантажується YouTube API');
        }
    }

    window.onYouTubeIframeAPIReady = function() {
        Object.keys(playerIds).forEach(playerId => {
            const element = elements[playerId];
            if (element) {
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => {
                            console.log(`YouTube плеєр ${playerId} готовий`);
                            event.target.cueVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
                        },
                        'onError': error => console.error(`Помилка YouTube плеєра ${playerId}:`, error)
                    }
                });
            }
        });
    };

    loadYouTubeAPI();

    function stopAllVideos() {
        Object.keys(players).forEach(playerId => {
            const player = players[playerId];
            const element = elements[playerId];
            if (player && typeof player.stopVideo === 'function') {
                try {
                    player.stopVideo();
                    console.log(`Зупинено відео через API: ${playerId}`);
                } catch (e) {
                    console.error(`Помилка при зупинці відео ${playerId}:`, e);
                }
            }
            if (element) {
                element.src = '';
                console.log(`Очищено src для ${playerId}`);
                const parent = element.parentNode;
                const newIframe = document.createElement('iframe');
                newIframe.id = playerId;
                newIframe.className = element.className;
                newIframe.setAttribute('data-src', playerSrcs[playerId]);
                newIframe.setAttribute('frameborder', '0');
                newIframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
                newIframe.setAttribute('allowfullscreen', '');
                parent.replaceChild(newIframe, element);
                elements[playerId] = newIframe;
                console.log(`Замінено iframe для ${playerId}`);
                players[playerId] = new YT.Player(playerId, {
                    videoId: playerIds[playerId],
                    playerVars: { 'autoplay': 0, 'controls': 1, 'rel': 0, 'showinfo': 0 },
                    events: {
                        'onReady': event => console.log(`YouTube плеєр ${playerId} переініціалізовано`),
                        'onError': error => console.error(`Помилка YouTube плеєра ${playerId}:`, error)
                    }
                });
            }
        });
    }

    function openVideoPlayerModal(videoModal, playerId) {
        stopAllVideos();
        toggleModal(elements.videoModal, false);
        toggleModal(videoModal, true);
        const element = elements[playerId];
        if (element && !element.src) {
            element.src = playerSrcs[playerId];
            console.log(`Відновлено src для ${playerId}: ${element.src}`);
        }
        if (players[playerId] && typeof players[playerId].loadVideoById === 'function') {
            try {
                players[playerId].loadVideoById({ videoId: playerIds[playerId], startSeconds: 0 });
                console.log(`Завантаження відео: ${playerId} з videoId ${playerIds[playerId]}`);
            } catch (e) {
                console.error(`Помилка при завантаженні відео ${playerId}:`, e);
            }
        }
    }

    // Функція для перемикання модальних вікон
    function toggleModal(modal, show) {
        if (!modal) {
            console.error('Модальне вікно не знайдено');
            return;
        }
        console.log(`toggleModal викликано для ${modal.id}, show: ${show}`);
        const allModals = [
            elements.theoryModal,
            elements.videoModal,
            elements.questionsModal,
            elements.trainerModal,
            elements.videoPlayerModal1,
            elements.videoPlayerModal2
        ].filter(Boolean);
        allModals.forEach(m => {
            if (m && m !== modal) {
                m.style.display = 'none';
                console.log(`Закрито модальне вікно ${m.id}`);
            }
        });
        modal.style.display = show ? 'flex' : 'none';
        elements.modalOverlay.style.display = show ? 'block' : 'none';
        document.body.style.overflow = show ? 'hidden' : 'auto';
        if (show) {
            const closeBtn = modal.querySelector('.close-btn');
            if (closeBtn) {
                closeBtn.focus();
                console.log(`Фокус встановлено на close-btn у ${modal.id}`);
            }
            if (modal === elements.theoryModal) closeAllTabs();
            if (modal === elements.trainerModal) {
                currentMatrixIndex = 0;
                initializeMatrices();
                displayMatrix();
            }
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([modal]).then(() => {
                    console.log(`MathJax типізація завершена для ${modal.id}`);
                    const modalContent = modal.querySelector('.modal-content');
                    if (modalContent) modalContent.scrollTop = 0;
                }).catch(err => console.error('Помилка MathJax:', err));
            }
        }
    }

    // Обробники для модальних вікон
    elements.openTheoryBtn?.addEventListener('click', () => {
        console.log('Клік на openTheoryBtn');
        toggleModal(elements.theoryModal, true);
    });
    elements.openVideoBtn?.addEventListener('click', () => {
        console.log('Клік на openVideoBtn');
        toggleModal(elements.videoModal, true);
    });
    elements.openQuestionsBtn?.addEventListener('click', () => {
        console.log('Клік на openQuestionsBtn');
        toggleModal(elements.questionsModal, true);
    });
    elements.openTrainerBtn?.addEventListener('click', () => {
        console.log('Клік на openTrainerBtn');
        toggleModal(elements.trainerModal, true);
    });

    elements.closeTheoryBtn?.addEventListener('click', () => {
        console.log('Клік на closeTheoryBtn');
        toggleModal(elements.theoryModal, false);
    });
    elements.closeVideoBtn?.addEventListener('click', () => {
        console.log('Клік на closeVideoBtn');
        toggleModal(elements.videoModal, false);
    });
    elements.closeQuestionsBtn?.addEventListener('click', () => {
        console.log('Клік на closeQuestionsBtn');
        toggleModal(elements.questionsModal, false);
    });
    elements.closeTrainerBtn?.addEventListener('click', () => {
        console.log('Клік на closeTrainerBtn');
        toggleModal(elements.trainerModal, false);
    });

    elements.closeVideoPlayerBtn1?.addEventListener('click', () => {
        console.log('Клік на closeVideoPlayerBtn1');
        stopAllVideos();
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoModal, true);
    });
    elements.closeVideoPlayerBtn2?.addEventListener('click', () => {
        console.log('Клік на closeVideoPlayerBtn2');
        stopAllVideos();
        toggleModal(elements.videoPlayerModal2, false);
        toggleModal(elements.videoModal, true);
    });

    elements.modalOverlay?.addEventListener('click', () => {
        console.log('Клік на modalOverlay');
        stopAllVideos();
        toggleModal(elements.theoryModal, false);
        toggleModal(elements.videoModal, false);
        toggleModal(elements.questionsModal, false);
        toggleModal(elements.trainerModal, false);
        toggleModal(elements.videoPlayerModal1, false);
        toggleModal(elements.videoPlayerModal2, false);
    });

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            console.log('Натиснуто Escape');
            stopAllVideos();
            toggleModal(elements.theoryModal, false);
            toggleModal(elements.videoModal, false);
            toggleModal(elements.questionsModal, false);
            toggleModal(elements.trainerModal, false);
            toggleModal(elements.videoPlayerModal1, false);
            toggleModal(elements.videoPlayerModal2, false);
        }
    });

    // Обробка перевертання карток
    document.querySelectorAll('.flashcard').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('flipped');
            console.log(`Картка ${card.querySelector('.flashcard-front p').textContent} перевернута: ${card.classList.contains('flipped')}`);
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([card]).catch(err => console.error('Помилка MathJax:', err));
            }
        });
        card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.classList.toggle('flipped');
                console.log(`Картка ${card.querySelector('.flashcard-front p').textContent} перевернута через клавіатуру: ${card.classList.contains('flipped')}`);
                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([card]).catch(err => console.error('Помилка MathJax:', err));
                }
            }
        });
    });

    // Обробка відео-карток
    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', () => {
            const videoNumber = card.getAttribute('data-video');
            const videoModal = elements[`videoPlayerModal${videoNumber}`];
            const playerId = `youtubePlayer${videoNumber}`;
            if (videoModal && playerId) openVideoPlayerModal(videoModal, playerId);
            else console.error(`Відео модальне вікно або playerId для video${videoNumber} не знайдено`);
        });
    });

    // Функція для генерації випадкового цілого числа
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Функція для перетворення матриці в LaTeX
    function matrixToLatex(matrix, rows, cols) {
        let latex = '\\begin{pmatrix} ';
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                latex += matrix[i][j];
                if (j < cols - 1) latex += ' & ';
            }
            if (i < rows - 1) latex += ' \\\\ ';
        }
        latex += ' \\end{pmatrix}';
        return latex;
    }

    // Функція для обчислення рангу матриці
    function calculateMatrixRank(matrix, rows, cols) {
        let m = matrix.map(row => [...row]);
        let rank = 0;
        let lead = 0;

        for (let r = 0; r < rows && lead < cols; r++) {
            let pivot = m[r][lead];
            let pivotRow = r;

            for (let i = r + 1; i < rows; i++) {
                if (Math.abs(m[i][lead]) > Math.abs(pivot)) {
                    pivot = m[i][lead];
                    pivotRow = i;
                }
            }

            if (Math.abs(pivot) < 1e-10) {
                lead++;
                continue;
            }

            if (pivotRow !== r) {
                [m[r], m[pivotRow]] = [m[pivotRow], m[r]];
            }

            for (let j = lead; j < cols; j++) {
                m[r][j] /= pivot;
            }

            for (let i = 0; i < rows; i++) {
                if (i !== r) {
                    let factor = m[i][lead];
                    for (let j = lead; j < cols; j++) {
                        m[i][j] -= factor * m[r][j];
                    }
                }
            }

            rank++;
            lead++;
        }

        return rank;
    }

    // Функція для генерації матриці
    function generateMatrix(type, attempts = 0, targetRank = null) {
        let rows, cols, maxRank;
        let matrix = [];

        switch (type) {
            case 0: rows = 2; cols = 2; maxRank = 2; break;
            case 1: rows = 2; cols = 4; maxRank = 2; break;
            case 2: rows = 3; cols = 3; maxRank = 3; break;
            case 3: rows = 3; cols = 4; maxRank = 3; break;
            case 4: rows = 4; cols = 4; maxRank = 4; break;
        }

        let possibleRanks;
        if (targetRank === null) {
            if (type === 0 || type === 1) {
                possibleRanks = [0,1,2];
            } else if (type === 2 || type === 3) {
                possibleRanks = [0,0,1,2,3,3];
            } else if (type === 4) {
                possibleRanks = [0,0,0,1,2,3,4,4,4];
            }
            targetRank = possibleRanks[getRandomInt(0, possibleRanks.length - 1)];
        }
        console.log(`Генерація матриці типу ${type} з цільовим рангом ${targetRank}`);

        matrix = Array(rows).fill().map(() => Array(cols).fill(0));

        if (targetRank === 0) {
            console.log(`Повертаємо нульову матрицю для типу ${type}`);
            return { matrix, rows, cols, correct: '0' };
        }

        // Заповнюємо перші targetRank рядків випадковими числами
        for (let i = 0; i < targetRank && i < rows; i++) {
            let nonZero = false;
            for (let j = 0; j < cols; j++) {
                matrix[i][j] = getRandomInt(-9, 9);
                if (matrix[i][j] !== 0) nonZero = true;
            }
            // Гарантуємо, що рядок не нульовий
            if (!nonZero) {
                matrix[i][getRandomInt(0, cols - 1)] = getRandomInt(1, 9) * (Math.random() > 0.5 ? 1 : -1);
            }
        }

        // Решта рядків є лінійними комбінаціями попередніх
        for (let i = targetRank; i < rows; i++) {
            let coefficients = Array(targetRank).fill().map(() => getRandomInt(-5, 5));
            // Гарантуємо, що коефіцієнти не всі нульові
            if (coefficients.every(c => c === 0)) {
                coefficients[getRandomInt(0, targetRank - 1)] = getRandomInt(1, 5) * (Math.random() > 0.5 ? 1 : -1);
            }
            for (let j = 0; j < cols; j++) {
                matrix[i][j] = 0;
                for (let k = 0; k < targetRank && k < rows; k++) {
                    matrix[i][j] += coefficients[k] * matrix[k][j];
                }
                matrix[i][j] = Math.round(matrix[i][j]);
            }
        }

        // Перевірка рангу
        let rank = calculateMatrixRank(matrix, rows, cols);
        console.log(`Згенерована матриця типу ${type}:`, matrix, `Обчислений ранг: ${rank}, цільовий ранг: ${targetRank}`);

        if (rank !== targetRank && attempts < 10) {
            console.log(`Ранг ${rank} не відповідає цільовому ${targetRank} для типу ${type}, повторна генерація, спроба ${attempts + 1}`);
            return generateMatrix(type, attempts + 1, targetRank);
        }

        if (attempts >= 10) {
            console.error(`Не вдалося згенерувати матрицю типу ${type} з рангом ${targetRank} після 10 спроб`);
            return { matrix, rows, cols, correct: rank.toString() };
        }

        return { matrix, rows, cols, correct: rank.toString() };
    }

    // Пул матриць
    const matrixPool = [
        { generate: () => generateMatrix(0) },
        { generate: () => generateMatrix(1) },
        { generate: () => generateMatrix(2) },
        { generate: () => generateMatrix(3) },
        { generate: () => generateMatrix(4) }
    ];

    let matrices = [];
    let currentMatrixIndex = 0;
    let selectedRank = null;

    // Ініціалізація матриць
    function initializeMatrices() {
        matrices = matrixPool.map(pool => pool.generate());
        console.log("Матриці ініціалізовано:", matrices.map(m => ({ matrix: m.matrix, rank: m.correct })));
    }

    // Відображення матриці
    function displayMatrix() {
        if (!elements.questionText || !elements.matrixText || !elements.rankSelect || !elements.submitAnswerBtn || !elements.completionMessage) {
            console.error('Не вистачає елементів для відображення матриці');
            return;
        }

        selectedRank = null;
        elements.rankSelect.value = '';
        elements.submitAnswerBtn.disabled = true;
        elements.submitAnswerBtn.classList.remove('active');
        elements.resultMessage.style.opacity = '0';
        elements.resultMessage.className = 'result-message';
        elements.completionMessage.style.display = 'none';
        elements.questionText.innerHTML = 'Визначте ранг матриці \\( A \\):';
        elements.matrixText.innerHTML = `\\( A = ${matrixToLatex(matrices[currentMatrixIndex].matrix, matrices[currentMatrixIndex].rows, matrices[currentMatrixIndex].cols)} \\)`;
        elements.questionText.style.display = 'block';
        elements.matrixText.style.display = 'block';
        elements.rankSelect.parentElement.style.display = 'flex';
        elements.submitAnswerBtn.style.display = 'block';

        console.log(`Відображається матриця ${currentMatrixIndex + 1} (${matrices[currentMatrixIndex].rows}×${matrices[currentMatrixIndex].cols}), правильний ранг: ${matrices[currentMatrixIndex].correct}`);

        if (window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([elements.questionText, elements.matrixText]).then(() => {
                console.log(`MathJax типізація завершена для матриці ${currentMatrixIndex + 1}`);
                elements.rankSelect.focus();
            }).catch(err => console.error('Помилка MathJax:', err));
        }
    }

    // Обробка вибору рангу
    elements.rankSelect?.addEventListener('change', e => {
        selectedRank = e.target.value;
        elements.submitAnswerBtn.disabled = !selectedRank;
        elements.submitAnswerBtn.classList.toggle('active', !!selectedRank);
        console.log(`Вибрано ранг: ${selectedRank}, кнопка активна: ${!elements.submitAnswerBtn.disabled}`);
    });

    // Обробка підтвердження відповіді
    elements.submitAnswerBtn?.addEventListener('click', () => {
        if (!selectedRank || elements.submitAnswerBtn.disabled) {
            console.log(`Кнопка неактивна або ранг не вибрано: selectedRank=${selectedRank}, disabled=${elements.submitAnswerBtn.disabled}`);
            return;
        }

        const currentMatrix = matrices[currentMatrixIndex];
        const isCorrect = selectedRank === currentMatrix.correct;
        const message = isCorrect ? '✓ Правильно! Молодець!' : '✗ Неправильно. Спробуй ще раз!';
        elements.resultMessage.textContent = message;
        elements.resultMessage.className = `result-message ${isCorrect ? 'correct' : 'wrong'}`;
        elements.resultMessage.style.display = 'block';
        elements.resultMessage.style.opacity = '1';

        console.log(`Матриця ${currentMatrixIndex + 1}, вибрано ранг: ${selectedRank}, правильний ранг: ${currentMatrix.correct}, результат: ${isCorrect}`);

        setTimeout(() => {
            elements.resultMessage.style.opacity = '0';
            setTimeout(() => {
                elements.resultMessage.style.display = 'none';
                if (isCorrect) {
                    if (currentMatrixIndex < matrixPool.length - 1) {
                        currentMatrixIndex++;
                        console.log(`Перехід до наступної матриці: ${currentMatrixIndex + 1}`);
                        displayMatrix();
                    } else {
                        console.log('Остання матриця, тренування завершено');
                        elements.questionText.style.display = 'none';
                        elements.matrixText.style.display = 'none';
                        elements.rankSelect.parentElement.style.display = 'none';
                        elements.submitAnswerBtn.style.display = 'none';
                        elements.completionMessage.style.display = 'block';
                        const completionText = elements.completionMessage.querySelector('#completionText');
                        if (completionText) {
                            completionText.textContent = 'Тренування завершено! Молодець!';
                        } else {
                            console.error('Елемент #completionText не знайдено');
                        }
                        elements.resetTrainerBtn.focus();
                        console.log('Фокус встановлено на resetTrainerBtn');
                        if (window.MathJax && MathJax.typesetPromise) {
                            MathJax.typesetPromise([elements.completionMessage]).catch(err => console.error('Помилка MathJax:', err));
                        }
                    }
                } else {
                    console.log(`Неправильна відповідь для матриці ${currentMatrixIndex + 1}`);
                    selectedRank = null;
                    elements.rankSelect.value = '';
                    elements.submitAnswerBtn.disabled = true;
                    elements.submitAnswerBtn.classList.remove('active');
                    elements.rankSelect.focus();
                }
            }, 500);
        }, 3000);
    });

    // Скидання тренажера
    elements.resetTrainerBtn?.addEventListener('click', () => {
        console.log('Кнопка скидання натиснута');
        currentMatrixIndex = 0;
        initializeMatrices();
        displayMatrix();
    });
});
    </script>
</body>
</html>
